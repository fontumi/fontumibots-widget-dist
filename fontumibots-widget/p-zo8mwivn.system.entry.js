var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r["throw"](e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return u([e,t])}}function u(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};System.register(["./p-80505f91.system.js"],function(e){"use strict";var t,n,r;return{setters:[function(e){t=e.r;n=e.c;r=e.h}],execute:function(){var i=this;function o(e){var t,n,r,i;if(e.match(/^rgb/)){e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);t=e[1];n=e[2];r=e[3]}else{e=+("0x"+e.slice(1).replace(e.length<5&&/./g,"$&$&"));t=e>>16;n=e>>8&255;r=e&255}i=Math.sqrt(.299*(t*t)+.587*(n*n)+.114*(r*r));return i>127.5?"light":"dark"}function a(e){var t=o(e);return t==="dark"?"white":"black"}var s=function(){function e(e){var r=this;t(this,e);this.opened=false;this.toggleOpened=function(){r.opened=!r.opened;r.toggleEvent.emit(r.opened)};this.toggleEvent=n(this,"toggled",7)}e.prototype.render=function(){console.log(this.color);return r("div",{id:"fontumibots-bubble-button",style:{background:this.color},onClick:this.toggleOpened},this.opened?r("fontumibots-icon-close",{height:20,width:20,fill:a(this.color)}):r("fontumibots-icon-messages",{height:20,width:20,fill:a(this.color)}))};Object.defineProperty(e,"style",{get:function(){return"#fontumibots-bubble-button{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;-webkit-box-shadow:var(--fontumibots-shadow);box-shadow:var(--fontumibots-shadow);border-radius:50%;position:absolute;height:55px;width:55px;bottom:var(--fontumibots-chat-borders);right:var(--fontumibots-chat-borders);z-index:var(--fontumibots-z-index);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}"},enumerable:true,configurable:true});return e}();e("fontumibots_bubble_button",s);var u=function(){function e(e,t,n,r){this.id=e;this.name=t;this.title=n;this.values=r}e.prototype.props=function(){return this.values.property};e.prototype.question=function(){var e;switch(this.name){case"end":{e="goodbye_text";break}case"start":{e="welcome_text";break}default:{e="question";break}}var t=this.values.property[e].value||"";return{type:this.name,value:t}};return e}();var c=function(){function e(e,t,n,r,i){this.id=e;this.originID=t;this.originSlot=n;this.targetID=r;this.targetSlot=i}return e}();var l=function(){function e(e,t){var n=this;this.blocks=[];this.links=[];t.map(function(e){return n.blocks.push(new u(e.id,e.name,e.title,e.values))});e.map(function(e){return n.links.push(new c(e.id,e.originID,e.originSlot,e.targetID,e.targetSlot))});this.startBlock=this.blockByName("start")[0];this.actualBlock=this.startBlock}e.prototype.blockByName=function(e){return this.blocks.filter(function(t){return t.name===e})};e.prototype.blockById=function(e){return this.blocks.find(function(t){return t.id===e})};e.prototype.next=function(e){var t=this;if(e===void 0){e=0}if(this.actualBlock.name==="end")return;var n=this.links.find(function(n){return n.originID===t.actualBlock.id&&n.originSlot===e});var r=this.blockById(n.targetID);this.actualBlock=r;return r};return e}();var f=function(){function e(e){var n=this;t(this,e);this.messages=[];this.actualQuestionType="text";this.answer=function(e){n.addMessage(e.detail,true);if(n.actualQuestionType==="yesno"){n.controller.next(e.detail==="No"?1:0)}else{n.controller.next()}n.ask()}}e.prototype.ask=function(){this.addMessage(this.controller.actualBlock.question().value,false);this.actualQuestionType=this.controller.actualBlock.question().type};e.prototype.initChatController=function(){this.controller=new l(this.bot.escene.links,this.bot.escene.blocks);this.ask();this.controller.next();this.ask()};e.prototype.addMessage=function(e,t){this.messages=this.messages.concat([{id:Date.now(),message:e,user:t}])};e.prototype.componentWillLoad=function(){this.initChatController()};e.prototype.componentDidLoad=function(){};e.prototype.render=function(){var e=a(this.bot.colors.a);var t=a(this.bot.colors.b);var n=this.bot.colors.a;var i=this.bot.colors.b;var o=function(o){var a=o.id,s=o.message,u=o.user;return r("div",{id:"message-"+a+"-"+u,class:"uk-text-"+(u?"right":"left")+" fontumibots-message"},r("div",{style:{background:u?i:n}},r("p",{class:"uk-text-break",style:{color:u?t:e}},s)))};return r("div",{id:"fontumibots-chat-container",class:"uk-card uk-card-default uk-card-hover uk-width-5-6 uk-width-1-4@m"},r("div",{class:"uk-card-header",style:{background:n}},r("div",{class:"uk-grid uk-grid-small uk-flex-middle"},r("div",{class:"uk-width-auto"},r("img",{class:"uk-border-circle",width:"40",height:"40",src:"https://getuikit.com/docs/images/avatar.jpg"})),r("div",{class:"uk-width-expand"},r("h3",{class:"uk-card-title uk-margin-remove-bottom",style:{color:e}},this.bot.name),r("p",{class:"uk-text-meta uk-margin-remove-top",style:{color:e}},this.bot.email)))),r("div",{id:"fontumibots-chat-container-body",class:"uk-card-body uk-padding-small"},this.messages.map(function(e){return o(e)})),r("div",{class:"uk-card-footer"},this.actualQuestionType==="end"?r("div",null):r("fontumibots-chat-input",{type:this.actualQuestionType,props:this.controller.actualBlock.props()||[],style:{width:"100px"},onSendMessage:this.answer}),r("div",{class:"uk-grid uk-flex-center"},r("img",{src:"https://www.fontumi.co/empresas/logos/byfontumilogo.png",alt:"",style:{width:"100px",marginBottom:"10px"}}))))};Object.defineProperty(e,"style",{get:function(){return"#fontumibots-chat-container{border-radius:var(--fontumibots-border);max-height:calc(100vh - (var(--fontumibots-chat-borders) + 95px));position:absolute;right:var(--fontumibots-chat-borders);margin-left:10px;bottom:calc(10px + 55px + var(--fontumibots-chat-borders));z-index:var(--fontumibots-z-index)}#fontumibots-chat-container>.uk-card-body{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;overflow:scroll;overflow-x:hidden;max-height:calc(100vh - 330px)}#fontumibots-chat-container>.uk-card-footer{padding:6px 10px}fontumibots-chat-input .uk-inline{width:100%}#fontumibots-chat-container-input{border-radius:30px}.fontumibots-message>div>p{margin:7px 10px}.fontumibots-message>div{display:-ms-inline-flexbox;display:inline-flex;max-width:90%;border-radius:20px;margin-bottom:5px}.uk-button{border-radius:30px}"},enumerable:true,configurable:true});return e}();e("fontumibots_chat_container",f);var h=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}function p(e,t){return t={exports:{}},e(t,t.exports),t.exports}var m=p(function(e,t){!function(t,n){e.exports=n()}(h,function(){function e(e,t){if(!function(e){return null!==e&&"object"==typeof e}(e)||"string"!=typeof t)return e;for(var n=t.split("."),r=0;r<n.length;r++){var i=n[r];if(null===(e=e.hasOwnProperty(i)?e[i]:null))break}return e}function t(e){this.fn=e,this._promise=null}t.prototype.then=function(e,t){return this._promise=this._promise||new Promise(this.fn),this._promise.then(e,t)},t.prototype.catch=function(e){return this._promise=this._promise||new Promise(this.fn),this._promise.catch(e)};var n=function(e,t){t.add();for(var n=e.length,r=0,i="name";r<n;){var o=e[r++],a=o.charCodeAt(0);58===a||44===a?(i="arg",t.shiftValue()):124===a?(i="name",t.add()):"arg"===i?t.appendValue(o):t.appendKey(o,a)}return t.toJSON()};var r=function(){return{nodes:[],currentNode:null,add:function(){this.currentNode={name:"",args:[]},this.nodes.push(this.currentNode)},appendKey:function(e,t){32!==t&&(this.currentNode.name+=e)},appendValue:function(e){this.currentNode.args[this.currentNode.args.length-1]+=e},shiftValue:function(){this.currentNode.args.push("")},toJSON:function(){return this.nodes}}};function i(t,i){return i=i||{},Object.keys(t).reduce(function(o,a){var s=t[a];if("string"==typeof s)s=n(s,new r);else if(!Array.isArray(s))throw new Error("Rules must be defined as a string or an array");a.indexOf("*")>-1?function t(n,r,i,o){if(!r)return[];i=i||0;var a=n[i++],s=n[i];return o||(o=[a],a=""),o=o.reduce(function(t,n){var i=a?n+"."+a:n;if(void 0!==s){var o=e(r,i);if(Array.isArray(o))for(var u=o.length,c=0;c<u;c++)t.push(i+"."+c)}else t.push(i);return t},[]),i===n.length?o:t(n,r,i,o)}(a.split(/\.\*\.?/),i).forEach(function(e){o[e]=s}):o[a]=s;return o},{})}var o=function(e){return e.replace(/_(\w)/g,function(e,t){return t.toUpperCase()})};function a(t,n,r,i){var a=n.replace(/\.\d/g,".*"),s=o(r),u=t[a+"."+r]||t[a+"."+s]||t[r]||t[s]||"{{validation}} validation failed on {{ field }}";return"function"==typeof u?u(a,r,i):function(t,n,r){r=r||{skipUndefined:!1,throwOnUndefined:!1};for(var i,o=/{{2}(.+?)}{2}/g,a=t;null!==(i=o.exec(t));){var s=i[1].trim();if(s){var u=e(n,s);if(void 0!==u&&null!==u)a=a.replace(i[0],u);else{if(r.throwOnUndefined){var c=new Error("Missing value for "+i[0]);throw c.key=s,c.code="E_MISSING_KEY",c}r.skipUndefined||(a=a.replace(i[0],""))}}}return a}(u,{field:n,validation:r,argument:i})}function s(n,r,i,s,u){return Object.keys(r).reduce(function(c,l){return r[l].map(function(r){c.push(function(n,r,i,s,u,c){var l=r.name,f=r.args;return new t(function(t,r){var h=o(l),d=n[h];if("function"!=typeof d){var p=new Error(h+" is not defined as a validation rule");return c.addError(p,i,h,f),void r(p)}d(s,i,a(u,i,l,f),f,e).then(t).catch(function(e){c.addError(e,i,h,f),r(e)})})}(n,r,l,i,s,u))}),c},[])}function u(e,t,n,r,o,a){return new Promise(function(u,c){o=o||{};var l=i(r,n);(function(e,t){var n=[],r=e.length;return function t(i,o){return i>=r?Promise.resolve(n):e[i].then(function(e){return n.push(function(e){return{fullFilled:!0,rejected:!1,value:e,reason:null}}(e)),t(i+1,o)}).catch(function(e){return n.push(function(e){return{fullFilled:!1,rejected:!0,value:null,reason:e}}(e)),o?Promise.resolve(n):t(i+1,o)})}(0,t)})(s(e,l,n,o,a),t).then(function(e){var t=a.toJSON();if(t)return c(t);u(n)})})}var c=function(e,t){var n="Cannot instantiate validator without";if(!e)throw new Error(n+" validations");if(!t)throw new Error(n+" error formatter");return{validate:function(n,r,i,o){return o=new(o||t),u(e,!0,n,r,i,o)},validateAll:function(n,r,i,o){return o=new(o||t),u(e,!1,n,r,i,o)}}},l="undefined"!=typeof window?window:"undefined"!=typeof h?h:"undefined"!=typeof self?self:{};function f(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function d(e,t){return e(t={exports:{}},t.exports),t.exports}var p=d(function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(o,s,u,c,l){"object"==typeof s&&(u=s.depth,c=s.prototype,l=s.includeNonEnumerable,s=s.circular);var f=[],h=[],d="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===u&&(u=1/0),function o(u,p){if(null===u)return null;if(0===p)return u;var m,y;if("object"!=typeof u)return u;if(e(u,t))m=new t;else if(e(u,n))m=new n;else if(e(u,r))m=new r(function(e,t){u.then(function(t){e(o(t,p-1))},function(e){t(o(e,p-1))})});else if(i.__isArray(u))m=[];else if(i.__isRegExp(u))m=new RegExp(u.source,a(u)),u.lastIndex&&(m.lastIndex=u.lastIndex);else if(i.__isDate(u))m=new Date(u.getTime());else{if(d&&Buffer.isBuffer(u))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(u.length):new Buffer(u.length),u.copy(m),m;e(u,Error)?m=Object.create(u):void 0===c?(y=Object.getPrototypeOf(u),m=Object.create(y)):(m=Object.create(c),y=c)}if(s){var v=f.indexOf(u);if(-1!=v)return h[v];f.push(u),h.push(m)}for(var g in e(u,t)&&u.forEach(function(e,t){var n=o(t,p-1),r=o(e,p-1);m.set(n,r)}),e(u,n)&&u.forEach(function(e){var t=o(e,p-1);m.add(t)}),u){var b;y&&(b=Object.getOwnPropertyDescriptor(y,g)),b&&null==b.set||(m[g]=o(u[g],p-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(u);for(g=0;g<w.length;g++){var E=w[g];(!(T=Object.getOwnPropertyDescriptor(u,E))||T.enumerable||l)&&(m[E]=o(u[E],p-1),T.enumerable||Object.defineProperty(m,E,{enumerable:!1}))}}if(l){var S=Object.getOwnPropertyNames(u);for(g=0;g<S.length;g++){var T,I=S[g];(T=Object.getOwnPropertyDescriptor(u,I))&&T.enumerable||(m[I]=o(u[I],p-1),Object.defineProperty(m,I,{enumerable:!1}))}}return m}(o,u)}function o(e){return Object.prototype.toString.call(e)}function a(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=o,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===o(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===o(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===o(e)},i.__getRegExpFlags=a,i}();e.exports&&(e.exports=t)}),m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function v(e){return null!==e&&"object"===(void 0===e?"undefined":m(e))}var g=function(t){return{sanitize:function(n,r){var a=i(r,n);return Object.keys(a).reduce(function(r,i){var s=e(n,i);return null!==s&&function(e,t,n){if(v(e)&&"string"==typeof t){var r=t.split(".");(function e(t,i){var o=r[i];if(i+1!==r.length)return isNaN(parseInt(r[i+1]))||Array.isArray(t[o])?v(t[o])||(t[o]={}):t[o]=[],e(t[o],i+1);t[o]=n})(e,0)}}(r,i,function(e,t,n){var r=t;return n.forEach(function(t){var n=o(t.name);if("function"!=typeof e[n])throw new Error(n+" is not a sanitization method");r=e[n](r,t.args)}),r}(t,s,a[i])),r},p(n,!1))}}},b=function(e){return new Promise(function(t,n){var r=e();if(r)return n(r);t("validation passed")})},w={EXISTY_STRICT:!1,FORMATTER:null},E=function(e){return"string"==typeof e?e.trim().length>0:null!==e&&void 0!==e},S=function(e){return w.EXISTY_STRICT?void 0===e:!E(e)},T=function(e,t){return Number(e)>Number(t)},I=function(e){return E(e)&&!1!==e&&0!==e},_=/^[a-z]+$/i,D=function(e){return _.test(e)},C=/^[a-z0-9]+$/i,A=function(e){return C.test(e)},N=function(e){var t=[!0,!1,0,1];return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?t.indexOf(e)>-1:t.map(function(e){return String(e)}).indexOf(String(e))>-1},k=function(e,t){return e===t},O=d(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!("string"==typeof e||e instanceof String))throw new TypeError("This library (validator.js) validates strings only")},e.exports=t.default});f(O);var x=d(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];for(var n in t)void 0===e[n]&&(e[n]=t[n]);return e},e.exports=t.default});f(x);var R=d(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=function(e,t){(0,i.default)(e);var r=void 0,o=void 0;"object"===(void 0===t?"undefined":n(t))?(r=t.min||0,o=t.max):(r=arguments[1],o=arguments[2]);var a=encodeURI(e).split(/%..|./).length-1;return a>=r&&(void 0===o||a<=o)};var r,i=(r=O)&&r.__esModule?r:{default:r};e.exports=t.default});f(R);var M=d(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,n.default)(e),(t=(0,r.default)(t,o)).allow_trailing_dot&&"."===e[e.length-1]&&(e=e.substring(0,e.length-1));for(var i=e.split("."),a=0;a<i.length;a++)if(i[a].length>63)return!1;if(t.require_tld){var s=i.pop();if(!i.length||!/^([a-z\u00a1-\uffff]{2,}|xn[a-z0-9-]{2,})$/i.test(s))return!1;if(/[\s\u2002-\u200B\u202F\u205F\u3000\uFEFF\uDB40\uDC20]/.test(s))return!1}for(var u,c=0;c<i.length;c++){if(u=i[c],t.allow_underscores&&(u=u.replace(/_/g,"")),!/^[a-z\u00a1-\uffff0-9-]+$/i.test(u))return!1;if(/[\uff01-\uff5e]/.test(u))return!1;if("-"===u[0]||"-"===u[u.length-1])return!1}return!0};var n=i(O),r=i(x);function i(e){return e&&e.__esModule?e:{default:e}}var o={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1};e.exports=t.default});f(M);var P=d(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(0,r.default)(t);n=String(n);if(!n)return e(t,4)||e(t,6);if("4"===n){if(!i.test(t))return!1;var a=t.split(".").sort(function(e,t){return e-t});return a[3]<=255}if("6"===n){var s=t.split(":"),u=!1,c=e(s[s.length-1],4),l=c?7:8;if(s.length>l)return!1;if("::"===t)return!0;"::"===t.substr(0,2)?(s.shift(),s.shift(),u=!0):"::"===t.substr(t.length-2)&&(s.pop(),s.pop(),u=!0);for(var f=0;f<s.length;++f)if(""===s[f]&&f>0&&f<s.length-1){if(u)return!1;u=!0}else if(c&&f===s.length-1);else if(!o.test(s[f]))return!1;return u?s.length>=1:s.length===l}return!1};var n,r=(n=O)&&n.__esModule?n:{default:n};var i=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/,o=/^[0-9A-F]{1,4}$/i;e.exports=t.default});f(P);var L=f(d(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,n.default)(e),(t=(0,r.default)(t,u)).require_display_name||t.allow_display_name){var s=e.match(c);if(s)e=s[1];else if(t.require_display_name)return!1}var m=e.split("@"),y=m.pop(),v=m.join("@"),g=y.toLowerCase();if(t.domain_specific_validation&&("gmail.com"===g||"googlemail.com"===g)){var b=(v=v.toLowerCase()).split("+")[0];if(!(0,i.default)(b.replace(".",""),{min:6,max:30}))return!1;for(var w=b.split("."),E=0;E<w.length;E++)if(!f.test(w[E]))return!1}if(!(0,i.default)(v,{max:64})||!(0,i.default)(y,{max:254}))return!1;if(!(0,o.default)(y,{require_tld:t.require_tld})){if(!t.allow_ip_domain)return!1;if(!(0,a.default)(y)){if(!y.startsWith("[")||!y.endsWith("]"))return!1;var S=y.substr(1,y.length-2);if(0===S.length||!(0,a.default)(S))return!1}}if('"'===v[0])return v=v.slice(1,v.length-1),t.allow_utf8_local_part?p.test(v):h.test(v);for(var T=t.allow_utf8_local_part?d:l,I=v.split("."),_=0;_<I.length;_++)if(!T.test(I[_]))return!1;return!0};var n=s(O),r=s(x),i=s(R),o=s(M),a=s(P);function s(e){return e&&e.__esModule?e:{default:e}}var u={allow_display_name:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0},c=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\.\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\,\.\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF\s]*<(.+)>$/i,l=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,f=/^[a-z\d]+$/,h=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,d=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,p=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i;e.exports=t.default})),F=function(e,t){return L(String(e),t)},q=function(e,t){return"function"==typeof t.indexOf&&t.indexOf(e)>-1},U=/^(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}$/,V=function(e){return U.test(e)},B=/^(?:(?:[0-9a-fA-F:]){1,4}(?:(?::(?:[0-9a-fA-F]){1,4}|:)){2,7})+$/,j=function(e){return B.test(e)},Q=function(e){return V(e)||j(e)},z=function(e){try{return!!(JSON.parse(e)||{})}catch(e){return!1}},K=function(e,t){var n="number"==typeof e&&!isNaN(e);return!0!==e&&!1!==e&&(n||t?n:!isNaN(e))},W=function(e){return e instanceof Object&&!Array.isArray(e)},G=function(e,t,n){return(e=Number(e))>Number(t)&&e<Number(n)},H=function(e){return null===e},Y=function(e){return!E(e)||!(e instanceof Date)&&("object"===(void 0===e?"undefined":m(e))&&0===Object.keys(e).length)};var $=function(e){return"string"==typeof e},X=/https?:\/\/(www\.)?([-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}|localhost)\b([-a-zA-Z0-9@:%_+.~#?&\/\/=]*)/i,J=function(e){return X.test(e)};var Z=function(e){return e instanceof Date},ee=36e5,te=6e4,ne=2,re=/[T ]/,ie=/:/,oe=/^(\d{2})$/,ae=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],se=/^(\d{4})/,ue=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],ce=/^-(\d{2})$/,le=/^-?(\d{3})$/,fe=/^-?(\d{2})-?(\d{2})$/,he=/^-?W(\d{2})$/,de=/^-?W(\d{2})-?(\d{1})$/,pe=/^(\d{2}([.,]\d*)?)$/,me=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,ye=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,ve=/([Z+-].*)$/,ge=/^(Z)$/,be=/^([+-])(\d{2})$/,we=/^([+-])(\d{2}):?(\d{2})$/;function Ee(e,t,n){t=t||0,n=n||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var i=7*t+n+1-(r.getUTCDay()||7);return r.setUTCDate(r.getUTCDate()+i),r}var Se=function(e,t){if(Z(e))return new Date(e.getTime());if("string"!=typeof e)return new Date(e);var n=(t||{}).additionalDigits;n=null==n?ne:Number(n);var r=function(e){var t,n={},r=e.split(re);if(ie.test(r[0])?(n.date=null,t=r[0]):(n.date=r[0],t=r[1]),t){var i=ve.exec(t);i?(n.time=t.replace(i[1],""),n.timezone=i[1]):n.time=t}return n}(e),i=function(e,t){var n,r=ae[t],i=ue[t];if(n=se.exec(e)||i.exec(e)){var o=n[1];return{year:parseInt(o,10),restDateString:e.slice(o.length)}}if(n=oe.exec(e)||r.exec(e)){var a=n[1];return{year:100*parseInt(a,10),restDateString:e.slice(a.length)}}return{year:null}}(r.date,n),o=i.year,a=function(e,t){if(null===t)return null;var n,r,i,o;if(0===e.length)return(r=new Date(0)).setUTCFullYear(t),r;if(n=ce.exec(e))return r=new Date(0),i=parseInt(n[1],10)-1,r.setUTCFullYear(t,i),r;if(n=le.exec(e)){r=new Date(0);var a=parseInt(n[1],10);return r.setUTCFullYear(t,0,a),r}if(n=fe.exec(e)){r=new Date(0),i=parseInt(n[1],10)-1;var s=parseInt(n[2],10);return r.setUTCFullYear(t,i,s),r}if(n=he.exec(e))return o=parseInt(n[1],10)-1,Ee(t,o);if(n=de.exec(e)){o=parseInt(n[1],10)-1;var u=parseInt(n[2],10)-1;return Ee(t,o,u)}return null}(i.restDateString,o);if(a){var s,u=a.getTime(),c=0;return r.time&&(c=function(e){var t,n,r;if(t=pe.exec(e))return(n=parseFloat(t[1].replace(",",".")))%24*ee;if(t=me.exec(e))return n=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),n%24*ee+r*te;if(t=ye.exec(e)){n=parseInt(t[1],10),r=parseInt(t[2],10);var i=parseFloat(t[3].replace(",","."));return n%24*ee+r*te+1e3*i}return null}(r.time)),r.timezone?(l=r.timezone,s=(f=ge.exec(l))?0:(f=be.exec(l))?(h=60*parseInt(f[2],10),"+"===f[1]?-h:h):(f=we.exec(l))?(h=60*parseInt(f[2],10)+parseInt(f[3],10),"+"===f[1]?-h:h):0):(s=new Date(u+c).getTimezoneOffset(),s=new Date(u+c+s*te).getTimezoneOffset()),new Date(u+c+s*te)}var l,f,h;return new Date(e)};var Te=function(e,t){var n=Se(e),r=Se(t);return n.getTime()>r.getTime()};var Ie=function(e,t){var n=Se(e),r=Se(t);return n.getTime()<r.getTime()},_e=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e instanceof Date==!0||!t&&"Invalid Date"!==new Date(e).toString()};var De=function(e){var t=Se(e),n=new Date(0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n};var Ce=function(e){var t=Se(e);return t.setHours(0,0,0,0),t},Ae=6e4,Ne=864e5;var ke=function(e,t){var n=Ce(e),r=Ce(t),i=n.getTime()-n.getTimezoneOffset()*Ae,o=r.getTime()-r.getTimezoneOffset()*Ae;return Math.round((i-o)/Ne)};var Oe=function(e){var t=Se(e);return ke(t,De(t))+1};var xe=function(e,t){var n=t&&Number(t.weekStartsOn)||0,r=Se(e),i=r.getDay(),o=(i<n?7:0)+i-n;return r.setDate(r.getDate()-o),r.setHours(0,0,0,0),r};var Re=function(e){return xe(e,{weekStartsOn:1})};var Me=function(e){var t=Se(e),n=t.getFullYear(),r=new Date(0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);var i=Re(r),o=new Date(0);o.setFullYear(n,0,4),o.setHours(0,0,0,0);var a=Re(o);return t.getTime()>=i.getTime()?n+1:t.getTime()>=a.getTime()?n:n-1};var Pe=function(e){var t=Me(e),n=new Date(0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),Re(n)},Le=6048e5;var Fe=function(e){var t=Se(e),n=Re(t).getTime()-Pe(t).getTime();return Math.round(n/Le)+1};var qe=function(e){if(Z(e))return!isNaN(e);throw new TypeError(toString.call(e)+" is not an instance of Date")};var Ue=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"];var Ve=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);var r=Ue.concat(t).sort().reverse();return new RegExp("(\\[[^\\[]*\\])|(\\\\)?("+r.join("|")+"|.)","g")};var Be=function(){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Su","Mo","Tu","We","Th","Fr","Sa"],r=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["AM","PM"],a=["am","pm"],s=["a.m.","p.m."],u={MMM:function(t){return e[t.getMonth()]},MMMM:function(e){return t[e.getMonth()]},dd:function(e){return n[e.getDay()]},ddd:function(e){return r[e.getDay()]},dddd:function(e){return i[e.getDay()]},A:function(e){return e.getHours()/12>=1?o[1]:o[0]},a:function(e){return e.getHours()/12>=1?a[1]:a[0]},aa:function(e){return e.getHours()/12>=1?s[1]:s[0]}};return["M","D","DDD","d","Q","W"].forEach(function(e){u[e+"o"]=function(t,n){return function(e){var t=e%100;if(t>20||t<10)switch(t%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"}(n[e](t))}}),{formatters:u,formattingTokensRegExp:Ve(u)}},je={distanceInWords:function(){var e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};return{localize:function(t,n,r){var i;return r=r||{},i="string"==typeof e[t]?e[t]:1===n?e[t].one:e[t].other.replace("{{count}}",n),r.addSuffix?r.comparison>0?"in "+i:i+" ago":i}}}(),format:Be()};var Qe={M:function(e){return e.getMonth()+1},MM:function(e){return Ke(e.getMonth()+1,2)},Q:function(e){return Math.ceil((e.getMonth()+1)/3)},D:function(e){return e.getDate()},DD:function(e){return Ke(e.getDate(),2)},DDD:function(e){return Oe(e)},DDDD:function(e){return Ke(Oe(e),3)},d:function(e){return e.getDay()},E:function(e){return e.getDay()||7},W:function(e){return Fe(e)},WW:function(e){return Ke(Fe(e),2)},YY:function(e){return Ke(e.getFullYear(),4).substr(2)},YYYY:function(e){return Ke(e.getFullYear(),4)},GG:function(e){return String(Me(e)).substr(2)},GGGG:function(e){return Me(e)},H:function(e){return e.getHours()},HH:function(e){return Ke(e.getHours(),2)},h:function(e){var t=e.getHours();return 0===t?12:t>12?t%12:t},hh:function(e){return Ke(Qe.h(e),2)},m:function(e){return e.getMinutes()},mm:function(e){return Ke(e.getMinutes(),2)},s:function(e){return e.getSeconds()},ss:function(e){return Ke(e.getSeconds(),2)},S:function(e){return Math.floor(e.getMilliseconds()/100)},SS:function(e){return Ke(Math.floor(e.getMilliseconds()/10),2)},SSS:function(e){return Ke(e.getMilliseconds(),3)},Z:function(e){return ze(e.getTimezoneOffset(),":")},ZZ:function(e){return ze(e.getTimezoneOffset())},X:function(e){return Math.floor(e.getTime()/1e3)},x:function(e){return e.getTime()}};function ze(e,t){t=t||"";var n=e>0?"-":"+",r=Math.abs(e),i=r%60;return n+Ke(Math.floor(r/60),2)+t+Ke(i,2)}function Ke(e,t){for(var n=Math.abs(e).toString();n.length<t;)n="0"+n;return n}var We=function(e,t,n){var r=t?String(t):"YYYY-MM-DDTHH:mm:ss.SSSZ",i=(n||{}).locale,o=je.format.formatters,a=je.format.formattingTokensRegExp;i&&i.format&&i.format.formatters&&(o=i.format.formatters,i.format.formattingTokensRegExp&&(a=i.format.formattingTokensRegExp));var s=Se(e);return qe(s)?function(e,t,n){var r,i,o,a=e.match(n),s=a.length;for(r=0;r<s;r++)i=t[a[r]]||Qe[a[r]],a[r]=i||((o=a[r]).match(/\[[\s\S]/)?o.replace(/^\[|]$/g,""):o.replace(/\\/g,""));return function(e){for(var t="",n=0;n<s;n++)a[n]instanceof Function?t+=a[n](e,Qe):t+=a[n];return t}}(r,o,a)(s):"Invalid Date"},Ge=function(e,t){return(Array.isArray(t)?t:[t]).some(function(t){var n=e,r=!1;t.endsWith("ZZ")?(n=e.replace(/(\+|-)\d{4}$/,""),t=t.replace(/ZZ$/,""),r=!0):t.endsWith("Z")&&(n=e.replace(/Z$/,"").replace(/(\+|-)\d{2}:\d{2}$/,""),t=t.replace(/Z$/,""),r=!0);var i=We(n,t);return"Invalid Date"!==i&&i===n&&(!r||n!==e)})};var He=function(e){var t=Se(e),n=t.getFullYear(),r=t.getMonth(),i=new Date(0);return i.setFullYear(n,r+1,0),i.setHours(0,0,0,0),i.getDate()};var Ye=function(e,t){var n=Se(e),r=Number(t),i=n.getMonth()+r,o=new Date(0);o.setFullYear(n.getFullYear(),i,1),o.setHours(0,0,0,0);var a=He(o);return n.setMonth(i,Math.min(a,n.getDate())),n};var $e=function(e,t){var n=Se(e),r=Number(t);return n.setDate(n.getDate()+r),n};var Xe=function(e,t){var n=Se(e).getTime(),r=Number(t);return new Date(n+r)},Je=function(e,t,n){var r={years:function(e){return 12*e},quarters:function(e){return 3*e},months:function(e){return e}},i={weeks:function(e){return 7*e},days:function(e){return e}},o={hours:function(e){return 36e5*e},minutes:function(e){return 6e4*e},seconds:function(e){return 1e3*e},milliseconds:function(e){return e}};return e=Number(e),r[t]?Ye(new Date,"-"===n?-r[t](e):r[t](e)):i[t]?$e(new Date,"-"===n?-i[t](e):i[t](e)):o[t]?Xe(new Date,"-"===n?-o[t](e):o[t](e)):void 0},Ze=function(e,t,n){var r=Je(t,n,"-");return!!r&&Ie(e,r)},et=function(e,t,n){var r=Je(t,n,"+");return!!r&&Te(e,r)},tt=Object.freeze({above:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(!o)return new Error("above:make sure to define minValue");var r=i(e,t);return S(r)||T(r,o)?void 0:n})},accepted:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!I(r))return n})},alpha:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!D(r))return n})},alphaNumeric:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!A(r))return n})},array:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!Array.isArray(r))return n})},boolean:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!N(r,!1))return n})},confirmed:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!k(r,i(e,t+"_confirmation")))return n})},different:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(!o)throw new Error("different:make sure to define target field for comparison");var r=i(e,t),a=i(e,o);if(!S(r)&&a&&a===r)return n})},email:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!F(r))return n})},endsWith:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(!o)throw new Error("endsWith:make sure to define the matching substring");var r=i(e,t);if(!S(r)&&String(r).trim().substr(-o.length)!==String(o))return n})},equals:function(e,t,n,r,i){var o=r[0];return b(function(){var r=i(e,t);if(!S(r)&&o!=r)return n})},in:function(e,t,n,r,i){return b(function(){var o=i(e,t);if(!S(o)&&!q(o,r))return n})},includes:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){var r=i(e,t);if(!S(r)&&-1===String(r).indexOf(o))return n})},integer:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!Number.isInteger(Number(r)))return n})},ip:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!Q(r))return n})},ipv4:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!V(r))return n})},ipv6:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!j(r))return n})},json:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!z(r))return n})},max:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(!o)throw new Error("max:make sure to define max length");var r=i(e,t),a=Array.isArray(r)?r:String(r);if(!S(r)&&a.length>o)return n})},min:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(!o)throw new Error("min:make sure to define min length");var r=i(e,t),a=Array.isArray(r)?r:String(r);if(!S(r)&&a.length<o)return n})},notEquals:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){var r=i(e,t);if(!S(r)&&o==r)return n})},notIn:function(e,t,n,r,i){return b(function(){var o=i(e,t);if(!S(o)&&q(o,r))return n})},number:function(e,t,n,r,i){return b(function(){var r=i(e,t),o="string"==typeof r?Number(r):r;if(!S(r)&&!K(o))return n})},object:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!W(r))return n})},range:function(e,t,n,r,i){var o=y(r,2),a=o[0],s=o[1];return b(function(){if([a,s].some(function(e){return H(e)||isNaN(e)}))return new Error("range:min and max values are required for range validation");var r=i(e,t);return S(r)||G(r,a,s)?void 0:n})},regex:function(e,t,n,r,i){var o=y(r,2),a=o[0],s=o[1];return b(function(){var r=i(e,t),o=a instanceof RegExp?a:new RegExp(a,s);if(!S(r)&&!o.test(r))return n})},required:function(e,t,n,r,i){return b(function(){if(Y(i(e,t)))return n})},requiredIf:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(E(i(e,o))&&Y(i(e,t)))return n})},requiredWhen:function(e,t,n,r,i){var o=y(r,2),a=o[0],s=o[1];return b(function(){var r=i(e,a);if(String(s)===String(r)&&Y(i(e,t)))return n})},requiredWithAll:function(e,t,n,r,i){return b(function(){if(!r.some(function(t){return!E(i(e,t))})&&Y(i(e,t)))return n})},requiredWithAny:function(e,t,n,r,i){return b(function(){if(r.some(function(t){return E(i(e,t))})&&Y(i(e,t)))return n})},requiredWithoutAll:function(e,t,n,r,i){return b(function(){if(!r.some(function(t){return E(i(e,t))})&&Y(i(e,t)))return n})},requiredWithoutAny:function(e,t,n,r,i){return b(function(){if(r.some(function(t){return!E(i(e,t))})&&Y(i(e,t)))return n})},same:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){var r=i(e,t),a=i(e,o);if(!S(r)&&E(a)&&a!==r)return n})},startsWith:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(!o)throw new Error("startsWith:make sure to define the matching substring");var r=i(e,t);if(!S(r)&&String(r).trim().substr(0,o.length)!==String(o))return n})},string:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!$(r))return n})},under:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(!o)throw new Error("under:make sure to pass the max value");var r=i(e,t);if(!S(r)&&Number(r)>=Number(o))return n})},url:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!J(r))return n})},after:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(!o)return new Error("after:make sure to define the after date");var r=i(e,t);return S(r)||Te(r,o)?void 0:n})},before:function(e,t,n,r,i){var o=y(r,1)[0];return b(function(){if(!o)return new Error("before:make sure to define the before date");var r=i(e,t);return S(r)||Ie(r,o)?void 0:n})},date:function(e,t,n,r,i){return b(function(){var r=i(e,t);if(!S(r)&&!_e(r,!1))return n})},dateFormat:function(e,t,n,r,i){return b(function(){if(0===r.length)throw new Error("dateFormat:make sure to define atleast one date format");var o=i(e,t);if(!S(o)&&!Ge(o,r))return n})},beforeOffsetOf:function(e,t,n,r,i){var o=y(r,2),a=o[0],s=o[1];return b(function(){if(!a||!s)return new Error("beforeOffsetOf:make sure to define offset unit and key");var r=i(e,t);return S(r)||Ze(r,a,s)?void 0:n})},afterOffsetOf:function(e,t,n,r,i){var o=y(r,2),a=o[0],s=o[1];return b(function(){if(!a||!s)return new Error("afterOffsetOf:make sure to define offset unit and key");var r=i(e,t);return S(r)||et(r,a,s)?void 0:n})}}),nt=f(d(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){t=(0,r.default)(t,i);var n=e.split("@"),l=n.pop(),f=[n.join("@"),l];if(f[1]=f[1].toLowerCase(),"gmail.com"===f[1]||"googlemail.com"===f[1]){if(t.gmail_remove_subaddress&&(f[0]=f[0].split("+")[0]),t.gmail_remove_dots&&(f[0]=f[0].replace(/\.+/g,c)),!f[0].length)return!1;(t.all_lowercase||t.gmail_lowercase)&&(f[0]=f[0].toLowerCase()),f[1]=t.gmail_convert_googlemaildotcom?"gmail.com":f[1]}else if(o.indexOf(f[1])>=0){if(t.icloud_remove_subaddress&&(f[0]=f[0].split("+")[0]),!f[0].length)return!1;(t.all_lowercase||t.icloud_lowercase)&&(f[0]=f[0].toLowerCase())}else if(a.indexOf(f[1])>=0){if(t.outlookdotcom_remove_subaddress&&(f[0]=f[0].split("+")[0]),!f[0].length)return!1;(t.all_lowercase||t.outlookdotcom_lowercase)&&(f[0]=f[0].toLowerCase())}else if(s.indexOf(f[1])>=0){if(t.yahoo_remove_subaddress){var h=f[0].split("-");f[0]=h.length>1?h.slice(0,-1).join("-"):h[0]}if(!f[0].length)return!1;(t.all_lowercase||t.yahoo_lowercase)&&(f[0]=f[0].toLowerCase())}else u.indexOf(f[1])>=0?((t.all_lowercase||t.yandex_lowercase)&&(f[0]=f[0].toLowerCase()),f[1]="yandex.ru"):t.all_lowercase&&(f[0]=f[0].toLowerCase());return f.join("@")};var n,r=(n=x)&&n.__esModule?n:{default:n};var i={all_lowercase:!0,gmail_lowercase:!0,gmail_remove_dots:!0,gmail_remove_subaddress:!0,gmail_convert_googlemaildotcom:!0,outlookdotcom_lowercase:!0,outlookdotcom_remove_subaddress:!0,yahoo_lowercase:!0,yahoo_remove_subaddress:!0,yandex_lowercase:!0,icloud_lowercase:!0,icloud_remove_subaddress:!0},o=["icloud.com","me.com"],a=["hotmail.at","hotmail.be","hotmail.ca","hotmail.cl","hotmail.co.il","hotmail.co.nz","hotmail.co.th","hotmail.co.uk","hotmail.com","hotmail.com.ar","hotmail.com.au","hotmail.com.br","hotmail.com.gr","hotmail.com.mx","hotmail.com.pe","hotmail.com.tr","hotmail.com.vn","hotmail.cz","hotmail.de","hotmail.dk","hotmail.es","hotmail.fr","hotmail.hu","hotmail.id","hotmail.ie","hotmail.in","hotmail.it","hotmail.jp","hotmail.kr","hotmail.lv","hotmail.my","hotmail.ph","hotmail.pt","hotmail.sa","hotmail.sg","hotmail.sk","live.be","live.co.uk","live.com","live.com.ar","live.com.mx","live.de","live.es","live.eu","live.fr","live.it","live.nl","msn.com","outlook.at","outlook.be","outlook.cl","outlook.co.il","outlook.co.nz","outlook.co.th","outlook.com","outlook.com.ar","outlook.com.au","outlook.com.br","outlook.com.gr","outlook.com.pe","outlook.com.tr","outlook.com.vn","outlook.cz","outlook.de","outlook.dk","outlook.es","outlook.fr","outlook.hu","outlook.id","outlook.ie","outlook.in","outlook.it","outlook.jp","outlook.kr","outlook.lv","outlook.my","outlook.ph","outlook.pt","outlook.sa","outlook.sg","outlook.sk","passport.com"],s=["rocketmail.com","yahoo.ca","yahoo.co.uk","yahoo.com","yahoo.de","yahoo.fr","yahoo.in","yahoo.it","ymail.com"],u=["yandex.ru","yandex.ua","yandex.kz","yandex.com","yandex.by","ya.ru"];function c(e){return e.length>1?e:""}e.exports=t.default})),rt=d(function(e){!function(t){if("function"!=typeof n){var n=function(e){return e};n.nonNative=!0}var r=n("plaintext"),i=n("html"),o=n("comment"),a=/<(\w*)>/g,s=/<\/?([^\s\/>]+)/;function u(e,t,n){return l(e=e||"",c(t=t||[],n=n||""))}function c(e,t){return{allowable_tags:e=function(e){var t=new Set;if("string"==typeof e)for(var r=void 0;r=a.exec(e);)t.add(r[1]);else n.nonNative||"function"!=typeof e[n.iterator]?"function"==typeof e.forEach&&e.forEach(t.add,t):t=new Set(e);return t}(e),tag_replacement:t,state:r,tag_buffer:"",depth:0,in_quote_char:""}}function l(e,t){for(var n=t.allowable_tags,a=t.tag_replacement,s=t.state,u=t.tag_buffer,c=t.depth,l=t.in_quote_char,h="",d=0,p=e.length;d<p;d++){var m=e[d];if(s===r)switch(m){case"<":s=i,u+=m;break;default:h+=m}else if(s===i)switch(m){case"<":if(l)break;c++;break;case">":if(l)break;if(c){c--;break}l="",s=r,u+=">",n.has(f(u))?h+=u:h+=a,u="";break;case'"':case"'":l=m===l?"":l||m,u+=m;break;case"-":"<!-"===u&&(s=o),u+=m;break;case" ":case"\n":if("<"===u){s=r,h+="< ",u="";break}u+=m;break;default:u+=m}else if(s===o)switch(m){case">":"--"==u.slice(-2)&&(s=r),u="";break;default:u+=m}}return t.state=s,t.tag_buffer=u,t.depth=c,t.in_quote_char=l,h}function f(e){var t=s.exec(e);return t?t[1].toLowerCase():null}u.init_streaming_mode=function(e,t){var n=c(e=e||[],t=t||"");return function(e){return l(e||"",n)}},e.exports?e.exports=u:t.striptags=u}(l)}),it=d(function(e,t){var n;n=function(){var e=[],t=[],n={},r={},i={};function o(e){return"string"==typeof e?new RegExp("^"+e+"$","i"):e}function a(e,t){return e===t?t:e===e.toUpperCase()?t.toUpperCase():e[0]===e[0].toUpperCase()?t.charAt(0).toUpperCase()+t.substr(1).toLowerCase():t.toLowerCase()}function s(e,t){return e.replace(t[0],function(n,r){var i,o,s=(i=t[1],o=arguments,i.replace(/\$(\d{1,2})/g,function(e,t){return o[t]||""}));return a(""===n?e[r-1]:n,s)})}function u(e,t,r){if(!e.length||n.hasOwnProperty(e))return t;for(var i=r.length;i--;){var o=r[i];if(o[0].test(t))return s(t,o)}return t}function c(e,t,n){return function(r){var i=r.toLowerCase();return t.hasOwnProperty(i)?a(r,i):e.hasOwnProperty(i)?a(r,e[i]):u(i,r,n)}}function l(e,t,n,r){return function(r){var i=r.toLowerCase();return!!t.hasOwnProperty(i)||!e.hasOwnProperty(i)&&u(i,i,n)===i}}function f(e,t,n){var r=1===t?f.singular(e):f.plural(e);return(n?t+" ":"")+r}return f.plural=c(i,r,e),f.isPlural=l(i,r,e),f.singular=c(r,i,t),f.isSingular=l(r,i,t),f.addPluralRule=function(t,n){e.push([o(t),n])},f.addSingularRule=function(e,n){t.push([o(e),n])},f.addUncountableRule=function(e){"string"!=typeof e?(f.addPluralRule(e,"$0"),f.addSingularRule(e,"$0")):n[e.toLowerCase()]=!0},f.addIrregularRule=function(e,t){t=t.toLowerCase(),e=e.toLowerCase(),i[e]=t,r[t]=e},[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["whiskey","whiskies"]].forEach(function(e){return f.addIrregularRule(e[0],e[1])}),[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|tlas|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[emjzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|octop|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/(m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach(function(e){return f.addPluralRule(e[0],e[1])}),[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/(m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|tlas|gas|(?:her|at|gr)o|ris)(?:es)?$/i,"$1"],[/(analy|ba|diagno|parenthe|progno|synop|the|empha|cri)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|octop|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach(function(e){return f.addSingularRule(e[0],e[1])}),["adulthood","advice","agenda","aid","alcohol","ammo","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","flounder","fun","gallows","garbage","graffiti","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","manga","news","pike","plankton","pliers","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","species","staff","swine","tennis","traffic","transporation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(f.addUncountableRule),f},e.exports=n()}),ot=1/0,at="[object Symbol]",st=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ut=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ct="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",lt="["+ct+"]",ft="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",ht="\\d+",dt="[\\u2700-\\u27bf]",pt="[a-z\\xdf-\\xf6\\xf8-\\xff]",mt="[^\\ud800-\\udfff"+ct+ht+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",yt="(?:\\ud83c[\\udde6-\\uddff]){2}",vt="[\\ud800-\\udbff][\\udc00-\\udfff]",gt="[A-Z\\xc0-\\xd6\\xd8-\\xde]",bt="(?:"+pt+"|"+mt+")",wt="(?:"+gt+"|"+mt+")",Et="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",St="[\\ufe0e\\ufe0f]?"+Et+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",yt,vt].join("|")+")[\\ufe0e\\ufe0f]?"+Et+")*"),Tt="(?:"+[dt,yt,vt].join("|")+")"+St,It=RegExp("['’]","g"),_t=RegExp(ft,"g"),Dt=RegExp([gt+"?"+pt+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[lt,gt,"$"].join("|")+")",wt+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[lt,gt+bt,"$"].join("|")+")",gt+"?"+bt+"+(?:['’](?:d|ll|m|re|s|t|ve))?",gt+"+(?:['’](?:D|LL|M|RE|S|T|VE))?",ht,Tt].join("|"),"g"),Ct=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,At="object"==typeof l&&l&&l.Object===Object&&l,Nt="object"==typeof self&&self&&self.Object===Object&&self,kt=At||Nt||Function("return this")();var Ot=function(e){return function(t){return null==e?void 0:e[t]}}({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"ss"});var xt,Rt=Object.prototype.toString,Mt=kt.Symbol,Pt=Mt?Mt.prototype:void 0,Lt=Pt?Pt.toString:void 0;function Ft(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&Rt.call(e)==at}(e))return Lt?Lt.call(e):"";var t=e+"";return"0"==t&&1/e==-ot?"-0":t}function qt(e){return null==e?"":Ft(e)}var Ut=(xt=function(e,t,n){return e+(n?"-":"")+t.toLowerCase()},function(e){return function(e,t,n,r){var i=-1,o=e?e.length:0;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}(function(e,t,n){return e=qt(e),void 0===(t=n?void 0:t)?function(e){return Ct.test(e)}(e)?function(e){return e.match(Dt)||[]}(e):function(e){return e.match(st)||[]}(e):e.match(t)||[]}(function(e){return(e=qt(e))&&e.replace(ut,Ot).replace(_t,"")}(e).replace(It,"")),xt,"")});function Vt(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(void 0!==i&&null!==i)for(var o=Object.keys(Object(i)),a=0,s=o.length;a<s;a++){var u=o[a],c=Object.getOwnPropertyDescriptor(i,u);void 0!==c&&c.enumerable&&(n[u]=i[u])}}return n}var Bt=Vt,jt=Bt({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ő":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ű":"U","Ý":"Y","Þ":"TH","Ÿ":"Y","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ő":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ű":"u","ý":"y","þ":"th","ÿ":"y"},{"©":"(c)","œ":"oe","Œ":"OE","∑":"sum","®":"(r)","†":"+","“":'"',"”":'"',"‘":"'","’":"'","∂":"d","ƒ":"f","™":"tm","℠":"sm","…":"...","˚":"o","º":"o","ª":"a","•":"*","∆":"delta","∞":"infinity","♥":"love","&":"and","|":"or","<":"less",">":"greater","@":"at"},{"α":"a","β":"b","γ":"g","δ":"d","ε":"e","ζ":"z","η":"h","θ":"8","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"3","ο":"o","π":"p","ρ":"r","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"w","ά":"a","έ":"e","ί":"i","ό":"o","ύ":"y","ή":"h","ώ":"w","ς":"s","ϊ":"i","ΰ":"y","ϋ":"y","ΐ":"i","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"H","Θ":"8","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"3","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"W","Ά":"A","Έ":"E","Ί":"I","Ό":"O","Ύ":"Y","Ή":"H","Ώ":"W","Ϊ":"I","Ϋ":"Y"},{"ş":"s","Ş":"S","ı":"i","İ":"I","ç":"c","Ç":"C","ü":"u","Ü":"U","ö":"o","Ö":"O","ğ":"g","Ğ":"G"},{"ă":"a","î":"i","ș":"s","ț":"t","â":"a","Ă":"A","Î":"I","Ș":"S","Ț":"T","Â":"A"},{"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"Yo","Ж":"Zh","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya"},{"Є":"Ye","І":"I","Ї":"Yi","Ґ":"G","є":"ye","і":"i","ї":"yi","ґ":"g"},{"č":"c","ď":"d","ě":"e","ň":"n","ř":"r","š":"s","ť":"t","ů":"u","ž":"z","Č":"C","Ď":"D","Ě":"E","Ň":"N","Ř":"R","Š":"S","Ť":"T","Ů":"U","Ž":"Z"},{"á":"a","ä":"a","č":"c","ď":"d","é":"e","í":"i","ľ":"l","ĺ":"l","ň":"n","ó":"o","ô":"o","ŕ":"r","š":"s","ť":"t","ú":"u","ý":"y","ž":"z","Á":"a","Ä":"A","Č":"C","Ď":"D","É":"E","Í":"I","Ľ":"L","Ĺ":"L","Ň":"N","Ó":"O","Ô":"O","Ŕ":"R","Š":"S","Ť":"T","Ú":"U","Ý":"Y","Ž":"Z"},{"ą":"a","ć":"c","ę":"e","ł":"l","ń":"n","ó":"o","ś":"s","ź":"z","ż":"z","Ą":"A","Ć":"C","Ę":"E","Ł":"L","Ń":"N","Ó":"O","Ś":"S","Ź":"Z","Ż":"Z"},{"ā":"a","č":"c","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","š":"s","ū":"u","ž":"z","Ā":"A","Č":"C","Ē":"E","Ģ":"G","Ī":"I","Ķ":"K","Ļ":"L","Ņ":"N","Š":"S","Ū":"U","Ž":"Z"},{"أ":"a","ب":"b","ت":"t","ث":"th","ج":"g","ح":"h","خ":"kh","د":"d","ذ":"th","ر":"r","ز":"z","س":"s","ش":"sh","ص":"s","ض":"d","ط":"t","ظ":"th","ع":"aa","غ":"gh","ف":"f","ق":"k","ك":"k","ل":"l","م":"m","ن":"n","ه":"h","و":"o","ي":"y"},{"ą":"a","č":"c","ę":"e","ė":"e","į":"i","š":"s","ų":"u","ū":"u","ž":"z","Ą":"A","Č":"C","Ę":"E","Ė":"E","Į":"I","Š":"S","Ų":"U","Ū":"U","Ž":"Z"},{"ђ":"dj","ј":"j","љ":"lj","њ":"nj","ћ":"c","џ":"dz","đ":"dj","Ђ":"Dj","Ј":"j","Љ":"Lj","Њ":"Nj","Ћ":"C","Џ":"Dz","Đ":"Dj"},{"ç":"c","ə":"e","ğ":"g","ı":"i","ö":"o","ş":"s","ü":"u","Ç":"C","Ə":"E","Ğ":"G","İ":"I","Ö":"O","Ş":"S","Ü":"U"},{"ა":"a","ბ":"b","გ":"g","დ":"d","ე":"e","ვ":"v","ზ":"z","თ":"t","ი":"i","კ":"k","ლ":"l","მ":"m","ნ":"n","ო":"o","პ":"p","ჟ":"j","რ":"r","ს":"s","ტ":"t","უ":"u","ფ":"f","ქ":"q","ღ":"g","ყ":"y","შ":"sh","ჩ":"ch","ც":"c","ძ":"dz","წ":"w","ჭ":"ch","ხ":"x","ჯ":"j","ჰ":"h"},{"Ạ":"A","Ả":"A","Ầ":"A","Ấ":"A","Ậ":"A","Ẩ":"A","Ẫ":"A","Ằ":"A","Ắ":"A","Ặ":"A","Ẳ":"A","Ẵ":"A","Ẹ":"E","Ẻ":"E","Ẽ":"E","Ề":"E","Ế":"E","Ệ":"E","Ể":"E","Ễ":"E","Ị":"I","Ỉ":"I","Ĩ":"I","Ọ":"O","Ỏ":"O","Ồ":"O","Ố":"O","Ộ":"O","Ổ":"O","Ỗ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ợ":"O","Ở":"O","Ỡ":"O","Ụ":"U","Ủ":"U","Ũ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ự":"U","Ử":"U","Ữ":"U","Ỳ":"Y","Ỵ":"Y","Ỷ":"Y","Ỹ":"Y","Đ":"D","ạ":"a","ả":"a","ầ":"a","ấ":"a","ậ":"a","ẩ":"a","ẫ":"a","ằ":"a","ắ":"a","ặ":"a","ẳ":"a","ẵ":"a","ẹ":"e","ẻ":"e","ẽ":"e","ề":"e","ế":"e","ệ":"e","ể":"e","ễ":"e","ị":"i","ỉ":"i","ĩ":"i","ọ":"o","ỏ":"o","ồ":"o","ố":"o","ộ":"o","ổ":"o","ỗ":"o","ơ":"o","ờ":"o","ớ":"o","ợ":"o","ở":"o","ỡ":"o","ụ":"u","ủ":"u","ũ":"u","ư":"u","ừ":"u","ứ":"u","ự":"u","ử":"u","ữ":"u","ỳ":"y","ỵ":"y","ỷ":"y","ỹ":"y","đ":"d"},{"€":"euro","₢":"cruzeiro","₣":"french franc","£":"pound","₤":"lira","₥":"mill","₦":"naira","₧":"peseta","₨":"rupee","₩":"won","₪":"new shequel","₫":"dong","₭":"kip","₮":"tugrik","₯":"drachma","₰":"penny","₱":"peso","₲":"guarani","₳":"austral","₴":"hryvnia","₵":"cedi","¢":"cent","¥":"yen","元":"yuan","円":"yen","﷼":"rial","₠":"ecu","¤":"currency","฿":"baht",$:"dollar","₹":"indian rupee"});function Qt(e){if(void 0===e)return"";for(var t="",n=0;n<e.length;n++){var r=e[n];t+=void 0!==jt[r]?jt[r]:r}return t}Qt.extends=function(e){Bt(jt,e)};var zt=Qt;function Kt(e){return void 0===e?"":Ut(function(e){for(var t="",n=0;n<=e.length;n++)e.charCodeAt(n)<128&&(t+=e[n]);return t}(zt(e.toString())))}Kt.extends=function(e){zt.extends(e)};var Wt=Kt,Gt=/<a\b[^>]*>(.*?)<\/a>/g,Ht=Object.freeze({normalizeEmail:function(e,t){if("string"==typeof e){var n=t&&t.length?t[0]:{};return nt(e,n)}return e},stripTags:function(e,t){return"string"!=typeof e?e:rt(e,t)},toBoolean:function(e){return!(!e||"false"===e||"0"===e)},toNull:function(e){return E(e)?e:null},toInt:function(e,t){var n=Array.isArray(t)&&t[0]?t[0]:10;return parseInt(e,n)},toDate:function(e){if(e instanceof Date)return e;var t=new Date(e);return"Invalid Date"===t.toString()?null:t},plural:function(e){return"string"!=typeof e?e:it(e)},singular:function(e){return"string"!=typeof e?e:it.singular(e)},slug:function(e){return"string"!=typeof e?e:Wt(e)},escape:function(e){return"string"!=typeof e?e:e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},stripLinks:function(e){return"string"!=typeof e?e:e.replace(Gt,function(e,t){return t.trim()})},trim:function(e){return"string"!=typeof e?e:e.trim()}}),Yt=function(e){return Number(e)%2==0},$t=function(e){return Number(e)>=0},Xt=/\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/;var Jt=function(e){return Ce(e).getTime()===Ce(new Date).getTime()};var Zt=function(e){var t=new Date;return t.setDate(t.getDate()-1),Ce(e).getTime()===Ce(t).getTime()};var en=function(e){var t=new Date;return t.setDate(t.getDate()+1),Ce(e).getTime()===Ce(t).getTime()};var tn=function(e){return Se(e).getTime()<(new Date).getTime()};var nn=function(e){return Se(e).getTime()>(new Date).getTime()};var rn=function(e,t,n){var r=Se(e).getTime(),i=Se(t).getTime(),o=Se(n).getTime();if(i>o)throw new Error("The start of the range cannot be after the end of the range");return r>=i&&r<=o},on=Object.freeze({above:T,affirmative:function(e){return"A"===e||["yes","true","y","ok","okay"].indexOf(e.toLowerCase())>-1},alpha:D,alphaNumeric:A,array:function(e){return Array.isArray(e)},between:G,boolean:N,creditCard:function(e,t){return L(String(e),t)},date:_e,email:F,empty:Y,even:Yt,existy:E,falsy:function(e){return!I(e)},inArray:q,intersectAll:function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.filter(function(e){return t.indexOf(e)>-1}).length===e.length},intersectAny:function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.filter(function(e){return t.indexOf(e)>-1}).length>0},ip:Q,ipv4:V,ipv6:j,isFunction:function(e){return"function"==typeof e},json:z,negative:function(e){return!$t(e)},isNull:H,isNumber:K,isObject:W,odd:function(e){return!Yt(e)},phone:function(e){return Xt.test(e)},positive:$t,regex:function(e,t){if(t instanceof RegExp==0)throw new Error("You must pass regex as the 2nd argument");return t.test(e)},same:k,sameType:function(e,t){return e===t},sorted:function(e){if(!Array.isArray(e))return!1;for(var t=!1,n=0;n<e.length;){var r=e[n++],i=e[n-2];if(i&&i>r){t=!0;break}}return!t},isString:$,truthy:I,under:function(e,t){return!T(e,t)},url:J,isDate:function(e,t){var n=e instanceof Date;return n||t?n:"Invalid Date"!==new Date(e).toString()},today:Jt,yesterday:Zt,tomorrow:en,past:tn,future:nn,inDateRange:rn,afterOffsetOf:et,beforeOffsetOf:Ze,dateFormat:Ge});function an(){this.errors=[]}function sn(){this.errors=[]}an.prototype.addError=function(e,t,n,r){var i=e;e instanceof Error&&(n="ENGINE_EXCEPTION",i=e.message),this.errors.push({message:i,field:t,validation:n})},an.prototype.toJSON=function(){return this.errors.length?this.errors:null},sn.prototype.addError=function(e,t,n,r){var i=e;e instanceof Error&&(n="ENGINE_EXCEPTION",i=e.message),this.errors.push({title:n,detail:i,source:{pointer:t}})},sn.prototype.toJSON=function(){return this.errors.length?{errors:this.errors}:null};var un=Object.freeze({Vanilla:an,JsonApi:sn});function cn(e){Object.keys(e).forEach(function(t){void 0!==w[t]&&(w[t]=e[t])})}cn.DEFAULTS=Object.keys(w).reduce(function(e,t){return e[t]=w[t],e},{});var ln=Object.keys(on).reduce(function(e,t){return e[t]=on[t],e},{}),fn=Object.keys(tt).reduce(function(e,t){return e[t]=tt[t],e},{}),hn=Object.keys(Ht).reduce(function(e,t){return e[t]=Ht[t],e},{});return{validate:function(){var e;var t=[];for(var n=0;n<arguments.length;n++){t[n]=arguments[n]}return(e=c(fn,w.FORMATTER||an)).validate.apply(e,t)},validateAll:function(){var e;var t=[];for(var n=0;n<arguments.length;n++){t[n]=arguments[n]}return(e=c(fn,w.FORMATTER||an)).validateAll.apply(e,t)},sanitize:function(){var e;var t=[];for(var n=0;n<arguments.length;n++){t[n]=arguments[n]}return(e=g(hn)).sanitize.apply(e,t)},is:ln,sanitizor:hn,validations:fn,rule:function(e,t){return{name:e,args:t?Array.isArray(t)?t:[t]:[]}},formatters:un,configure:cn}})});var y=d(m);var v=function(e,t,n){if(n===void 0){n={integer:false,max:false,min:false,required:true}}return A(i,void 0,void 0,function(){var r;return N(this,function(i){t=t.trim();if(e==="phone"){e="number";n["integer"]=true;t=t.replace(/ /g,"")}else if(["text","yesno"].indexOf(e)>-1){e="string"}r=Object.keys(n).filter(function(e){return!!n[e]}).map(function(e){if(e=="max"||e=="min"){return e+":"+n[e]}return e}).join("|");console.log(t,e+"|"+r);return[2,y.validate({message:t},{message:e+"|"+r})]})})};var g=function(){function e(e){var r=this;t(this,e);this.validMessage=true;this.handleInput=function(e){return r.message=e.target.value};this.handleKeyPress=function(e){return e.key=="enter"||e.key=="Enter"?r.sendMessage():r.validMessage=true};this.sendMessageEvent=n(this,"sendMessage",7)}e.prototype.sendMessage=function(){return A(this,void 0,void 0,function(){var e;return N(this,function(t){switch(t.label){case 0:t.trys.push([0,2,,3]);return[4,v(this.type,this.message)];case 1:t.sent();this.sendMessageEvent.emit(this.message);this.message="";return[3,3];case 2:e=t.sent();console.log(e);this.validMessage=false;return[3,3];case 3:return[2]}})})};e.prototype.render=function(){var e=this;var t=function(){switch(e.type){case"email":{return r("input",{id:"fontumibots-chat-container-input",class:{"uk-input uk-text-center":true,"uk-form-danger":!e.validMessage},type:"email",placeholder:"E-Mail",value:e.message,onInput:e.handleInput,onKeyPress:e.handleKeyPress})}case"number":{return r("input",{id:"fontumibots-chat-container-input",class:{"uk-input uk-text-center":true,"uk-form-danger":!e.validMessage},type:"number",min:e.props["min"].value,max:e.props["max"].value,placeholder:"Respuesta numérica",value:e.message,onInput:e.handleInput,onKeyPress:e.handleKeyPress})}case"phone":{return r("input",{id:"fontumibots-chat-container-input",class:{"uk-input uk-text-center":true,"uk-form-danger":!e.validMessage},type:"tel",placeholder:"Número de celular",minLength:5,maxlength:13,value:e.message,onInput:e.handleInput,onKeyPress:e.handleKeyPress})}case"yesno":{return r("div",{class:"uk-flex uk-flex-center"},r("button",{class:"uk-button uk-button-secondary",onClick:function(){e.message="Si";e.sendMessage()}},"Sí"),r("button",{class:"uk-button uk-margin-left uk-button-danger",onClick:function(){e.message="No";e.sendMessage()}},"No"))}}return r("input",{id:"fontumibots-chat-container-input",class:{"uk-input uk-text-center":true,"uk-form-danger":!e.validMessage},type:"text",placeholder:"Enviar un mensaje...",value:e.message,onInput:e.handleInput,onKeyPress:e.handleKeyPress})};return r("div",{class:"uk-margin"},r("div",{class:"uk-inline"},t()))};return e}();e("fontumibots_chat_input",g);var b=function(){function e(e){t(this,e);this.height=30;this.width=30;this.fill="black"}e.prototype.render=function(){return r("svg",{xmlns:"http://www.w3.org/2000/svg",width:this.width,height:this.height,fill:this.fill,viewBox:"0 0 17 17",style:{marginTop:"-4px"}},r("path",{d:"M9.207 8.5l6.646 6.646-.707.707L8.5 9.207l-6.646 6.646-.707-.707L7.793 8.5 1.146 1.854l.707-.707L8.5 7.793l6.646-6.646.707.707L9.207 8.5z"}))};return e}();e("fontumibots_icon_close",b);var w=function(){function e(e){t(this,e);this.height=30;this.width=30;this.fill="black"}e.prototype.render=function(){return r("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:this.width,height:this.height,fill:this.fill,viewBox:"0 0 96.000000 96.000000",preserveAspectRatio:"xMidYMid meet",style:{marginTop:"-4px"}},r("g",{transform:"translate(0.000000,96.000000) scale(0.100000,-0.100000)",fill:this.fill,stroke:"none"},r("path",{d:"M105 855 l-25 -24 0 -278 0 -277 63 62 63 62 212 0 c283 0 262 -19 262 240 0 189 0 191 -25 215 l-24 25 -251 0 -251 0 -24 -25z"}),r("path",{d:"M720 569 c0 -197 -16 -209 -269 -209 l-171 0 0 -55 c0 -46 4 -60 25 -80 l24 -25 218 0 217 0 58 -57 58 -57 0 272 0 273 -25 24 c-20 21 -34 25 -80 25 l-55 0 0 -111z"})))};return e}();e("fontumibots_icon_messages",w);var E=function(e,t){E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return E(e,t)};function S(e,t){E(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var T=function(){T=Object.assign||function e(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o))t[o]=n[o]}return t};return T.apply(this,arguments)};function I(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)if(t.indexOf(r[i])<0)n[r[i]]=e[r[i]];return n}function _(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o;return i>3&&o&&Object.defineProperty(t,n,o),o}function D(e,t){return function(n,r){t(n,r,e)}}function C(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function A(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r["throw"](e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})}function N(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return u([e,t])}}function u(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}}function k(e,t){for(var n in e)if(!t.hasOwnProperty(n))t[n]=e[n]}function O(e){var t=typeof Symbol==="function"&&e[Symbol.iterator],n=0;if(t)return t.call(e);return{next:function(){if(e&&n>=e.length)e=void 0;return{value:e&&e[n++],done:!e}}}}function x(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o}function R(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(x(arguments[t]));return e}function M(e){return this instanceof M?(this.v=e,this):new M(e)}function P(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,o=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(e){if(r[e])i[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||s(e,t)})}}function s(e,t){try{u(r[e](t))}catch(e){f(o[0][3],e)}}function u(e){e.value instanceof M?Promise.resolve(e.value.v).then(c,l):f(o[0][2],e)}function c(e){s("next",e)}function l(e){s("throw",e)}function f(e,t){if(e(t),o.shift(),o.length)s(o[0][0],o[0][1])}}function L(e){var t,n;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:M(e[r](t)),done:r==="return"}:i?i(t):t}:i}}function F(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof O==="function"?O(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(t){n[t]=e[t]&&function(n){return new Promise(function(r,o){n=e[t](n),i(r,o,n.done,n.value)})}}function i(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}}function q(e,t){if(Object.defineProperty){Object.defineProperty(e,"raw",{value:t})}else{e.raw=t}return e}function U(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)if(Object.hasOwnProperty.call(e,n))t[n]=e[n];t.default=e;return t}function V(e){return e&&e.__esModule?e:{default:e}}var B=Object.freeze({__extends:S,get __assign(){return T},__rest:I,__decorate:_,__param:D,__metadata:C,__awaiter:A,__generator:N,__exportStar:k,__values:O,__read:x,__spread:R,__await:M,__asyncGenerator:P,__asyncDelegator:L,__asyncValues:F,__makeTemplateObject:q,__importStar:U,__importDefault:V});var j=p(function(e,t){Object.defineProperty(t,"__esModule",{value:true});var n={NODE_CLIENT:false,NODE_ADMIN:false,SDK_VERSION:"${JSCORE_VERSION}"};var r=function(e,t){if(!e){throw i(t)}};var i=function(e){return new Error("Firebase Database ("+n.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)};var o=function(e){var t=[];var n=0;for(var r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i<128){t[n++]=i}else if(i<2048){t[n++]=i>>6|192;t[n++]=i&63|128}else if((i&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320){i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023);t[n++]=i>>18|240;t[n++]=i>>12&63|128;t[n++]=i>>6&63|128;t[n++]=i&63|128}else{t[n++]=i>>12|224;t[n++]=i>>6&63|128;t[n++]=i&63|128}}return t};var a=function(e){var t=[];var n=0,r=0;while(n<e.length){var i=e[n++];if(i<128){t[r++]=String.fromCharCode(i)}else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){var o=e[n++];var a=e[n++];var s=e[n++];var u=((i&7)<<18|(o&63)<<12|(a&63)<<6|s&63)-65536;t[r++]=String.fromCharCode(55296+(u>>10));t[r++]=String.fromCharCode(56320+(u&1023))}else{var o=e[n++];var a=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return t.join("")};var s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"abcdefghijklmnopqrstuvwxyz"+"0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(e,t){if(!Array.isArray(e)){throw Error("encodeByteArray takes an array as a parameter")}this.init_();var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_;var r=[];for(var i=0;i<e.length;i+=3){var o=e[i];var a=i+1<e.length;var s=a?e[i+1]:0;var u=i+2<e.length;var c=u?e[i+2]:0;var l=o>>2;var f=(o&3)<<4|s>>4;var h=(s&15)<<2|c>>6;var d=c&63;if(!u){d=64;if(!a){h=64}}r.push(n[l],n[f],n[h],n[d])}return r.join("")},encodeString:function(e,t){if(this.HAS_NATIVE_SUPPORT&&!t){return btoa(e)}return this.encodeByteArray(o(e),t)},decodeString:function(e,t){if(this.HAS_NATIVE_SUPPORT&&!t){return atob(e)}return a(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;var r=[];for(var i=0;i<e.length;){var o=n[e.charAt(i++)];var a=i<e.length;var s=a?n[e.charAt(i)]:0;++i;var u=i<e.length;var c=u?n[e.charAt(i)]:64;++i;var l=i<e.length;var f=l?n[e.charAt(i)]:64;++i;if(o==null||s==null||c==null||f==null){throw Error()}var h=o<<2|s>>4;r.push(h);if(c!==64){var d=s<<4&240|c>>2;r.push(d);if(f!==64){var p=c<<6&192|f;r.push(p)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={};this.charToByteMap_={};this.byteToCharMapWebSafe_={};this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++){this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e);this.charToByteMap_[this.byteToCharMap_[e]]=e;this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e);this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e;if(e>=this.ENCODED_VALS_BASE.length){this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e;this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e}}}}};var u=function(e){var t=o(e);return s.encodeByteArray(t,true)};var c=function(e){try{return s.decodeString(e,true)}catch(e){console.error("base64Decode failed: ",e)}return null};function l(e){return f(undefined,e)}function f(e,t){if(!(t instanceof Object)){return t}switch(t.constructor){case Date:var n=t;return new Date(n.getTime());case Object:if(e===undefined){e={}}break;case Array:e=[];break;default:return t}for(var r in t){if(!t.hasOwnProperty(r)){continue}e[r]=f(e[r],t[r])}return e}var d=function(){function e(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t;e.reject=n})}e.prototype.wrapCallback=function(e){var t=this;return function(n,r){if(n){t.reject(n)}else{t.resolve(r)}if(typeof e==="function"){t.promise.catch(function(){});if(e.length===1){e(n)}else{e(n,r)}}}};return e}();function p(){if(typeof navigator!=="undefined"&&typeof navigator["userAgent"]==="string"){return navigator["userAgent"]}else{return""}}function m(){return typeof window!=="undefined"&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())}function y(){try{return Object.prototype.toString.call(h.process)==="[object process]"}catch(e){return false}}function v(){return typeof self==="object"&&self.self===self}function g(){return typeof navigator==="object"&&navigator["product"]==="ReactNative"}function b(){return n.NODE_CLIENT===true||n.NODE_ADMIN===true}var w="FirebaseError";var E=function(e){B.__extends(t,e);function t(n,r){var i=e.call(this,r)||this;i.code=n;i.name=w;Object.setPrototypeOf(i,t.prototype);if(Error.captureStackTrace){Error.captureStackTrace(i,S.prototype.create)}return i}return t}(Error);var S=function(){function e(e,t,n){this.service=e;this.serviceName=t;this.errors=n}e.prototype.create=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}var r=t[0]||{};var i=this.service+"/"+e;var o=this.errors[e];var a=o?T(o,r):"Error";var s=this.serviceName+": "+a+" ("+i+").";var u=new E(i,s);for(var c=0,l=Object.keys(r);c<l.length;c++){var f=l[c];if(f.slice(-1)!=="_"){if(f in u){console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.')}u[f]=r[f]}}return u};return e}();function T(e,t){return e.replace(I,function(e,n){var r=t[n];return r!=null?r.toString():"<"+n+"?>"})}var I=/\{\$([^}]+)}/g;function _(e){return JSON.parse(e)}function D(e){return JSON.stringify(e)}var C=function(e){var t={},n={},r={},i="";try{var o=e.split(".");t=_(c(o[0])||"");n=_(c(o[1])||"");i=o[2];r=n["d"]||{};delete n["d"]}catch(e){}return{header:t,claims:n,data:r,signature:i}};var A=function(e){var t=C(e).claims;var n=Math.floor((new Date).getTime()/1e3);var r=0,i=0;if(typeof t==="object"){if(t.hasOwnProperty("nbf")){r=t["nbf"]}else if(t.hasOwnProperty("iat")){r=t["iat"]}if(t.hasOwnProperty("exp")){i=t["exp"]}else{i=r+86400}}return!!n&&!!r&&!!i&&n>=r&&n<=i};var N=function(e){var t=C(e).claims;if(typeof t==="object"&&t.hasOwnProperty("iat")){return t["iat"]}return null};var k=function(e){var t=C(e),n=t.claims;return!!n&&typeof n==="object"&&n.hasOwnProperty("iat")};var O=function(e){var t=C(e).claims;return typeof t==="object"&&t["admin"]===true};var x=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var R=function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};var M=function(e,t){for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){t(n,e[n])}}};var P=function(e,t){M(t,function(t,n){e[t]=n});return e};var L=function(e){return P({},e)};var F=function(e){return typeof e==="object"&&e!==null};var q=function(e){for(var t in e){return false}return true};var U=function(e){var t=0;for(var n in e){t++}return t};var V=function(e,t,n){var r={};for(var i in e){r[i]=t.call(n,e[i],i,e)}return r};var j=function(e,t,n){for(var r in e){if(t.call(n,e[r],r,e)){return r}}return undefined};var Q=function(e,t,n){var r=j(e,t,n);return r&&e[r]};var z=function(e){for(var t in e){return t}};var K=function(e){var t=[];var n=0;for(var r in e){t[n++]=e[r]}return t};var W=function(e,t){for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){if(!t(n,e[n])){return false}}}return true};var G=function(e){var t=[];M(e,function(e,n){if(Array.isArray(n)){n.forEach(function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})}else{t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}});return t.length?"&"+t.join("&"):""};var H=function(e){var t={};var n=e.replace(/^\?/,"").split("&");n.forEach(function(e){if(e){var n=e.split("=");t[n[0]]=n[1]}});return t};var Y=function(){function e(){this.chain_=[];this.buf_=[];this.W_=[];this.pad_=[];this.inbuf_=0;this.total_=0;this.blockSize=512/8;this.pad_[0]=128;for(var e=1;e<this.blockSize;++e){this.pad_[e]=0}this.reset()}e.prototype.reset=function(){this.chain_[0]=1732584193;this.chain_[1]=4023233417;this.chain_[2]=2562383102;this.chain_[3]=271733878;this.chain_[4]=3285377520;this.inbuf_=0;this.total_=0};e.prototype.compress_=function(e,t){if(!t){t=0}var n=this.W_;if(typeof e==="string"){for(var r=0;r<16;r++){n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3);t+=4}}else{for(var r=0;r<16;r++){n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];t+=4}}for(var r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=(i<<1|i>>>31)&4294967295}var o=this.chain_[0];var a=this.chain_[1];var s=this.chain_[2];var u=this.chain_[3];var c=this.chain_[4];var l,f;for(var r=0;r<80;r++){if(r<40){if(r<20){l=u^a&(s^u);f=1518500249}else{l=a^s^u;f=1859775393}}else{if(r<60){l=a&s|u&(a|s);f=2400959708}else{l=a^s^u;f=3395469782}}var i=(o<<5|o>>>27)+l+c+f+n[r]&4294967295;c=u;u=s;s=(a<<30|a>>>2)&4294967295;a=o;o=i}this.chain_[0]=this.chain_[0]+o&4294967295;this.chain_[1]=this.chain_[1]+a&4294967295;this.chain_[2]=this.chain_[2]+s&4294967295;this.chain_[3]=this.chain_[3]+u&4294967295;this.chain_[4]=this.chain_[4]+c&4294967295};e.prototype.update=function(e,t){if(e==null){return}if(t===undefined){t=e.length}var n=t-this.blockSize;var r=0;var i=this.buf_;var o=this.inbuf_;while(r<t){if(o===0){while(r<=n){this.compress_(e,r);r+=this.blockSize}}if(typeof e==="string"){while(r<t){i[o]=e.charCodeAt(r);++o;++r;if(o===this.blockSize){this.compress_(i);o=0;break}}}else{while(r<t){i[o]=e[r];++o;++r;if(o===this.blockSize){this.compress_(i);o=0;break}}}}this.inbuf_=o;this.total_+=t};e.prototype.digest=function(){var e=[];var t=this.total_*8;if(this.inbuf_<56){this.update(this.pad_,56-this.inbuf_)}else{this.update(this.pad_,this.blockSize-(this.inbuf_-56))}for(var n=this.blockSize-1;n>=56;n--){this.buf_[n]=t&255;t/=256}this.compress_(this.buf_);var r=0;for(var n=0;n<5;n++){for(var i=24;i>=0;i-=8){e[r]=this.chain_[n]>>i&255;++r}}return e};return e}();function $(e,t){var n=new X(e,t);return n.subscribe.bind(n)}var X=function(){function e(e,t){var n=this;this.observers=[];this.unsubscribes=[];this.observerCount=0;this.task=Promise.resolve();this.finalized=false;this.onNoObservers=t;this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}e.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})};e.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)});this.close(e)};e.prototype.complete=function(){this.forEachObserver(function(e){e.complete()});this.close()};e.prototype.subscribe=function(e,t,n){var r=this;var i;if(e===undefined&&t===undefined&&n===undefined){throw new Error("Missing Observer.")}if(Z(e,["next","error","complete"])){i=e}else{i={next:e,error:t,complete:n}}if(i.next===undefined){i.next=ee}if(i.error===undefined){i.error=ee}if(i.complete===undefined){i.complete=ee}var o=this.unsubscribeOne.bind(this,this.observers.length);if(this.finalized){this.task.then(function(){try{if(r.finalError){i.error(r.finalError)}else{i.complete()}}catch(e){}return})}this.observers.push(i);return o};e.prototype.unsubscribeOne=function(e){if(this.observers===undefined||this.observers[e]===undefined){return}delete this.observers[e];this.observerCount-=1;if(this.observerCount===0&&this.onNoObservers!==undefined){this.onNoObservers(this)}};e.prototype.forEachObserver=function(e){if(this.finalized){return}for(var t=0;t<this.observers.length;t++){this.sendOne(t,e)}};e.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(n.observers!==undefined&&n.observers[e]!==undefined){try{t(n.observers[e])}catch(e){if(typeof console!=="undefined"&&console.error){console.error(e)}}}})};e.prototype.close=function(e){var t=this;if(this.finalized){return}this.finalized=true;if(e!==undefined){this.finalError=e}this.task.then(function(){t.observers=undefined;t.onNoObservers=undefined})};return e}();function J(e,t){return function(){var n=[];for(var r=0;r<arguments.length;r++){n[r]=arguments[r]}Promise.resolve(true).then(function(){e.apply(void 0,n)}).catch(function(e){if(t){t(e)}})}}function Z(e,t){if(typeof e!=="object"||e===null){return false}for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&typeof e[i]==="function"){return true}}return false}function ee(){}var te=function(e,t,n,r){var i;if(r<t){i="at least "+t}else if(r>n){i=n===0?"none":"no more than "+n}if(i){var o=e+" failed: Was called with "+r+(r===1?" argument.":" arguments.")+" Expects "+i+".";throw new Error(o)}};function ne(e,t,n){var r="";switch(t){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=e+" failed: ";i+=r+" argument ";return i}function re(e,t,n,r){if(r&&!n){return}if(typeof n!=="string"){throw new Error(ne(e,t,r)+"must be a valid firebase namespace.")}}function ie(e,t,n,r){if(r&&!n){return}if(typeof n!=="function"){throw new Error(ne(e,t,r)+"must be a valid function.")}}function oe(e,t,n,r){if(r&&!n){return}if(typeof n!=="object"||n===null){throw new Error(ne(e,t,r)+"must be a valid context object.")}}var ae=function(e){var t=[];var n=0;for(var i=0;i<e.length;i++){var o=e.charCodeAt(i);if(o>=55296&&o<=56319){var a=o-55296;i++;r(i<e.length,"Surrogate pair missing trail surrogate.");var s=e.charCodeAt(i)-56320;o=65536+(a<<10)+s}if(o<128){t[n++]=o}else if(o<2048){t[n++]=o>>6|192;t[n++]=o&63|128}else if(o<65536){t[n++]=o>>12|224;t[n++]=o>>6&63|128;t[n++]=o&63|128}else{t[n++]=o>>18|240;t[n++]=o>>12&63|128;t[n++]=o>>6&63|128;t[n++]=o&63|128}}return t};var se=function(e){var t=0;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t++}else if(r<2048){t+=2}else if(r>=55296&&r<=56319){t+=4;n++}else{t+=3}}return t};t.CONSTANTS=n;t.Deferred=d;t.ErrorFactory=S;t.FirebaseError=E;t.Sha1=Y;t.assert=r;t.assertionError=i;t.async=J;t.base64=s;t.base64Decode=c;t.base64Encode=u;t.clone=L;t.contains=x;t.createSubscribe=$;t.decode=C;t.deepCopy=l;t.deepExtend=f;t.errorPrefix=ne;t.every=W;t.extend=P;t.findKey=j;t.findValue=Q;t.forEach=M;t.getAnyKey=z;t.getCount=U;t.getUA=p;t.getValues=K;t.isAdmin=O;t.isBrowser=v;t.isEmpty=q;t.isMobileCordova=m;t.isNode=y;t.isNodeSdk=b;t.isNonNullObject=F;t.isReactNative=g;t.isValidFormat=k;t.isValidTimestamp=A;t.issuedAtTime=N;t.jsonEval=_;t.map=V;t.querystring=G;t.querystringDecode=H;t.safeGet=R;t.stringLength=se;t.stringToByteArray=ae;t.stringify=D;t.validateArgCount=te;t.validateCallback=ie;t.validateContextObject=oe;t.validateNamespace=re});d(j);var Q=j.CONSTANTS;var z=j.Deferred;var K=j.ErrorFactory;var W=j.FirebaseError;var G=j.Sha1;var H=j.assert;var Y=j.assertionError;var $=j.async;var X=j.base64;var J=j.base64Decode;var Z=j.base64Encode;var ee=j.clone;var te=j.contains;var ne=j.createSubscribe;var re=j.decode;var ie=j.deepCopy;var oe=j.deepExtend;var ae=j.errorPrefix;var se=j.every;var ue=j.extend;var ce=j.findKey;var le=j.findValue;var fe=j.forEach;var he=j.getAnyKey;var de=j.getCount;var pe=j.getUA;var me=j.getValues;var ye=j.isAdmin;var ve=j.isBrowser;var ge=j.isEmpty;var be=j.isMobileCordova;var we=j.isNode;var Ee=j.isNodeSdk;var Se=j.isNonNullObject;var Te=j.isReactNative;var Ie=j.isValidFormat;var _e=j.isValidTimestamp;var De=j.issuedAtTime;var Ce=j.jsonEval;var Ae=j.map;var Ne=j.querystring;var ke=j.querystringDecode;var Oe=j.safeGet;var xe=j.stringLength;var Re=j.stringToByteArray;var Me=j.stringify;var Pe=j.validateArgCount;var Le=j.validateCallback;var Fe=j.validateContextObject;var qe=j.validateNamespace;var Ue=[];var Ve;(function(e){e[e["DEBUG"]=0]="DEBUG";e[e["VERBOSE"]=1]="VERBOSE";e[e["INFO"]=2]="INFO";e[e["WARN"]=3]="WARN";e[e["ERROR"]=4]="ERROR";e[e["SILENT"]=5]="SILENT"})(Ve||(Ve={}));var Be=Ve.INFO;var je=function(e,t){var n=[];for(var r=2;r<arguments.length;r++){n[r-2]=arguments[r]}if(t<e.logLevel){return}var i=(new Date).toISOString();switch(t){case Ve.DEBUG:console.log.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case Ve.VERBOSE:console.log.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case Ve.INFO:console.info.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case Ve.WARN:console.warn.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case Ve.ERROR:console.error.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}};var Qe=function(){function e(e){this.name=e;this._logLevel=Be;this._logHandler=je;Ue.push(this)}Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in Ve)){throw new TypeError("Invalid value assigned to `logLevel`")}this._logLevel=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if(typeof e!=="function"){throw new TypeError("Value assigned to `logHandler` must be a function")}this._logHandler=e},enumerable:true,configurable:true});e.prototype.debug=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,Ve.DEBUG].concat(e))};e.prototype.log=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,Ve.VERBOSE].concat(e))};e.prototype.info=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,Ve.INFO].concat(e))};e.prototype.warn=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,Ve.WARN].concat(e))};e.prototype.error=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,Ve.ERROR].concat(e))};return e}();function ze(e){Ue.forEach(function(t){t.logLevel=e})}var Ke=Object.freeze({get LogLevel(){return Ve},Logger:Qe,setLogLevel:ze});var We=p(function(e,t){Object.defineProperty(t,"__esModule",{value:true});var n;var r=(n={},n["no-app"]="No Firebase App '{$name}' has been created - "+"call Firebase App.initializeApp()",n["bad-app-name"]="Illegal App name: '{$name}",n["duplicate-app"]="Firebase App named '{$name}' already exists",n["app-deleted"]="Firebase App named '{$name}' already deleted",n["duplicate-service"]="Firebase service named '{$name}' already registered",n["invalid-app-argument"]="firebase.{$name}() takes either no argument or a "+"Firebase App instance.",n);var i=new j.ErrorFactory("app","Firebase",r);var o="[DEFAULT]";var a=[];var s=function(){function e(e,t,n){this.firebase_=n;this.isDeleted_=false;this.services_={};this.name_=t.name;this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||false;this.options_=j.deepCopy(e);this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(e){a.push(e);setTimeout(function(){return e(null)},0)},removeAuthTokenListener:function(e){a=a.filter(function(t){return t!==e})}}}Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){this.checkDestroyed_();return this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_();this.automaticDataCollectionEnabled_=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"name",{get:function(){this.checkDestroyed_();return this.name_},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"options",{get:function(){this.checkDestroyed_();return this.options_},enumerable:true,configurable:true});e.prototype.delete=function(){var e=this;return new Promise(function(t){e.checkDestroyed_();t()}).then(function(){e.firebase_.INTERNAL.removeApp(e.name_);var t=[];for(var n=0,r=Object.keys(e.services_);n<r.length;n++){var i=r[n];for(var o=0,a=Object.keys(e.services_[i]);o<a.length;o++){var s=a[o];t.push(e.services_[i][s])}}return Promise.all(t.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))}).then(function(){e.isDeleted_=true;e.services_={}})};e.prototype._getService=function(e,t){if(t===void 0){t=o}this.checkDestroyed_();if(!this.services_[e]){this.services_[e]={}}if(!this.services_[e][t]){var n=t!==o?t:undefined;var r=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),n);this.services_[e][t]=r}return this.services_[e][t]};e.prototype.extendApp=function(e){var t=this;j.deepExtend(this,e);if(e.INTERNAL&&e.INTERNAL.addAuthTokenListener){a.forEach(function(e){t.INTERNAL.addAuthTokenListener(e)});a=[]}};e.prototype.checkDestroyed_=function(){if(this.isDeleted_){throw i.create("app-deleted",{name:this.name_})}};return e}();s.prototype.name&&s.prototype.options||s.prototype.delete||console.log("dc");var u="6.2.2";function c(e){var t={};var n={};var r={};var a={__esModule:true,initializeApp:l,app:c,apps:null,SDK_VERSION:u,INTERNAL:{registerService:h,removeApp:s,factories:n,useAsService:p}};a["default"]=a;Object.defineProperty(a,"apps",{get:f});function s(e){var n=t[e];d(n,"delete");delete t[e]}function c(e){e=e||o;if(!j.contains(t,e)){throw i.create("no-app",{name:e})}return t[e]}c["App"]=e;function l(n,r){if(r===void 0){r={}}if(typeof r!=="object"||r===null){var s=r;r={name:s}}var u=r;if(u.name===undefined){u.name=o}var c=u.name;if(typeof c!=="string"||!c){throw i.create("bad-app-name",{name:String(c)})}if(j.contains(t,c)){throw i.create("duplicate-app",{name:c})}var l=new e(n,u,a);t[c]=l;d(l,"create");return l}function f(){return Object.keys(t).map(function(e){return t[e]})}function h(t,o,s,u,l){if(l===void 0){l=false}if(n[t]){throw i.create("duplicate-service",{name:t})}n[t]=o;if(u){r[t]=u;f().forEach(function(e){u("create",e)})}function h(e){if(e===void 0){e=c()}if(typeof e[t]!=="function"){throw i.create("invalid-app-argument",{name:t})}return e[t]()}if(s!==undefined){j.deepExtend(h,s)}a[t]=h;e.prototype[t]=function(){var e=[];for(var n=0;n<arguments.length;n++){e[n]=arguments[n]}var r=this._getService.bind(this,t);return r.apply(this,l?e:[])};return h}function d(e,t){for(var i=0,o=Object.keys(n);i<o.length;i++){var a=o[i];var s=p(e,a);if(s===null){return}if(r[s]){r[s](t,e)}}}function p(e,t){if(t==="serverAuth"){return null}var n=t;return n}return a}function l(){var e=c(s);e.INTERNAL=B.__assign({},e.INTERNAL,{createFirebaseNamespace:l,extendNamespace:t,createSubscribe:j.createSubscribe,ErrorFactory:j.ErrorFactory,deepExtend:j.deepExtend});function t(t){j.deepExtend(e,t)}return e}var f=new Ke.Logger("@firebase/app");if(j.isBrowser()&&self.firebase!==undefined){f.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var h=self.firebase.SDK_VERSION;if(h&&h.indexOf("LITE")>=0){f.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}}var d=l();var p=d.initializeApp;d.initializeApp=function(){if(j.isNode()){f.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and set "module"\n      to false and "main" to true:\n      https://github.com/rollup/rollup-plugin-node-resolve\n      ')}return p.apply(undefined,arguments)};var m=d;t.default=m;t.firebase=m});d(We);var Ge=We.firebase;function He(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var Ye=He(We);var $e=Ye;var Xe=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var Je,Ze=Ze||{},et=Xe;function tt(e){return"string"==typeof e}function nt(e){return"number"==typeof e}function rt(e,t){e=e.split(".");t=t||et;for(var n=0;n<e.length;n++)if(t=t[e[n]],null==t)return null;return t}function it(){}function ot(e){var t=typeof e;if("object"==t)if(e){if(e instanceof Array)return"array";if(e instanceof Object)return t;var n=Object.prototype.toString.call(e);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==t&&"undefined"==typeof e.call)return"object";return t}function at(e){return"array"==ot(e)}function st(e){var t=ot(e);return"array"==t||"object"==t&&"number"==typeof e.length}function ut(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var ct="closure_uid_"+(1e9*Math.random()>>>0),lt=0;function ft(e,t,n){return e.call.apply(e.bind,arguments)}function ht(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(n,r);return e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function dt(e,t,n){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?dt=ft:dt=ht;return dt.apply(null,arguments)}function pt(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();t.push.apply(t,arguments);return e.apply(this,t)}}var mt=Date.now||function(){return+new Date};function yt(e,t){function n(){}n.prototype=t.prototype;e.N=t.prototype;e.prototype=new n;e.prototype.constructor=e;e.yb=function(e,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[n].apply(e,i)}}function vt(){this.j=this.j;this.i=this.i}var gt=0;vt.prototype.j=!1;vt.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0!=gt)){var e=this[ct]||(this[ct]=++lt)}};vt.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var bt=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(tt(e))return tt(t)&&1==t.length?e.indexOf(t,0):-1;for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},wt=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=tt(e)?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function Et(e){e:{var t=Ui;for(var n=e.length,r=tt(e)?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:tt(e)?e.charAt(t):e[t]}function St(e){return Array.prototype.concat.apply([],arguments)}function Tt(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function It(e){return/^[\s\xa0]*$/.test(e)}var _t=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Dt(e,t){return-1!=e.indexOf(t)}function Ct(e,t){return e<t?-1:e>t?1:0}var At;e:{var Nt=et.navigator;if(Nt){var kt=Nt.userAgent;if(kt){At=kt;break e}}At=""}function Ot(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function xt(e){var t={},n;for(n in e)t[n]=e[n];return t}var Rt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Mt(e,t){for(var n,r,i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(var o=0;o<Rt.length;o++)n=Rt[o],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Pt(e){Pt[" "](e);return e}Pt[" "]=it;function Lt(e,t){var n=Ht;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}var Ft=Dt(At,"Opera"),qt=Dt(At,"Trident")||Dt(At,"MSIE"),Ut=Dt(At,"Edge"),Vt=Ut||qt,Bt=Dt(At,"Gecko")&&!(Dt(At.toLowerCase(),"webkit")&&!Dt(At,"Edge"))&&!(Dt(At,"Trident")||Dt(At,"MSIE"))&&!Dt(At,"Edge"),jt=Dt(At.toLowerCase(),"webkit")&&!Dt(At,"Edge");function Qt(){var e=et.document;return e?e.documentMode:void 0}var zt;e:{var Kt="",Wt=function(){var e=At;if(Bt)return/rv:([^\);]+)(\)|;)/.exec(e);if(Ut)return/Edge\/([\d\.]+)/.exec(e);if(qt)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(jt)return/WebKit\/(\S+)/.exec(e);if(Ft)return/(?:Version)[ \/]?(\S+)/.exec(e)}();Wt&&(Kt=Wt?Wt[1]:"");if(qt){var Gt=Qt();if(null!=Gt&&Gt>parseFloat(Kt)){zt=String(Gt);break e}}zt=Kt}var Ht={};function Yt(e){return Lt(e,function(){for(var t=0,n=_t(String(zt)).split("."),r=_t(String(e)).split("."),i=Math.max(n.length,r.length),o=0;0==t&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""];s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""];if(0==a[0].length&&0==s[0].length)break;t=Ct(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||Ct(0==a[2].length,0==s[2].length)||Ct(a[2],s[2]);a=a[3];s=s[3]}while(0==t)}return 0<=t})}var $t;var Xt=et.document;$t=Xt&&qt?Qt()||("CSS1Compat"==Xt.compatMode?parseInt(zt,10):5):void 0;var Jt=!qt||9<=Number($t),Zt=qt&&!Yt("9"),en=function(){if(!et.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{et.addEventListener("test",it,t),et.removeEventListener("test",it,t)}catch(e){}return e}();function tn(e,t){this.type=e;this.a=this.target=t;this.Ja=!0}tn.prototype.b=function(){this.Ja=!1};function nn(e,t){tn.call(this,e?e.type:"");this.relatedTarget=this.a=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType="";this.c=null;if(e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement;this.a=t;if(t=e.relatedTarget){if(Bt){e:{try{Pt(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t;r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0);this.button=e.button;this.key=e.key||"";this.ctrlKey=e.ctrlKey;this.altKey=e.altKey;this.shiftKey=e.shiftKey;this.metaKey=e.metaKey;this.pointerId=e.pointerId||0;this.pointerType=tt(e.pointerType)?e.pointerType:rn[e.pointerType]||"";this.c=e;e.defaultPrevented&&this.b()}}yt(nn,tn);var rn={2:"touch",3:"pen",4:"mouse"};nn.prototype.b=function(){nn.N.b.call(this);var e=this.c;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,Zt)try{if(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)e.keyCode=-1}catch(e){}};var on="closure_listenable_"+(1e6*Math.random()|0),an=0;function sn(e,t,n,r,i){this.listener=e;this.proxy=null;this.src=t;this.type=n;this.capture=!!r;this.da=i;this.key=++an;this.X=this.Z=!1}function un(e){e.X=!0;e.listener=null;e.proxy=null;e.src=null;e.da=null}function cn(e){this.src=e;this.a={};this.b=0}cn.prototype.add=function(e,t,n,r,i){var o=e.toString();e=this.a[o];e||(e=this.a[o]=[],this.b++);var a=fn(e,t,r,i);-1<a?(t=e[a],n||(t.Z=!1)):(t=new sn(t,this.src,o,!!r,i),t.Z=n,e.push(t));return t};function ln(e,t){var n=t.type;if(n in e.a){var r=e.a[n],i=bt(r,t),o;(o=0<=i)&&Array.prototype.splice.call(r,i,1);o&&(un(t),0==e.a[n].length&&(delete e.a[n],e.b--))}}function fn(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.X&&o.listener==t&&o.capture==!!n&&o.da==r)return i}return-1}var hn="closure_lm_"+(1e6*Math.random()|0),dn={};function pn(e,t,n,r,i){if(r&&r.once)return vn(e,t,n,r,i);if(at(t)){for(var o=0;o<t.length;o++)pn(e,t[o],n,r,i);return null}n=_n(n);return e&&e[on]?e.Aa(t,n,ut(r)?!!r.capture:!!r,i):mn(e,t,n,!1,r,i)}function mn(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var a=ut(i)?!!i.capture:!!i;if(a&&!Jt)return null;var s=Tn(e);s||(e[hn]=s=new cn(e));n=s.add(t,n,r,a,o);if(n.proxy)return n;r=yn();n.proxy=r;r.src=e;r.listener=n;if(e.addEventListener)en||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(wn(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function yn(){var e=Sn,t=Jt?function(n){return e.call(t.src,t.listener,n)}:function(n){n=e.call(t.src,t.listener,n);if(!n)return n};return t}function vn(e,t,n,r,i){if(at(t)){for(var o=0;o<t.length;o++)vn(e,t[o],n,r,i);return null}n=_n(n);return e&&e[on]?e.Ba(t,n,ut(r)?!!r.capture:!!r,i):mn(e,t,n,!0,r,i)}function gn(e,t,n,r,i){if(at(t))for(var o=0;o<t.length;o++)gn(e,t[o],n,r,i);else(r=ut(r)?!!r.capture:!!r,n=_n(n),e&&e[on])?(e=e.c,t=String(t).toString(),t in e.a&&(o=e.a[t],n=fn(o,n,r,i),-1<n&&(un(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete e.a[t],e.b--)))):e&&(e=Tn(e))&&(t=e.a[t.toString()],e=-1,t&&(e=fn(t,n,r,i)),(n=-1<e?t[e]:null)&&bn(n))}function bn(e){if(!nt(e)&&e&&!e.X){var t=e.src;if(t&&t[on])ln(t.c,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(wn(n),r):t.addListener&&t.removeListener&&t.removeListener(r);(n=Tn(t))?(ln(n,e),0==n.b&&(n.src=null,t[hn]=null)):un(e)}}}function wn(e){return e in dn?dn[e]:dn[e]="on"+e}function En(e,t){var n=e.listener,r=e.da||e.src;e.Z&&bn(e);return n.call(r,t)}function Sn(e,t){return e.X?!0:Jt?En(e,new nn(t,this)):(t=new nn(t||rt("window.event"),this),En(e,t))}function Tn(e){e=e[hn];return e instanceof cn?e:null}var In="__closure_events_fn_"+(1e9*Math.random()>>>0);function _n(e){if("function"==ot(e))return e;e[In]||(e[In]=function(t){return e.handleEvent(t)});return e[In]}function Dn(){vt.call(this);this.c=new cn(this);this.J=this;this.B=null}yt(Dn,vt);Dn.prototype[on]=!0;Je=Dn.prototype;Je.addEventListener=function(e,t,n,r){pn(this,e,t,n,r)};Je.removeEventListener=function(e,t,n,r){gn(this,e,t,n,r)};Je.dispatchEvent=function(e){var t,n=this.B;if(n)for(t=[];n;n=n.B)t.push(n);n=this.J;var r=e.type||e;if(tt(e))e=new tn(e,n);else if(e instanceof tn)e.target=e.target||n;else{var i=e;e=new tn(r,n);Mt(e,i)}i=!0;if(t)for(var o=t.length-1;0<=o;o--){var a=e.a=t[o];i=Cn(a,r,!0,e)&&i}a=e.a=n;i=Cn(a,r,!0,e)&&i;i=Cn(a,r,!1,e)&&i;if(t)for(o=0;o<t.length;o++)a=e.a=t[o],i=Cn(a,r,!1,e)&&i;return i};Je.G=function(){Dn.N.G.call(this);if(this.c){var e=this.c,t;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)un(n[r]);delete e.a[t];e.b--}}this.B=null};Je.Aa=function(e,t,n,r){return this.c.add(String(e),t,!1,n,r)};Je.Ba=function(e,t,n,r){return this.c.add(String(e),t,!0,n,r)};function Cn(e,t,n,r){t=e.c.a[String(t)];if(!t)return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var a=t[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&ln(e.c,a);i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}var An=et.JSON.stringify;function Nn(e,t){this.c=e;this.f=t;this.b=0;this.a=null}Nn.prototype.get=function(){if(0<this.b){this.b--;var e=this.a;this.a=e.next;e.next=null}else e=this.c();return e};function kn(){this.b=this.a=null}var On=new Nn(function(){return new Rn},function(e){e.reset()});kn.prototype.add=function(e,t){var n=On.get();n.set(e,t);this.b?this.b.next=n:this.a=n;this.b=n};function xn(){var e=Un,t=null;e.a&&(t=e.a,e.a=e.a.next,e.a||(e.b=null),t.next=null);return t}function Rn(){this.next=this.b=this.a=null}Rn.prototype.set=function(e,t){this.a=e;this.b=t;this.next=null};Rn.prototype.reset=function(){this.next=this.b=this.a=null};function Mn(e){et.setTimeout(function(){throw e},0)}function Pn(e,t){Ln||Fn();qn||(Ln(),qn=!0);Un.add(e,t)}var Ln;function Fn(){var e=et.Promise.resolve(void 0);Ln=function(){e.then(Vn)}}var qn=!1,Un=new kn;function Vn(){for(var e;e=xn();){try{e.a.call(e.b)}catch(e){Mn(e)}var t=On;t.f(e);100>t.b&&(t.b++,e.next=t.a,t.a=e)}qn=!1}function Bn(e,t){Dn.call(this);this.b=e||1;this.a=t||et;this.f=dt(this.gb,this);this.g=mt()}yt(Bn,Dn);Je=Bn.prototype;Je.ba=!1;Je.L=null;Je.gb=function(){if(this.ba){var e=mt()-this.g;0<e&&e<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-e):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(jn(this),this.start()))}};Je.start=function(){this.ba=!0;this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=mt())};function jn(e){e.ba=!1;e.L&&(e.a.clearTimeout(e.L),e.L=null)}Je.G=function(){Bn.N.G.call(this);jn(this);delete this.a};function Qn(e,t,n){if("function"==ot(e))n&&(e=dt(e,n));else if(e&&"function"==typeof e.handleEvent)e=dt(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:et.setTimeout(e,t||0)}function zn(e,t,n){vt.call(this);this.f=null!=n?dt(e,n):e;this.c=t;this.b=dt(this.ab,this);this.a=[]}yt(zn,vt);Je=zn.prototype;Je.ea=!1;Je.U=null;Je.Ua=function(e){this.a=arguments;this.U?this.ea=!0:Kn(this)};Je.G=function(){zn.N.G.call(this);this.U&&(et.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])};Je.ab=function(){this.U=null;this.ea&&(this.ea=!1,Kn(this))};function Kn(e){e.U=Qn(e.b,e.c);e.f.apply(null,e.a)}function Wn(e){vt.call(this);this.b=e;this.a={}}yt(Wn,vt);var Gn=[];function Hn(e,t,n,r){at(n)||(n&&(Gn[0]=n.toString()),n=Gn);for(var i=0;i<n.length;i++){var o=pn(t,n[i],r||e.handleEvent,!1,e.b||e);if(!o)break;e.a[o.key]=o}}function Yn(e){Ot(e.a,function(e,t){this.a.hasOwnProperty(t)&&bn(e)},e);e.a={}}Wn.prototype.G=function(){Wn.N.G.call(this);Yn(this)};Wn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function $n(){}var Xn=new Dn;function Jn(e){tn.call(this,"serverreachability",e)}yt(Jn,tn);function Zn(e){Xn.dispatchEvent(new Jn(Xn,e))}function er(e){tn.call(this,"statevent",e)}yt(er,tn);function tr(e){Xn.dispatchEvent(new er(Xn,e))}function nr(e){tn.call(this,"timingevent",e)}yt(nr,tn);function rr(e,t){if("function"!=ot(e))throw Error("Fn must not be null and must be a function");return et.setTimeout(function(){e()},t)}var ir={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9};var or={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function ar(){}ar.prototype.a=null;function sr(e){var t;(t=e.a)||(t=e.a={});return t}function ur(){}var cr={OPEN:"a",ib:"b",Na:"c",rb:"d"};function lr(){tn.call(this,"d")}yt(lr,tn);function fr(){tn.call(this,"c")}yt(fr,tn);var hr;function dr(){}yt(dr,ar);hr=new dr;function pr(e,t,n){this.g=e;this.W=t;this.V=n||1;this.I=new Wn(this);this.O=mr;e=Vt?125:void 0;this.P=new Bn(e);this.h=null;this.b=!1;this.l=this.D=this.f=this.F=this.v=this.R=this.i=null;this.j=[];this.a=null;this.A=0;this.c=this.w=null;this.o=-1;this.m=!1;this.J=0;this.B=null;this.s=this.S=this.H=!1}var mr=45e3,yr={},vr={};Je=pr.prototype;Je.setTimeout=function(e){this.O=e};function gr(e,t,n){e.F=1;e.f=Wr(Ur(t));e.l=n;e.H=!0;wr(e,null)}function br(e,t,n,r){e.F=1;e.f=Wr(Ur(t));e.l=null;e.H=n;wr(e,r)}function wr(e,t){e.v=mt();Tr(e);e.D=Ur(e.f);Kr(e.D,"t",e.V);e.A=0;e.a=e.g.$(e.g.Y()?t:null);0<e.J&&(e.B=new zn(dt(e.Ka,e,e.a),e.J));Hn(e.I,e.a,"readystatechange",e.eb);t=e.h?xt(e.h):{};e.l?(e.w||(e.w="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.a.ca(e.D,e.w,e.l,t)):(e.w="GET",e.a.ca(e.D,e.w,null,t));Zn(1)}Je.eb=function(e){e=e.target;var t=this.B;t&&3==Ki(e)?t.Ua():this.Ka(e)};Je.Ka=function(e){try{if(e==this.a)e:{var t=Ki(this.a),n=this.a.ya(),r=this.a.T();if(!(3>t||3==t&&!Vt&&!this.a.aa())){this.m||4!=t||7==n||(8==n||0>=r?Zn(3):Zn(2));_r(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){t:{if(this.a){var a=Wi(this.a,"X-HTTP-Initial-Response");if(a&&!It(a)){var s=a;break t}}s=null}if(s)this.s=!0,Ar(this,s);else{this.b=!1;this.c=3;tr(12);Cr(this);Dr(this);break e}}this.H?(Er(this,t,o),Vt&&this.b&&3==t&&(Hn(this.I,this.P,"tick",this.cb),this.P.start())):Ar(this,o);4==t&&Cr(this);this.b&&!this.m&&(4==t?this.g.na(this):(this.b=!1,Tr(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,tr(12)):(this.c=0,tr(13)),Cr(this),Dr(this)}}}catch(e){}finally{}};function Er(e,t,n){for(var r=!0;!e.m&&e.A<n.length;){var i=Sr(e,n);if(i==vr){4==t&&(e.c=4,tr(14),r=!1);break}else if(i==yr){e.c=4;tr(15);r=!1;break}else Ar(e,i)}4==t&&0==n.length&&(e.c=1,tr(16),r=!1);e.b=e.b&&r;r||(Cr(e),Dr(e))}Je.cb=function(){if(this.a){var e=Ki(this.a),t=this.a.aa();this.A<t.length&&(_r(this),Er(this,e,t),this.b&&4!=e&&Tr(this))}};function Sr(e,t){var n=e.A,r=t.indexOf("\n",n);if(-1==r)return vr;n=Number(t.substring(n,r));if(isNaN(n))return yr;r+=1;if(r+n>t.length)return vr;t=t.substr(r,n);e.A=r+n;return t}Je.cancel=function(){this.m=!0;Cr(this)};function Tr(e){e.R=mt()+e.O;Ir(e,e.O)}function Ir(e,t){if(null!=e.i)throw Error("WatchDog timer not null");e.i=rr(dt(e.bb,e),t)}function _r(e){e.i&&(et.clearTimeout(e.i),e.i=null)}Je.bb=function(){this.i=null;var e=mt();0<=e-this.R?(2!=this.F&&(Zn(3),tr(17)),Cr(this),this.c=2,Dr(this)):Ir(this,this.R-e)};function Dr(e){e.g.Da()||e.m||e.g.na(e)}function Cr(e){_r(e);var t=e.B;t&&"function"==typeof t.la&&t.la();e.B=null;jn(e.P);Yn(e.I);e.a&&(t=e.a,e.a=null,t.abort(),t.la())}function Ar(e,t){try{e.g.Ga(e,t),Zn(4)}catch(e){}}function Nr(e){if(e.C&&"function"==typeof e.C)return e.C();if(tt(e))return e.split("");if(st(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[];n=0;for(r in e)t[n++]=e[r];return t}function kr(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(st(e)||tt(e))wt(e,t,void 0);else{if(e.K&&"function"==typeof e.K)var n=e.K();else if(e.C&&"function"==typeof e.C)n=void 0;else if(st(e)||tt(e)){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=Nr(e);i=r.length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function Or(e,t){this.b={};this.a=[];this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Or)for(n=e.K(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}Je=Or.prototype;Je.C=function(){Mr(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e};Je.K=function(){Mr(this);return this.a.concat()};function xr(e){e.b={};e.a.length=0;e.c=0}function Rr(e,t){Pr(e.b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&Mr(e))}function Mr(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];Pr(e.b,r)&&(e.a[n++]=r);t++}e.a.length=n}if(e.c!=e.a.length){var i={};for(n=t=0;t<e.a.length;)r=e.a[t],Pr(i,r)||(e.a[n++]=r,i[r]=1),t++;e.a.length=n}}Je.get=function(e,t){return Pr(this.b,e)?this.b[e]:t};Je.set=function(e,t){Pr(this.b,e)||(this.c++,this.a.push(e));this.b[e]=t};Je.forEach=function(e,t){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};function Pr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Lr=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Fr(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function qr(e,t){this.b=this.j=this.f="";this.i=null;this.g=this.a="";this.h=!1;var n;e instanceof qr?(this.h=void 0!==t?t:e.h,Vr(this,e.f),this.j=e.j,Br(this,e.b),jr(this,e.i),this.a=e.a,Qr(this,ui(e.c)),this.g=e.g):e&&(n=String(e).match(Lr))?(this.h=!!t,Vr(this,n[1]||"",!0),this.j=Yr(n[2]||""),Br(this,n[3]||"",!0),jr(this,n[4]),this.a=Yr(n[5]||"",!0),Qr(this,n[6]||"",!0),this.g=Yr(n[7]||"")):(this.h=!!t,this.c=new ri(null,this.h))}qr.prototype.toString=function(){var e=[],t=this.f;t&&e.push($r(t,Jr,!0),":");var n=this.b;if(n||"file"==t)e.push("//"),(t=this.j)&&e.push($r(t,Jr,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.i,null!=n&&e.push(":",String(n));if(n=this.a)this.b&&"/"!=n.charAt(0)&&e.push("/"),e.push($r(n,"/"==n.charAt(0)?ei:Zr,!0));(n=this.c.toString())&&e.push("?",n);(n=this.g)&&e.push("#",$r(n,ni));return e.join("")};qr.prototype.resolve=function(e){var t=Ur(this),n=!!e.f;n?Vr(t,e.f):n=!!e.j;n?t.j=e.j:n=!!e.b;n?Br(t,e.b):n=null!=e.i;var r=e.a;if(n)jr(t,e.i);else if(n=!!e.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=t.a.lastIndexOf("/");-1!=i&&(r=t.a.substr(0,i+1)+r)}i=r;if(".."==i||"."==i)r="";else if(Dt(i,"./")||Dt(i,"/.")){r=0==i.lastIndexOf("/",0);i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}n?t.a=r:n=""!==e.c.toString();n?Qr(t,ui(e.c)):n=!!e.g;n&&(t.g=e.g);return t};function Ur(e){return new qr(e)}function Vr(e,t,n){e.f=n?Yr(t,!0):t;e.f&&(e.f=e.f.replace(/:$/,""))}function Br(e,t,n){e.b=n?Yr(t,!0):t}function jr(e,t){if(t){t=Number(t);if(isNaN(t)||0>t)throw Error("Bad port number "+t);e.i=t}else e.i=null}function Qr(e,t,n){t instanceof ri?(e.c=t,li(e.c,e.h)):(n||(t=$r(t,ti)),e.c=new ri(t,e.h))}function zr(e,t,n){e.c.set(t,n)}function Kr(e,t,n){at(n)||(n=[String(n)]);si(e.c,t,n)}function Wr(e){zr(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^mt()).toString(36));return e}function Gr(e){return e instanceof qr?Ur(e):new qr(e,void 0)}function Hr(e,t,n,r){var i=new qr(null,void 0);e&&Vr(i,e);t&&Br(i,t);n&&jr(i,n);r&&(i.a=r);return i}function Yr(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function $r(e,t,n){return tt(e)?(e=encodeURI(e).replace(t,Xr),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Xr(e){e=e.charCodeAt(0);return"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var Jr=/[#\/\?@]/g,Zr=/[#\?:]/g,ei=/[#\?]/g,ti=/[#\?@]/g,ni=/#/g;function ri(e,t){this.b=this.a=null;this.c=e||null;this.f=!!t}function ii(e){e.a||(e.a=new Or,e.b=0,e.c&&Fr(e.c,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}Je=ri.prototype;Je.add=function(e,t){ii(this);this.c=null;e=ci(this,e);var n=this.a.get(e);n||this.a.set(e,n=[]);n.push(t);this.b+=1;return this};function oi(e,t){ii(e);t=ci(e,t);Pr(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,Rr(e.a,t))}function ai(e,t){ii(e);t=ci(e,t);return Pr(e.a.b,t)}Je.forEach=function(e,t){ii(this);this.a.forEach(function(n,r){wt(n,function(n){e.call(t,n,r,this)},this)},this)};Je.K=function(){ii(this);for(var e=this.a.C(),t=this.a.K(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n};Je.C=function(e){ii(this);var t=[];if(tt(e))ai(this,e)&&(t=St(t,this.a.get(ci(this,e))));else{e=this.a.C();for(var n=0;n<e.length;n++)t=St(t,e[n])}return t};Je.set=function(e,t){ii(this);this.c=null;e=ci(this,e);ai(this,e)&&(this.b-=this.a.get(e).length);this.a.set(e,[t]);this.b+=1;return this};Je.get=function(e,t){if(!e)return t;e=this.C(e);return 0<e.length?String(e[0]):t};function si(e,t,n){oi(e,t);0<n.length&&(e.c=null,e.a.set(ci(e,t),Tt(n)),e.b+=n.length)}Je.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.K(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o])));e.push(a)}}return this.c=e.join("&")};function ui(e){var t=new ri;t.c=e.c;e.a&&(t.a=new Or(e.a),t.b=e.b);return t}function ci(e,t){t=String(t);e.f&&(t=t.toLowerCase());return t}function li(e,t){t&&!e.f&&(ii(e),e.c=null,e.a.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(oi(this,t),si(this,n,e))},e));e.f=t}function fi(){}function hi(){}yt(hi,fi);function di(e){this.a=e;this.b=this.h=null;this.g=!1;this.i=null;this.c=-1;this.l=this.f=null}Je=di.prototype;Je.M=null;function pi(e){var t=e.a.F.a;if(null!=t)tr(4),t?(tr(10),ao(e.a,e,!1)):(tr(11),ao(e.a,e,!0));else{e.b=new pr(e,void 0,void 0);e.b.h=e.h;t=e.a;t=fo(t,t.Y()?e.f:null,e.i);tr(4);Kr(t,"TYPE","xmlhttp");var n=e.a.j,r=e.a.I;n&&r&&zr(t,n,r);br(e.b,t,!1,e.f)}}Je.$=function(e){return this.a.$(e)};Je.abort=function(){this.b&&(this.b.cancel(),this.b=null);this.c=-1};Je.Da=function(){return!1};Je.Ga=function(e,t){this.c=e.o;if(0==this.M){if(!this.a.o&&(e=e.a)){var n=Wi(e,"X-Client-Wire-Protocol");this.l=n?n:null;this.a.j&&(e=Wi(e,"X-HTTP-Session-Id"))&&(this.a.I=e)}if(t){try{var r=this.a.ja.a.parse(t)}catch(e){t=this.a;t.m=this.c;co(t,2);return}this.f=r[0]}else t=this.a,t.m=this.c,co(t,2)}else if(1==this.M)if(this.g)tr(6);else if("11111"==t){if(tr(5),this.g=!0,!qt||10<=Number($t))this.c=200,this.b.cancel(),tr(11),ao(this.a,this,!0)}else tr(7),this.g=!1};Je.na=function(){this.c=this.b.o;if(this.b.b)0==this.M?(this.M=1,pi(this)):1==this.M&&(this.g?(tr(11),ao(this.a,this,!0)):(tr(10),ao(this.a,this,!1)));else{0==this.M?tr(8):1==this.M&&tr(9);var e=this.a;e.m=this.c;co(e,2)}};Je.Y=function(){return this.a.Y()};Je.ma=function(){return this.a.ma()};function mi(){this.a=this.b=null}function yi(){this.a=new Or}function vi(e){var t=typeof e;return"object"==t&&e||"function"==t?"o"+(e[ct]||(e[ct]=++lt)):t.charAt(0)+e}yi.prototype.add=function(e){this.a.set(vi(e),e)};yi.prototype.C=function(){return this.a.C()};function gi(e,t){this.b=e;this.a=t}function bi(e){this.g=e||wi;et.PerformanceNavigationTiming?(e=et.performance.getEntriesByType("navigation"),e=0<e.length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol)):e=!!(et.ka&&et.ka.Ea&&et.ka.Ea()&&et.ka.Ea().zb);this.f=e?this.g:1;this.a=null;1<this.f&&(this.a=new yi);this.b=null;this.c=[]}var wi=10;function Ei(e,t){!e.a&&(Dt(t,"spdy")||Dt(t,"quic")||Dt(t,"h2"))&&(e.f=e.g,e.a=new yi,e.b&&(_i(e,e.b),e.b=null))}function Si(e){return e.b?!0:e.a?e.a.a.c>=e.f:!1}function Ti(e){return e.b?1:e.a?e.a.a.c:0}function Ii(e,t){e.b?e=e.b==t:e.a?(t=vi(t),e=Pr(e.a.a.b,t)):e=!1;return e}function _i(e,t){e.a?e.a.add(t):e.b=t}function Di(e,t){if(e.b&&e.b==t)e.b=null;else{var n;if(n=e.a)n=vi(t),n=Pr(e.a.a.b,n);n&&Rr(e.a.a,vi(t))}}bi.prototype.cancel=function(){this.c=Ci(this);this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(wt(this.a.C(),function(e){e.cancel()}),xr(this.a.a))};function Ci(e){if(null!=e.b)return e.c.concat(e.b.j);if(null!=e.a&&0!=e.a.a.c){var t=e.c;wt(e.a.C(),function(e){t=t.concat(e.j)});return t}return Tt(e.c)}function Ai(){}Ai.prototype.stringify=function(e){return et.JSON.stringify(e,void 0)};Ai.prototype.parse=function(e){return et.JSON.parse(e,void 0)};function Ni(){this.a=new Ai}function ki(e,t,n){var r=n||"";try{kr(e,function(e,n){var i=e;ut(e)&&(i=An(e));t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Oi(e,t){var n=new $n;if(et.Image){var r=new Image;r.onload=pt(xi,n,r,"TestLoadImage: loaded",!0,t);r.onerror=pt(xi,n,r,"TestLoadImage: error",!1,t);r.onabort=pt(xi,n,r,"TestLoadImage: abort",!1,t);r.ontimeout=pt(xi,n,r,"TestLoadImage: timeout",!1,t);et.setTimeout(function(){if(r.ontimeout)r.ontimeout()},1e4);r.src=e}else t(!1)}function xi(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}var Ri=et.JSON.parse;function Mi(e){Dn.call(this);this.headers=new Or;this.H=e||null;this.b=!1;this.s=this.a=null;this.A="";this.h=0;this.f="";this.g=this.w=this.l=this.v=!1;this.o=0;this.m=null;this.I=Pi;this.D=this.F=!1}yt(Mi,Dn);var Pi="",Li=/^https?$/i,Fi=["POST","PUT"];Je=Mi.prototype;Je.ca=function(e,t,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+e);t=t?t.toUpperCase():"GET";this.A=e;this.f="";this.h=0;this.v=!1;this.b=!0;this.a=new XMLHttpRequest;this.s=this.H?sr(this.H):sr(hr);this.a.onreadystatechange=dt(this.Fa,this);try{this.w=!0,this.a.open(t,String(e),!0),this.w=!1}catch(e){Vi(this,e);return}e=n||"";var i=new Or(this.headers);r&&kr(r,function(e,t){i.set(t,e)});r=Et(i.K());n=et.FormData&&e instanceof et.FormData;!(0<=bt(Fi,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");i.forEach(function(e,t){this.a.setRequestHeader(t,e)},this);this.I&&(this.a.responseType=this.I);"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{zi(this),0<this.o&&((this.D=qi(this.a))?(this.a.timeout=this.o,this.a.ontimeout=dt(this.Ca,this)):this.m=Qn(this.Ca,this.o,this)),this.l=!0,this.a.send(e),this.l=!1}catch(e){Vi(this,e)}};function qi(e){return qt&&Yt(9)&&nt(e.timeout)&&void 0!==e.ontimeout}function Ui(e){return"content-type"==e.toLowerCase()}Je.Ca=function(){"undefined"!=typeof Ze&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))};function Vi(e,t){e.b=!1;e.a&&(e.g=!0,e.a.abort(),e.g=!1);e.f=t;e.h=5;Bi(e);Qi(e)}function Bi(e){e.v||(e.v=!0,e.dispatchEvent("complete"),e.dispatchEvent("error"))}Je.abort=function(e){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=e||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Qi(this))};Je.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Qi(this,!0));Mi.N.G.call(this)};Je.Fa=function(){this.j||(this.w||this.l||this.g?ji(this):this.$a())};Je.$a=function(){ji(this)};function ji(e){if(e.b&&"undefined"!=typeof Ze&&(!e.s[1]||4!=Ki(e)||2!=e.T()))if(e.l&&4==Ki(e))Qn(e.Fa,0,e);else if(e.dispatchEvent("readystatechange"),4==Ki(e)){e.b=!1;try{var t=e.T();e:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n=!0;break e;default:n=!1}var r;if(!(r=n)){var i;if(i=0===t){var o=String(e.A).match(Lr)[1]||null;if(!o&&et.self&&et.self.location){var a=et.self.location.protocol;o=a.substr(0,a.length-1)}i=!Li.test(o?o.toLowerCase():"")}r=i}r?(e.dispatchEvent("complete"),e.dispatchEvent("success")):(e.h=6,e.f=e.za()+" ["+e.T()+"]",Bi(e))}finally{Qi(e)}}}function Qi(e,t){if(e.a){zi(e);var n=e.a,r=e.s[0]?it:null;e.a=null;e.s=null;t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){}}}function zi(e){e.a&&e.D&&(e.a.ontimeout=null);e.m&&(et.clearTimeout(e.m),e.m=null)}function Ki(e){return e.a?e.a.readyState:0}Je.T=function(){try{return 2<Ki(this)?this.a.status:-1}catch(e){return-1}};Je.za=function(){try{return 2<Ki(this)?this.a.statusText:""}catch(e){return""}};Je.aa=function(){try{return this.a?this.a.responseText:""}catch(e){return""}};Je.Va=function(e){if(this.a){var t=this.a.responseText;e&&0==t.indexOf(e)&&(t=t.substring(e.length));return Ri(t)}};function Wi(e,t){return e.a?e.a.getResponseHeader(t):null}Je.ya=function(){return this.h};Je.Ya=function(){return tt(this.f)?this.f:String(this.f)};function Gi(e){var t="";Ot(e,function(e,n){t+=n;t+=":";t+=e;t+="\r\n"});return t}function Hi(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}if(r)return e;n=Gi(n);if(tt(e)){t=encodeURIComponent(String(t));n=null!=n?"="+encodeURIComponent(String(n)):"";if(t+=n){n=e.indexOf("#");0>n&&(n=e.length);r=e.indexOf("?");if(0>r||r>n){r=n;var i=""}else i=e.substring(r+1,n);e=[e.substr(0,r),i,e.substr(n)];n=e[1];e[1]=t?n?n+"&"+t:t:n;e=e[0]+(e[1]?"?"+e[1]:"")+e[2]}return e}zr(e,t,n);return e}function Yi(e){this.f=[];this.F=new mi;this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null;this.Ra=this.P=0;this.Pa=!!rt("internalChannelParams.failFast",e);this.ia=this.w=this.s=this.l=this.h=this.c=null;this.oa=!0;this.m=this.ra=this.O=-1;this.S=this.v=this.A=0;this.Oa=rt("internalChannelParams.baseRetryDelayMs",e)||5e3;this.Sa=rt("internalChannelParams.retryDelaySeedMs",e)||1e4;this.Qa=rt("internalChannelParams.forwardChannelMaxRetries",e)||2;this.qa=rt("internalChannelParams.forwardChannelRequestTimeoutMs",e)||2e4;this.La=e&&e.Ab||void 0;this.D=void 0;this.R=e&&e.supportsCrossDomainXhr||!1;this.H="";this.b=new bi(e&&e.concurrentRequestLimit);this.ja=new Ni;this.o=e&&void 0!==e.backgroundChannelTest?e.backgroundChannelTest:!0;(this.W=e&&e.fastHandshake||!1)&&!this.o&&(this.o=!0);e&&e.forceLongPolling&&(this.oa=!1);this.fa=void 0}Je=Yi.prototype;Je.wa=8;Je.u=1;function $i(e){Xi(e);if(3==e.u){var t=e.P++,n=Ur(e.B);zr(n,"SID",e.H);zr(n,"RID",t);zr(n,"TYPE","terminate");no(e,n);t=new pr(e,t,void 0);t.F=2;t.f=Wr(Ur(n));n=!1;et.navigator&&et.navigator.sendBeacon&&(n=et.navigator.sendBeacon(t.f.toString(),""));!n&&et.Image&&((new Image).src=t.f,n=!0);n||(t.a=t.g.$(null),t.a.ca(t.f));t.v=mt();Tr(t)}lo(e)}function Xi(e){e.w&&(e.w.abort(),e.w=null);e.a&&(e.a.cancel(),e.a=null);e.l&&(et.clearTimeout(e.l),e.l=null);so(e);e.b.cancel();e.h&&(nt(e.h)&&et.clearTimeout(e.h),e.h=null)}function Ji(e,t){e.f.push(new gi(e.Ra++,t));3==e.u&&Zi(e)}Je.Da=function(){return 0==this.u};function Zi(e){Si(e.b)||e.h||(e.h=!0,Pn(e.Ia,e),e.A=0)}function eo(e,t){if(Ti(e.b)>=e.b.f-(e.h?1:0))return!1;if(e.h)return e.f=t.j.concat(e.f),!0;if(1==e.u||2==e.u||e.A>=(e.Pa?0:e.Qa))return!1;e.h=rr(dt(e.Ia,e,t),uo(e,e.A));e.A++;return!0}Je.Ia=function(e){if(this.h)if(this.h=null,1==this.u){if(!e){this.P=Math.floor(1e5*Math.random());e=this.P++;var t=new pr(this,e,void 0),n=this.i;this.J&&(n?(n=xt(n),Mt(n,this.J)):n=this.J);null===this.g&&(t.h=n);var r;if(this.W)e:{for(var i=r=0;i<this.f.length;i++){t:{var o=this.f[i];if("__data__"in o.a&&(o=o.a.__data__,tt(o))){o=o.length;break t}o=void 0}if(void 0===o)break;r+=o;if(4096<r){r=i;break e}if(4096===r||i===this.f.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=ro(this,t,r);i=Ur(this.B);zr(i,"RID",e);zr(i,"CVER",22);this.o&&this.j&&zr(i,"X-HTTP-Session-Id",this.j);no(this,i);this.g&&n&&Hi(i,this.g,n);_i(this.b,t);this.W?(zr(i,"$req",r),zr(i,"SID","null"),t.S=!0,gr(t,i,null)):gr(t,i,r);this.u=2}}else 3==this.u&&(e?to(this,e):0==this.f.length||Si(this.b)||to(this))};function to(e,t){var n;t?n=t.W:n=e.P++;var r=Ur(e.B);zr(r,"SID",e.H);zr(r,"RID",n);zr(r,"AID",e.O);no(e,r);e.g&&e.i&&Hi(r,e.g,e.i);n=new pr(e,n,e.A+1);null===e.g&&(n.h=e.i);t&&(e.f=t.j.concat(e.f));t=ro(e,n,1e3);n.setTimeout(Math.round(.5*e.qa)+Math.round(.5*e.qa*Math.random()));_i(e.b,n);gr(n,r,t)}function no(e,t){e.c&&kr({},function(e,n){zr(t,n,e)})}function ro(e,t,n){n=Math.min(e.f.length,n);var r=e.c?dt(e.c.Ta,e.c,e):null;e:for(var i=e.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,l=i[u].a;c-=o;if(0>c)o=Math.max(0,i[u].b-100),s=!1;else try{ki(l,a,"req"+c+"_")}catch(e){r&&r(l)}}if(s){r=a.join("&");break e}}e=e.f.splice(0,n);t.j=e;return r}function io(e){e.a||e.l||(e.S=1,Pn(e.Ha,e),e.v=0)}function oo(e){if(e.a||e.l||3<=e.v)return!1;e.S++;e.l=rr(dt(e.Ha,e),uo(e,e.v));e.v++;return!0}Je.Ha=function(){this.l=null;this.a=new pr(this,"rpc",this.S);null===this.g&&(this.a.h=this.i);this.a.J=0;var e=Ur(this.pa);zr(e,"RID","rpc");zr(e,"SID",this.H);zr(e,"CI",this.ia?"0":"1");zr(e,"AID",this.O);no(this,e);zr(e,"TYPE","xmlhttp");this.g&&this.i&&Hi(e,this.g,this.i);this.D&&this.a.setTimeout(this.D);br(this.a,e,!0,this.ga)};function ao(e,t,n){var r=t.l;r&&Ei(e.b,r);e.ia=e.oa&&n;e.m=t.c;e.B=fo(e,null,e.ha);Zi(e)}Je.Ga=function(e,t){if(0!=this.u&&(this.a==e||Ii(this.b,e)))if(this.m=e.o,!e.s&&Ii(this.b,e)&&3==this.u){try{var n=this.ja.a.parse(t)}catch(e){n=null}if(at(n)&&3==n.length){t=n;if(0==t[0])e:{if(!this.l){if(this.a)if(this.a.v+3e3<e.v)so(this),this.a.cancel(),this.a=null;else break e;oo(this);tr(18)}}else this.ra=t[1],0<this.ra-this.O&&37500>t[2]&&this.ia&&0==this.v&&!this.s&&(this.s=rr(dt(this.Za,this),6e3));if(1>=Ti(this.b)&&this.fa){try{this.fa()}catch(e){}this.fa=void 0}}else co(this,11)}else if((e.s||this.a==e)&&so(this),!It(t))for(t=n=this.ja.a.parse(t),n=0;n<t.length;n++){var r=t[n];this.O=r[0];r=r[1];if(2==this.u)if("c"==r[0]){this.H=r[1];this.ga=r[2];var i=r[3];null!=i&&(this.wa=i);r=r[5];null!=r&&nt(r)&&0<r&&(this.D=1.5*r);this.o&&(r=e.a)&&((i=Wi(r,"X-Client-Wire-Protocol"))&&Ei(this.b,i),this.j&&(r=Wi(r,"X-HTTP-Session-Id")))&&(this.I=r,zr(this.B,this.j,r));this.u=3;this.c&&this.c.va();r=e;this.pa=fo(this,this.Y()?this.ga:null,this.ha);r.s?(Di(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(_r(r),Tr(r)),this.a=r):io(this);0<this.f.length&&Zi(this)}else"stop"!=r[0]&&"close"!=r[0]||co(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?co(this,7):$i(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}};Je.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,oo(this),tr(19))};function so(e){null!=e.s&&(et.clearTimeout(e.s),e.s=null)}Je.na=function(e){var t=null;if(this.a==e){so(this);this.a=null;var n=2}else if(Ii(this.b,e))t=e.j,Di(this.b,e),n=1;else return;this.m=e.o;if(0!=this.u)if(e.b)1==n?(t=mt()-e.v,Xn.dispatchEvent(new nr(Xn,e.l?e.l.length:0,t,this.A)),Zi(this)):io(this);else{var r=e.c;if(3==r||0==r&&0<this.m||!(1==n&&eo(this,e)||2==n&&oo(this)))switch(t&&0<t.length&&(e=this.b,e.c=e.c.concat(t)),r){case 1:co(this,5);break;case 4:co(this,10);break;case 3:co(this,6);break;default:co(this,2)}}};function uo(e,t){var n=e.Oa+Math.floor(Math.random()*e.Sa);e.ma()||(n*=2);return n*t}function co(e,t){if(2==t){var n=null;e.c&&(n=null);var r=dt(e.fb,e);n||(n=new qr("//www.google.com/images/cleardot.gif"),et.location&&"http"==et.location.protocol||Vr(n,"https"),Wr(n));Oi(n.toString(),r)}else tr(2);e.u=0;e.c&&e.c.ta(t);lo(e);Xi(e)}Je.fb=function(e){e?tr(2):tr(1)};function lo(e){e.u=0;e.m=-1;if(e.c){if(0!=Ci(e.b).length||0!=e.f.length)e.b.c.length=0,Tt(e.f),e.f.length=0;e.c.sa()}}function fo(e,t,n){var r=Gr(n);if(""!=r.b)t&&Br(r,t+"."+r.b),jr(r,r.i);else{var i=et.location,o;t?o=t+"."+i.hostname:o=i.hostname;r=Hr(i.protocol,o,+i.port,n)}e.V&&Ot(e.V,function(e,t){zr(r,t,e)});t=e.j;n=e.I;t&&n&&zr(r,t,n);zr(r,"VER",e.wa);no(e,r);return r}Je.$=function(e){if(e&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");e=new Mi(this.La);e.F=this.R;return e};Je.ma=function(){return!!this.c&&!0};Je.Y=function(){return this.R};function ho(){}Je=ho.prototype;Je.va=function(){};Je.ua=function(){};Je.ta=function(){};Je.sa=function(){};Je.Ta=function(){};function po(e){for(var t=arguments[0],n=1;n<arguments.length;n++){var r=arguments[n];if(0==r.lastIndexOf("/",0))t=r;else{var i;(i=""==t)||(i=t.length-1,i=0<=i&&t.indexOf("/",i)==i);i?t+=r:t+="/"+r}}return t}function mo(){if(qt&&!(10<=Number($t)))throw Error("Environmental error: no available transport.")}mo.prototype.a=function(e,t){return new yo(e,t)};function yo(e,t){Dn.call(this);this.a=new Yi(t);this.g=e;this.m=t&&t.testUrl?t.testUrl:po(this.g,"test");this.b=t&&t.messageUrlParams||null;e=t&&t.messageHeaders||null;t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"});this.a.i=e;e=t&&t.initMessageHeaders||null;t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType});t&&t.xa&&(e?e["X-WebChannel-Client-Profile"]=t.xa:e={"X-WebChannel-Client-Profile":t.xa});this.a.J=e;(e=t&&t.httpHeadersOverwriteParam)&&!It(e)&&(this.a.g=e);this.l=t&&t.supportsCrossDomainXhr||!1;this.h=t&&t.sendRawJson||!1;(t=t&&t.httpSessionIdParam)&&!It(t)&&(this.a.j=t,e=this.b,null!==e&&t in e&&(e=this.b,t in e&&delete e[t]));this.f=new bo(this)}yt(yo,Dn);Je=yo.prototype;Je.addEventListener=function(e,t,n,r){yo.N.addEventListener.call(this,e,t,n,r)};Je.removeEventListener=function(e,t,n,r){yo.N.removeEventListener.call(this,e,t,n,r)};Je.Wa=function(){this.a.c=this.f;this.l&&(this.a.R=!0);var e=this.a,t=this.m,n=this.g,r=this.b||void 0;tr(0);e.ha=n;e.V=r||{};e.o&&(e.F.b=[],e.F.a=!1);e.w=new di(e);null===e.g&&(e.w.h=e.i);n=t;e.g&&e.i&&(n=Hi(t,e.g,e.i));e=e.w;e.i=n;t=fo(e.a,null,e.i);tr(3);n=e.a.F.b;null!=n?(e.f=n[0],e.M=1,pi(e)):(Kr(t,"MODE","init"),!e.a.o&&e.a.j&&Kr(t,"X-HTTP-Session-Id",e.a.j),e.b=new pr(e,void 0,void 0),e.b.h=e.h,br(e.b,t,!1,null),e.M=0)};Je.close=function(){$i(this.a)};Je.Xa=function(e){if(tt(e)){var t={};t.__data__=e;Ji(this.a,t)}else this.h?(t={},t.__data__=An(e),Ji(this.a,t)):Ji(this.a,e)};Je.G=function(){this.a.c=null;delete this.f;$i(this.a);delete this.a;yo.N.G.call(this)};function vo(e){lr.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.c=e)?(e=this.c,this.data=null!==t&&e in t?t[e]:void 0):this.data=t}else this.data=e}yt(vo,lr);function go(){fr.call(this);this.status=1}yt(go,fr);function bo(e){this.a=e}yt(bo,ho);bo.prototype.va=function(){this.a.dispatchEvent("a")};bo.prototype.ua=function(e){this.a.dispatchEvent(new vo(e))};bo.prototype.ta=function(e){this.a.dispatchEvent(new go(e))};bo.prototype.sa=function(){this.a.dispatchEvent("b")};var wo=pt(function(e,t){function n(){}n.prototype=e.prototype;var r=new n;e.apply(r,Array.prototype.slice.call(arguments,1));return r},mo);mo.prototype.createWebChannel=mo.prototype.a;yo.prototype.send=yo.prototype.Xa;yo.prototype.open=yo.prototype.Wa;yo.prototype.close=yo.prototype.close;ir.NO_ERROR=0;ir.TIMEOUT=8;ir.HTTP_ERROR=6;or.COMPLETE="complete";ur.EventType=cr;cr.OPEN="a";cr.CLOSE="b";cr.ERROR="c";cr.MESSAGE="d";Dn.prototype.listen=Dn.prototype.Aa;Mi.prototype.listenOnce=Mi.prototype.Ba;Mi.prototype.getLastError=Mi.prototype.Ya;Mi.prototype.getLastErrorCode=Mi.prototype.ya;Mi.prototype.getStatus=Mi.prototype.T;Mi.prototype.getStatusText=Mi.prototype.za;Mi.prototype.getResponseJson=Mi.prototype.Va;Mi.prototype.getResponseText=Mi.prototype.aa;Mi.prototype.send=Mi.prototype.ca;var Eo={createWebChannelTransport:wo,ErrorCode:ir,EventType:or,WebChannel:ur,XhrIo:Mi};var So=p(function(e,t){Object.defineProperty(t,"__esModule",{value:true});function n(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var r=n(We);var i=r.SDK_VERSION;var o=new Ke.Logger("@firebase/firestore");var a;(function(e){e[e["DEBUG"]=0]="DEBUG";e[e["ERROR"]=1]="ERROR";e[e["SILENT"]=2]="SILENT"})(a||(a={}));function s(){if(o.logLevel===Ke.LogLevel.DEBUG){return a.DEBUG}else if(o.logLevel===Ke.LogLevel.SILENT){return a.SILENT}else{return a.ERROR}}function u(e){switch(e){case a.DEBUG:o.logLevel=Ke.LogLevel.DEBUG;break;case a.ERROR:o.logLevel=Ke.LogLevel.ERROR;break;case a.SILENT:o.logLevel=Ke.LogLevel.SILENT;break;default:o.error("Firestore ("+i+"): Invalid value passed to `setLogLevel`")}}function c(e,t){var n=[];for(var r=2;r<arguments.length;r++){n[r-2]=arguments[r]}if(o.logLevel<=Ke.LogLevel.DEBUG){var a=n.map(f);o.debug.apply(o,["Firestore ("+i+") ["+e+"]: "+t].concat(a))}}function l(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}if(o.logLevel<=Ke.LogLevel.ERROR){var r=t.map(f);o.error.apply(o,["Firestore ("+i+"): "+e].concat(r))}}function f(e){if(typeof e==="string"){return e}else{var t=p.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}}function h(e){var t="FIRESTORE ("+i+") INTERNAL ASSERTION FAILED: "+e;l(t);throw new Error(t)}function d(e,t){if(!e){h(t)}}var p=function(){function e(){}e.setPlatform=function(t){if(e.platform){h("Platform already defined")}e.platform=t};e.getPlatform=function(){if(!e.platform){h("Platform not set")}return e.platform};return e}();function m(){return p.getPlatform().emptyByteString}var y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};var v=function(e){B.__extends(t,e);function t(t,n){var r=e.call(this,n)||this;r.code=t;r.message=n;r.name="FirebaseError";r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message};return r}return t}(Error);function g(e,t){function n(){var e="This constructor is private.";if(t){e+=" ";e+=t}throw new v(y.INVALID_ARGUMENT,e)}n.prototype=e.prototype;for(var r in e){if(e.hasOwnProperty(r)){n[r]=e[r]}}return n}function b(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function w(e,t){return e!==undefined?e:t}function E(e,t){for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){var r=Number(n);if(!isNaN(r)){t(r,e[n])}}}}function S(e){var t=[];T(e,function(e,n){return t.push(n)});return t}function T(e,t){for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){t(n,e[n])}}}function I(e){d(e!=null&&typeof e==="object","isEmpty() expects object parameter.");for(var t in e){if(Object.prototype.hasOwnProperty.call(e,t)){return false}}return true}function _(e){d(e&&typeof e==="object","shallowCopy() expects object parameter.");var t={};for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){t[n]=e[n]}}return t}function D(e,t){if(t.length!==0){throw new v(y.INVALID_ARGUMENT,"Function "+e+"() does not support arguments, "+"but was called with "+$(t.length,"argument")+".")}}function C(e,t,n){if(t.length!==n){throw new v(y.INVALID_ARGUMENT,"Function "+e+"() requires "+$(n,"argument")+", but was called with "+$(t.length,"argument")+".")}}function A(e,t,n){if(t.length<n){throw new v(y.INVALID_ARGUMENT,"Function "+e+"() requires at least "+$(n,"argument")+", but was called with "+$(t.length,"argument")+".")}}function N(e,t,n,r){if(t.length<n||t.length>r){throw new v(y.INVALID_ARGUMENT,"Function "+e+"() requires between "+n+" and "+(r+" arguments, but was called with ")+$(t.length,"argument")+".")}}function k(e,t,n,r){if(!(t instanceof Array)||t.length<r){throw new v(y.INVALID_ARGUMENT,"Function "+e+"() requires its "+n+" argument to be an "+"array with at least "+($(r,"element")+"."))}}function O(e,t,n,r){V(e,t,Y(n)+" argument",r)}function x(e,t,n,r){if(r!==undefined){O(e,t,n,r)}}function R(e,t,n,r){V(e,t,n+" option",r)}function M(e,t,n,r){if(r!==undefined){R(e,t,n,r)}}function P(e,t,n,r,i){if(!(r instanceof Array)){throw new v(y.INVALID_ARGUMENT,"Function "+e+"() requires its "+t+" "+("option to be an array, but it was: "+z(r)))}for(var o=0;o<r.length;++o){if(!i(r[o])){throw new v(y.INVALID_ARGUMENT,"Function "+e+"() requires all "+t+" "+("elements to be "+n+", but the value at index "+o+" ")+("was: "+z(r[o])))}}}function L(e,t,n,r,i){if(r!==undefined){P(e,t,n,r,i)}}function F(e,t,n,r,i){var o=[];for(var a=0,s=i;a<s.length;a++){var u=s[a];if(u===r){return}o.push(z(u))}var c=z(r);throw new v(y.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+e+"() for option "+('"'+n+'". Acceptable values: '+o.join(", ")))}function q(e,t,n,r,i){if(r!==undefined){F(e,t,n,r,i)}}function U(e,t,n,r){if(!t.some(function(e){return e===r})){throw new v(y.INVALID_ARGUMENT,"Invalid value "+z(r)+" provided to function "+(e+"() for its "+Y(n)+" argument. Acceptable ")+("values: "+t.join(", ")))}}function V(e,t,n,r){var i=false;if(t==="object"){i=Q(r)}else if(t==="non-empty string"){i=typeof r==="string"&&r!==""}else{i=typeof r===t}if(!i){var o=z(r);throw new v(y.INVALID_ARGUMENT,"Function "+e+"() requires its "+n+" "+("to be of type "+t+", but it was: "+o))}}function Q(e){return typeof e==="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function z(e){if(e===undefined){return"undefined"}else if(e===null){return"null"}else if(typeof e==="string"){if(e.length>20){e=e.substring(0,20)+"..."}return JSON.stringify(e)}else if(typeof e==="number"||typeof e==="boolean"){return""+e}else if(typeof e==="object"){if(e instanceof Array){return"an array"}else{var t=K(e);if(t){return"a custom "+t+" object"}else{return"an object"}}}else if(typeof e==="function"){return"a function"}else{return h("Unknown wrong type: "+typeof e)}}function K(e){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/;var n=t.exec(e.constructor.toString());if(n&&n.length>1){return n[1]}}return null}function W(e,t,n){if(n===undefined){throw new v(y.INVALID_ARGUMENT,"Function "+e+"() requires a valid "+Y(t)+" "+"argument, but it was undefined.")}}function G(e,t,n){T(t,function(t,r){if(n.indexOf(t)<0){throw new v(y.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+e+"(). "+"Available options: "+n.join(", "))}})}function H(e,t,n,r){var i=z(r);return new v(y.INVALID_ARGUMENT,"Function "+e+"() requires its "+Y(n)+" "+("argument to be a "+t+", but it was: "+i))}function Y(e){switch(e){case 1:return"first";case 2:return"second";case 3:return"third";default:return e+"th"}}function $(e,t){return e+" "+t+(e===1?"":"s")}var X=function(){function e(){}e.newId=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";var t="";for(var n=0;n<20;n++){t+=e.charAt(Math.floor(Math.random()*e.length))}d(t.length===20,"Invalid auto ID: "+t);return t};return e}();function J(e,t){if(e<t)return-1;if(e>t)return 1;return 0}function Z(e,t){if(e!==null&&e!==undefined){return!!(t&&e.isEqual(t))}else{return e===t}}function ee(e,t){if(e.length!==t.length){return false}for(var n=0;n<e.length;n++){if(!e[n].isEqual(t[n])){return false}}return true}function te(e){return e+"\0"}function ne(){if(typeof Uint8Array==="undefined"){throw new v(y.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}}function re(){if(!p.getPlatform().base64Available){throw new v(y.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}}var ie=function(){function e(e){re();this._binaryString=e}e.fromBase64String=function(t){C("Blob.fromBase64String",arguments,1);O("Blob.fromBase64String","string",1,t);re();try{var n=p.getPlatform().atob(t);return new e(n)}catch(e){throw new v(y.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+e)}};e.fromUint8Array=function(t){C("Blob.fromUint8Array",arguments,1);ne();if(!(t instanceof Uint8Array)){throw H("Blob.fromUint8Array","Uint8Array",1,t)}var n=Array.prototype.map.call(t,function(e){return String.fromCharCode(e)}).join("");return new e(n)};e.prototype.toBase64=function(){C("Blob.toBase64",arguments,0);re();return p.getPlatform().btoa(this._binaryString)};e.prototype.toUint8Array=function(){C("Blob.toUint8Array",arguments,0);ne();var e=new Uint8Array(this._binaryString.length);for(var t=0;t<this._binaryString.length;t++){e[t]=this._binaryString.charCodeAt(t)}return e};e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"};e.prototype.isEqual=function(e){return this._binaryString===e._binaryString};e.prototype._compareTo=function(e){return J(this._binaryString,e._binaryString)};return e}();var oe=g(ie,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead.");var ae=function(){function e(e,t,n,r,i){this.databaseId=e;this.persistenceKey=t;this.host=n;this.ssl=r;this.forceLongPolling=i}return e}();var se="(default)";var ue=function(){function e(e,t){this.projectId=e;this.database=t?t:se}Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database===se},enumerable:true,configurable:true});e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database};e.prototype.compareTo=function(e){return J(this.projectId,e.projectId)||J(this.database,e.database)};return e}();var ce=function(){function e(e,t){var n=this;this.previousValue=e;if(t){t.sequenceNumberHandler=function(e){return n.setPreviousValue(e)};this.writeNewSequenceNumber=function(e){return t.writeSequenceNumber(e)}}}e.prototype.setPreviousValue=function(e){this.previousValue=Math.max(e,this.previousValue);return this.previousValue};e.prototype.next=function(){var e=++this.previousValue;if(this.writeNewSequenceNumber){this.writeNewSequenceNumber(e)}return e};e.INVALID=-1;return e}();var le="__name__";var fe=function(){function e(e,t,n){this.init(e,t,n)}e.prototype.init=function(e,t,n){if(t===undefined){t=0}else if(t>e.length){h("offset "+t+" out of range "+e.length)}if(n===undefined){n=e.length-t}else if(n>e.length-t){h("length "+n+" out of range "+(e.length-t))}this.segments=e;this.offset=t;this.len=n};e.prototype.construct=function(e,t,n){var r=Object.create(Object.getPrototypeOf(this));r.init(e,t,n);return r};Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:true,configurable:true});e.prototype.isEqual=function(t){return e.comparator(this,t)===0};e.prototype.child=function(t){var n=this.segments.slice(this.offset,this.limit());if(t instanceof e){t.forEach(function(e){n.push(e)})}else if(typeof t==="string"){n.push(t)}else{h("Unknown parameter type for Path.child(): "+t)}return this.construct(n)};e.prototype.limit=function(){return this.offset+this.length};e.prototype.popFirst=function(e){e=e===undefined?1:e;d(this.length>=e,"Can't call popFirst() with less segments");return this.construct(this.segments,this.offset+e,this.length-e)};e.prototype.popLast=function(){d(!this.isEmpty(),"Can't call popLast() on empty path");return this.construct(this.segments,this.offset,this.length-1)};e.prototype.firstSegment=function(){d(!this.isEmpty(),"Can't call firstSegment() on empty path");return this.segments[this.offset]};e.prototype.lastSegment=function(){return this.get(this.length-1)};e.prototype.get=function(e){d(e<this.length,"Index out of range");return this.segments[this.offset+e]};e.prototype.isEmpty=function(){return this.length===0};e.prototype.isPrefixOf=function(e){if(e.length<this.length){return false}for(var t=0;t<this.length;t++){if(this.get(t)!==e.get(t)){return false}}return true};e.prototype.isImmediateParentOf=function(e){if(this.length+1!==e.length){return false}for(var t=0;t<this.length;t++){if(this.get(t)!==e.get(t)){return false}}return true};e.prototype.forEach=function(e){for(var t=this.offset,n=this.limit();t<n;t++){e(this.segments[t])}};e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())};e.comparator=function(e,t){var n=Math.min(e.length,t.length);for(var r=0;r<n;r++){var i=e.get(r);var o=t.get(r);if(i<o)return-1;if(i>o)return 1}if(e.length<t.length)return-1;if(e.length>t.length)return 1;return 0};return e}();var he=function(e){B.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.canonicalString=function(){return this.toArray().join("/")};t.prototype.toString=function(){return this.canonicalString()};t.fromString=function(e){if(e.indexOf("//")>=0){throw new v(y.INVALID_ARGUMENT,"Invalid path ("+e+"). Paths must not contain // in them.")}var n=e.split("/").filter(function(e){return e.length>0});return new t(n)};t.EMPTY_PATH=new t([]);return t}(fe);var de=/^[_a-zA-Z][_a-zA-Z0-9]*$/;var pe=function(e){B.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.isValidIdentifier=function(e){return de.test(e)};t.prototype.canonicalString=function(){return this.toArray().map(function(e){e=e.replace("\\","\\\\").replace("`","\\`");if(!t.isValidIdentifier(e)){e="`"+e+"`"}return e}).join(".")};t.prototype.toString=function(){return this.canonicalString()};t.prototype.isKeyField=function(){return this.length===1&&this.get(0)===le};t.keyField=function(){return new t([le])};t.fromServerFormat=function(e){var n=[];var r="";var i=0;var o=function(){if(r.length===0){throw new v(y.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin "+"with '.', end with '.', or contain '..'")}n.push(r);r=""};var a=false;while(i<e.length){var s=e[i];if(s==="\\"){if(i+1===e.length){throw new v(y.INVALID_ARGUMENT,"Path has trailing escape character: "+e)}var u=e[i+1];if(!(u==="\\"||u==="."||u==="`")){throw new v(y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e)}r+=u;i+=2}else if(s==="`"){a=!a;i++}else if(s==="."&&!a){o();i++}else{r+=s;i++}}o();if(a){throw new v(y.INVALID_ARGUMENT,"Unterminated ` in path: "+e)}return new t(n)};t.EMPTY_PATH=new t([]);return t}(fe);var me=function(){function e(t){this.path=t;d(e.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}e.prototype.hasCollectionId=function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e};e.prototype.isEqual=function(e){return e!==null&&he.comparator(this.path,e.path)===0};e.prototype.toString=function(){return this.path.toString()};e.comparator=function(e,t){return he.comparator(e.path,t.path)};e.isDocumentKey=function(e){return e.length%2===0};e.fromSegments=function(t){return new e(new he(t.slice()))};e.fromPathString=function(t){return new e(he.fromString(t))};e.EMPTY=new e(new he([]));return e}();var ye=function(){function e(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t;e.reject=n})}return e}();var ve;(function(e){e["All"]="all";e["ListenStreamIdle"]="listen_stream_idle";e["ListenStreamConnectionBackoff"]="listen_stream_connection_backoff";e["WriteStreamIdle"]="write_stream_idle";e["WriteStreamConnectionBackoff"]="write_stream_connection_backoff";e["OnlineStateTimeout"]="online_state_timeout";e["ClientMetadataRefresh"]="client_metadata_refresh";e["LruGarbageCollection"]="lru_garbage_collection"})(ve||(ve={}));var ge=function(){function e(e,t,n,r,i){this.asyncQueue=e;this.timerId=t;this.targetTimeMs=n;this.op=r;this.removalCallback=i;this.deferred=new ye;this.then=this.deferred.promise.then.bind(this.deferred.promise);this.catch=this.deferred.promise.catch.bind(this.deferred.promise);this.deferred.promise.catch(function(e){})}e.createAndSchedule=function(t,n,r,i,o){var a=Date.now()+r;var s=new e(t,n,a,i,o);s.start(r);return s};e.prototype.start=function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)};e.prototype.skipDelay=function(){return this.handleDelayElapsed()};e.prototype.cancel=function(e){if(this.timerHandle!==null){this.clearTimeout();this.deferred.reject(new v(y.CANCELLED,"Operation cancelled"+(e?": "+e:"")))}};e.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){if(e.timerHandle!==null){e.clearTimeout();return e.op().then(function(t){return e.deferred.resolve(t)})}else{return Promise.resolve()}})};e.prototype.clearTimeout=function(){if(this.timerHandle!==null){this.removalCallback(this);clearTimeout(this.timerHandle);this.timerHandle=null}};return e}();var be=function(){function e(){this.tail=Promise.resolve();this.delayedOperations=[];this.operationInProgress=false}e.prototype.enqueueAndForget=function(e){this.enqueue(e)};e.prototype.enqueue=function(e){var t=this;this.verifyNotFailed();var n=this.tail.then(function(){t.operationInProgress=true;return e().catch(function(e){t.failure=e;t.operationInProgress=false;var n=e.stack||e.message||"";l("INTERNAL UNHANDLED ERROR: ",n);if(n.indexOf("Firestore Test Simulated Error")<0){setTimeout(function(){throw e},0)}throw e}).then(function(e){t.operationInProgress=false;return e})});this.tail=n;return n};e.prototype.enqueueAfterDelay=function(e,t,n){var r=this;this.verifyNotFailed();d(t>=0,"Attempted to schedule an operation with a negative delay of "+t);d(!this.containsDelayedOperation(e),"Attempted to schedule multiple operations with timer id "+e+".");var i=ge.createAndSchedule(this,e,t,n,function(e){return r.removeDelayedOperation(e)});this.delayedOperations.push(i);return i};e.prototype.verifyNotFailed=function(){if(this.failure){h("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))}};e.prototype.verifyOperationInProgress=function(){d(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")};e.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})};e.prototype.containsDelayedOperation=function(e){for(var t=0,n=this.delayedOperations;t<n.length;t++){var r=n[t];if(r.timerId===e){return true}}return false};e.prototype.runDelayedOperationsEarly=function(e){var t=this;return this.drain().then(function(){d(e===ve.All||t.containsDelayedOperation(e),"Attempted to drain to missing operation "+e);t.delayedOperations.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});for(var n=0,r=t.delayedOperations;n<r.length;n++){var i=r[n];i.skipDelay();if(e!==ve.All&&i.timerId===e){break}}return t.drain()})};e.prototype.removeDelayedOperation=function(e){var t=this.delayedOperations.indexOf(e);d(t>=0,"Delayed operation not found.");this.delayedOperations.splice(t,1)};return e}();var we="";var Ee="";var Se="";var Te="";function Ie(e){var t="";for(var n=0;n<e.length;n++){if(t.length>0){t=De(t)}t=_e(e.get(n),t)}return De(t)}function _e(e,t){var n=t;var r=e.length;for(var i=0;i<r;i++){var o=e.charAt(i);switch(o){case"\0":n+=we+Se;break;case we:n+=we+Te;break;default:n+=o}}return n}function De(e){return e+we+Ee}function Ce(e){var t=e.length;d(t>=2,"Invalid path "+e);if(t===2){d(e.charAt(0)===we&&e.charAt(1)===Ee,"Non-empty path "+e+" had length 2");return he.EMPTY_PATH}var n=t-2;var r=[];var i="";for(var o=0;o<t;){var a=e.indexOf(we,o);if(a<0||a>n){h('Invalid encoded resource path: "'+e+'"')}var s=e.charAt(a+1);switch(s){case Ee:var u=e.substring(o,a);var c=void 0;if(i.length===0){c=u}else{i+=u;c=i;i=""}r.push(c);break;case Se:i+=e.substring(o,a);i+="\0";break;case Te:i+=e.substring(o,a+1);break;default:h('Invalid encoded resource path: "'+e+'"')}o=a+2}return new he(r)}var Ae=function(){function e(e,t){this.seconds=e;this.nanoseconds=t;if(t<0){throw new v(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t)}if(t>=1e9){throw new v(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t)}if(e<-62135596800){throw new v(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}if(e>=253402300800){throw new v(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}}e.now=function(){return e.fromMillis(Date.now())};e.fromDate=function(t){return e.fromMillis(t.getTime())};e.fromMillis=function(t){var n=Math.floor(t/1e3);var r=(t-n*1e3)*1e6;return new e(n,r)};e.prototype.toDate=function(){return new Date(this.toMillis())};e.prototype.toMillis=function(){return this.seconds*1e3+this.nanoseconds/1e6};e.prototype._compareTo=function(e){if(this.seconds===e.seconds){return J(this.nanoseconds,e.nanoseconds)}return J(this.seconds,e.seconds)};e.prototype.isEqual=function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds};e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"};return e}();var Ne=function(){function e(e){this.timestamp=e}e.fromMicroseconds=function(t){var n=Math.floor(t/1e6);var r=t%1e6*1e3;return new e(new Ae(n,r))};e.fromTimestamp=function(t){return new e(t)};e.forDeletedDoc=function(){return e.MIN};e.prototype.compareTo=function(e){return this.timestamp._compareTo(e.timestamp)};e.prototype.isEqual=function(e){return this.timestamp.isEqual(e.timestamp)};e.prototype.toMicroseconds=function(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3};e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"};e.prototype.toTimestamp=function(){return this.timestamp};e.MIN=new e(new Ae(0,0));return e}();var ke=function(){function e(e,t){this.comparator=e;this.root=t?t:xe.EMPTY}e.prototype.insert=function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,xe.BLACK,null,null))};e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,xe.BLACK,null,null))};e.prototype.get=function(e){var t=this.root;while(!t.isEmpty()){var n=this.comparator(e,t.key);if(n===0){return t.value}else if(n<0){t=t.left}else if(n>0){t=t.right}}return null};e.prototype.indexOf=function(e){var t=0;var n=this.root;while(!n.isEmpty()){var r=this.comparator(e,n.key);if(r===0){return t+n.left.size}else if(r<0){n=n.left}else{t+=n.left.size+1;n=n.right}}return-1};e.prototype.isEmpty=function(){return this.root.isEmpty()};Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:true,configurable:true});e.prototype.minKey=function(){return this.root.minKey()};e.prototype.maxKey=function(){return this.root.maxKey()};e.prototype.inorderTraversal=function(e){return this.root.inorderTraversal(e)};e.prototype.forEach=function(e){this.inorderTraversal(function(t,n){e(t,n);return false})};e.prototype.toString=function(){var e=[];this.inorderTraversal(function(t,n){e.push(t+":"+n);return false});return"{"+e.join(", ")+"}"};e.prototype.reverseTraversal=function(e){return this.root.reverseTraversal(e)};e.prototype.getIterator=function(){return new Oe(this.root,null,this.comparator,false)};e.prototype.getIteratorFrom=function(e){return new Oe(this.root,e,this.comparator,false)};e.prototype.getReverseIterator=function(){return new Oe(this.root,null,this.comparator,true)};e.prototype.getReverseIteratorFrom=function(e){return new Oe(this.root,e,this.comparator,true)};return e}();var Oe=function(){function e(e,t,n,r){this.isReverse=r;this.nodeStack=[];var i=1;while(!e.isEmpty()){i=t?n(e.key,t):1;if(r)i*=-1;if(i<0){if(this.isReverse){e=e.left}else{e=e.right}}else if(i===0){this.nodeStack.push(e);break}else{this.nodeStack.push(e);if(this.isReverse){e=e.right}else{e=e.left}}}}e.prototype.getNext=function(){d(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse){e=e.left;while(!e.isEmpty()){this.nodeStack.push(e);e=e.right}}else{e=e.right;while(!e.isEmpty()){this.nodeStack.push(e);e=e.left}}return t};e.prototype.hasNext=function(){return this.nodeStack.length>0};e.prototype.peek=function(){if(this.nodeStack.length===0)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}};return e}();var xe=function(){function e(t,n,r,i,o){this.key=t;this.value=n;this.color=r!=null?r:e.RED;this.left=i!=null?i:e.EMPTY;this.right=o!=null?o:e.EMPTY;this.size=this.left.size+1+this.right.size}e.prototype.copy=function(t,n,r,i,o){return new e(t!=null?t:this.key,n!=null?n:this.value,r!=null?r:this.color,i!=null?i:this.left,o!=null?o:this.right)};e.prototype.isEmpty=function(){return false};e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)};e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)};e.prototype.min=function(){if(this.left.isEmpty()){return this}else{return this.left.min()}};e.prototype.minKey=function(){return this.min().key};e.prototype.maxKey=function(){if(this.right.isEmpty()){return this.key}else{return this.right.maxKey()}};e.prototype.insert=function(e,t,n){var r=this;var i=n(e,r.key);if(i<0){r=r.copy(null,null,null,r.left.insert(e,t,n),null)}else if(i===0){r=r.copy(null,t,null,null,null)}else{r=r.copy(null,null,null,null,r.right.insert(e,t,n))}return r.fixUp()};e.prototype.removeMin=function(){if(this.left.isEmpty()){return e.EMPTY}var t=this;if(!t.left.isRed()&&!t.left.left.isRed())t=t.moveRedLeft();t=t.copy(null,null,null,t.left.removeMin(),null);return t.fixUp()};e.prototype.remove=function(t,n){var r;var i=this;if(n(t,i.key)<0){if(!i.left.isEmpty()&&!i.left.isRed()&&!i.left.left.isRed()){i=i.moveRedLeft()}i=i.copy(null,null,null,i.left.remove(t,n),null)}else{if(i.left.isRed())i=i.rotateRight();if(!i.right.isEmpty()&&!i.right.isRed()&&!i.right.left.isRed()){i=i.moveRedRight()}if(n(t,i.key)===0){if(i.right.isEmpty()){return e.EMPTY}else{r=i.right.min();i=i.copy(r.key,r.value,null,null,i.right.removeMin())}}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()};e.prototype.isRed=function(){return this.color};e.prototype.fixUp=function(){var e=this;if(e.right.isRed()&&!e.left.isRed())e=e.rotateLeft();if(e.left.isRed()&&e.left.left.isRed())e=e.rotateRight();if(e.left.isRed()&&e.right.isRed())e=e.colorFlip();return e};e.prototype.moveRedLeft=function(){var e=this.colorFlip();if(e.right.left.isRed()){e=e.copy(null,null,null,null,e.right.rotateRight());e=e.rotateLeft();e=e.colorFlip()}return e};e.prototype.moveRedRight=function(){var e=this.colorFlip();if(e.left.left.isRed()){e=e.rotateRight();e=e.colorFlip()}return e};e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)};e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)};e.prototype.colorFlip=function(){var e=this.left.copy(null,null,!this.left.color,null,null);var t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)};e.prototype.checkMaxDepth=function(){var e=this.check();if(Math.pow(2,e)<=this.size+1){return true}else{return false}};e.prototype.check=function(){if(this.isRed()&&this.left.isRed()){throw h("Red node has red child("+this.key+","+this.value+")")}if(this.right.isRed()){throw h("Right child of ("+this.key+","+this.value+") is red")}var e=this.left.check();if(e!==this.right.check()){throw h("Black depths differ")}else{return e+(this.isRed()?0:1)}};e.EMPTY=null;e.RED=true;e.BLACK=false;return e}();var Re=function(){function e(){this.size=0}e.prototype.copy=function(e,t,n,r,i){return this};e.prototype.insert=function(e,t,n){return new xe(e,t)};e.prototype.remove=function(e,t){return this};e.prototype.isEmpty=function(){return true};e.prototype.inorderTraversal=function(e){return false};e.prototype.reverseTraversal=function(e){return false};e.prototype.minKey=function(){return null};e.prototype.maxKey=function(){return null};e.prototype.isRed=function(){return false};e.prototype.checkMaxDepth=function(){return true};e.prototype.check=function(){return 0};return e}();xe.EMPTY=new Re;var Me=function(){function e(e){this.comparator=e;this.data=new ke(this.comparator)}e.fromMapKeys=function(t){var n=new e(t.comparator);t.forEach(function(e){n=n.add(e)});return n};e.prototype.has=function(e){return this.data.get(e)!==null};e.prototype.first=function(){return this.data.minKey()};e.prototype.last=function(){return this.data.maxKey()};Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:true,configurable:true});e.prototype.indexOf=function(e){return this.data.indexOf(e)};e.prototype.forEach=function(e){this.data.inorderTraversal(function(t,n){e(t);return false})};e.prototype.forEachInRange=function(e,t){var n=this.data.getIteratorFrom(e[0]);while(n.hasNext()){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}};e.prototype.forEachWhile=function(e,t){var n;if(t!==undefined){n=this.data.getIteratorFrom(t)}else{n=this.data.getIterator()}while(n.hasNext()){var r=n.getNext();var i=e(r.key);if(!i)return}};e.prototype.firstAfterOrEqual=function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null};e.prototype.getIterator=function(){return new Pe(this.data.getIterator())};e.prototype.getIteratorFrom=function(e){return new Pe(this.data.getIteratorFrom(e))};e.prototype.add=function(e){return this.copy(this.data.remove(e).insert(e,true))};e.prototype.delete=function(e){if(!this.has(e))return this;return this.copy(this.data.remove(e))};e.prototype.isEmpty=function(){return this.data.isEmpty()};e.prototype.unionWith=function(e){var t=this;e.forEach(function(e){t=t.add(e)});return t};e.prototype.isEqual=function(t){if(!(t instanceof e))return false;if(this.size!==t.size)return false;var n=this.data.getIterator();var r=t.data.getIterator();while(n.hasNext()){var i=n.getNext().key;var o=r.getNext().key;if(this.comparator(i,o)!==0)return false}return true};e.prototype.toArray=function(){var e=[];this.forEach(function(t){e.push(t)});return e};e.prototype.toString=function(){var e=[];this.forEach(function(t){return e.push(t)});return"SortedSet("+e.toString()+")"};e.prototype.copy=function(t){var n=new e(this.comparator);n.data=t;return n};return e}();var Pe=function(){function e(e){this.iter=e}e.prototype.getNext=function(){return this.iter.getNext().key};e.prototype.hasNext=function(){return this.iter.hasNext()};return e}();var Le=new ke(me.comparator);function Fe(){return Le}function qe(){return Fe()}var Ue=new ke(me.comparator);function Ve(){return Ue}var Be=new ke(me.comparator);function je(){return Be}var Qe=new Me(me.comparator);function ze(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n=Qe;for(var r=0,i=e;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ge=new Me(J);function He(){return Ge}var Ye=-1;var $e=function(){function e(e,t,n,r){this.batchId=e;this.localWriteTime=t;this.baseMutations=n;this.mutations=r;d(r.length>0,"Cannot create an empty mutation batch")}e.prototype.applyToRemoteDocument=function(e,t,n){if(t){d(t.key.isEqual(e),"applyToRemoteDocument: key "+e+" should match maybeDoc key\n        "+t.key)}var r=n.mutationResults;d(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(e)){var a=r[i];t=o.applyToRemoteDocument(t,a)}}return t};e.prototype.applyToLocalView=function(e,t){if(t){d(t.key.isEqual(e),"applyToLocalDocument: key "+e+" should match maybeDoc key\n        "+t.key)}for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];if(i.key.isEqual(e)){t=i.applyToLocalView(t,t,this.localWriteTime)}}var o=t;for(var a=0,s=this.mutations;a<s.length;a++){var i=s[a];if(i.key.isEqual(e)){t=i.applyToLocalView(t,o,this.localWriteTime)}}return t};e.prototype.applyToLocalDocumentSet=function(e){var t=this;var n=e;this.mutations.forEach(function(r){var i=t.applyToLocalView(r.key,e.get(r.key));if(i){n=n.insert(r.key,i)}});return n};e.prototype.keys=function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},ze())};e.prototype.isEqual=function(e){return this.batchId===e.batchId&&ee(this.mutations,e.mutations)&&ee(this.baseMutations,e.baseMutations)};return e}();var Xe=function(){function e(e,t,n,r,i){this.batch=e;this.commitVersion=t;this.mutationResults=n;this.streamToken=r;this.docVersions=i}e.from=function(t,n,r,i){d(t.mutations.length===r.length,"Mutations sent "+t.mutations.length+" must equal results received "+r.length);var o=je();var a=t.mutations;for(var s=0;s<a.length;s++){o=o.insert(a[s].key,r[s].version)}return new e(t,n,r,i,o)};return e}();var Je=function(){function e(e){var t=this;this.nextCallback=null;this.catchCallback=null;this.result=undefined;this.error=undefined;this.isDone=false;this.callbackAttached=false;e(function(e){t.isDone=true;t.result=e;if(t.nextCallback){t.nextCallback(e)}},function(e){t.isDone=true;t.error=e;if(t.catchCallback){t.catchCallback(e)}})}e.prototype.catch=function(e){return this.next(undefined,e)};e.prototype.next=function(t,n){var r=this;if(this.callbackAttached){h("Called next() or catch() twice for PersistencePromise")}this.callbackAttached=true;if(this.isDone){if(!this.error){return this.wrapSuccess(t,this.result)}else{return this.wrapFailure(n,this.error)}}else{return new e(function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)};r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}})}};e.prototype.toPromise=function(){var e=this;return new Promise(function(t,n){e.next(t,n)})};e.prototype.wrapUserFunction=function(t){try{var n=t();if(n instanceof e){return n}else{return e.resolve(n)}}catch(t){return e.reject(t)}};e.prototype.wrapSuccess=function(t,n){if(t){return this.wrapUserFunction(function(){return t(n)})}else{return e.resolve(n)}};e.prototype.wrapFailure=function(t,n){if(t){return this.wrapUserFunction(function(){return t(n)})}else{return e.reject(n)}};e.resolve=function(t){return new e(function(e,n){e(t)})};e.reject=function(t){return new e(function(e,n){n(t)})};e.waitFor=function(t){return new e(function(e,n){var r=0;var i=0;var o=false;t.forEach(function(t){++r;t.next(function(){++i;if(o&&i===r){e()}},function(e){return n(e)})});o=true;if(i===r){e()}})};e.or=function(t){var n=e.resolve(false);var r=function(t){n=n.next(function(n){if(n){return e.resolve(n)}else{return t()}})};for(var i=0,o=t;i<o.length;i++){var a=o[i];r(a)}return n};e.forEach=function(e,t){var n=this;var r=[];e.forEach(function(e,i){r.push(t.call(n,e,i))});return this.waitFor(r)};return e}();var Ze=function(){function e(e,t,n,r){this.userId=e;this.serializer=t;this.indexManager=n;this.referenceDelegate=r;this.documentKeysByBatchId={}}e.forUser=function(t,n,r,i){d(t.uid!=="","UserID must not be an empty string.");var o=t.isAuthenticated()?t.uid:"";return new e(o,n,r,i)};e.prototype.checkEmpty=function(e){var t=true;var n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return it(e).iterate({index:Ht.userMutationsIndex,range:n},function(e,n,r){t=false;r.done()}).next(function(){return t})};e.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){t.lastStreamToken=rt(n);return at(e).put(t)})};e.prototype.getLastStreamToken=function(e){return this.getMutationQueueMetadata(e).next(function(e){return e.lastStreamToken})};e.prototype.setLastStreamToken=function(e,t){return this.getMutationQueueMetadata(e).next(function(n){n.lastStreamToken=rt(t);return at(e).put(n)})};e.prototype.addMutationBatch=function(e,t,n,r){var i=this;var o=ot(e);var a=it(e);return a.add({}).next(function(s){d(typeof s==="number","Auto-generated key is not a number");var u=new $e(s,t,n,r);var c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();var l=[];for(var f=0,h=r;f<h.length;f++){var p=h[f];var m=Xt.key(i.userId,p.key.path,s);l.push(a.put(c));l.push(o.put(m,Xt.PLACEHOLDER));l.push(i.indexManager.addToCollectionParentIndex(e,p.key.path.popLast()))}return Je.waitFor(l).next(function(){return u})})};e.prototype.lookupMutationBatch=function(e,t){var n=this;return it(e).get(t).next(function(e){if(e){d(e.userId===n.userId,"Unexpected user '"+e.userId+"' for mutation batch "+t);return n.serializer.fromDbMutationBatch(e)}return null})};e.prototype.lookupMutationKeys=function(e,t){var n=this;if(this.documentKeysByBatchId[t]){return Je.resolve(this.documentKeysByBatchId[t])}else{return this.lookupMutationBatch(e,t).next(function(e){if(e){var r=e.keys();n.documentKeysByBatchId[t]=r;return r}else{return null}})}};e.prototype.getNextMutationBatchAfterBatchId=function(e,t){var n=this;var r=t+1;var i=IDBKeyRange.lowerBound([this.userId,r]);var o=null;return it(e).iterate({index:Ht.userMutationsIndex,range:i},function(e,t,i){if(t.userId===n.userId){d(t.batchId>=r,"Should have found mutation after "+r);o=n.serializer.fromDbMutationBatch(t)}i.done()}).next(function(){return o})};e.prototype.getAllMutationBatches=function(e){var t=this;var n=IDBKeyRange.bound([this.userId,Ye],[this.userId,Number.POSITIVE_INFINITY]);return it(e).loadAll(Ht.userMutationsIndex,n).next(function(e){return e.map(function(e){return t.serializer.fromDbMutationBatch(e)})})};e.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,t){var n=this;var r=Xt.prefixForPath(this.userId,t.path);var i=IDBKeyRange.lowerBound(r);var o=[];return ot(e).iterate({range:i},function(r,i,a){var s=r[0],u=r[1],c=r[2];var l=Ce(u);if(s!==n.userId||!t.path.isEqual(l)){a.done();return}return it(e).get(c).next(function(e){if(!e){throw h("Dangling document-mutation reference found: "+r+" which points to "+c)}d(e.userId===n.userId,"Unexpected user '"+e.userId+"' for mutation batch "+c);o.push(n.serializer.fromDbMutationBatch(e))})}).next(function(){return o})};e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var n=this;var r=new Me(J);var i=[];t.forEach(function(t){var o=Xt.prefixForPath(n.userId,t.path);var a=IDBKeyRange.lowerBound(o);var s=ot(e).iterate({range:a},function(e,i,o){var a=e[0],s=e[1],u=e[2];var c=Ce(s);if(a!==n.userId||!t.path.isEqual(c)){o.done();return}r=r.add(u)});i.push(s)});return Je.waitFor(i).next(function(){return n.lookupMutationBatches(e,r)})};e.prototype.getAllMutationBatchesAffectingQuery=function(e,t){var n=this;d(!t.isDocumentQuery(),"Document queries shouldn't go down this path");d(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=t.path;var i=r.length+1;var o=Xt.prefixForPath(this.userId,r);var a=IDBKeyRange.lowerBound(o);var s=new Me(J);return ot(e).iterate({range:a},function(e,t,o){var a=e[0],u=e[1],c=e[2];var l=Ce(u);if(a!==n.userId||!r.isPrefixOf(l)){o.done();return}if(l.length!==i){return}s=s.add(c)}).next(function(){return n.lookupMutationBatches(e,s)})};e.prototype.lookupMutationBatches=function(e,t){var n=this;var r=[];var i=[];t.forEach(function(t){i.push(it(e).get(t).next(function(e){if(e===null){throw h("Dangling document-mutation reference found, "+"which points to "+t)}d(e.userId===n.userId,"Unexpected user '"+e.userId+"' for mutation batch "+t);r.push(n.serializer.fromDbMutationBatch(e))}))});return Je.waitFor(i).next(function(){return r})};e.prototype.removeMutationBatch=function(e,t){var n=this;return nt(e.simpleDbTransaction,this.userId,t).next(function(r){n.removeCachedMutationKeys(t.batchId);return Je.forEach(r,function(t){return n.referenceDelegate.removeMutationReference(e,t)})})};e.prototype.removeCachedMutationKeys=function(e){delete this.documentKeysByBatchId[e]};e.prototype.performConsistencyCheck=function(e){var t=this;return this.checkEmpty(e).next(function(n){if(!n){return Je.resolve()}var r=IDBKeyRange.lowerBound(Xt.prefixForUser(t.userId));var i=[];return ot(e).iterate({range:r},function(e,n,r){var o=e[0];if(o!==t.userId){r.done();return}else{var a=Ce(e[1]);i.push(a)}}).next(function(){d(i.length===0,"Document leak -- detected dangling mutation references when queue is empty. "+"Dangling keys: "+i.map(function(e){return e.canonicalString()}))})})};e.prototype.containsKey=function(e,t){return et(e,this.userId,t)};e.prototype.getMutationQueueMetadata=function(e){var t=this;return at(e).get(this.userId).next(function(e){return e||new Gt(t.userId,Ye,"")})};return e}();function et(e,t,n){var r=Xt.prefixForPath(t,n.path);var i=r[1];var o=IDBKeyRange.lowerBound(r);var a=false;return ot(e).iterate({range:o,keysOnly:true},function(e,n,r){var o=e[0],s=e[1],u=e[2];if(o===t&&s===i){a=true}r.done()}).next(function(){return a})}function tt(e,t){var n=false;return at(e).iterateSerial(function(r){return et(e,r,t).next(function(e){if(e){n=true}return Je.resolve(!e)})}).next(function(){return n})}function nt(e,t,n){var r=e.store(Ht.store);var i=e.store(Xt.store);var o=[];var a=IDBKeyRange.only(n.batchId);var s=0;var u=r.iterate({range:a},function(e,t,n){s++;return n.delete()});o.push(u.next(function(){d(s===1,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));var c=[];for(var l=0,f=n.mutations;l<f.length;l++){var h=f[l];var p=Xt.key(t,h.key.path,n.batchId);o.push(i.delete(p));c.push(h.key)}return Je.waitFor(o).next(function(){return c})}function rt(e){if(e instanceof Uint8Array){d(process.env.USE_MOCK_PERSISTENCE==="YES","Persisting non-string stream tokens is only supported with mock persistence.");return e.toString()}else{return e}}function it(e){return Wn.getStore(e,Ht.store)}function ot(e){return Wn.getStore(e,Xt.store)}function at(e){return Wn.getStore(e,Gt.store)}var st=1;var ut;(function(e){e[e["QueryCache"]=0]="QueryCache";e[e["SyncEngine"]=1]="SyncEngine"})(ut||(ut={}));var ct=function(){function e(e,t){this.generatorId=e;d((e&st)===e,"Generator ID "+e+" contains more than "+st+" reserved bits");this.seek(t!==undefined?t:this.generatorId)}e.prototype.next=function(){var e=this.nextId;this.nextId+=1<<st;return e};e.prototype.after=function(e){this.seek(e+(1<<st));return this.next()};e.prototype.seek=function(e){d((e&st)===this.generatorId,"Cannot supply target ID from different generator ID");this.nextId=e};e.forQueryCache=function(){var t=new e(ut.QueryCache,2);return t};e.forSyncEngine=function(){return new e(ut.SyncEngine)};return e}();var lt="SimpleDb";var ft=function(){function e(t){this.db=t;var n=e.getIOSVersion(j.getUA());if(n===12.2){l("Firestore persistence suffers from a bug in iOS 12.2 "+"Safari that may cause your app to stop working. See "+"https://stackoverflow.com/q/56496296/110915 for details "+"and a potential workaround.")}}e.openOrCreate=function(t,n,r){d(e.isAvailable(),"IndexedDB not supported in current environment.");c(lt,"Opening database:",t);return new Je(function(i,o){var a=window.indexedDB.open(t,n);a.onsuccess=function(t){var n=t.target.result;i(new e(n))};a.onblocked=function(){o(new v(y.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. "+"Close all tabs that access Firestore and reload this page to proceed."))};a.onerror=function(e){var t=e.target.error;if(t.name==="VersionError"){o(new v(y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted "+"data is not compatible with the version of the SDK you are now using. The SDK "+"will operate with persistence disabled. If you need persistence, please "+"re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB "+"data for your app to start fresh."))}else{o(t)}};a.onupgradeneeded=function(e){c(lt,'Database "'+t+'" requires upgrade from version:',e.oldVersion);var n=e.target.result;var i=new dt(a.transaction);r.createOrUpgrade(n,i,e.oldVersion,Bt).next(function(){c(lt,"Database upgrade to version "+Bt+" complete")})}}).toPromise()};e.delete=function(e){c(lt,"Removing database:",e);return mt(window.indexedDB.deleteDatabase(e)).toPromise()};e.isAvailable=function(){if(typeof window==="undefined"||window.indexedDB==null){return false}if(window.navigator===undefined){return process.env.USE_MOCK_PERSISTENCE==="YES"}var t=j.getUA();var n=e.getIOSVersion(t);var r=0<n&&n<10;var i=e.getAndroidVersion(t);var o=0<i&&i<4.5;if(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o){return false}else{return true}};e.getStore=function(e,t){return e.store(t)};e.getIOSVersion=function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);var n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)};e.getAndroidVersion=function(e){var t=e.match(/Android ([\d.]+)/i);var n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)};e.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}};e.prototype.runTransaction=function(e,t,n){var r=dt.open(this.db,e,t);var i=n(r).catch(function(e){r.abort(e);return Je.reject(e)}).toPromise();i.catch(function(){});return r.completionPromise.then(function(){return i})};e.prototype.close=function(){this.db.close()};return e}();var ht=function(){function e(e){this.dbCursor=e;this.shouldStop=false;this.nextKey=null}Object.defineProperty(e.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cursor",{set:function(e){this.dbCursor=e},enumerable:true,configurable:true});e.prototype.done=function(){this.shouldStop=true};e.prototype.skip=function(e){this.nextKey=e};e.prototype.delete=function(){return mt(this.dbCursor.delete())};return e}();var dt=function(){function e(e){var t=this;this.transaction=e;this.aborted=false;this.completionDeferred=new ye;this.transaction.oncomplete=function(){t.completionDeferred.resolve()};this.transaction.onabort=function(){if(e.error){t.completionDeferred.reject(e.error)}else{t.completionDeferred.resolve()}};this.transaction.onerror=function(e){var n=vt(e.target.error);t.completionDeferred.reject(n)}}e.open=function(t,n,r){return new e(t.transaction(r,n))};Object.defineProperty(e.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:true,configurable:true});e.prototype.abort=function(e){if(e){this.completionDeferred.reject(e)}if(!this.aborted){c(lt,"Aborting transaction:",e?e.message:"Client-initiated abort");this.aborted=true;this.transaction.abort()}};e.prototype.store=function(e){var t=this.transaction.objectStore(e);d(!!t,"Object store not part of transaction: "+e);return new pt(t)};return e}();var pt=function(){function e(e){this.store=e}e.prototype.put=function(e,t){var n;if(t!==undefined){c(lt,"PUT",this.store.name,e,t);n=this.store.put(t,e)}else{c(lt,"PUT",this.store.name,"<auto-key>",e);n=this.store.put(e)}return mt(n)};e.prototype.add=function(e){c(lt,"ADD",this.store.name,e,e);var t=this.store.add(e);return mt(t)};e.prototype.get=function(e){var t=this;var n=this.store.get(e);return mt(n).next(function(n){if(n===undefined){n=null}c(lt,"GET",t.store.name,e,n);return n})};e.prototype.delete=function(e){c(lt,"DELETE",this.store.name,e);var t=this.store.delete(e);return mt(t)};e.prototype.count=function(){c(lt,"COUNT",this.store.name);var e=this.store.count();return mt(e)};e.prototype.loadAll=function(e,t){var n=this.cursor(this.options(e,t));var r=[];return this.iterateCursor(n,function(e,t){r.push(t)}).next(function(){return r})};e.prototype.deleteAll=function(e,t){c(lt,"DELETE ALL",this.store.name);var n=this.options(e,t);n.keysOnly=false;var r=this.cursor(n);return this.iterateCursor(r,function(e,t,n){return n.delete()})};e.prototype.iterate=function(e,t){var n;if(!t){n={};t=e}else{n=e}var r=this.cursor(n);return this.iterateCursor(r,t)};e.prototype.iterateSerial=function(e){var t=this.cursor({});return new Je(function(n,r){t.onerror=function(e){var t=vt(e.target.error);r(t)};t.onsuccess=function(t){var r=t.target.result;if(!r){n();return}e(r.primaryKey,r.value).next(function(e){if(e){r.continue()}else{n()}})}})};e.prototype.iterateCursor=function(e,t){var n=[];return new Je(function(r,i){e.onerror=function(e){i(e.target.error)};e.onsuccess=function(e){var i=e.target.result;if(!i){r();return}var o=new ht(i);var a=t(i.primaryKey,i.value,o);if(a instanceof Je){var s=a.catch(function(e){o.done();return Je.reject(e)});n.push(s)}if(o.isDone){r()}else if(o.skipToKey===null){i.continue()}else{i.continue(o.skipToKey)}}}).next(function(){return Je.waitFor(n)})};e.prototype.options=function(e,t){var n=undefined;if(e!==undefined){if(typeof e==="string"){n=e}else{d(t===undefined,"3rd argument must not be defined if 2nd is a range.");t=e}}return{index:n,range:t}};e.prototype.cursor=function(e){var t="next";if(e.reverse){t="prev"}if(e.index){var n=this.store.index(e.index);if(e.keysOnly){return n.openKeyCursor(e.range,t)}else{return n.openCursor(e.range,t)}}else{return this.store.openCursor(e.range,t)}};return e}();function mt(e){return new Je(function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)};e.onerror=function(e){var t=vt(e.target.error);n(t)}})}var yt=false;function vt(e){var t=ft.getIOSVersion(j.getUA());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new v("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely "+"due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 "+"for details and a potential workaround.");if(!yt){yt=true;setTimeout(function(){throw r},0)}return r}}return e}var gt=function(){function e(e,t){this.referenceDelegate=e;this.serializer=t;this.targetIdGenerator=ct.forQueryCache()}e.prototype.allocateTargetId=function(e){var t=this;return this.retrieveMetadata(e).next(function(n){n.highestTargetId=t.targetIdGenerator.after(n.highestTargetId);return t.saveMetadata(e,n).next(function(){return n.highestTargetId})})};e.prototype.getLastRemoteSnapshotVersion=function(e){return this.retrieveMetadata(e).next(function(e){return Ne.fromTimestamp(new Ae(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))})};e.prototype.getHighestSequenceNumber=function(e){return St(e.simpleDbTransaction)};e.prototype.setTargetsMetadata=function(e,t,n){var r=this;return this.retrieveMetadata(e).next(function(i){i.highestListenSequenceNumber=t;if(n){i.lastRemoteSnapshotVersion=n.toTimestamp()}if(t>i.highestListenSequenceNumber){i.highestListenSequenceNumber=t}return r.saveMetadata(e,i)})};e.prototype.addQueryData=function(e,t){var n=this;return this.saveQueryData(e,t).next(function(){return n.retrieveMetadata(e).next(function(r){r.targetCount+=1;n.updateMetadataFromQueryData(t,r);return n.saveMetadata(e,r)})})};e.prototype.updateQueryData=function(e,t){return this.saveQueryData(e,t)};e.prototype.removeQueryData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return bt(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){d(t.targetCount>0,"Removing from an empty query cache");t.targetCount-=1;return n.saveMetadata(e,t)})};e.prototype.removeTargets=function(e,t,n){var r=this;var i=0;var o=[];return bt(e).iterate(function(a,s){var u=r.serializer.fromDbTarget(s);if(u.sequenceNumber<=t&&n[u.targetId]===undefined){i++;o.push(r.removeQueryData(e,u))}}).next(function(){return Je.waitFor(o)}).next(function(){return i})};e.prototype.forEachTarget=function(e,t){var n=this;return bt(e).iterate(function(e,r){var i=n.serializer.fromDbTarget(r);t(i)})};e.prototype.retrieveMetadata=function(e){return Et(e.simpleDbTransaction)};e.prototype.saveMetadata=function(e,t){return wt(e).put(sn.key,t)};e.prototype.saveQueryData=function(e,t){return bt(e).put(this.serializer.toDbTarget(t))};e.prototype.updateMetadataFromQueryData=function(e,t){var n=false;if(e.targetId>t.highestTargetId){t.highestTargetId=e.targetId;n=true}if(e.sequenceNumber>t.highestListenSequenceNumber){t.highestListenSequenceNumber=e.sequenceNumber;n=true}return n};e.prototype.getQueryCount=function(e){return this.retrieveMetadata(e).next(function(e){return e.targetCount})};e.prototype.getQueryData=function(e,t){var n=this;var r=t.canonicalId();var i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);var o=null;return bt(e).iterate({range:i,index:on.queryTargetsIndexName},function(e,r,i){var a=n.serializer.fromDbTarget(r);if(t.isEqual(a.query)){o=a;i.done()}}).next(function(){return o})};e.prototype.addMatchingKeys=function(e,t,n){var r=this;var i=[];var o=Tt(e);t.forEach(function(t){var a=Ie(t.path);i.push(o.put(new an(n,a)));i.push(r.referenceDelegate.addReference(e,t))});return Je.waitFor(i)};e.prototype.removeMatchingKeys=function(e,t,n){var r=this;var i=Tt(e);return Je.forEach(t,function(t){var o=Ie(t.path);return Je.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(e,t)])})};e.prototype.removeMatchingKeysForTargetId=function(e,t){var n=Tt(e);var r=IDBKeyRange.bound([t],[t+1],false,true);return n.delete(r)};e.prototype.getMatchingKeysForTargetId=function(e,t){var n=IDBKeyRange.bound([t],[t+1],false,true);var r=Tt(e);var i=ze();return r.iterate({range:n,keysOnly:true},function(e,t,n){var r=Ce(e[1]);var o=new me(r);i=i.add(o)}).next(function(){return i})};e.prototype.containsKey=function(e,t){var n=Ie(t.path);var r=IDBKeyRange.bound([n],[te(n)],false,true);var i=0;return Tt(e).iterate({index:an.documentTargetsIndex,keysOnly:true,range:r},function(e,t,n){var r=e[0],o=e[1];if(r!==0){i++;n.done()}}).next(function(){return i>0})};e.prototype.getQueryDataForTarget=function(e,t){var n=this;return bt(e).get(t).next(function(e){if(e){return n.serializer.fromDbTarget(e)}else{return null}})};return e}();function bt(e){return Wn.getStore(e,on.store)}function wt(e){return Wn.getStore(e,sn.store)}function Et(e){var t=ft.getStore(e,sn.store);return t.get(sn.key).next(function(e){d(e!==null,"Missing metadata row.");return e})}function St(e){return Et(e).next(function(e){return e.highestListenSequenceNumber})}function Tt(e){return Wn.getStore(e,an.store)}var It=function(){function e(e,t){this.key=e;this.version=t}e.compareByKey=function(e,t){return me.comparator(e.key,t.key)};return e}();var _t=function(e){B.__extends(t,e);function t(t,n,r,i,o){var a=e.call(this,t,n)||this;a.data=r;a.proto=o;a.hasLocalMutations=!!i.hasLocalMutations;a.hasCommittedMutations=!!i.hasCommittedMutations;return a}t.prototype.field=function(e){return this.data.field(e)};t.prototype.fieldValue=function(e){var t=this.field(e);return t?t.value():undefined};t.prototype.value=function(){return this.data.value()};t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.data.isEqual(e.data)&&this.hasLocalMutations===e.hasLocalMutations&&this.hasCommittedMutations===e.hasCommittedMutations};t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", "+("{hasLocalMutations: "+this.hasLocalMutations+"}), ")+("{hasCommittedMutations: "+this.hasCommittedMutations+"})")};Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:true,configurable:true});t.compareByField=function(e,t,n){var r=t.field(e);var i=n.field(e);if(r!==undefined&&i!==undefined){return r.compareTo(i)}else{return h("Trying to compare documents on fields that don't exist")}};return t}(It);var Dt=function(e){B.__extends(t,e);function t(t,n,r){var i=e.call(this,t,n)||this;i.hasCommittedMutations=!!(r&&r.hasCommittedMutations);return i}t.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"};Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:true,configurable:true});t.prototype.isEqual=function(e){return e instanceof t&&e.hasCommittedMutations===this.hasCommittedMutations&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)};return t}(It);var Ct=function(e){B.__extends(t,e);function t(t,n){return e.call(this,t,n)||this}t.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"};Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return true},enumerable:true,configurable:true});t.prototype.isEqual=function(e){return e instanceof t&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)};return t}(It);var At=function(){function e(e){this.mapKeyFn=e;this.inner={}}e.prototype.get=function(e){var t=this.mapKeyFn(e);var n=this.inner[t];if(n===undefined){return undefined}for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(e)){return s}}return undefined};e.prototype.has=function(e){return this.get(e)!==undefined};e.prototype.set=function(e,t){var n=this.mapKeyFn(e);var r=this.inner[n];if(r===undefined){this.inner[n]=[[e,t]];return}for(var i=0;i<r.length;i++){if(r[i][0].isEqual(e)){r[i]=[e,t];return}}r.push([e,t])};e.prototype.delete=function(e){var t=this.mapKeyFn(e);var n=this.inner[t];if(n===undefined){return false}for(var r=0;r<n.length;r++){if(n[r][0].isEqual(e)){if(n.length===1){delete this.inner[t]}else{n.splice(r,1)}return true}}return false};e.prototype.forEach=function(e){T(this.inner,function(t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];e(a,s)}})};e.prototype.isEmpty=function(){return I(this.inner)};return e}();var Nt=function(){function e(){this.changes=Fe();this.documentSizes=new At(function(e){return e.toString()})}e.prototype.addEntry=function(e){var t=this.assertChanges();this.changes=t.insert(e.key,e)};e.prototype.getEntry=function(e,t){var n=this;var r=this.assertChanges();var i=r.get(t);if(i){return Je.resolve(i)}else{return this.getFromCache(e,t).next(function(e){if(e===null){n.documentSizes.set(t,0);return null}else{n.documentSizes.set(t,e.size);return e.maybeDocument}})}};e.prototype.getEntries=function(e,t){var n=this;return this.getAllFromCache(e,t).next(function(e){var t=e.maybeDocuments,r=e.sizeMap;r.forEach(function(e,t){n.documentSizes.set(e,t)});return t})};e.prototype.apply=function(e){var t=this.applyChanges(e);this.changes=null;return t};e.prototype.assertChanges=function(){d(this.changes!==null,"Changes have already been applied.");return this.changes};return e}();var kt="The remote document changelog no longer contains all changes for all "+"local query views. It may be necessary to rebuild these views.";var Ot=function(){function e(e,t,n){this.serializer=e;this.indexManager=t;this.keepDocumentChangeLog=n;this._lastProcessedDocumentChangeId=0}Object.defineProperty(e.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:true,configurable:true});e.prototype.start=function(e){var t=ft.getStore(e,hn.store);return this.synchronizeLastDocumentChangeId(t)};e.prototype.addEntries=function(e,t,n){var r=[];if(t.length>0){var i=Pt(e);var o=ze();for(var a=0,s=t;a<s.length;a++){var u=s[a],c=u.key,l=u.doc;r.push(i.put(Ft(c),l));o=o.add(c);r.push(this.indexManager.addToCollectionParentIndex(e,c.path.popLast()))}if(this.keepDocumentChangeLog){r.push(Lt(e).put({changes:this.serializer.toDbResourcePaths(o)}))}r.push(this.updateSize(e,n))}return Je.waitFor(r)};e.prototype.removeEntry=function(e,t){var n=Pt(e);var r=Ft(t);return n.get(r).next(function(e){if(e){return n.delete(r).next(function(){return qt(e)})}else{return Je.resolve(0)}})};e.prototype.getEntry=function(e,t){var n=this;return Pt(e).get(Ft(t)).next(function(e){return e?n.serializer.fromDbRemoteDocument(e):null})};e.prototype.getSizedEntry=function(e,t){var n=this;return Pt(e).get(Ft(t)).next(function(e){return e?{maybeDocument:n.serializer.fromDbRemoteDocument(e),size:qt(e)}:null})};e.prototype.getEntries=function(e,t){var n=this;var r=qe();return this.forEachDbEntry(e,t,function(e,t){if(t){r=r.insert(e,n.serializer.fromDbRemoteDocument(t))}else{r=r.insert(e,null)}}).next(function(){return r})};e.prototype.getSizedEntries=function(e,t){var n=this;var r=qe();var i=new ke(me.comparator);return this.forEachDbEntry(e,t,function(e,t){if(t){r=r.insert(e,n.serializer.fromDbRemoteDocument(t));i=i.insert(e,qt(t))}else{r=r.insert(e,null);i=i.insert(e,0)}}).next(function(){return{maybeDocuments:r,sizeMap:i}})};e.prototype.forEachDbEntry=function(e,t,n){if(t.isEmpty()){return Je.resolve()}var r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray());var i=t.getIterator();var o=i.getNext();return Pt(e).iterate({range:r},function(e,t,r){var a=me.fromSegments(e);while(o&&me.comparator(o,a)<0){n(o,null);o=i.getNext()}if(o&&o.isEqual(a)){n(o,t);o=i.hasNext()?i.getNext():null}if(o){r.skip(o.path.toArray())}else{r.done()}}).next(function(){while(o){n(o,null);o=i.hasNext()?i.getNext():null}})};e.prototype.getDocumentsMatchingQuery=function(e,t){var n=this;d(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=Ve();var i=t.path.length+1;var o=t.path.toArray();var a=IDBKeyRange.lowerBound(o);return Pt(e).iterate({range:a},function(e,o,a){if(e.length!==i){return}var s=n.serializer.fromDbRemoteDocument(o);if(!t.path.isPrefixOf(s.key.path)){a.done()}else if(s instanceof _t&&t.matches(s)){r=r.insert(s.key,s)}}).next(function(){return r})};e.prototype.getNewDocumentChanges=function(e){var t=this;d(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=ze();var r=Fe();var i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1);var o=true;var a=Lt(e);return a.iterate({range:i},function(e,r){if(o){o=false;if(t._lastProcessedDocumentChangeId+1!==r.id){return t.synchronizeLastDocumentChangeId(a).next(function(){return Je.reject(new v(y.DATA_LOSS,kt))})}}n=n.unionWith(t.serializer.fromDbResourcePaths(r.changes));t._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];n.forEach(function(n){i.push(t.getEntry(e,n).next(function(e){var t=e||new Dt(n,Ne.forDeletedDoc());r=r.insert(n,t)}))});return Je.waitFor(i)}).next(function(){return r})};e.prototype.removeDocumentChangesThroughChangeId=function(e,t){var n=IDBKeyRange.upperBound(t);return Lt(e).delete(n)};e.prototype.synchronizeLastDocumentChangeId=function(e){var t=this;this._lastProcessedDocumentChangeId=0;return e.iterate({keysOnly:true,reverse:true},function(e,n,r){t._lastProcessedDocumentChangeId=e;r.done()})};e.prototype.newChangeBuffer=function(){return new Rt(this)};e.prototype.getSize=function(e){return this.getMetadata(e).next(function(e){return e.byteSize})};e.prototype.getMetadata=function(e){return xt(e).get(nn.key).next(function(e){d(!!e,"Missing document cache metadata");return e})};e.prototype.setMetadata=function(e,t){return xt(e).put(nn.key,t)};e.prototype.updateSize=function(e,t){var n=this;return this.getMetadata(e).next(function(r){r.byteSize+=t;return n.setMetadata(e,r)})};return e}();function xt(e){return Wn.getStore(e,nn.store)}var Rt=function(e){B.__extends(t,e);function t(t){var n=e.call(this)||this;n.documentCache=t;return n}t.prototype.applyChanges=function(e){var t=this;var n=this.assertChanges();var r=0;var i=[];n.forEach(function(e,n){var o=t.documentCache.serializer.toDbRemoteDocument(n);var a=t.documentSizes.get(e);d(a!==undefined,"Attempting to change document "+e.toString()+" without having read it first");var s=qt(o);r+=s-a;i.push({key:e,doc:o})});return this.documentCache.addEntries(e,i,r)};t.prototype.getFromCache=function(e,t){return this.documentCache.getSizedEntry(e,t)};t.prototype.getAllFromCache=function(e,t){return this.documentCache.getSizedEntries(e,t)};return t}(Nt);function Mt(e){return e.code===y.DATA_LOSS&&e.message===kt}function Pt(e){return Wn.getStore(e,tn.store)}function Lt(e){return Wn.getStore(e,hn.store)}function Ft(e){return e.path.toArray()}function qt(e){var t;if(e.document){t=e.document}else if(e.unknownDocument){t=e.unknownDocument}else if(e.noDocument){t=e.noDocument}else{throw h("Unknown remote document type")}return JSON.stringify(t).length}var Ut=function(){function e(){this.collectionParentIndex=new Vt}e.prototype.addToCollectionParentIndex=function(e,t){this.collectionParentIndex.add(t);return Je.resolve()};e.prototype.getCollectionParents=function(e,t){return Je.resolve(this.collectionParentIndex.getEntries(t))};return e}();var Vt=function(){function e(){this.index={}}e.prototype.add=function(e){d(e.length%2===1,"Expected a collection path.");var t=e.lastSegment();var n=e.popLast();var r=this.index[t]||new Me(he.comparator);var i=!r.has(n);this.index[t]=r.add(n);return i};e.prototype.getEntries=function(e){var t=this.index[e]||new Me(he.comparator);return t.toArray()};return e}();var Bt=8;var jt=function(){function e(e){this.serializer=e}e.prototype.createOrUpgrade=function(e,t,n,r){var i=this;d(n<r&&n>=0&&r<=Bt,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");if(n<1&&r>=1){Wt(e);Yt(e);cn(e);Jt(e)}var o=Je.resolve();if(n<3&&r>=3){if(n!==0){ln(e);cn(e)}o=o.next(function(){return fn(t)})}if(n<4&&r>=4){if(n!==0){o=o.next(function(){return $t(e,t)})}o=o.next(function(){mn(e);dn(e)})}if(n<5&&r>=5){o=o.next(function(){return i.removeAcknowledgedMutations(t)})}if(n<6&&r>=6){o=o.next(function(){rn(e);return i.addDocumentGlobal(t)})}if(n<7&&r>=7){o=o.next(function(){return i.ensureSequenceNumbers(t)})}if(n<8&&r>=8){o=o.next(function(){return i.createCollectionParentIndex(e,t)})}return o};e.prototype.addDocumentGlobal=function(e){var t=0;return e.store(tn.store).iterate(function(e,n){t+=qt(n)}).next(function(){var n=new nn(t);return e.store(nn.store).put(nn.key,n)})};e.prototype.removeAcknowledgedMutations=function(e){var t=this;var n=e.store(Gt.store);var r=e.store(Ht.store);return n.loadAll().next(function(n){return Je.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,Ye],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(Ht.userMutationsIndex,i).next(function(r){return Je.forEach(r,function(r){d(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=t.serializer.fromDbMutationBatch(r);return nt(e,n.userId,i).next(function(){})})})})})};e.prototype.ensureSequenceNumbers=function(e){var t=e.store(an.store);var n=e.store(tn.store);return St(e).next(function(e){var r=function(n){return t.put(new an(0,Ie(n),e))};var i=[];return n.iterate(function(e,n){var o=new he(e);var a=Qt(o);i.push(t.get(a).next(function(e){if(!e){return r(o)}else{return Je.resolve()}}))}).next(function(){return Je.waitFor(i)})})};e.prototype.createCollectionParentIndex=function(e,t){e.createObjectStore(un.store,{keyPath:un.keyPath});var n=t.store(un.store);var r=new Vt;var i=function(e){if(r.add(e)){var t=e.lastSegment();var i=e.popLast();return n.put({collectionId:t,parent:Ie(i)})}};return t.store(tn.store).iterate({keysOnly:true},function(e,t){var n=new he(e);return i(n.popLast())}).next(function(){return t.store(Xt.store).iterate({keysOnly:true},function(e,t){var n=e[0],r=e[1],o=e[2];var a=Ce(r);return i(a.popLast())})})};return e}();function Qt(e){return[0,Ie(e)]}var zt=function(){function e(e,t){this.seconds=e;this.nanoseconds=t}return e}();var Kt=function(){function e(e,t,n){this.ownerId=e;this.allowTabSynchronization=t;this.leaseTimestampMs=n}e.store="owner";e.key="owner";return e}();function Wt(e){e.createObjectStore(Kt.store)}var Gt=function(){function e(e,t,n){this.userId=e;this.lastAcknowledgedBatchId=t;this.lastStreamToken=n}e.store="mutationQueues";e.keyPath="userId";return e}();var Ht=function(){function e(e,t,n,r,i){this.userId=e;this.batchId=t;this.localWriteTimeMs=n;this.baseMutations=r;this.mutations=i}e.store="mutations";e.keyPath="batchId";e.userMutationsIndex="userMutationsIndex";e.userMutationsKeyPath=["userId","batchId"];return e}();function Yt(e){e.createObjectStore(Gt.store,{keyPath:Gt.keyPath});var t=e.createObjectStore(Ht.store,{keyPath:Ht.keyPath,autoIncrement:true});t.createIndex(Ht.userMutationsIndex,Ht.userMutationsKeyPath,{unique:true});e.createObjectStore(Xt.store)}function $t(e,t){var n=t.store(Ht.store);return n.loadAll().next(function(n){e.deleteObjectStore(Ht.store);var r=e.createObjectStore(Ht.store,{keyPath:Ht.keyPath,autoIncrement:true});r.createIndex(Ht.userMutationsIndex,Ht.userMutationsKeyPath,{unique:true});var i=t.store(Ht.store);var o=n.map(function(e){return i.put(e)});return Je.waitFor(o)})}var Xt=function(){function e(){}e.prefixForUser=function(e){return[e]};e.prefixForPath=function(e,t){return[e,Ie(t)]};e.key=function(e,t,n){return[e,Ie(t),n]};e.store="documentMutations";e.PLACEHOLDER=new e;return e}();function Jt(e){e.createObjectStore(tn.store)}var Zt=function(){function e(e,t){this.path=e;this.readTime=t}return e}();var en=function(){function e(e,t){this.path=e;this.version=t}return e}();var tn=function(){function e(e,t,n,r){this.unknownDocument=e;this.noDocument=t;this.document=n;this.hasCommittedMutations=r}e.store="remoteDocuments";return e}();var nn=function(){function e(e){this.byteSize=e}e.store="remoteDocumentGlobal";e.key="remoteDocumentGlobalKey";return e}();function rn(e){e.createObjectStore(nn.store)}var on=function(){function e(e,t,n,r,i,o){this.targetId=e;this.canonicalId=t;this.readTime=n;this.resumeToken=r;this.lastListenSequenceNumber=i;this.query=o}e.store="targets";e.keyPath="targetId";e.queryTargetsIndexName="queryTargetsIndex";e.queryTargetsKeyPath=["canonicalId","targetId"];return e}();var an=function(){function e(e,t,n){this.targetId=e;this.path=t;this.sequenceNumber=n;d(e===0===(n!==undefined),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}e.store="targetDocuments";e.keyPath=["targetId","path"];e.documentTargetsIndex="documentTargetsIndex";e.documentTargetsKeyPath=["path","targetId"];return e}();var sn=function(){function e(e,t,n,r){this.highestTargetId=e;this.highestListenSequenceNumber=t;this.lastRemoteSnapshotVersion=n;this.targetCount=r}e.key="targetGlobalKey";e.store="targetGlobal";return e}();var un=function(){function e(e,t){this.collectionId=e;this.parent=t}e.store="collectionParents";e.keyPath=["collectionId","parent"];return e}();function cn(e){var t=e.createObjectStore(an.store,{keyPath:an.keyPath});t.createIndex(an.documentTargetsIndex,an.documentTargetsKeyPath,{unique:true});var n=e.createObjectStore(on.store,{keyPath:on.keyPath});n.createIndex(on.queryTargetsIndexName,on.queryTargetsKeyPath,{unique:true});e.createObjectStore(sn.store)}function ln(e){e.deleteObjectStore(an.store);e.deleteObjectStore(on.store);e.deleteObjectStore(sn.store)}function fn(e){var t=e.store(sn.store);var n=new sn(0,0,Ne.MIN.toTimestamp(),0);return t.put(sn.key,n)}var hn=function(){function e(e){this.changes=e}e.store="remoteDocumentChanges";e.keyPath="id";return e}();function dn(e){e.createObjectStore(hn.store,{keyPath:"id",autoIncrement:true})}var pn=function(){function e(e,t,n,r,i){this.clientId=e;this.updateTimeMs=t;this.networkEnabled=n;this.inForeground=r;this.lastProcessedDocumentChangeId=i}e.store="clientMetadata";e.keyPath="clientId";return e}();function mn(e){e.createObjectStore(pn.store,{keyPath:pn.keyPath})}var yn=[Gt.store,Ht.store,Xt.store,tn.store,on.store,Kt.store,sn.store,an.store];var vn=yn;var gn=vn.concat([pn.store,hn.store]);var bn=gn.concat([nn.store]);var wn=bn.concat([un.store]);var En=wn;var Sn=function(){function e(){this.collectionParentsCache=new Vt}e.prototype.addToCollectionParentIndex=function(e,t){d(t.length%2===1,"Expected a collection path.");if(this.collectionParentsCache.add(t)){d(t.length>=1,"Invalid collection path.");var n=t.lastSegment();var r=t.popLast();return Tn(e).put({collectionId:n,parent:Ie(r)})}return Je.resolve()};e.prototype.getCollectionParents=function(e,t){var n=[];var r=IDBKeyRange.bound([t,""],[te(t),""],false,true);return Tn(e).loadAll(r).next(function(e){for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o.collectionId!==t){break}n.push(Ce(o.parent))}return n})};return e}();function Tn(e){return Wn.getStore(e,un.store)}var In;(function(e){e[e["Listen"]=0]="Listen";e[e["ExistenceFilterMismatch"]=1]="ExistenceFilterMismatch";e[e["LimboResolution"]=2]="LimboResolution"})(In||(In={}));var _n=function(){function e(e,t,n,r,i,o){if(i===void 0){i=Ne.MIN}if(o===void 0){o=m()}this.query=e;this.targetId=t;this.purpose=n;this.sequenceNumber=r;this.snapshotVersion=i;this.resumeToken=o}e.prototype.copy=function(t){return new e(this.query,this.targetId,this.purpose,t.sequenceNumber===undefined?this.sequenceNumber:t.sequenceNumber,t.snapshotVersion===undefined?this.snapshotVersion:t.snapshotVersion,t.resumeToken===undefined?this.resumeToken:t.resumeToken)};e.prototype.isEqual=function(e){return this.targetId===e.targetId&&this.purpose===e.purpose&&this.sequenceNumber===e.sequenceNumber&&this.snapshotVersion.isEqual(e.snapshotVersion)&&this.resumeToken===e.resumeToken&&this.query.isEqual(e.query)};return e}();var Dn=function(){function e(e){this.remoteSerializer=e}e.prototype.fromDbRemoteDocument=function(e){if(e.document){return this.remoteSerializer.fromDocument(e.document,!!e.hasCommittedMutations)}else if(e.noDocument){var t=me.fromSegments(e.noDocument.path);var n=this.fromDbTimestamp(e.noDocument.readTime);return new Dt(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}else if(e.unknownDocument){var t=me.fromSegments(e.unknownDocument.path);var n=this.fromDbTimestamp(e.unknownDocument.version);return new Ct(t,n)}else{return h("Unexpected DbRemoteDocument")}};e.prototype.toDbRemoteDocument=function(e){if(e instanceof _t){var t=e.proto?e.proto:this.remoteSerializer.toDocument(e);var n=e.hasCommittedMutations;return new tn(null,null,t,n)}else if(e instanceof Dt){var r=e.key.path.toArray();var i=this.toDbTimestamp(e.version);var n=e.hasCommittedMutations;return new tn(null,new Zt(r,i),null,n)}else if(e instanceof Ct){var r=e.key.path.toArray();var i=this.toDbTimestamp(e.version);return new tn(new en(r,i),null,null,true)}else{return h("Unexpected MaybeDocumment")}};e.prototype.toDbTimestamp=function(e){var t=e.toTimestamp();return new zt(t.seconds,t.nanoseconds)};e.prototype.fromDbTimestamp=function(e){var t=new Ae(e.seconds,e.nanoseconds);return Ne.fromTimestamp(t)};e.prototype.toDbMutationBatch=function(e,t){var n=this;var r=t.baseMutations.map(function(e){return n.remoteSerializer.toMutation(e)});var i=t.mutations.map(function(e){return n.remoteSerializer.toMutation(e)});return new Ht(e,t.batchId,t.localWriteTime.toMillis(),r,i)};e.prototype.fromDbMutationBatch=function(e){var t=this;var n=(e.baseMutations||[]).map(function(e){return t.remoteSerializer.fromMutation(e)});var r=e.mutations.map(function(e){return t.remoteSerializer.fromMutation(e)});var i=Ae.fromMillis(e.localWriteTimeMs);return new $e(e.batchId,i,n,r)};e.prototype.toDbResourcePaths=function(e){var t=[];e.forEach(function(e){t.push(Ie(e.path))});return t};e.prototype.fromDbResourcePaths=function(e){var t=ze();for(var n=0,r=e;n<r.length;n++){var i=r[n];t=t.add(new me(Ce(i)))}return t};e.prototype.fromDbTarget=function(e){var t=this.fromDbTimestamp(e.readTime);var n;if(Cn(e.query)){n=this.remoteSerializer.fromDocumentsTarget(e.query)}else{n=this.remoteSerializer.fromQueryTarget(e.query)}return new _n(n,e.targetId,In.Listen,e.lastListenSequenceNumber,t,e.resumeToken)};e.prototype.toDbTarget=function(e){d(In.Listen===e.purpose,"Only queries with purpose "+In.Listen+" may be stored, got "+e.purpose);var t=this.toDbTimestamp(e.snapshotVersion);var n;if(e.query.isDocumentQuery()){n=this.remoteSerializer.toDocumentsTarget(e.query)}else{n=this.remoteSerializer.toQueryTarget(e.query)}var r;if(e.resumeToken instanceof Uint8Array){d(process.env.USE_MOCK_PERSISTENCE==="YES","Persisting non-string stream tokens is only supported with mock persistence .");r=e.resumeToken.toString()}else{r=e.resumeToken}return new on(e.targetId,e.query.canonicalId(),t,r,e.sequenceNumber,n)};return e}();function Cn(e){return e.documents!==undefined}function An(e,t){var n=e[0],r=e[1];var i=t[0],o=t[1];var a=J(n,i);if(a===0){return J(r,o)}else{return a}}var Nn=function(){function e(e){this.maxElements=e;this.buffer=new Me(An);this.previousIndex=0}e.prototype.nextIndex=function(){return++this.previousIndex};e.prototype.addElement=function(e){var t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements){this.buffer=this.buffer.add(t)}else{var n=this.buffer.last();if(An(t,n)<0){this.buffer=this.buffer.delete(n).add(t)}}};Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:true,configurable:true});return e}();var kn={didRun:false,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};var On=function(){function e(e,t,n){this.cacheSizeCollectionThreshold=e;this.percentileToCollect=t;this.maximumSequenceNumbersToCollect=n}e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)};e.COLLECTION_DISABLED=-1;e.MINIMUM_CACHE_SIZE_BYTES=1*1024*1024;e.DEFAULT_CACHE_SIZE_BYTES=40*1024*1024;e.DEFAULT_COLLECTION_PERCENTILE=10;e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;e.DEFAULT=new e(e.DEFAULT_CACHE_SIZE_BYTES,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);e.DISABLED=new e(e.COLLECTION_DISABLED,0,0);return e}();var xn=1*60*1e3;var Rn=5*60*1e3;var Mn=function(){function e(e,t,n){this.garbageCollector=e;this.asyncQueue=t;this.localStore=n;this.gcTask=null}e.prototype.start=function(){d(this.gcTask===null,"Cannot start an already started LruScheduler");if(this.garbageCollector.params.cacheSizeCollectionThreshold!==On.COLLECTION_DISABLED){this.scheduleGC()}};e.prototype.stop=function(){if(this.gcTask){this.gcTask.cancel();this.gcTask=null}};Object.defineProperty(e.prototype,"started",{get:function(){return this.gcTask!==null},enumerable:true,configurable:true});e.prototype.scheduleGC=function(){var e=this;d(this.gcTask===null,"Cannot schedule GC while a task is pending");var t=this.hasRun?Rn:xn;c("LruGarbageCollector","Garbage collection scheduled in "+t+"ms");this.gcTask=this.asyncQueue.enqueueAfterDelay(ve.LruGarbageCollection,t,function(){e.gcTask=null;e.hasRun=true;return e.localStore.collectGarbage(e.garbageCollector).then(function(){return e.scheduleGC()}).catch(Hn)})};return e}();var Pn=function(){function e(e,t){this.delegate=e;this.params=t}e.prototype.calculateTargetCount=function(e,t){return this.delegate.getSequenceNumberCount(e).next(function(e){return Math.floor(t/100*e)})};e.prototype.nthSequenceNumber=function(e,t){var n=this;if(t===0){return Je.resolve(ce.INVALID)}var r=new Nn(t);return this.delegate.forEachTarget(e,function(e){return r.addElement(e.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(e,function(e){return r.addElement(e)})}).next(function(){return r.maxValue})};e.prototype.removeTargets=function(e,t,n){return this.delegate.removeTargets(e,t,n)};e.prototype.removeOrphanedDocuments=function(e,t){return this.delegate.removeOrphanedDocuments(e,t)};e.prototype.collect=function(e,t){var n=this;if(this.params.cacheSizeCollectionThreshold===On.COLLECTION_DISABLED){c("LruGarbageCollector","Garbage collection skipped; disabled");return Je.resolve(kn)}return this.getCacheSize(e).next(function(r){if(r<n.params.cacheSizeCollectionThreshold){c("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" "+("is lower than threshold "+n.params.cacheSizeCollectionThreshold));return kn}else{return n.runGarbageCollection(e,t)}})};e.prototype.getCacheSize=function(e){return this.delegate.getCacheSize(e)};e.prototype.runGarbageCollection=function(e,t){var n=this;var r;var i,o;var u,l,f,h,d;u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){if(t>n.params.maximumSequenceNumbersToCollect){c("LruGarbageCollector","Capping sequence numbers to collect down "+("to the maximum of "+n.params.maximumSequenceNumbersToCollect+" ")+("from "+t));i=n.params.maximumSequenceNumbersToCollect}else{i=t}l=Date.now();return n.nthSequenceNumber(e,i)}).next(function(i){r=i;f=Date.now();return n.removeTargets(e,r,t)}).next(function(t){o=t;h=Date.now();return n.removeOrphanedDocuments(e,r)}).next(function(e){d=Date.now();if(s()<=a.DEBUG){var t="LRU Garbage Collection\n"+("\tCounted targets in "+(l-u)+"ms\n")+("\tDetermined least recently used "+i+" in ")+(f-l+"ms\n")+("\tRemoved "+o+" targets in ")+(h-f+"ms\n")+("\tRemoved "+e+" documents in ")+(d-h+"ms\n")+("Total Duration: "+(d-u)+"ms");c("LruGarbageCollector",t)}return Je.resolve({didRun:true,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:e})})};return e}();var Ln=function(){function e(){}return e}();var Fn="IndexedDbPersistence";var qn=30*60*1e3;var Un=5e3;var Vn=4e3;var Bn="The current tab is not in the required state to perform this operation. "+"It might be necessary to refresh the browser tab.";var jn="Another tab has exclusive access to the persistence layer. "+"To allow shared access, make sure to invoke "+"`enablePersistence()` with `synchronizeTabs:true` in all tabs.";var Qn="This platform is either missing"+" IndexedDB or is known to have an incomplete implementation. Offline"+" persistence has been disabled.";var zn="firestore_zombie";var Kn=function(e){B.__extends(t,e);function t(t,n){var r=e.call(this)||this;r.simpleDbTransaction=t;r.currentSequenceNumber=n;return r}return t}(Ln);var Wn=function(){function e(t,n,r,i,o,a,s){this.persistenceKey=t;this.clientId=n;this.queue=i;this.multiClientParams=s;this._started=false;this.isPrimary=false;this.networkEnabled=true;this.inForeground=false;this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY;this.primaryStateListener=function(e){return Promise.resolve()};if(!e.isAvailable()){throw new v(y.UNIMPLEMENTED,Qn)}this.referenceDelegate=new Xn(this,a);this.dbName=t+e.MAIN_DATABASE;this.serializer=new Dn(o);this.document=r.document;this.allowTabSynchronization=s!==undefined;this.queryCache=new gt(this.referenceDelegate,this.serializer);this.indexManager=new Sn;this.remoteDocumentCache=new Ot(this.serializer,this.indexManager,this.allowTabSynchronization);if(r.window&&r.window.localStorage){this.window=r.window;this.webStorage=this.window.localStorage}else{throw new v(y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.")}}e.getStore=function(e,t){if(e instanceof Kn){return ft.getStore(e.simpleDbTransaction,t)}else{throw h("IndexedDbPersistence must use instances of IndexedDbTransaction")}};e.createIndexedDbPersistence=function(t,n,r,i,o,a){return B.__awaiter(this,void 0,void 0,function(){var s;return B.__generator(this,function(u){switch(u.label){case 0:s=new e(t,n,r,i,o,a);return[4,s.start()];case 1:u.sent();return[2,s]}})})};e.createMultiClientIndexedDbPersistence=function(t,n,r,i,o,a,s){return B.__awaiter(this,void 0,void 0,function(){var u;return B.__generator(this,function(c){switch(c.label){case 0:u=new e(t,n,r,i,o,a,s);return[4,u.start()];case 1:c.sent();return[2,u]}})})};e.prototype.start=function(){var e=this;d(!this.started,"IndexedDbPersistence double-started!");d(this.window!==null,"Expected 'window' to be defined");return ft.openOrCreate(this.dbName,Bt,new jt(this.serializer)).then(function(t){e.simpleDb=t;return e.updateClientMetadataAndTryBecomePrimary()}).then(function(){e.attachVisibilityHandler();e.attachWindowUnloadHook();e.scheduleClientMetadataAndPrimaryLeaseRefreshes();return e.startRemoteDocumentCache()}).then(function(){return e.simpleDb.runTransaction("readonly",[sn.store],function(t){return St(t).next(function(t){var n=e.multiClientParams?e.multiClientParams.sequenceNumberSyncer:undefined;e.listenSequence=new ce(t,n)})})}).then(function(){e._started=true}).catch(function(t){e.simpleDb&&e.simpleDb.close();return Promise.reject(t)})};e.prototype.startRemoteDocumentCache=function(){var e=this;return this.simpleDb.runTransaction("readonly",En,function(t){return e.remoteDocumentCache.start(t)})};e.prototype.setPrimaryStateListener=function(e){var t=this;this.primaryStateListener=function(n){return B.__awaiter(t,void 0,void 0,function(){return B.__generator(this,function(t){if(this.started){return[2,e(n)]}return[2]})})};return e(this.isPrimary)};e.prototype.setDatabaseDeletedListener=function(e){var t=this;this.simpleDb.setVersionChangeListener(function(n){return B.__awaiter(t,void 0,void 0,function(){return B.__generator(this,function(t){switch(t.label){case 0:if(!(n.newVersion===null))return[3,2];return[4,e()];case 1:t.sent();t.label=2;case 2:return[2]}})})})};e.prototype.setNetworkEnabled=function(e){var t=this;if(this.networkEnabled!==e){this.networkEnabled=e;this.queue.enqueueAndForget(function(){return B.__awaiter(t,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:if(!this.started)return[3,2];return[4,this.updateClientMetadataAndTryBecomePrimary()];case 1:e.sent();e.label=2;case 2:return[2]}})})})}};e.prototype.updateClientMetadataAndTryBecomePrimary=function(){var e=this;return this.simpleDb.runTransaction("readwrite",En,function(t){var n=$n(t);return n.put(new pn(e.clientId,Date.now(),e.networkEnabled,e.inForeground,e.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(e.isPrimary){return e.verifyPrimaryLease(t).next(function(t){if(!t){e.isPrimary=false;e.queue.enqueueAndForget(function(){return e.primaryStateListener(false)})}})}}).next(function(){return e.canActAsPrimary(t)}).next(function(n){var r=e.isPrimary;e.isPrimary=n;if(r!==e.isPrimary){e.queue.enqueueAndForget(function(){return e.primaryStateListener(e.isPrimary)})}if(r&&!e.isPrimary){return e.releasePrimaryLeaseIfHeld(t)}else if(e.isPrimary){return e.acquireOrExtendPrimaryLease(t)}})})};e.prototype.verifyPrimaryLease=function(e){var t=this;var n=Yn(e);return n.get(Kt.key).next(function(e){return Je.resolve(t.isLocalClient(e))})};e.prototype.removeClientMetadata=function(e){var t=$n(e);return t.delete(this.clientId)};e.prototype.maybeGarbageCollectMultiClientState=function(){return B.__awaiter(this,void 0,void 0,function(){var t,n;var r=this;return B.__generator(this,function(i){switch(i.label){case 0:if(!(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,qn)))return[3,2];this.lastGarbageCollectionTime=Date.now();n=[];return[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(i){var o=e.getStore(i,pn.store);return o.loadAll().next(function(e){t=r.filterActiveClients(e,qn);n=e.filter(function(e){return t.indexOf(e)===-1})}).next(function(){return Je.forEach(n,function(e){return o.delete(e.clientId)})}).next(function(){t=t.filter(function(e){return e.clientId!==r.clientId});if(t.length>0){var e=t.map(function(e){return e.lastProcessedDocumentChangeId||0});var n=Math.min.apply(Math,e);return r.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,n)}})})];case 1:i.sent();n.forEach(function(e){r.window.localStorage.removeItem(r.zombiedClientLocalStorageKey(e.clientId))});i.label=2;case 2:return[2]}})})};e.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var e=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(ve.ClientMetadataRefresh,Vn,function(){return e.updateClientMetadataAndTryBecomePrimary().then(function(){return e.maybeGarbageCollectMultiClientState()}).then(function(){return e.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})};e.prototype.isLocalClient=function(e){return e?e.ownerId===this.clientId:false};e.prototype.canActAsPrimary=function(e){var t=this;var n=Yn(e);return n.get(Kt.key).next(function(n){var r=n!==null&&t.isWithinAge(n.leaseTimestampMs,Un)&&!t.isClientZombied(n.ownerId);if(r){if(t.isLocalClient(n)&&t.networkEnabled){return true}if(!t.isLocalClient(n)){if(!n.allowTabSynchronization){throw new v(y.FAILED_PRECONDITION,jn)}return false}}if(t.networkEnabled&&t.inForeground){return true}return $n(e).loadAll().next(function(e){var n=t.filterActiveClients(e,Un).find(function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled;var r=!t.inForeground&&e.inForeground;var i=t.networkEnabled===e.networkEnabled;if(n||r&&i){return true}}return false});return n===undefined})}).next(function(e){if(t.isPrimary!==e){c(Fn,"Client "+(e?"is":"is not")+" eligible for a primary lease.")}return e})};e.prototype.shutdown=function(){return B.__awaiter(this,void 0,void 0,function(){var e=this;return B.__generator(this,function(t){switch(t.label){case 0:this._started=false;this.markClientZombied();if(this.clientMetadataRefresher){this.clientMetadataRefresher.cancel()}this.detachVisibilityHandler();this.detachWindowUnloadHook();return[4,this.simpleDb.runTransaction("readwrite",[Kt.store,pn.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:t.sent();this.simpleDb.close();this.removeClientZombiedEntry();return[2]}})})};e.prototype.filterActiveClients=function(e,t){var n=this;return e.filter(function(e){return n.isWithinAge(e.updateTimeMs,t)&&!n.isClientZombied(e.clientId)})};e.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly",[pn.store],function(t){return $n(t).loadAll().next(function(t){return e.filterActiveClients(t,qn).map(function(e){return e.clientId})})})};e.clearPersistence=function(t){return B.__awaiter(this,void 0,void 0,function(){var n;return B.__generator(this,function(r){switch(r.label){case 0:if(!e.isAvailable()){return[2,Promise.resolve()]}n=t+e.MAIN_DATABASE;return[4,ft.delete(n)];case 1:r.sent();return[2]}})})};Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:true,configurable:true});e.prototype.getMutationQueue=function(e){d(this.started,"Cannot initialize MutationQueue before persistence is started.");return Ze.forUser(e,this.serializer,this.indexManager,this.referenceDelegate)};e.prototype.getQueryCache=function(){d(this.started,"Cannot initialize QueryCache before persistence is started.");return this.queryCache};e.prototype.getRemoteDocumentCache=function(){d(this.started,"Cannot initialize RemoteDocumentCache before persistence is started.");return this.remoteDocumentCache};e.prototype.getIndexManager=function(){d(this.started,"Cannot initialize IndexManager before persistence is started.");return this.indexManager};e.prototype.runTransaction=function(e,t,n){var r=this;c(Fn,"Starting transaction:",e);return this.simpleDb.runTransaction(t==="readonly"?"readonly":"readwrite",En,function(i){if(t==="readwrite-primary"){return r.verifyPrimaryLease(i).next(function(t){if(!t){l("Failed to obtain primary lease for action '"+e+"'.");r.isPrimary=false;r.queue.enqueueAndForget(function(){return r.primaryStateListener(false)});throw new v(y.FAILED_PRECONDITION,Bn)}return n(new Kn(i,r.listenSequence.next()))}).next(function(e){return r.acquireOrExtendPrimaryLease(i).next(function(){return e})})}else{return r.verifyAllowTabSynchronization(i).next(function(){return n(new Kn(i,r.listenSequence.next()))})}})};e.prototype.verifyAllowTabSynchronization=function(e){var t=this;var n=Yn(e);return n.get(Kt.key).next(function(e){var n=e!==null&&t.isWithinAge(e.leaseTimestampMs,Un)&&!t.isClientZombied(e.ownerId);if(n&&!t.isLocalClient(e)){if(!e.allowTabSynchronization){throw new v(y.FAILED_PRECONDITION,jn)}}})};e.prototype.acquireOrExtendPrimaryLease=function(e){var t=new Kt(this.clientId,this.allowTabSynchronization,Date.now());return Yn(e).put(Kt.key,t)};e.isAvailable=function(){return ft.isAvailable()};e.buildStoragePrefix=function(e){var t=e.databaseId.projectId;if(!e.databaseId.isDefaultDatabase){t+="."+e.databaseId.database}return"firestore/"+e.persistenceKey+"/"+t+"/"};e.prototype.releasePrimaryLeaseIfHeld=function(e){var t=this;var n=Yn(e);return n.get(Kt.key).next(function(e){if(t.isLocalClient(e)){c(Fn,"Releasing primary lease.");return n.delete(Kt.key)}else{return Je.resolve()}})};e.prototype.isWithinAge=function(e,t){var n=Date.now();var r=n-t;var i=n;if(e<r){return false}else if(e>i){l("Detected an update time that is in the future: "+e+" > "+i);return false}return true};e.prototype.attachVisibilityHandler=function(){var e=this;if(this.document!==null&&typeof this.document.addEventListener==="function"){this.documentVisibilityHandler=function(){e.queue.enqueueAndForget(function(){e.inForeground=e.document.visibilityState==="visible";return e.updateClientMetadataAndTryBecomePrimary()})};this.document.addEventListener("visibilitychange",this.documentVisibilityHandler);this.inForeground=this.document.visibilityState==="visible"}};e.prototype.detachVisibilityHandler=function(){if(this.documentVisibilityHandler){d(this.document!==null&&typeof this.document.addEventListener==="function","Expected 'document.addEventListener' to be a function");this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler);this.documentVisibilityHandler=null}};e.prototype.attachWindowUnloadHook=function(){var e=this;if(typeof this.window.addEventListener==="function"){this.windowUnloadHandler=function(){e.markClientZombied();e.queue.enqueueAndForget(function(){return e.shutdown()})};this.window.addEventListener("unload",this.windowUnloadHandler)}};e.prototype.detachWindowUnloadHook=function(){if(this.windowUnloadHandler){d(typeof this.window.removeEventListener==="function","Expected 'window.removeEventListener' to be a function");this.window.removeEventListener("unload",this.windowUnloadHandler);this.windowUnloadHandler=null}};e.prototype.isClientZombied=function(e){try{var t=this.webStorage.getItem(this.zombiedClientLocalStorageKey(e))!==null;c(Fn,"Client '"+e+"' "+(t?"is":"is not")+" zombied in LocalStorage");return t}catch(e){l(Fn,"Failed to get zombied client id.",e);return false}};e.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){l("Failed to set zombie client id.",e)}};e.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}};e.prototype.zombiedClientLocalStorageKey=function(e){return zn+"_"+this.persistenceKey+"_"+e};e.MAIN_DATABASE="main";return e}();function Gn(e){return e.code===y.FAILED_PRECONDITION&&e.message===Bn}function Hn(e){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){if(Gn(e)){c(Fn,"Unexpectedly lost primary lease")}else{throw e}return[2]})})}function Yn(e){return e.store(Kt.store)}function $n(e){return e.store(pn.store)}var Xn=function(){function e(e,t){this.db=e;this.garbageCollector=new Pn(this,t)}e.prototype.getSequenceNumberCount=function(e){var t=this.orphanedDocmentCount(e);var n=this.db.getQueryCache().getQueryCount(e);return n.next(function(e){return t.next(function(t){return e+t})})};e.prototype.orphanedDocmentCount=function(e){var t=0;return this.forEachOrphanedDocumentSequenceNumber(e,function(e){t++}).next(function(){return t})};e.prototype.forEachTarget=function(e,t){return this.db.getQueryCache().forEachTarget(e,t)};e.prototype.forEachOrphanedDocumentSequenceNumber=function(e,t){return this.forEachOrphanedDocument(e,function(e,n){return t(n)})};e.prototype.setInMemoryPins=function(e){this.inMemoryPins=e};e.prototype.addReference=function(e,t){return er(e,t)};e.prototype.removeReference=function(e,t){return er(e,t)};e.prototype.removeTargets=function(e,t,n){return this.db.getQueryCache().removeTargets(e,t,n)};e.prototype.removeMutationReference=function(e,t){return er(e,t)};e.prototype.isPinned=function(e,t){if(this.inMemoryPins.containsKey(t)){return Je.resolve(true)}else{return tt(e,t)}};e.prototype.removeOrphanedDocuments=function(e,t){var n=this;var r=0;var i=0;var o=[];var a=this.forEachOrphanedDocument(e,function(a,s){if(s<=t){var u=n.isPinned(e,a).next(function(t){if(!t){r++;return n.removeOrphanedDocument(e,a).next(function(e){i+=e})}});o.push(u)}});return a.next(function(){return Je.waitFor(o)}).next(function(){return n.db.getRemoteDocumentCache().updateSize(e,-i)}).next(function(){return r})};e.prototype.removeOrphanedDocument=function(e,t){var n=0;var r=this.db.getRemoteDocumentCache();return Je.waitFor([Tt(e).delete(Jn(t)),r.removeEntry(e,t).next(function(e){n+=e})]).next(function(){return n})};e.prototype.removeTarget=function(e,t){var n=t.copy({sequenceNumber:e.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(e,n)};e.prototype.updateLimboDocument=function(e,t){return er(e,t)};e.prototype.forEachOrphanedDocument=function(e,t){var n=Tt(e);var r=ce.INVALID;var i;return n.iterate({index:an.documentTargetsIndex},function(e,n){var o=e[0],a=e[1];var s=n.path,u=n.sequenceNumber;if(o===0){if(r!==ce.INVALID){t(new me(Ce(i)),r)}r=u;i=s}else{r=ce.INVALID}}).next(function(){if(r!==ce.INVALID){t(new me(Ce(i)),r)}})};e.prototype.getCacheSize=function(e){return this.db.getRemoteDocumentCache().getSize(e)};return e}();function Jn(e){return[0,Ie(e.path)]}function Zn(e,t){return new an(0,Ie(e.path),t)}function er(e,t){return Tt(e).put(Zn(t,e.currentSequenceNumber))}var tr;(function(e){e[e["NullValue"]=0]="NullValue";e[e["BooleanValue"]=1]="BooleanValue";e[e["NumberValue"]=2]="NumberValue";e[e["TimestampValue"]=3]="TimestampValue";e[e["StringValue"]=4]="StringValue";e[e["BlobValue"]=5]="BlobValue";e[e["RefValue"]=6]="RefValue";e[e["GeoPointValue"]=7]="GeoPointValue";e[e["ArrayValue"]=8]="ArrayValue";e[e["ObjectValue"]=9]="ObjectValue"})(tr||(tr={}));var nr;(function(e){e[e["Default"]=0]="Default";e[e["Estimate"]=1]="Estimate";e[e["Previous"]=2]="Previous"})(nr||(nr={}));var rr=function(){function e(e,t){this.serverTimestampBehavior=e;this.timestampsInSnapshots=t}e.fromSnapshotOptions=function(t,n){switch(t.serverTimestamps){case"estimate":return new e(nr.Estimate,n);case"previous":return new e(nr.Previous,n);case"none":case undefined:return new e(nr.Default,n);default:return h("fromSnapshotOptions() called with invalid options.")}};return e}();var ir=function(){function e(){}e.prototype.toString=function(){var e=this.value();return e===null?"null":e.toString()};e.prototype.defaultCompareTo=function(e){d(this.typeOrder!==e.typeOrder,"Default compareTo should not be used for values of same type.");var t=J(this.typeOrder,e.typeOrder);return t};return e}();var or=function(e){B.__extends(t,e);function t(){var t=e.call(this)||this;t.typeOrder=tr.NullValue;t.internalValue=null;return t}t.prototype.value=function(e){return null};t.prototype.isEqual=function(e){return e instanceof t};t.prototype.compareTo=function(e){if(e instanceof t){return 0}return this.defaultCompareTo(e)};t.INSTANCE=new t;return t}(ir);var ar=function(e){B.__extends(t,e);function t(t){var n=e.call(this)||this;n.internalValue=t;n.typeOrder=tr.BooleanValue;return n}t.prototype.value=function(e){return this.internalValue};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue===e.internalValue};t.prototype.compareTo=function(e){if(e instanceof t){return J(this,e)}return this.defaultCompareTo(e)};t.of=function(e){return e?t.TRUE:t.FALSE};t.TRUE=new t(true);t.FALSE=new t(false);return t}(ir);var sr=function(e){B.__extends(t,e);function t(t){var n=e.call(this)||this;n.internalValue=t;n.typeOrder=tr.NumberValue;return n}t.prototype.value=function(e){return this.internalValue};t.prototype.compareTo=function(e){if(e instanceof t){return ur(this.internalValue,e.internalValue)}return this.defaultCompareTo(e)};return t}(ir);function ur(e,t){if(e<t){return-1}else if(e>t){return 1}else if(e===t){return 0}else{if(isNaN(e)){return isNaN(t)?0:-1}else{return 1}}}function cr(e,t){if(e===t){return e!==0||1/e===1/t}else{return e!==e&&t!==t}}var lr=function(e){B.__extends(t,e);function t(t){return e.call(this,t)||this}t.prototype.isEqual=function(e){if(e instanceof t){return cr(this.internalValue,e.internalValue)}else{return false}};return t}(sr);var fr=function(e){B.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.internalValue=t;return n}t.prototype.isEqual=function(e){if(e instanceof t){return cr(this.internalValue,e.internalValue)}else{return false}};t.NAN=new t(NaN);t.POSITIVE_INFINITY=new t(Infinity);t.NEGATIVE_INFINITY=new t(-Infinity);return t}(sr);var hr=function(e){B.__extends(t,e);function t(t){var n=e.call(this)||this;n.internalValue=t;n.typeOrder=tr.StringValue;return n}t.prototype.value=function(e){return this.internalValue};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue===e.internalValue};t.prototype.compareTo=function(e){if(e instanceof t){return J(this.internalValue,e.internalValue)}return this.defaultCompareTo(e)};return t}(ir);var dr=function(e){B.__extends(t,e);function t(t){var n=e.call(this)||this;n.internalValue=t;n.typeOrder=tr.TimestampValue;return n}t.prototype.value=function(e){if(!e||e.timestampsInSnapshots){return this.internalValue}else{return this.internalValue.toDate()}};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue.isEqual(e.internalValue)};t.prototype.compareTo=function(e){if(e instanceof t){return this.internalValue._compareTo(e.internalValue)}else if(e instanceof pr){return-1}else{return this.defaultCompareTo(e)}};return t}(ir);var pr=function(e){B.__extends(t,e);function t(t,n){var r=e.call(this)||this;r.localWriteTime=t;r.previousValue=n;r.typeOrder=tr.TimestampValue;return r}t.prototype.value=function(e){if(e&&e.serverTimestampBehavior===nr.Estimate){return new dr(this.localWriteTime).value(e)}else if(e&&e.serverTimestampBehavior===nr.Previous){return this.previousValue?this.previousValue.value(e):null}else{return null}};t.prototype.isEqual=function(e){return e instanceof t&&this.localWriteTime.isEqual(e.localWriteTime)};t.prototype.compareTo=function(e){if(e instanceof t){return this.localWriteTime._compareTo(e.localWriteTime)}else if(e instanceof dr){return 1}else{return this.defaultCompareTo(e)}};t.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"};return t}(ir);var mr=function(e){B.__extends(t,e);function t(t){var n=e.call(this)||this;n.internalValue=t;n.typeOrder=tr.BlobValue;return n}t.prototype.value=function(e){return this.internalValue};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue.isEqual(e.internalValue)};t.prototype.compareTo=function(e){if(e instanceof t){return this.internalValue._compareTo(e.internalValue)}return this.defaultCompareTo(e)};return t}(ir);var yr=function(e){B.__extends(t,e);function t(t,n){var r=e.call(this)||this;r.databaseId=t;r.key=n;r.typeOrder=tr.RefValue;return r}t.prototype.value=function(e){return this.key};t.prototype.isEqual=function(e){if(e instanceof t){return this.key.isEqual(e.key)&&this.databaseId.isEqual(e.databaseId)}else{return false}};t.prototype.compareTo=function(e){if(e instanceof t){var n=this.databaseId.compareTo(e.databaseId);return n!==0?n:me.comparator(this.key,e.key)}return this.defaultCompareTo(e)};return t}(ir);var vr=function(e){B.__extends(t,e);function t(t){var n=e.call(this)||this;n.internalValue=t;n.typeOrder=tr.GeoPointValue;return n}t.prototype.value=function(e){return this.internalValue};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue.isEqual(e.internalValue)};t.prototype.compareTo=function(e){if(e instanceof t){return this.internalValue._compareTo(e.internalValue)}return this.defaultCompareTo(e)};return t}(ir);var gr=function(e){B.__extends(t,e);function t(t){var n=e.call(this)||this;n.internalValue=t;n.typeOrder=tr.ObjectValue;return n}t.prototype.value=function(e){var t={};this.internalValue.inorderTraversal(function(n,r){t[n]=r.value(e)});return t};t.prototype.forEach=function(e){this.internalValue.inorderTraversal(e)};t.prototype.isEqual=function(e){if(e instanceof t){var n=this.internalValue.getIterator();var r=e.internalValue.getIterator();while(n.hasNext()&&r.hasNext()){var i=n.getNext();var o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value)){return false}}return!n.hasNext()&&!r.hasNext()}return false};t.prototype.compareTo=function(e){if(e instanceof t){var n=this.internalValue.getIterator();var r=e.internalValue.getIterator();while(n.hasNext()&&r.hasNext()){var i=n.getNext();var o=r.getNext();var a=J(i.key,o.key)||i.value.compareTo(o.value);if(a){return a}}return J(n.hasNext(),r.hasNext())}else{return this.defaultCompareTo(e)}};t.prototype.set=function(e,n){d(!e.isEmpty(),"Cannot set field for empty path on ObjectValue");if(e.length===1){return this.setChild(e.firstSegment(),n)}else{var r=this.child(e.firstSegment());if(!(r instanceof t)){r=t.EMPTY}var i=r.set(e.popFirst(),n);return this.setChild(e.firstSegment(),i)}};t.prototype.delete=function(e){d(!e.isEmpty(),"Cannot delete field for empty path on ObjectValue");if(e.length===1){return new t(this.internalValue.remove(e.firstSegment()))}else{var n=this.child(e.firstSegment());if(n instanceof t){var r=n.delete(e.popFirst());return new t(this.internalValue.insert(e.firstSegment(),r))}else{return this}}};t.prototype.contains=function(e){return this.field(e)!==undefined};t.prototype.field=function(e){d(!e.isEmpty(),"Can't get field of empty path");var n=this;e.forEach(function(e){if(n instanceof t){n=n.internalValue.get(e)||undefined}else{n=undefined}});return n};t.prototype.toString=function(){return this.internalValue.toString()};t.prototype.child=function(e){return this.internalValue.get(e)||undefined};t.prototype.setChild=function(e,n){return new t(this.internalValue.insert(e,n))};t.EMPTY=new t(new ke(J));return t}(ir);var br=function(e){B.__extends(t,e);function t(t){var n=e.call(this)||this;n.internalValue=t;n.typeOrder=tr.ArrayValue;return n}t.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})};t.prototype.contains=function(e){for(var t=0,n=this.internalValue;t<n.length;t++){var r=n[t];if(r.isEqual(e)){return true}}return false};t.prototype.forEach=function(e){this.internalValue.forEach(e)};t.prototype.isEqual=function(e){if(e instanceof t){if(this.internalValue.length!==e.internalValue.length){return false}for(var n=0;n<this.internalValue.length;n++){if(!this.internalValue[n].isEqual(e.internalValue[n])){return false}}return true}return false};t.prototype.compareTo=function(e){if(e instanceof t){var n=Math.min(this.internalValue.length,e.internalValue.length);for(var r=0;r<n;r++){var i=this.internalValue[r].compareTo(e.internalValue[r]);if(i){return i}}return J(this.internalValue.length,e.internalValue.length)}else{return this.defaultCompareTo(e)}};t.prototype.toString=function(){var e=this.internalValue.map(function(e){return e.toString()});return"["+e.join(",")+"]"};return t}(ir);var wr=function(){function e(e){this.fields=e}e.fromSet=function(t){return new e(t)};e.fromArray=function(t){var n=new Me(pe.comparator);t.forEach(function(e){return n=n.add(e)});return new e(n)};e.prototype.covers=function(e){var t=false;this.fields.forEach(function(n){if(n.isPrefixOf(e)){t=true}});return t};e.prototype.applyTo=function(e){var t=gr.EMPTY;this.fields.forEach(function(n){if(n.isEmpty()){return e}else{var r=e.field(n);if(r!==undefined){t=t.set(n,r)}}});return t};e.prototype.isEqual=function(e){return this.fields.isEqual(e.fields)};return e}();var Er=function(){function e(e,t){this.field=e;this.transform=t}Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return this.transform.isIdempotent},enumerable:true,configurable:true});e.prototype.isEqual=function(e){return this.field.isEqual(e.field)&&this.transform.isEqual(e.transform)};return e}();var Sr=function(){function e(e,t){this.version=e;this.transformResults=t}return e}();var Tr;(function(e){e[e["Set"]=0]="Set";e[e["Patch"]=1]="Patch";e[e["Transform"]=2]="Transform";e[e["Delete"]=3]="Delete"})(Tr||(Tr={}));var Ir=function(){function e(e,t){this.updateTime=e;this.exists=t;d(e===undefined||t===undefined,'Precondition can specify "exists" or "updateTime" but not both')}e.exists=function(t){return new e(undefined,t)};e.updateTime=function(t){return new e(t)};Object.defineProperty(e.prototype,"isNone",{get:function(){return this.updateTime===undefined&&this.exists===undefined},enumerable:true,configurable:true});e.prototype.isValidFor=function(e){if(this.updateTime!==undefined){return e instanceof _t&&e.version.isEqual(this.updateTime)}else if(this.exists!==undefined){return this.exists===e instanceof _t}else{d(this.isNone,"Precondition should be empty");return true}};e.prototype.isEqual=function(e){return Z(this.updateTime,e.updateTime)&&this.exists===e.exists};e.NONE=new e;return e}();var _r=function(){function e(){}e.prototype.verifyKeyMatches=function(e){if(e!=null){d(e.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")}};e.getPostMutationVersion=function(e){if(e instanceof _t){return e.version}else{return Ne.MIN}};return e}();var Dr=function(e){B.__extends(t,e);function t(t,n,r){var i=e.call(this)||this;i.key=t;i.value=n;i.precondition=r;i.type=Tr.Set;return i}t.prototype.applyToRemoteDocument=function(e,t){this.verifyKeyMatches(e);d(t.transformResults==null,"Transform results received by SetMutation.");var n=t.version;return new _t(this.key,n,this.value,{hasCommittedMutations:true})};t.prototype.applyToLocalView=function(e,t,n){this.verifyKeyMatches(e);if(!this.precondition.isValidFor(e)){return e}var r=_r.getPostMutationVersion(e);return new _t(this.key,r,this.value,{hasLocalMutations:true})};Object.defineProperty(t.prototype,"isIdempotent",{get:function(){return true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"fieldMask",{get:function(){return null},enumerable:true,configurable:true});t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.value.isEqual(e.value)&&this.precondition.isEqual(e.precondition)};return t}(_r);var Cr=function(e){B.__extends(t,e);function t(t,n,r,i){var o=e.call(this)||this;o.key=t;o.data=n;o.fieldMask=r;o.precondition=i;o.type=Tr.Patch;return o}t.prototype.applyToRemoteDocument=function(e,t){this.verifyKeyMatches(e);d(t.transformResults==null,"Transform results received by PatchMutation.");if(!this.precondition.isValidFor(e)){return new Ct(this.key,t.version)}var n=this.patchDocument(e);return new _t(this.key,t.version,n,{hasCommittedMutations:true})};t.prototype.applyToLocalView=function(e,t,n){this.verifyKeyMatches(e);if(!this.precondition.isValidFor(e)){return e}var r=_r.getPostMutationVersion(e);var i=this.patchDocument(e);return new _t(this.key,r,i,{hasLocalMutations:true})};Object.defineProperty(t.prototype,"isIdempotent",{get:function(){return true},enumerable:true,configurable:true});t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.fieldMask.isEqual(e.fieldMask)&&this.precondition.isEqual(e.precondition)};t.prototype.patchDocument=function(e){var t;if(e instanceof _t){t=e.data}else{t=gr.EMPTY}return this.patchObject(t)};t.prototype.patchObject=function(e){var t=this;this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);if(r!==undefined){e=e.set(n,r)}else{e=e.delete(n)}}});return e};return t}(_r);var Ar=function(e){B.__extends(t,e);function t(t,n){var r=e.call(this)||this;r.key=t;r.fieldTransforms=n;r.type=Tr.Transform;r.precondition=Ir.exists(true);return r}t.prototype.applyToRemoteDocument=function(e,t){this.verifyKeyMatches(e);d(t.transformResults!=null,"Transform results missing for TransformMutation.");if(!this.precondition.isValidFor(e)){return new Ct(this.key,t.version)}var n=this.requireDocument(e);var r=this.serverTransformResults(e,t.transformResults);var i=t.version;var o=this.transformObject(n.data,r);return new _t(this.key,i,o,{hasCommittedMutations:true})};t.prototype.applyToLocalView=function(e,t,n){this.verifyKeyMatches(e);if(!this.precondition.isValidFor(e)){return e}var r=this.requireDocument(e);var i=this.localTransformResults(n,t);var o=this.transformObject(r.data,i);return new _t(this.key,r.version,o,{hasLocalMutations:true})};Object.defineProperty(t.prototype,"isIdempotent",{get:function(){for(var e=0,t=this.fieldTransforms;e<t.length;e++){var n=t[e];if(!n.isIdempotent){return false}}return true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"fieldMask",{get:function(){var e=new Me(pe.comparator);this.fieldTransforms.forEach(function(t){return e=e.add(t.field)});return new wr(e)},enumerable:true,configurable:true});t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&ee(this.fieldTransforms,e.fieldTransforms)&&this.precondition.isEqual(e.precondition)};t.prototype.requireDocument=function(e){d(e instanceof _t,"Unknown MaybeDocument type "+e);var t=e;d(t.key.isEqual(this.key),"Can only transform a document with the same key");return t};t.prototype.serverTransformResults=function(e,t){var n=[];d(this.fieldTransforms.length===t.length,"server transform result count ("+t.length+") "+("should match field transform count ("+this.fieldTransforms.length+")"));for(var r=0;r<t.length;r++){var i=this.fieldTransforms[r];var o=i.transform;var a=null;if(e instanceof _t){a=e.field(i.field)||null}n.push(o.applyToRemoteDocument(a,t[r]))}return n};t.prototype.localTransformResults=function(e,t){var n=[];for(var r=0,i=this.fieldTransforms;r<i.length;r++){var o=i[r];var a=o.transform;var s=null;if(t instanceof _t){s=t.field(o.field)||null}n.push(a.applyToLocalView(s,e))}return n};t.prototype.transformObject=function(e,t){d(t.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n];var i=r.field;e=e.set(i,t[n])}return e};return t}(_r);var Nr=function(e){B.__extends(t,e);function t(t,n){var r=e.call(this)||this;r.key=t;r.precondition=n;r.type=Tr.Delete;return r}t.prototype.applyToRemoteDocument=function(e,t){this.verifyKeyMatches(e);d(t.transformResults==null,"Transform results received by DeleteMutation.");return new Dt(this.key,t.version,{hasCommittedMutations:true})};t.prototype.applyToLocalView=function(e,t,n){this.verifyKeyMatches(e);if(!this.precondition.isValidFor(e)){return e}if(e){d(e.key.isEqual(this.key),"Can only apply mutation to document with same key")}return new Dt(this.key,Ne.forDeletedDoc())};t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.precondition.isEqual(e.precondition)};Object.defineProperty(t.prototype,"isIdempotent",{get:function(){return true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"fieldMask",{get:function(){return null},enumerable:true,configurable:true});return t}(_r);var kr=function(){function e(e,t,n){this.remoteDocumentCache=e;this.mutationQueue=t;this.indexManager=n}e.prototype.getDocument=function(e,t){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,t).next(function(r){return n.getDocumentInternal(e,t,r)})};e.prototype.getDocumentInternal=function(e,t,n){return this.remoteDocumentCache.getEntry(e,t).next(function(e){for(var r=0,i=n;r<i.length;r++){var o=i[r];e=o.applyToLocalView(t,e)}return e})};e.prototype.applyLocalMutationsToDocuments=function(e,t,n){var r=qe();t.forEach(function(e,t){for(var i=0,o=n;i<o.length;i++){var a=o[i];t=a.applyToLocalView(e,t)}r=r.insert(e,t)});return r};e.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})};e.prototype.getLocalViewOfDocuments=function(e,t){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(function(r){var i=n.applyLocalMutationsToDocuments(e,t,r);var o=Fe();i.forEach(function(e,t){if(!t){t=new Dt(e,Ne.forDeletedDoc())}o=o.insert(e,t)});return o})};e.prototype.getDocumentsMatchingQuery=function(e,t){if(t.isDocumentQuery()){return this.getDocumentsMatchingDocumentQuery(e,t.path)}else if(t.isCollectionGroupQuery()){return this.getDocumentsMatchingCollectionGroupQuery(e,t)}else{return this.getDocumentsMatchingCollectionQuery(e,t)}};e.prototype.getDocumentsMatchingDocumentQuery=function(e,t){return this.getDocument(e,new me(t)).next(function(e){var t=Ve();if(e instanceof _t){t=t.insert(e.key,e)}return t})};e.prototype.getDocumentsMatchingCollectionGroupQuery=function(e,t){var n=this;d(t.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=t.collectionGroup;var i=Ve();return this.indexManager.getCollectionParents(e,r).next(function(o){return Je.forEach(o,function(o){var a=t.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(e,a).next(function(e){e.forEach(function(e,t){i=i.insert(e,t)})})}).next(function(){return i})})};e.prototype.getDocumentsMatchingCollectionQuery=function(e,t){var n=this;var r;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,t).next(function(i){r=i;return n.mutationQueue.getAllMutationBatchesAffectingQuery(e,t)}).next(function(e){for(var n=0,i=e;n<i.length;n++){var o=i[n];for(var a=0,s=o.mutations;a<s.length;a++){var u=s[a];var c=u.key;if(!t.path.isImmediateParentOf(c.path)){continue}var l=r.get(c);var f=u.applyToLocalView(l,l,o.localWriteTime);if(f instanceof _t){r=r.insert(c,f)}else{r=r.remove(c)}}}}).next(function(){r.forEach(function(e,n){if(!t.matches(n)){r=r.remove(e)}});return r})};return e}();var Or=function(){function e(){this.refsByKey=new Me(xr.compareByKey);this.refsByTarget=new Me(xr.compareByTargetId)}e.prototype.isEmpty=function(){return this.refsByKey.isEmpty()};e.prototype.addReference=function(e,t){var n=new xr(e,t);this.refsByKey=this.refsByKey.add(n);this.refsByTarget=this.refsByTarget.add(n)};e.prototype.addReferences=function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})};e.prototype.removeReference=function(e,t){this.removeRef(new xr(e,t))};e.prototype.removeReferences=function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})};e.prototype.removeReferencesForId=function(e){var t=this;var n=me.EMPTY;var r=new xr(n,e);var i=new xr(n,e+1);var o=[];this.refsByTarget.forEachInRange([r,i],function(e){t.removeRef(e);o.push(e.key)});return o};e.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})};e.prototype.removeRef=function(e){this.refsByKey=this.refsByKey.delete(e);this.refsByTarget=this.refsByTarget.delete(e)};e.prototype.referencesForId=function(e){var t=me.EMPTY;var n=new xr(t,e);var r=new xr(t,e+1);var i=ze();this.refsByTarget.forEachInRange([n,r],function(e){i=i.add(e.key)});return i};e.prototype.containsKey=function(e){var t=new xr(e,0);var n=this.refsByKey.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)};return e}();var xr=function(){function e(e,t){this.key=e;this.targetOrBatchId=t}e.compareByKey=function(e,t){return me.comparator(e.key,t.key)||J(e.targetOrBatchId,t.targetOrBatchId)};e.compareByTargetId=function(e,t){return J(e.targetOrBatchId,t.targetOrBatchId)||me.comparator(e.key,t.key)};return e}();var Rr="LocalStore";var Mr=function(){function e(e,t){this.persistence=e;this.localViewReferences=new Or;this.queryDataByTarget={};d(e.started,"LocalStore was passed an unstarted persistence implementation");this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences);this.mutationQueue=e.getMutationQueue(t);this.remoteDocuments=e.getRemoteDocumentCache();this.queryCache=e.getQueryCache();this.localDocuments=new kr(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}e.prototype.handleUserChange=function(e){var t=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return t.mutationQueue.getAllMutationBatches(n).next(function(i){r=i;t.mutationQueue=t.persistence.getMutationQueue(e);t.localDocuments=new kr(t.remoteDocuments,t.mutationQueue,t.persistence.getIndexManager());return t.mutationQueue.getAllMutationBatches(n)}).next(function(e){var i=[];var o=[];var a=ze();for(var s=0,u=r;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var l=0,f=c.mutations;l<f.length;l++){var h=f[l];a=a.add(h.key)}}for(var d=0,p=e;d<p.length;d++){var c=p[d];o.push(c.batchId);for(var m=0,y=c.mutations;m<y.length;m++){var h=y[m];a=a.add(h.key)}}return t.localDocuments.getDocuments(n,a).next(function(e){return{affectedDocuments:e,removedBatchIds:i,addedBatchIds:o}})})})};e.prototype.localWrite=function(e){var t=this;var n=Ae.now();var r=e.reduce(function(e,t){return e.add(t.key)},ze());return this.persistence.runTransaction("Locally write mutations","readwrite",function(i){return t.localDocuments.getDocuments(i,r).next(function(r){var o=[];for(var a=0,s=e;a<s.length;a++){var u=s[a];var c=r.get(u.key);if(!u.isIdempotent){var l=u.fieldMask;if(l){var f=c instanceof _t?l.applyTo(c.data):gr.EMPTY;o.push(new Cr(u.key,f,l,Ir.exists(true)))}}}return t.mutationQueue.addMutationBatch(i,n,o,e).next(function(e){var t=e.applyToLocalDocumentSet(r);return{batchId:e.batchId,changes:t}})})})};e.prototype.lookupMutationDocuments=function(e){var t=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return t.mutationQueue.lookupMutationKeys(n,e).next(function(e){if(e){return t.localDocuments.getDocuments(n,e)}else{return Je.resolve(null)}})})};e.prototype.acknowledgeBatch=function(e){var t=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=e.batch.keys();var i=t.remoteDocuments.newChangeBuffer();return t.mutationQueue.acknowledgeBatch(n,e.batch,e.streamToken).next(function(){return t.applyWriteToRemoteDocuments(n,e,i)}).next(function(){return i.apply(n)}).next(function(){return t.mutationQueue.performConsistencyCheck(n)}).next(function(){return t.localDocuments.getDocuments(n,r)})})};e.prototype.rejectBatch=function(e){var t=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return t.mutationQueue.lookupMutationBatch(n,e).next(function(e){d(e!==null,"Attempt to reject nonexistent batch!");r=e.keys();return t.mutationQueue.removeMutationBatch(n,e)}).next(function(){return t.mutationQueue.performConsistencyCheck(n)}).next(function(){return t.localDocuments.getDocuments(n,r)})})};e.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.mutationQueue.getLastStreamToken(t)})};e.prototype.setLastStreamToken=function(e){var t=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return t.mutationQueue.setLastStreamToken(n,e)})};e.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.queryCache.getLastRemoteSnapshotVersion(t)})};e.prototype.applyRemoteEvent=function(t){var n=this;var r=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var o=[];var a=ze();E(t.targetChanges,function(r,s){var u=n.queryDataByTarget[r];if(!u)return;s.addedDocuments.forEach(function(e){a=a.add(e)});s.modifiedDocuments.forEach(function(e){a=a.add(e)});o.push(n.queryCache.removeMatchingKeys(i,s.removedDocuments,r).next(function(){return n.queryCache.addMatchingKeys(i,s.addedDocuments,r)}));var c=s.resumeToken;if(c.length>0){var l=u;u=u.copy({resumeToken:c,snapshotVersion:t.snapshotVersion});n.queryDataByTarget[r]=u;if(e.shouldPersistQueryData(l,u,s)){o.push(n.queryCache.updateQueryData(i,u))}}});var s=Fe();var u=ze();t.documentUpdates.forEach(function(e,t){u=u.add(e)});o.push(r.getEntries(i,u).next(function(e){t.documentUpdates.forEach(function(u,l){var f=e.get(u);if(f==null||l.version.isEqual(Ne.MIN)||a.has(l.key)&&!f.hasPendingWrites||l.version.compareTo(f.version)>=0){r.addEntry(l);s=s.insert(u,l)}else{c(Rr,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",l.version)}if(t.resolvedLimboDocuments.has(u)){o.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))}})}));var l=t.snapshotVersion;if(!l.isEqual(Ne.MIN)){var f=n.queryCache.getLastRemoteSnapshotVersion(i).next(function(e){d(l.compareTo(e)>=0,"Watch stream reverted to previous snapshot?? "+l+" < "+e);return n.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,l)});o.push(f)}return Je.waitFor(o).next(function(){return r.apply(i)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(i,s)})})};e.shouldPersistQueryData=function(e,t,n){if(t.resumeToken.length===0)return false;if(e.resumeToken.length===0)return true;var r=t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds();if(r>=this.RESUME_TOKEN_MAX_AGE_MICROS)return true;var i=n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size;return i>0};e.prototype.notifyLocalViewChanges=function(e){var t=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Je.forEach(e,function(e){t.localViewReferences.addReferences(e.addedKeys,e.targetId);t.localViewReferences.removeReferences(e.removedKeys,e.targetId);return Je.forEach(e.removedKeys,function(e){return t.persistence.referenceDelegate.removeReference(n,e)})})})};e.prototype.nextMutationBatch=function(e){var t=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){if(e===undefined){e=Ye}return t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)})};e.prototype.readDocument=function(e){var t=this;return this.persistence.runTransaction("read document","readonly",function(n){return t.localDocuments.getDocument(n,e)})};e.prototype.allocateQuery=function(e){var t=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return t.queryCache.getQueryData(n,e).next(function(i){if(i){r=i;return Je.resolve()}else{return t.queryCache.allocateTargetId(n).next(function(i){r=new _n(e,i,In.Listen,n.currentSequenceNumber);return t.queryCache.addQueryData(n,r)})}}).next(function(){d(!t.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+e);t.queryDataByTarget[r.targetId]=r;return r})})};e.prototype.releaseQuery=function(e,t){var n=this;var r=t?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,e).next(function(i){d(i!=null,"Tried to release nonexistent query: "+e);var o=i.targetId;var a=n.queryDataByTarget[o];var s=n.localViewReferences.removeReferencesForId(o);delete n.queryDataByTarget[o];if(!t){return Je.forEach(s,function(e){return n.persistence.referenceDelegate.removeReference(r,e)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,a)})}else{return Je.resolve()}})})};e.prototype.executeQuery=function(e){var t=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return t.localDocuments.getDocumentsMatchingQuery(n,e)})};e.prototype.remoteDocumentKeys=function(e){var t=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return t.queryCache.getMatchingKeysForTargetId(n,e)})};e.prototype.getActiveClients=function(){return this.persistence.getActiveClients()};e.prototype.removeCachedMutationBatchMetadata=function(e){this.mutationQueue.removeCachedMutationKeys(e)};e.prototype.setNetworkEnabled=function(e){this.persistence.setNetworkEnabled(e)};e.prototype.applyWriteToRemoteDocuments=function(e,t,n){var r=this;var i=t.batch;var o=i.keys();var a=Je.resolve();o.forEach(function(r){a=a.next(function(){return n.getEntry(e,r)}).next(function(e){var o=e;var a=t.docVersions.get(r);d(a!==null,"ackVersions should contain every doc in the write.");if(!o||o.version.compareTo(a)<0){o=i.applyToRemoteDocument(r,o,t);if(!o){d(!e,"Mutation batch "+i+" applied to document "+e+" resulted in null")}else{n.addEntry(o)}}})});return a.next(function(){return r.mutationQueue.removeMutationBatch(e,i)})};e.prototype.collectGarbage=function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return e.collect(n,t.queryDataByTarget)})};e.prototype.getQueryForTarget=function(e){var t=this;if(this.queryDataByTarget[e]){return Promise.resolve(this.queryDataByTarget[e].query)}else{return this.persistence.runTransaction("Get query data","readonly",function(n){return t.queryCache.getQueryDataForTarget(n,e).next(function(e){return e?e.query:null})})}};e.prototype.getNewDocumentChanges=function(){var e=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return e.remoteDocuments.getNewDocumentChanges(t)})};e.RESUME_TOKEN_MAX_AGE_MICROS=5*60*1e6;return e}();var Pr=function(){function e(e,t){this.indexManager=e;this.referenceDelegate=t;this.mutationQueue=[];this.nextBatchId=1;this.lastStreamToken=m();this.batchesByDocumentKey=new Me(xr.compareByKey)}e.prototype.checkEmpty=function(e){return Je.resolve(this.mutationQueue.length===0)};e.prototype.acknowledgeBatch=function(e,t,n){var r=t.batchId;var i=this.indexOfExistingBatchId(r,"acknowledged");d(i===0,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];d(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId);this.lastStreamToken=n;return Je.resolve()};e.prototype.getLastStreamToken=function(e){return Je.resolve(this.lastStreamToken)};e.prototype.setLastStreamToken=function(e,t){this.lastStreamToken=t;return Je.resolve()};e.prototype.addMutationBatch=function(e,t,n,r){d(r.length!==0,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++;if(this.mutationQueue.length>0){var o=this.mutationQueue[this.mutationQueue.length-1];d(o.batchId<i,"Mutation batchIDs must be monotonically increasing order")}var a=new $e(i,t,n,r);this.mutationQueue.push(a);for(var s=0,u=r;s<u.length;s++){var c=u[s];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new xr(c.key,i));this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast())}return Je.resolve(a)};e.prototype.lookupMutationBatch=function(e,t){return Je.resolve(this.findMutationBatch(t))};e.prototype.lookupMutationKeys=function(e,t){var n=this.findMutationBatch(t);d(n!=null,"Failed to find local mutation batch.");return Je.resolve(n.keys())};e.prototype.getNextMutationBatchAfterBatchId=function(e,t){var n=t+1;var r=this.indexOfBatchId(n);var i=r<0?0:r;return Je.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)};e.prototype.getAllMutationBatches=function(e){return Je.resolve(this.mutationQueue.slice())};e.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,t){var n=this;var r=new xr(t,0);var i=new xr(t,Number.POSITIVE_INFINITY);var o=[];this.batchesByDocumentKey.forEachInRange([r,i],function(e){d(t.isEqual(e.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(e.targetOrBatchId);d(r!==null,"Batches in the index must exist in the main table");o.push(r)});return Je.resolve(o)};e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var n=this;var r=new Me(J);t.forEach(function(e){var t=new xr(e,0);var i=new xr(e,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([t,i],function(t){d(e.isEqual(t.key),"For each key, should only iterate over a single key's batches");r=r.add(t.targetOrBatchId)})});return Je.resolve(this.findMutationBatches(r))};e.prototype.getAllMutationBatchesAffectingQuery=function(e,t){d(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=t.path;var r=n.length+1;var i=n;if(!me.isDocumentKey(i)){i=i.child("")}var o=new xr(new me(i),0);var a=new Me(J);this.batchesByDocumentKey.forEachWhile(function(e){var t=e.key.path;if(!n.isPrefixOf(t)){return false}else{if(t.length===r){a=a.add(e.targetOrBatchId)}return true}},o);return Je.resolve(this.findMutationBatches(a))};e.prototype.findMutationBatches=function(e){var t=this;var n=[];e.forEach(function(e){var r=t.findMutationBatch(e);if(r!==null){n.push(r)}});return n};e.prototype.removeMutationBatch=function(e,t){var n=this;var r=this.indexOfExistingBatchId(t.batchId,"removed");d(r===0,"Can only remove the first entry of the mutation queue");this.mutationQueue.shift();var i=this.batchesByDocumentKey;return Je.forEach(t.mutations,function(r){var o=new xr(r.key,t.batchId);i=i.delete(o);return n.referenceDelegate.removeMutationReference(e,r.key)}).next(function(){n.batchesByDocumentKey=i})};e.prototype.removeCachedMutationKeys=function(e){};e.prototype.containsKey=function(e,t){var n=new xr(t,0);var r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Je.resolve(t.isEqual(r&&r.key))};e.prototype.performConsistencyCheck=function(e){if(this.mutationQueue.length===0){d(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty.")}return Je.resolve()};e.prototype.indexOfExistingBatchId=function(e,t){var n=this.indexOfBatchId(e);d(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+t);return n};e.prototype.indexOfBatchId=function(e){if(this.mutationQueue.length===0){return 0}var t=this.mutationQueue[0].batchId;return e-t};e.prototype.findMutationBatch=function(e){var t=this.indexOfBatchId(e);if(t<0||t>=this.mutationQueue.length){return null}var n=this.mutationQueue[t];d(n.batchId===e,"If found batch must match");return n};return e}();var Lr=function(){function e(e){this.persistence=e;this.queries=new At(function(e){return e.canonicalId()});this.lastRemoteSnapshotVersion=Ne.MIN;this.highestTargetId=0;this.highestSequenceNumber=0;this.references=new Or;this.targetCount=0;this.targetIdGenerator=ct.forQueryCache()}e.prototype.getTargetCount=function(e){return Je.resolve(this.targetCount)};e.prototype.forEachTarget=function(e,t){this.queries.forEach(function(e,n){return t(n)});return Je.resolve()};e.prototype.getLastRemoteSnapshotVersion=function(e){return Je.resolve(this.lastRemoteSnapshotVersion)};e.prototype.getHighestSequenceNumber=function(e){return Je.resolve(this.highestSequenceNumber)};e.prototype.allocateTargetId=function(e){var t=this.targetIdGenerator.after(this.highestTargetId);this.highestTargetId=t;return Je.resolve(t)};e.prototype.setTargetsMetadata=function(e,t,n){if(n){this.lastRemoteSnapshotVersion=n}if(t>this.highestSequenceNumber){this.highestSequenceNumber=t}return Je.resolve()};e.prototype.saveQueryData=function(e){this.queries.set(e.query,e);var t=e.targetId;if(t>this.highestTargetId){this.highestTargetId=t}if(e.sequenceNumber>this.highestSequenceNumber){this.highestSequenceNumber=e.sequenceNumber}};e.prototype.addQueryData=function(e,t){d(!this.queries.has(t.query),"Adding a query that already exists");this.saveQueryData(t);this.targetCount+=1;return Je.resolve()};e.prototype.updateQueryData=function(e,t){d(this.queries.has(t.query),"Updating a non-existent query");this.saveQueryData(t);return Je.resolve()};e.prototype.removeQueryData=function(e,t){d(this.targetCount>0,"Removing a target from an empty cache");d(this.queries.has(t.query),"Removing a non-existent target from the cache");this.queries.delete(t.query);this.references.removeReferencesForId(t.targetId);this.targetCount-=1;return Je.resolve()};e.prototype.removeTargets=function(e,t,n){var r=this;var i=0;var o=[];this.queries.forEach(function(a,s){if(s.sequenceNumber<=t&&!n[s.targetId]){r.queries.delete(a);o.push(r.removeMatchingKeysForTargetId(e,s.targetId));i++}});return Je.waitFor(o).next(function(){return i})};e.prototype.getQueryCount=function(e){return Je.resolve(this.targetCount)};e.prototype.getQueryData=function(e,t){var n=this.queries.get(t)||null;return Je.resolve(n)};e.prototype.getQueryDataForTarget=function(e,t){return h("Not yet implemented.")};e.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate;var i=[];if(r){t.forEach(function(t){i.push(r.addReference(e,t))})}return Je.waitFor(i)};e.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate;var i=[];if(r){t.forEach(function(t){i.push(r.removeReference(e,t))})}return Je.waitFor(i)};e.prototype.removeMatchingKeysForTargetId=function(e,t){this.references.removeReferencesForId(t);return Je.resolve()};e.prototype.getMatchingKeysForTargetId=function(e,t){var n=this.references.referencesForId(t);return Je.resolve(n)};e.prototype.containsKey=function(e,t){return Je.resolve(this.references.containsKey(t))};return e}();function Fr(){return new ke(me.comparator)}var qr=function(){function e(e,t){this.indexManager=e;this.sizer=t;this.docs=Fr();this.newDocumentChanges=ze();this.size=0}e.prototype.addEntries=function(e,t,n){var r=[];for(var i=0,o=t;i<o.length;i++){var a=o[i];var s=a.maybeDocument.key;this.docs=this.docs.insert(s,a);this.newDocumentChanges=this.newDocumentChanges.add(s);r.push(this.indexManager.addToCollectionParentIndex(e,s.path.popLast()))}this.size+=n;return Je.waitFor(r)};e.prototype.removeEntry=function(e,t){var n=this.docs.get(t);if(n){this.docs=this.docs.remove(t);this.size-=n.size;return Je.resolve(n.size)}else{return Je.resolve(0)}};e.prototype.getEntry=function(e,t){var n=this.docs.get(t);return Je.resolve(n?n.maybeDocument:null)};e.prototype.getSizedEntry=function(e,t){return Je.resolve(this.docs.get(t))};e.prototype.getEntries=function(e,t){var n=this;var r=qe();t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.maybeDocument:null)});return Je.resolve(r)};e.prototype.getSizedEntries=function(e,t){var n=this;var r=qe();var i=new ke(me.comparator);t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.maybeDocument:null);i=i.insert(e,t?t.size:0)});return Je.resolve({maybeDocuments:r,sizeMap:i})};e.prototype.getDocumentsMatchingQuery=function(e,t){d(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=Ve();var r=new me(t.path.child(""));var i=this.docs.getIteratorFrom(r);while(i.hasNext()){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!t.path.isPrefixOf(a.path)){break}if(s instanceof _t&&t.matches(s)){n=n.insert(s.key,s)}}return Je.resolve(n)};e.prototype.forEachDocumentKey=function(e,t){return Je.forEach(this.docs,function(e){return t(e)})};e.prototype.getNewDocumentChanges=function(e){var t=this;var n=Fe();this.newDocumentChanges.forEach(function(e){var r=t.docs.get(e);var i=r?r.maybeDocument:new Dt(e,Ne.forDeletedDoc());n=n.insert(e,i)});this.newDocumentChanges=ze();return Je.resolve(n)};e.prototype.newChangeBuffer=function(){return new Ur(this.sizer,this)};e.prototype.getSize=function(e){return Je.resolve(this.size)};return e}();var Ur=function(e){B.__extends(t,e);function t(t,n){var r=e.call(this)||this;r.sizer=t;r.documentCache=n;return r}t.prototype.applyChanges=function(e){var t=this;var n=this.assertChanges();var r=0;var i=[];n.forEach(function(e,n){var o=t.documentSizes.get(e);d(o!==undefined,"Attempting to change document "+e.toString()+" without having read it first");var a=t.sizer(n);r+=a-o;i.push({maybeDocument:n,size:a})});return this.documentCache.addEntries(e,i,r)};t.prototype.getFromCache=function(e,t){return this.documentCache.getSizedEntry(e,t)};t.prototype.getAllFromCache=function(e,t){return this.documentCache.getSizedEntries(e,t)};return t}(Nt);var Vr="MemoryPersistence";var Br=function(){function e(e,t){var n=this;this.clientId=e;this.mutationQueues={};this.listenSequence=new ce(0);this._started=false;this._started=true;this.referenceDelegate=t(this);this.queryCache=new Lr(this);var r=function(e){return n.referenceDelegate.documentSize(e)};this.indexManager=new Ut;this.remoteDocumentCache=new qr(this.indexManager,r)}e.createLruPersistence=function(t,n,r){var i=function(e){return new zr(e,new Dn(n),r)};return new e(t,i)};e.createEagerPersistence=function(t){var n=function(e){return new Qr(e)};return new e(t,n)};e.prototype.shutdown=function(){this._started=false;return Promise.resolve()};Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:true,configurable:true});e.prototype.getActiveClients=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){return[2,[this.clientId]]})})};e.prototype.setPrimaryStateListener=function(e){return e(true)};e.prototype.setDatabaseDeletedListener=function(){};e.prototype.setNetworkEnabled=function(e){};e.prototype.getIndexManager=function(){return this.indexManager};e.prototype.getMutationQueue=function(e){var t=this.mutationQueues[e.toKey()];if(!t){t=new Pr(this.indexManager,this.referenceDelegate);this.mutationQueues[e.toKey()]=t}return t};e.prototype.getQueryCache=function(){return this.queryCache};e.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache};e.prototype.runTransaction=function(e,t,n){var r=this;c(Vr,"Starting transaction:",e);var i=new jr(this.listenSequence.next());this.referenceDelegate.onTransactionStarted();return n(i).next(function(e){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return e})}).toPromise()};e.prototype.mutationQueuesContainKey=function(e,t){return Je.or(S(this.mutationQueues).map(function(n){return function(){return n.containsKey(e,t)}}))};return e}();var jr=function(){function e(e){this.currentSequenceNumber=e}return e}();var Qr=function(){function e(e){this.persistence=e}e.prototype.setInMemoryPins=function(e){this.inMemoryPins=e};e.prototype.addReference=function(e,t){this.orphanedDocuments.delete(t);return Je.resolve()};e.prototype.removeReference=function(e,t){this.orphanedDocuments.add(t);return Je.resolve()};e.prototype.removeMutationReference=function(e,t){this.orphanedDocuments.add(t);return Je.resolve()};e.prototype.removeTarget=function(e,t){var n=this;var r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.orphanedDocuments.add(e)})}).next(function(){return r.removeQueryData(e,t)})};e.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set};e.prototype.onTransactionCommitted=function(e){var t=this;var n=this.persistence.getRemoteDocumentCache();return Je.forEach(this.orphanedDocuments,function(r){return t.isReferenced(e,r).next(function(t){if(!t){return n.removeEntry(e,r).next(function(){})}return Je.resolve()})})};e.prototype.updateLimboDocument=function(e,t){var n=this;return this.isReferenced(e,t).next(function(e){if(e){n.orphanedDocuments.delete(t)}else{n.orphanedDocuments.add(t)}})};e.prototype.documentSize=function(e){return 0};e.prototype.isReferenced=function(e,t){var n=this;return Je.or([function(){return n.persistence.getQueryCache().containsKey(e,t)},function(){return n.persistence.mutationQueuesContainKey(e,t)},function(){return Je.resolve(n.inMemoryPins.containsKey(t))}])};return e}();var zr=function(){function e(e,t,n){this.persistence=e;this.serializer=t;this.orphanedSequenceNumbers=new At(function(e){return Ie(e.path)});this.garbageCollector=new Pn(this,n)}e.prototype.onTransactionStarted=function(){};e.prototype.onTransactionCommitted=function(e){return Je.resolve()};e.prototype.forEachTarget=function(e,t){return this.persistence.getQueryCache().forEachTarget(e,t)};e.prototype.getSequenceNumberCount=function(e){var t=this.orphanedDocumentCount(e);var n=this.persistence.getQueryCache().getTargetCount(e);return n.next(function(e){return t.next(function(t){return e+t})})};e.prototype.orphanedDocumentCount=function(e){var t=0;return this.forEachOrphanedDocumentSequenceNumber(e,function(e){t++}).next(function(){return t})};e.prototype.forEachOrphanedDocumentSequenceNumber=function(e,t){var n=this;return Je.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(e,r,i).next(function(e){if(!e){return t(i)}else{return Je.resolve()}})})};e.prototype.setInMemoryPins=function(e){this.inMemoryPins=e};e.prototype.removeTargets=function(e,t,n){return this.persistence.getQueryCache().removeTargets(e,t,n)};e.prototype.removeOrphanedDocuments=function(e,t){var n=this;var r=0;var i=this.persistence.getRemoteDocumentCache();var o=i.forEachDocumentKey(e,function(o){return n.isPinned(e,o,t).next(function(t){if(t){return Je.resolve()}else{r++;return i.removeEntry(e,o).next()}})});return o.next(function(){return r})};e.prototype.removeMutationReference=function(e,t){this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber);return Je.resolve()};e.prototype.removeTarget=function(e,t){var n=t.copy({sequenceNumber:e.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(e,n)};e.prototype.addReference=function(e,t){this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber);return Je.resolve()};e.prototype.removeReference=function(e,t){this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber);return Je.resolve()};e.prototype.updateLimboDocument=function(e,t){this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber);return Je.resolve()};e.prototype.documentSize=function(e){var t=this.serializer.toDbRemoteDocument(e);var n;if(t.document){n=t.document}else if(t.unknownDocument){n=t.unknownDocument}else if(t.noDocument){n=t.noDocument}else{throw h("Unknown remote document type")}return JSON.stringify(n).length};e.prototype.isPinned=function(e,t,n){var r=this;return Je.or([function(){return r.persistence.mutationQueuesContainKey(e,t)},function(){return Je.resolve(r.inMemoryPins.containsKey(t))},function(){return r.persistence.getQueryCache().containsKey(e,t)},function(){var e=r.orphanedSequenceNumbers.get(t);return Je.resolve(e!==undefined&&e>n)}])};e.prototype.getCacheSize=function(e){return this.persistence.getRemoteDocumentCache().getSize(e)};return e}();var Kr=Number;var Wr=Kr.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1);var Gr=Kr.MAX_SAFE_INTEGER||Math.pow(2,53)-1;var Hr=Kr.isInteger||function(e){return typeof e==="number"&&isFinite(e)&&Math.floor(e)===e};function Yr(e){return e===null||e===undefined}function $r(e){return Hr(e)&&e<=Gr&&e>=Wr}var Xr="ExponentialBackoff";var Jr=function(){function e(e,t,n,r,i){this.queue=e;this.timerId=t;this.initialDelayMs=n;this.backoffFactor=r;this.maxDelayMs=i;this.timerPromise=null;this.lastAttemptTime=Date.now();this.reset()}e.prototype.reset=function(){this.currentBaseMs=0};e.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs};e.prototype.backoffAndRun=function(e){var t=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs());var r=Math.max(0,Date.now()-this.lastAttemptTime);var i=Math.max(0,n-r);if(this.currentBaseMs>0){c(Xr,"Backing off for "+i+" ms "+("(base delay: "+this.currentBaseMs+" ms, ")+("delay with jitter: "+n+" ms, ")+("last attempt: "+r+" ms ago)"))}this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){t.lastAttemptTime=Date.now();return e()});this.currentBaseMs*=this.backoffFactor;if(this.currentBaseMs<this.initialDelayMs){this.currentBaseMs=this.initialDelayMs}if(this.currentBaseMs>this.maxDelayMs){this.currentBaseMs=this.maxDelayMs}};e.prototype.cancel=function(){if(this.timerPromise!==null){this.timerPromise.cancel();this.timerPromise=null}};e.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs};return e}();var Zr="PersistentStream";var ei;(function(e){e[e["Initial"]=0]="Initial";e[e["Starting"]=1]="Starting";e[e["Open"]=2]="Open";e[e["Error"]=3]="Error";e[e["Backoff"]=4]="Backoff"})(ei||(ei={}));var ti=1e3;var ni=60*1e3;var ri=1.5;var ii=60*1e3;var oi=function(){function e(e,t,n,r,i,o){this.queue=e;this.idleTimerId=n;this.connection=r;this.credentialsProvider=i;this.listener=o;this.state=ei.Initial;this.closeCount=0;this.idleTimer=null;this.stream=null;this.backoff=new Jr(e,t,ti,ri,ni)}e.prototype.isStarted=function(){return this.state===ei.Starting||this.state===ei.Open||this.state===ei.Backoff};e.prototype.isOpen=function(){return this.state===ei.Open};e.prototype.start=function(){if(this.state===ei.Error){this.performBackoff();return}d(this.state===ei.Initial,"Already started");this.auth()};e.prototype.stop=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:if(!this.isStarted())return[3,2];return[4,this.close(ei.Initial)];case 1:e.sent();e.label=2;case 2:return[2]}})})};e.prototype.inhibitBackoff=function(){d(!this.isStarted(),"Can only inhibit backoff in a stopped state");this.state=ei.Initial;this.backoff.reset()};e.prototype.markIdle=function(){var e=this;if(this.isOpen()&&this.idleTimer===null){this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,ii,function(){return e.handleIdleCloseTimer()})}};e.prototype.sendRequest=function(e){this.cancelIdleCheck();this.stream.send(e)};e.prototype.handleIdleCloseTimer=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){if(this.isOpen()){return[2,this.close(ei.Initial)]}return[2]})})};e.prototype.cancelIdleCheck=function(){if(this.idleTimer){this.idleTimer.cancel();this.idleTimer=null}};e.prototype.close=function(e,t){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(n){switch(n.label){case 0:d(this.isStarted(),"Only started streams should be closed.");d(e===ei.Error||Yr(t),"Can't provide an error when not in an error state.");this.cancelIdleCheck();this.backoff.cancel();this.closeCount++;if(e!==ei.Error){this.backoff.reset()}else if(t&&t.code===y.RESOURCE_EXHAUSTED){l(t.toString());l("Using maximum backoff delay to prevent overloading the backend.");this.backoff.resetToMax()}else if(t&&t.code===y.UNAUTHENTICATED){this.credentialsProvider.invalidateToken()}if(this.stream!==null){this.tearDown();this.stream.close();this.stream=null}this.state=e;return[4,this.listener.onClose(t)];case 1:n.sent();return[2]}})})};e.prototype.tearDown=function(){};e.prototype.auth=function(){var e=this;d(this.state===ei.Initial,"Must be in initial state to auth");this.state=ei.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount);var n=this.closeCount;this.credentialsProvider.getToken().then(function(t){if(e.closeCount===n){e.startStream(t)}},function(n){t(function(){var t=new v(y.UNKNOWN,"Fetching auth token failed: "+n.message);return e.handleStreamClose(t)})})};e.prototype.startStream=function(e){var t=this;d(this.state===ei.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e);this.stream.onOpen(function(){n(function(){d(t.state===ei.Starting,"Expected stream to be in state Starting, but was "+t.state);t.state=ei.Open;return t.listener.onOpen()})});this.stream.onClose(function(e){n(function(){return t.handleStreamClose(e)})});this.stream.onMessage(function(e){n(function(){return t.onMessage(e)})})};e.prototype.performBackoff=function(){var e=this;d(this.state===ei.Error,"Should only perform backoff when in Error state");this.state=ei.Backoff;this.backoff.backoffAndRun(function(){return B.__awaiter(e,void 0,void 0,function(){return B.__generator(this,function(e){d(this.state===ei.Backoff,"Backoff elapsed but state is now: "+this.state);this.state=ei.Initial;this.start();d(this.isStarted(),"PersistentStream should have started");return[2]})})})};e.prototype.handleStreamClose=function(e){d(this.isStarted(),"Can't handle server close on non-started stream");c(Zr,"close with error: "+e);this.stream=null;return this.close(ei.Error,e)};e.prototype.getCloseGuardedDispatcher=function(e){var t=this;return function(n){t.queue.enqueueAndForget(function(){if(t.closeCount===e){return n()}else{c(Zr,"stream callback skipped by getCloseGuardedDispatcher.");return Promise.resolve()}})}};return e}();var ai=function(e){B.__extends(t,e);function t(t,n,r,i,o){var a=e.call(this,t,ve.ListenStreamConnectionBackoff,ve.ListenStreamIdle,n,r,o)||this;a.serializer=i;return a}t.prototype.startRpc=function(e){return this.connection.openStream("Listen",e)};t.prototype.onMessage=function(e){this.backoff.reset();var t=this.serializer.fromWatchChange(e);var n=this.serializer.versionFromListenResponse(e);return this.listener.onWatchChange(t,n)};t.prototype.watch=function(e){var t={};t.database=this.serializer.encodedDatabaseId;t.addTarget=this.serializer.toTarget(e);var n=this.serializer.toListenRequestLabels(e);if(n){t.labels=n}this.sendRequest(t)};t.prototype.unwatch=function(e){var t={};t.database=this.serializer.encodedDatabaseId;t.removeTarget=e;this.sendRequest(t)};return t}(oi);var si=function(e){B.__extends(t,e);function t(t,n,r,i,o){var a=e.call(this,t,ve.WriteStreamConnectionBackoff,ve.WriteStreamIdle,n,r,o)||this;a.serializer=i;a.handshakeComplete_=false;return a}Object.defineProperty(t.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:true,configurable:true});t.prototype.start=function(){this.handshakeComplete_=false;e.prototype.start.call(this)};t.prototype.tearDown=function(){if(this.handshakeComplete_){this.writeMutations([])}};t.prototype.startRpc=function(e){return this.connection.openStream("Write",e)};t.prototype.onMessage=function(e){d(!!e.streamToken,"Got a write response without a stream token");this.lastStreamToken=e.streamToken;if(!this.handshakeComplete_){d(!e.writeResults||e.writeResults.length===0,"Got mutation results for handshake");this.handshakeComplete_=true;return this.listener.onHandshakeComplete()}else{this.backoff.reset();var t=this.serializer.fromWriteResults(e.writeResults,e.commitTime);var n=this.serializer.fromVersion(e.commitTime);return this.listener.onMutationResult(n,t)}};t.prototype.writeHandshake=function(){d(this.isOpen(),"Writing handshake requires an opened stream");d(!this.handshakeComplete_,"Handshake already completed");var e={};e.database=this.serializer.encodedDatabaseId;this.sendRequest(e)};t.prototype.writeMutations=function(e){var t=this;d(this.isOpen(),"Writing mutations requires an opened stream");d(this.handshakeComplete_,"Handshake must be complete before writing mutations");d(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:e.map(function(e){return t.serializer.toMutation(e)})};this.sendRequest(n)};return t}(oi);var ui=function(){function e(e,t,n,r){this.queue=e;this.connection=t;this.credentials=n;this.serializer=r}e.prototype.newPersistentWriteStream=function(e){return new si(this.queue,this.connection,this.credentials,this.serializer,e)};e.prototype.newPersistentWatchStream=function(e){return new ai(this.queue,this.connection,this.credentials,this.serializer,e)};e.prototype.commit=function(e){var t=this;var n={database:this.serializer.encodedDatabaseId,writes:e.map(function(e){return t.serializer.toMutation(e)})};return this.invokeRPC("Commit",n).then(function(e){return t.serializer.fromWriteResults(e.writeResults,e.commitTime)})};e.prototype.lookup=function(e){var t=this;var n={database:this.serializer.encodedDatabaseId,documents:e.map(function(e){return t.serializer.toName(e)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=Fe();n.forEach(function(e){var n=t.serializer.fromMaybeDocument(e);r=r.insert(n.key,n)});var i=[];e.forEach(function(e){var t=r.get(e);d(!!t,"Missing entity in write response for "+e);i.push(t)});return i})};e.prototype.invokeRPC=function(e,t){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(e,t,r)}).catch(function(e){if(e.code===y.UNAUTHENTICATED){n.credentials.invalidateToken()}throw e})};e.prototype.invokeStreamingRPC=function(e,t){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(e,t,r)}).catch(function(e){if(e.code===y.UNAUTHENTICATED){n.credentials.invalidateToken()}throw e})};return e}();var ci=function(){function e(e){this.datastore=e;this.readVersions=je();this.mutations=[];this.committed=false}e.prototype.recordVersion=function(e){var t;if(e instanceof _t){t=e.version}else if(e instanceof Dt){t=Ne.forDeletedDoc()}else{throw h("Document in a transaction was a "+e.constructor.name)}var n=this.readVersions.get(e.key);if(n!==null){if(!t.isEqual(n)){throw new v(y.ABORTED,"Document version changed between two reads.")}}else{this.readVersions=this.readVersions.insert(e.key,t)}};e.prototype.lookup=function(e){var t=this;if(this.committed){return Promise.reject("Transaction has already completed.")}if(this.mutations.length>0){return Promise.reject("Transactions lookups are invalid after writes.")}return this.datastore.lookup(e).then(function(e){e.forEach(function(e){if(e instanceof Dt||e instanceof _t){t.recordVersion(e)}else{h("Document in a transaction was a "+e.constructor.name)}});return e})};e.prototype.write=function(e){if(this.committed){throw new v(y.FAILED_PRECONDITION,"Transaction has already completed.")}this.mutations=this.mutations.concat(e)};e.prototype.precondition=function(e){var t=this.readVersions.get(e);if(t){return Ir.updateTime(t)}else{return Ir.NONE}};e.prototype.preconditionForUpdate=function(e){var t=this.readVersions.get(e);if(t&&t.isEqual(Ne.forDeletedDoc())){throw new v(y.FAILED_PRECONDITION,"Can't update a document that doesn't exist.")}else if(t){return Ir.updateTime(t)}else{return Ir.exists(true)}};e.prototype.set=function(e,t){this.write(t.toMutations(e,this.precondition(e)))};e.prototype.update=function(e,t){this.write(t.toMutations(e,this.preconditionForUpdate(e)))};e.prototype.delete=function(e){this.write([new Nr(e,this.precondition(e))]);this.readVersions=this.readVersions.insert(e,Ne.forDeletedDoc())};e.prototype.commit=function(){var e=this;var t=this.readVersions;this.mutations.forEach(function(e){t=t.remove(e.key)});if(!t.isEmpty()){return Promise.reject(Error("Every document read in a transaction must also be written."))}return this.datastore.commit(this.mutations).then(function(){e.committed=true})};return e}();var li;(function(e){e[e["Unknown"]=0]="Unknown";e[e["Online"]=1]="Online";e[e["Offline"]=2]="Offline"})(li||(li={}));var fi;(function(e){e[e["RemoteStore"]=0]="RemoteStore";e[e["SharedClientState"]=1]="SharedClientState"})(fi||(fi={}));var hi="OnlineStateTracker";var di=1;var pi=10*1e3;var mi=function(){function e(e,t){this.asyncQueue=e;this.onlineStateHandler=t;this.state=li.Unknown;this.watchStreamFailures=0;this.onlineStateTimer=null;this.shouldWarnClientIsOffline=true}e.prototype.handleWatchStreamStart=function(){var e=this;if(this.watchStreamFailures===0){this.setAndBroadcast(li.Unknown);d(this.onlineStateTimer===null,"onlineStateTimer shouldn't be started yet");this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(ve.OnlineStateTimeout,pi,function(){e.onlineStateTimer=null;d(e.state===li.Unknown,"Timer should be canceled if we transitioned to a different state.");e.logClientOfflineWarningIfNecessary("Backend didn't respond within "+pi/1e3+" "+"seconds.");e.setAndBroadcast(li.Offline);return Promise.resolve()})}};e.prototype.handleWatchStreamFailure=function(e){if(this.state===li.Online){this.setAndBroadcast(li.Unknown);d(this.watchStreamFailures===0,"watchStreamFailures must be 0");d(this.onlineStateTimer===null,"onlineStateTimer must be null")}else{this.watchStreamFailures++;if(this.watchStreamFailures>=di){this.clearOnlineStateTimer();this.logClientOfflineWarningIfNecessary("Connection failed "+di+" "+("times. Most recent error: "+e.toString()));this.setAndBroadcast(li.Offline)}}};e.prototype.set=function(e){this.clearOnlineStateTimer();this.watchStreamFailures=0;if(e===li.Online){this.shouldWarnClientIsOffline=false}this.setAndBroadcast(e)};e.prototype.setAndBroadcast=function(e){if(e!==this.state){this.state=e;this.onlineStateHandler(e)}};e.prototype.logClientOfflineWarningIfNecessary=function(e){var t="Could not reach Cloud Firestore backend. "+e+"\n"+"This typically indicates that your device does not have a healthy "+"Internet connection at the moment. The client will operate in offline "+"mode until it is able to successfully connect to the backend.";if(this.shouldWarnClientIsOffline){l(t);this.shouldWarnClientIsOffline=false}else{c(hi,t)}};e.prototype.clearOnlineStateTimer=function(){if(this.onlineStateTimer!==null){this.onlineStateTimer.cancel();this.onlineStateTimer=null}};return e}();var yi;(function(e){e[e["OK"]=0]="OK";e[e["CANCELLED"]=1]="CANCELLED";e[e["UNKNOWN"]=2]="UNKNOWN";e[e["INVALID_ARGUMENT"]=3]="INVALID_ARGUMENT";e[e["DEADLINE_EXCEEDED"]=4]="DEADLINE_EXCEEDED";e[e["NOT_FOUND"]=5]="NOT_FOUND";e[e["ALREADY_EXISTS"]=6]="ALREADY_EXISTS";e[e["PERMISSION_DENIED"]=7]="PERMISSION_DENIED";e[e["UNAUTHENTICATED"]=16]="UNAUTHENTICATED";e[e["RESOURCE_EXHAUSTED"]=8]="RESOURCE_EXHAUSTED";e[e["FAILED_PRECONDITION"]=9]="FAILED_PRECONDITION";e[e["ABORTED"]=10]="ABORTED";e[e["OUT_OF_RANGE"]=11]="OUT_OF_RANGE";e[e["UNIMPLEMENTED"]=12]="UNIMPLEMENTED";e[e["INTERNAL"]=13]="INTERNAL";e[e["UNAVAILABLE"]=14]="UNAVAILABLE";e[e["DATA_LOSS"]=15]="DATA_LOSS"})(yi||(yi={}));function vi(e){switch(e){case y.OK:return h("Treated status OK as error");case y.CANCELLED:case y.UNKNOWN:case y.DEADLINE_EXCEEDED:case y.RESOURCE_EXHAUSTED:case y.INTERNAL:case y.UNAVAILABLE:case y.UNAUTHENTICATED:return false;case y.INVALID_ARGUMENT:case y.NOT_FOUND:case y.ALREADY_EXISTS:case y.PERMISSION_DENIED:case y.FAILED_PRECONDITION:case y.ABORTED:case y.OUT_OF_RANGE:case y.UNIMPLEMENTED:case y.DATA_LOSS:return true;default:return h("Unknown status code: "+e)}}function gi(e){return vi(e)&&e!==y.ABORTED}function bi(e){var t=yi[e];if(t===undefined){return undefined}return wi(t)}function wi(e){if(e===undefined){l("GRPC error has no .code");return y.UNKNOWN}switch(e){case yi.OK:return y.OK;case yi.CANCELLED:return y.CANCELLED;case yi.UNKNOWN:return y.UNKNOWN;case yi.DEADLINE_EXCEEDED:return y.DEADLINE_EXCEEDED;case yi.RESOURCE_EXHAUSTED:return y.RESOURCE_EXHAUSTED;case yi.INTERNAL:return y.INTERNAL;case yi.UNAVAILABLE:return y.UNAVAILABLE;case yi.UNAUTHENTICATED:return y.UNAUTHENTICATED;case yi.INVALID_ARGUMENT:return y.INVALID_ARGUMENT;case yi.NOT_FOUND:return y.NOT_FOUND;case yi.ALREADY_EXISTS:return y.ALREADY_EXISTS;case yi.PERMISSION_DENIED:return y.PERMISSION_DENIED;case yi.FAILED_PRECONDITION:return y.FAILED_PRECONDITION;case yi.ABORTED:return y.ABORTED;case yi.OUT_OF_RANGE:return y.OUT_OF_RANGE;case yi.UNIMPLEMENTED:return y.UNIMPLEMENTED;case yi.DATA_LOSS:return y.DATA_LOSS;default:return h("Unknown status code: "+e)}}function Ei(e){if(e===undefined){return yi.OK}switch(e){case y.OK:return yi.OK;case y.CANCELLED:return yi.CANCELLED;case y.UNKNOWN:return yi.UNKNOWN;case y.DEADLINE_EXCEEDED:return yi.DEADLINE_EXCEEDED;case y.RESOURCE_EXHAUSTED:return yi.RESOURCE_EXHAUSTED;case y.INTERNAL:return yi.INTERNAL;case y.UNAVAILABLE:return yi.UNAVAILABLE;case y.UNAUTHENTICATED:return yi.UNAUTHENTICATED;case y.INVALID_ARGUMENT:return yi.INVALID_ARGUMENT;case y.NOT_FOUND:return yi.NOT_FOUND;case y.ALREADY_EXISTS:return yi.ALREADY_EXISTS;case y.PERMISSION_DENIED:return yi.PERMISSION_DENIED;case y.FAILED_PRECONDITION:return yi.FAILED_PRECONDITION;case y.ABORTED:return yi.ABORTED;case y.OUT_OF_RANGE:return yi.OUT_OF_RANGE;case y.UNIMPLEMENTED:return yi.UNIMPLEMENTED;case y.DATA_LOSS:return yi.DATA_LOSS;default:return h("Unknown status code: "+e)}}function Si(e){switch(e){case 200:return y.OK;case 400:return y.INVALID_ARGUMENT;case 401:return y.UNAUTHENTICATED;case 403:return y.PERMISSION_DENIED;case 404:return y.NOT_FOUND;case 409:return y.ABORTED;case 416:return y.OUT_OF_RANGE;case 429:return y.RESOURCE_EXHAUSTED;case 499:return y.CANCELLED;case 500:return y.UNKNOWN;case 501:return y.UNIMPLEMENTED;case 503:return y.UNAVAILABLE;case 504:return y.DEADLINE_EXCEEDED;default:if(e>=200&&e<300)return y.OK;if(e>=400&&e<500)return y.FAILED_PRECONDITION;if(e>=500&&e<600)return y.INTERNAL;return y.UNKNOWN}}var Ti=function(){function e(e){if(e){this.comparator=function(t,n){return e(t,n)||me.comparator(t.key,n.key)}}else{this.comparator=function(e,t){return me.comparator(e.key,t.key)}}this.keyedMap=Ve();this.sortedSet=new ke(this.comparator)}e.emptySet=function(t){return new e(t.comparator)};e.prototype.has=function(e){return this.keyedMap.get(e)!=null};e.prototype.get=function(e){return this.keyedMap.get(e)};e.prototype.first=function(){return this.sortedSet.minKey()};e.prototype.last=function(){return this.sortedSet.maxKey()};e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()};e.prototype.indexOf=function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1};Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:true,configurable:true});e.prototype.forEach=function(e){this.sortedSet.inorderTraversal(function(t,n){e(t);return false})};e.prototype.add=function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))};e.prototype.delete=function(e){var t=this.get(e);if(!t){return this}return this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t))};e.prototype.isEqual=function(t){if(!(t instanceof e))return false;if(this.size!==t.size)return false;var n=this.sortedSet.getIterator();var r=t.sortedSet.getIterator();while(n.hasNext()){var i=n.getNext().key;var o=r.getNext().key;if(!i.isEqual(o))return false}return true};e.prototype.toString=function(){var e=[];this.forEach(function(t){e.push(t.toString())});if(e.length===0){return"DocumentSet ()"}else{return"DocumentSet (\n  "+e.join("  \n")+"\n)"}};e.prototype.copy=function(t,n){var r=new e;r.comparator=this.comparator;r.keyedMap=t;r.sortedSet=n;return r};return e}();var Ii;(function(e){e[e["Added"]=0]="Added";e[e["Removed"]=1]="Removed";e[e["Modified"]=2]="Modified";e[e["Metadata"]=3]="Metadata"})(Ii||(Ii={}));var _i;(function(e){e[e["Local"]=0]="Local";e[e["Synced"]=1]="Synced"})(_i||(_i={}));var Di=function(){function e(){this.changeMap=new ke(me.comparator)}e.prototype.track=function(e){var t=e.doc.key;var n=this.changeMap.get(t);if(!n){this.changeMap=this.changeMap.insert(t,e);return}if(e.type!==Ii.Added&&n.type===Ii.Metadata){this.changeMap=this.changeMap.insert(t,e)}else if(e.type===Ii.Metadata&&n.type!==Ii.Removed){this.changeMap=this.changeMap.insert(t,{type:n.type,doc:e.doc})}else if(e.type===Ii.Modified&&n.type===Ii.Modified){this.changeMap=this.changeMap.insert(t,{type:Ii.Modified,doc:e.doc})}else if(e.type===Ii.Modified&&n.type===Ii.Added){this.changeMap=this.changeMap.insert(t,{type:Ii.Added,doc:e.doc})}else if(e.type===Ii.Removed&&n.type===Ii.Added){this.changeMap=this.changeMap.remove(t)}else if(e.type===Ii.Removed&&n.type===Ii.Modified){this.changeMap=this.changeMap.insert(t,{type:Ii.Removed,doc:n.doc})}else if(e.type===Ii.Added&&n.type===Ii.Removed){this.changeMap=this.changeMap.insert(t,{type:Ii.Modified,doc:e.doc})}else{h("unsupported combination of changes: "+JSON.stringify(e)+" after "+JSON.stringify(n))}};e.prototype.getChanges=function(){var e=[];this.changeMap.inorderTraversal(function(t,n){e.push(n)});return e};return e}();var Ci=function(){function e(e,t,n,r,i,o,a,s){this.query=e;this.docs=t;this.oldDocs=n;this.docChanges=r;this.mutatedKeys=i;this.fromCache=o;this.syncStateChanged=a;this.excludesMetadataChanges=s}e.fromInitialDocuments=function(t,n,r,i){var o=[];n.forEach(function(e){o.push({type:Ii.Added,doc:e})});return new e(t,n,Ti.emptySet(n),o,r,i,true,false)};Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:true,configurable:true});e.prototype.isEqual=function(e){if(this.fromCache!==e.fromCache||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!this.query.isEqual(e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs)){return false}var t=this.docChanges;var n=e.docChanges;if(t.length!==n.length){return false}for(var r=0;r<t.length;r++){if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc)){return false}}return true};return e}();var Ai=function(){function e(e,t,n,r,i){this.snapshotVersion=e;this.targetChanges=t;this.targetMismatches=n;this.documentUpdates=r;this.resolvedLimboDocuments=i}e.createSynthesizedRemoteEventForCurrentChange=function(t,n){var r;var i=(r={},r[t]=Ni.createSynthesizedTargetChangeForCurrentChange(t,n),r);return new e(Ne.MIN,i,He(),Fe(),ze())};return e}();var Ni=function(){function e(e,t,n,r,i){this.resumeToken=e;this.current=t;this.addedDocuments=n;this.modifiedDocuments=r;this.removedDocuments=i}e.createSynthesizedTargetChangeForCurrentChange=function(t,n){return new e(m(),n,ze(),ze(),ze())};return e}();var ki=function(){function e(e,t,n,r){this.updatedTargetIds=e;this.removedTargetIds=t;this.key=n;this.newDoc=r}return e}();var Oi=function(){function e(e,t){this.targetId=e;this.existenceFilter=t}return e}();var xi;(function(e){e[e["NoChange"]=0]="NoChange";e[e["Added"]=1]="Added";e[e["Removed"]=2]="Removed";e[e["Current"]=3]="Current";e[e["Reset"]=4]="Reset"})(xi||(xi={}));var Ri=function(){function e(e,t,n,r){if(n===void 0){n=m()}if(r===void 0){r=null}this.state=e;this.targetIds=t;this.resumeToken=n;this.cause=r}return e}();var Mi=function(){function e(){this.pendingResponses=0;this.documentChanges=Fi();this._resumeToken=m();this._current=false;this._hasPendingChanges=true}Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"isPending",{get:function(){return this.pendingResponses!==0},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:true,configurable:true});e.prototype.updateResumeToken=function(e){if(e.length>0){this._hasPendingChanges=true;this._resumeToken=e}};e.prototype.toTargetChange=function(){var e=ze();var t=ze();var n=ze();this.documentChanges.forEach(function(r,i){switch(i){case Ii.Added:e=e.add(r);break;case Ii.Modified:t=t.add(r);break;case Ii.Removed:n=n.add(r);break;default:h("Encountered invalid change type: "+i)}});return new Ni(this._resumeToken,this._current,e,t,n)};e.prototype.clearPendingChanges=function(){this._hasPendingChanges=false;this.documentChanges=Fi()};e.prototype.addDocumentChange=function(e,t){this._hasPendingChanges=true;this.documentChanges=this.documentChanges.insert(e,t)};e.prototype.removeDocumentChange=function(e){this._hasPendingChanges=true;this.documentChanges=this.documentChanges.remove(e)};e.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1};e.prototype.recordTargetResponse=function(){this.pendingResponses-=1};e.prototype.markCurrent=function(){this._hasPendingChanges=true;this._current=true};return e}();var Pi=function(){function e(e){this.metadataProvider=e;this.targetStates={};this.pendingDocumentUpdates=Fe();this.pendingDocumentTargetMapping=Li();this.pendingTargetResets=new Me(J)}e.prototype.handleDocumentChange=function(e){for(var t=0,n=e.updatedTargetIds;t<n.length;t++){var r=n[t];if(e.newDoc instanceof _t){this.addDocumentToTarget(r,e.newDoc)}else if(e.newDoc instanceof Dt){this.removeDocumentFromTarget(r,e.key,e.newDoc)}}for(var i=0,o=e.removedTargetIds;i<o.length;i++){var r=o[i];this.removeDocumentFromTarget(r,e.key,e.newDoc)}};e.prototype.handleTargetChange=function(e){var t=this;this.forEachTarget(e,function(n){var r=t.ensureTargetState(n);switch(e.state){case xi.NoChange:if(t.isActiveTarget(n)){r.updateResumeToken(e.resumeToken)}break;case xi.Added:r.recordTargetResponse();if(!r.isPending){r.clearPendingChanges()}r.updateResumeToken(e.resumeToken);break;case xi.Removed:r.recordTargetResponse();if(!r.isPending){t.removeTarget(n)}d(!e.cause,"WatchChangeAggregator does not handle errored targets");break;case xi.Current:if(t.isActiveTarget(n)){r.markCurrent();r.updateResumeToken(e.resumeToken)}break;case xi.Reset:if(t.isActiveTarget(n)){t.resetTarget(n);r.updateResumeToken(e.resumeToken)}break;default:h("Unknown target watch change state: "+e.state)}})};e.prototype.forEachTarget=function(e,t){if(e.targetIds.length>0){e.targetIds.forEach(t)}else{E(this.targetStates,t)}};e.prototype.handleExistenceFilter=function(e){var t=e.targetId;var n=e.existenceFilter.count;var r=this.queryDataForActiveTarget(t);if(r){var i=r.query;if(i.isDocumentQuery()){if(n===0){var o=new me(i.path);this.removeDocumentFromTarget(t,o,new Dt(o,Ne.forDeletedDoc()))}else{d(n===1,"Single document existence filter with count: "+n)}}else{var a=this.getCurrentDocumentCountForTarget(t);if(a!==n){this.resetTarget(t);this.pendingTargetResets=this.pendingTargetResets.add(t)}}}};e.prototype.createRemoteEvent=function(e){var t=this;var n={};E(this.targetStates,function(r,i){var o=t.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var a=new me(o.query.path);if(t.pendingDocumentUpdates.get(a)===null&&!t.targetContainsDocument(r,a)){t.removeDocumentFromTarget(r,a,new Dt(a,e))}}if(i.hasPendingChanges){n[r]=i.toTargetChange();i.clearPendingChanges()}}});var r=ze();this.pendingDocumentTargetMapping.forEach(function(e,n){var i=true;n.forEachWhile(function(e){var n=t.queryDataForActiveTarget(e);if(n&&n.purpose!==In.LimboResolution){i=false;return false}return true});if(i){r=r.add(e)}});var i=new Ai(e,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);this.pendingDocumentUpdates=Fe();this.pendingDocumentTargetMapping=Li();this.pendingTargetResets=new Me(J);return i};e.prototype.addDocumentToTarget=function(e,t){if(!this.isActiveTarget(e)){return}var n=this.targetContainsDocument(e,t.key)?Ii.Modified:Ii.Added;var r=this.ensureTargetState(e);r.addDocumentChange(t.key,n);this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t);this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))};e.prototype.removeDocumentFromTarget=function(e,t,n){if(!this.isActiveTarget(e)){return}var r=this.ensureTargetState(e);if(this.targetContainsDocument(e,t)){r.addDocumentChange(t,Ii.Removed)}else{r.removeDocumentChange(t)}this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e));if(n){this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,n)}};e.prototype.removeTarget=function(e){delete this.targetStates[e]};e.prototype.getCurrentDocumentCountForTarget=function(e){var t=this.ensureTargetState(e);var n=t.toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size};e.prototype.recordPendingTargetRequest=function(e){var t=this.ensureTargetState(e);t.recordPendingTargetRequest()};e.prototype.ensureTargetState=function(e){if(!this.targetStates[e]){this.targetStates[e]=new Mi}return this.targetStates[e]};e.prototype.ensureDocumentTargetMapping=function(e){var t=this.pendingDocumentTargetMapping.get(e);if(!t){t=new Me(J);this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)}return t};e.prototype.isActiveTarget=function(e){return this.queryDataForActiveTarget(e)!==null};e.prototype.queryDataForActiveTarget=function(e){var t=this.targetStates[e];return t&&t.isPending?null:this.metadataProvider.getQueryDataForTarget(e)};e.prototype.resetTarget=function(e){var t=this;d(!this.targetStates[e].isPending,"Should only reset active targets");this.targetStates[e]=new Mi;var n=this.metadataProvider.getRemoteKeysForTarget(e);n.forEach(function(n){t.removeDocumentFromTarget(e,n,null)})};e.prototype.targetContainsDocument=function(e,t){var n=this.metadataProvider.getRemoteKeysForTarget(e);return n.has(t)};return e}();function Li(){return new ke(me.comparator)}function Fi(){return new ke(me.comparator)}var qi="RemoteStore";var Ui=10;var Vi=function(){function e(e,t,n,r,i){var o=this;this.localStore=e;this.datastore=t;this.writePipeline=[];this.listenTargets={};this.watchChangeAggregator=null;this.networkEnabled=false;this.isPrimary=false;this.connectivityMonitor=i;this.connectivityMonitor.addCallback(function(e){n.enqueueAndForget(function(){return B.__awaiter(o,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:if(!this.canUseNetwork())return[3,2];c(qi,"Restarting streams for network reachability change.");return[4,this.restartNetwork()];case 1:e.sent();e.label=2;case 2:return[2]}})})})});this.onlineStateTracker=new mi(n,r);this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)});this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}e.prototype.start=function(){return this.enableNetwork()};e.prototype.enableNetwork=function(){return B.__awaiter(this,void 0,void 0,function(){var e;return B.__generator(this,function(t){switch(t.label){case 0:this.networkEnabled=true;if(!this.canUseNetwork())return[3,3];e=this.writeStream;return[4,this.localStore.getLastStreamToken()];case 1:e.lastStreamToken=t.sent();if(this.shouldStartWatchStream()){this.startWatchStream()}else{this.onlineStateTracker.set(li.Unknown)}return[4,this.fillWritePipeline()];case 2:t.sent();t.label=3;case 3:return[2]}})})};e.prototype.disableNetwork=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:this.networkEnabled=false;return[4,this.disableNetworkInternal()];case 1:e.sent();this.onlineStateTracker.set(li.Offline);return[2]}})})};e.prototype.disableNetworkInternal=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:return[4,this.writeStream.stop()];case 1:e.sent();return[4,this.watchStream.stop()];case 2:e.sent();if(this.writePipeline.length>0){c(qi,"Stopping write stream with "+this.writePipeline.length+" pending writes");this.writePipeline=[]}this.cleanUpWatchStreamState();return[2]}})})};e.prototype.shutdown=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:c(qi,"RemoteStore shutting down.");this.networkEnabled=false;return[4,this.disableNetworkInternal()];case 1:e.sent();this.connectivityMonitor.shutdown();this.onlineStateTracker.set(li.Unknown);return[2]}})})};e.prototype.listen=function(e){d(!b(this.listenTargets,e.targetId),"listen called with duplicate targetId!");this.listenTargets[e.targetId]=e;if(this.shouldStartWatchStream()){this.startWatchStream()}else if(this.watchStream.isOpen()){this.sendWatchRequest(e)}};e.prototype.unlisten=function(e){d(b(this.listenTargets,e),"unlisten called without assigned target ID!");delete this.listenTargets[e];if(this.watchStream.isOpen()){this.sendUnwatchRequest(e)}if(I(this.listenTargets)){if(this.watchStream.isOpen()){this.watchStream.markIdle()}else if(this.canUseNetwork()){this.onlineStateTracker.set(li.Unknown)}}};e.prototype.getQueryDataForTarget=function(e){return this.listenTargets[e]||null};e.prototype.getRemoteKeysForTarget=function(e){return this.syncEngine.getRemoteKeysForTarget(e)};e.prototype.sendWatchRequest=function(e){this.watchChangeAggregator.recordPendingTargetRequest(e.targetId);this.watchStream.watch(e)};e.prototype.sendUnwatchRequest=function(e){this.watchChangeAggregator.recordPendingTargetRequest(e);this.watchStream.unwatch(e)};e.prototype.startWatchStream=function(){d(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false.");this.watchChangeAggregator=new Pi(this);this.watchStream.start();this.onlineStateTracker.handleWatchStreamStart()};e.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!I(this.listenTargets)};e.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled};e.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null};e.prototype.onWatchStreamOpen=function(){return B.__awaiter(this,void 0,void 0,function(){var e=this;return B.__generator(this,function(t){E(this.listenTargets,function(t,n){e.sendWatchRequest(n)});return[2]})})};e.prototype.onWatchStreamClose=function(e){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){if(e===undefined){d(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed.")}this.cleanUpWatchStreamState();if(this.shouldStartWatchStream()){this.onlineStateTracker.handleWatchStreamFailure(e);this.startWatchStream()}else{this.onlineStateTracker.set(li.Unknown)}return[2]})})};e.prototype.onWatchStreamChange=function(e,t){return B.__awaiter(this,void 0,void 0,function(){var n;return B.__generator(this,function(r){switch(r.label){case 0:this.onlineStateTracker.set(li.Online);if(e instanceof Ri&&e.state===xi.Removed&&e.cause){return[2,this.handleTargetError(e)]}if(e instanceof ki){this.watchChangeAggregator.handleDocumentChange(e)}else if(e instanceof Oi){this.watchChangeAggregator.handleExistenceFilter(e)}else{d(e instanceof Ri,"Expected watchChange to be an instance of WatchTargetChange");this.watchChangeAggregator.handleTargetChange(e)}if(!!t.isEqual(Ne.MIN))return[3,3];return[4,this.localStore.getLastRemoteSnapshotVersion()];case 1:n=r.sent();if(!(t.compareTo(n)>=0))return[3,3];return[4,this.raiseWatchSnapshot(t)];case 2:r.sent();r.label=3;case 3:return[2]}})})};e.prototype.raiseWatchSnapshot=function(e){var t=this;d(!e.isEqual(Ne.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(e);E(n.targetChanges,function(n,r){if(r.resumeToken.length>0){var i=t.listenTargets[n];if(i){t.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:e})}}});n.targetMismatches.forEach(function(e){var n=t.listenTargets[e];if(!n){return}t.listenTargets[e]=n.copy({resumeToken:m()});t.sendUnwatchRequest(e);var r=new _n(n.query,e,In.ExistenceFilterMismatch,n.sequenceNumber);t.sendWatchRequest(r)});return this.syncEngine.applyRemoteEvent(n)};e.prototype.handleTargetError=function(e){var t=this;d(!!e.cause,"Handling target error without a cause");var n=e.cause;var r=Promise.resolve();e.targetIds.forEach(function(e){r=r.then(function(){return B.__awaiter(t,void 0,void 0,function(){return B.__generator(this,function(t){if(b(this.listenTargets,e)){delete this.listenTargets[e];this.watchChangeAggregator.removeTarget(e);return[2,this.syncEngine.rejectListen(e,n)]}return[2]})})})});return r};e.prototype.fillWritePipeline=function(){return B.__awaiter(this,void 0,void 0,function(){var e,t;return B.__generator(this,function(n){switch(n.label){case 0:if(!this.canAddToWritePipeline())return[3,4];e=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:Ye;return[4,this.localStore.nextMutationBatch(e)];case 1:t=n.sent();if(!(t===null))return[3,2];if(this.writePipeline.length===0){this.writeStream.markIdle()}return[3,4];case 2:this.addToWritePipeline(t);return[4,this.fillWritePipeline()];case 3:n.sent();n.label=4;case 4:if(this.shouldStartWriteStream()){this.startWriteStream()}return[2]}})})};e.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<Ui};e.prototype.outstandingWrites=function(){return this.writePipeline.length};e.prototype.addToWritePipeline=function(e){d(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full");this.writePipeline.push(e);if(this.writeStream.isOpen()&&this.writeStream.handshakeComplete){this.writeStream.writeMutations(e.mutations)}};e.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0};e.prototype.startWriteStream=function(){d(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false.");this.writeStream.start()};e.prototype.onWriteStreamOpen=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){this.writeStream.writeHandshake();return[2]})})};e.prototype.onWriteHandshakeComplete=function(){var e=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,n=e.writePipeline;t<n.length;t++){var r=n[t];e.writeStream.writeMutations(r.mutations)}}).catch(Hn)};e.prototype.onMutationResult=function(e,t){var n=this;d(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift();var i=Xe.from(r,e,t,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})};e.prototype.onWriteStreamClose=function(e){return B.__awaiter(this,void 0,void 0,function(){var t;var n=this;return B.__generator(this,function(r){if(e===undefined){d(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed.")}if(e&&this.writePipeline.length>0){t=void 0;if(this.writeStream.handshakeComplete){t=this.handleWriteError(e)}else{t=this.handleHandshakeError(e)}return[2,t.then(function(){if(n.shouldStartWriteStream()){n.startWriteStream()}})]}return[2]})})};e.prototype.handleHandshakeError=function(e){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){if(vi(e.code)){c(qi,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken);this.writeStream.lastStreamToken=m();return[2,this.localStore.setLastStreamToken(m()).catch(Hn)]}return[2]})})};e.prototype.handleWriteError=function(e){return B.__awaiter(this,void 0,void 0,function(){var t;var n=this;return B.__generator(this,function(r){if(gi(e.code)){t=this.writePipeline.shift();this.writeStream.inhibitBackoff();return[2,this.syncEngine.rejectFailedWrite(t.batchId,e).then(function(){return n.fillWritePipeline()})]}return[2]})})};e.prototype.createTransaction=function(){return new ci(this.datastore)};e.prototype.restartNetwork=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:this.networkEnabled=false;return[4,this.disableNetworkInternal()];case 1:e.sent();this.onlineStateTracker.set(li.Unknown);return[4,this.enableNetwork()];case 2:e.sent();return[2]}})})};e.prototype.handleCredentialChange=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:if(!this.canUseNetwork())return[3,2];c(qi,"RemoteStore restarting streams for new credential");return[4,this.restartNetwork()];case 1:e.sent();e.label=2;case 2:return[2]}})})};e.prototype.applyPrimaryState=function(e){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){switch(t.label){case 0:this.isPrimary=e;if(!(e&&this.networkEnabled))return[3,2];return[4,this.enableNetwork()];case 1:t.sent();return[3,4];case 2:if(!!e)return[3,4];return[4,this.disableNetworkInternal()];case 3:t.sent();this.onlineStateTracker.set(li.Unknown);t.label=4;case 4:return[2]}})})};return e}();var Bi=function(){function e(e,t){C("GeoPoint",arguments,2);O("GeoPoint","number",1,e);O("GeoPoint","number",2,t);if(!isFinite(e)||e<-90||e>90){throw new v(y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e)}if(!isFinite(t)||t<-180||t>180){throw new v(y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t)}this._lat=e;this._long=t}Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:true,configurable:true});e.prototype.isEqual=function(e){return this._lat===e._lat&&this._long===e._long};e.prototype._compareTo=function(e){return J(this._lat,e._lat)||J(this._long,e._long)};return e}();var ji=function(){function e(e,t,n,r,i,o,a){if(t===void 0){t=null}if(n===void 0){n=[]}if(r===void 0){r=[]}if(i===void 0){i=null}if(o===void 0){o=null}if(a===void 0){a=null}this.path=e;this.collectionGroup=t;this.explicitOrderBy=n;this.filters=r;this.limit=i;this.startAt=o;this.endAt=a;this.memoizedCanonicalId=null;this.memoizedOrderBy=null;if(this.startAt){this.assertValidBound(this.startAt)}if(this.endAt){this.assertValidBound(this.endAt)}}e.atPath=function(t){return new e(t)};Object.defineProperty(e.prototype,"orderBy",{get:function(){if(this.memoizedOrderBy===null){var e=this.getInequalityFilterField();var t=this.getFirstOrderByField();if(e!==null&&t===null){if(e.isKeyField()){this.memoizedOrderBy=[Zi]}else{this.memoizedOrderBy=[new Ji(e),Zi]}}else{d(e===null||t!==null&&e.isEqual(t),"First orderBy should match inequality field.");this.memoizedOrderBy=[];var n=false;for(var r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o);if(o.field.isKeyField()){n=true}}if(!n){var a=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:$i.ASCENDING;this.memoizedOrderBy.push(a===$i.ASCENDING?Zi:eo)}}}return this.memoizedOrderBy},enumerable:true,configurable:true});e.prototype.addFilter=function(t){d(this.getInequalityFilterField()==null||!(t instanceof Ki)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field.");d(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([t]);return new e(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.startAt,this.endAt)};e.prototype.addOrderBy=function(t){d(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([t]);return new e(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.startAt,this.endAt)};e.prototype.withLimit=function(t){return new e(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)};e.prototype.withStartAt=function(t){return new e(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)};e.prototype.withEndAt=function(t){return new e(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)};e.prototype.asCollectionQueryAtPath=function(t){return new e(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)};e.prototype.canonicalId=function(){if(this.memoizedCanonicalId===null){var e=this.path.canonicalString();if(this.isCollectionGroupQuery()){e+="|cg:"+this.collectionGroup}e+="|f:";for(var t=0,n=this.filters;t<n.length;t++){var r=n[t];e+=r.canonicalId();e+=","}e+="|ob:";for(var i=0,o=this.orderBy;i<o.length;i++){var a=o[i];e+=a.canonicalId();e+=","}if(!Yr(this.limit)){e+="|l:";e+=this.limit}if(this.startAt){e+="|lb:";e+=this.startAt.canonicalId()}if(this.endAt){e+="|ub:";e+=this.endAt.canonicalId()}this.memoizedCanonicalId=e}return this.memoizedCanonicalId};e.prototype.toString=function(){var e="Query("+this.path.canonicalString();if(this.isCollectionGroupQuery()){e+=" collectionGroup="+this.collectionGroup}if(this.filters.length>0){e+=", filters: ["+this.filters.join(", ")+"]"}if(!Yr(this.limit)){e+=", limit: "+this.limit}if(this.explicitOrderBy.length>0){e+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"}if(this.startAt){e+=", startAt: "+this.startAt.canonicalId()}if(this.endAt){e+=", endAt: "+this.endAt.canonicalId()}return e+")"};e.prototype.isEqual=function(e){if(this.limit!==e.limit){return false}if(this.orderBy.length!==e.orderBy.length){return false}for(var t=0;t<this.orderBy.length;t++){if(!this.orderBy[t].isEqual(e.orderBy[t])){return false}}if(this.filters.length!==e.filters.length){return false}for(var t=0;t<this.filters.length;t++){if(!this.filters[t].isEqual(e.filters[t])){return false}}if(this.collectionGroup!==e.collectionGroup){return false}if(!this.path.isEqual(e.path)){return false}if(this.startAt!==null?!this.startAt.isEqual(e.startAt):e.startAt!==null){return false}return this.endAt!==null?this.endAt.isEqual(e.endAt):e.endAt===null};e.prototype.docComparator=function(e,t){var n=false;for(var r=0,i=this.orderBy;r<i.length;r++){var o=i[r];var a=o.compare(e,t);if(a!==0)return a;n=n||o.field.isKeyField()}d(n,"orderBy used that doesn't compare on key field");return 0};e.prototype.matches=function(e){return this.matchesPathAndCollectionGroup(e)&&this.matchesOrderBy(e)&&this.matchesFilters(e)&&this.matchesBounds(e)};e.prototype.hasLimit=function(){return!Yr(this.limit)};e.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null};e.prototype.getInequalityFilterField=function(){for(var e=0,t=this.filters;e<t.length;e++){var n=t[e];if(n instanceof Ki&&n.isInequality()){return n.field}}return null};e.prototype.findFilterOperator=function(e){for(var t=0,n=this.filters;t<n.length;t++){var r=n[t];if(r instanceof Ki){if(e.indexOf(r.op)>=0){return r.op}}}return null};e.prototype.isDocumentQuery=function(){return me.isDocumentKey(this.path)&&this.collectionGroup===null&&this.filters.length===0};e.prototype.isCollectionGroupQuery=function(){return this.collectionGroup!==null};e.prototype.matchesPathAndCollectionGroup=function(e){var t=e.key.path;if(this.collectionGroup!==null){return e.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(t)}else if(me.isDocumentKey(this.path)){return this.path.isEqual(t)}else{return this.path.isImmediateParentOf(t)}};e.prototype.matchesOrderBy=function(e){for(var t=0,n=this.explicitOrderBy;t<n.length;t++){var r=n[t];if(!r.field.isKeyField()&&e.field(r.field)===undefined){return false}}return true};e.prototype.matchesFilters=function(e){for(var t=0,n=this.filters;t<n.length;t++){var r=n[t];if(!r.matches(e)){return false}}return true};e.prototype.matchesBounds=function(e){if(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,e)){return false}if(this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,e)){return false}return true};e.prototype.assertValidBound=function(e){d(e.position.length<=this.orderBy.length,"Bound is longer than orderBy")};return e}();var Qi=function(){function e(){}e.create=function(e,t,n){if(e.isKeyField()){d(n instanceof yr,"Comparing on key, but filter value not a RefValue");d(t!==zi.ARRAY_CONTAINS&&t!==zi.ARRAY_CONTAINS_ANY&&t!==zi.IN,"'"+t.toString()+"' queries don't make sense on document keys.");return new Wi(e,t,n)}else if(n.isEqual(or.INSTANCE)){if(t!==zi.EQUAL){throw new v(y.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on null.")}return new Ki(e,t,n)}else if(n.isEqual(fr.NAN)){if(t!==zi.EQUAL){throw new v(y.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on NaN.")}return new Ki(e,t,n)}else if(t===zi.ARRAY_CONTAINS){return new Gi(e,n)}else if(t===zi.IN){d(n instanceof br,"IN filter has invalid value: "+n.toString());return new Hi(e,n)}else if(t===zi.ARRAY_CONTAINS_ANY){d(n instanceof br,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString());return new Yi(e,n)}else{return new Ki(e,t,n)}};return e}();var zi=function(){function e(e){this.name=e}e.fromString=function(t){switch(t){case"<":return e.LESS_THAN;case"<=":return e.LESS_THAN_OR_EQUAL;case"==":return e.EQUAL;case">=":return e.GREATER_THAN_OR_EQUAL;case">":return e.GREATER_THAN;case"array-contains":return e.ARRAY_CONTAINS;case"in":return e.IN;case"array-contains-any":return e.ARRAY_CONTAINS_ANY;default:return h("Unknown FieldFilter operator: "+t)}};e.prototype.toString=function(){return this.name};e.prototype.isEqual=function(e){return this.name===e.name};e.LESS_THAN=new e("<");e.LESS_THAN_OR_EQUAL=new e("<=");e.EQUAL=new e("==");e.GREATER_THAN=new e(">");e.GREATER_THAN_OR_EQUAL=new e(">=");e.ARRAY_CONTAINS=new e("array-contains");e.IN=new e("in");e.ARRAY_CONTAINS_ANY=new e("array-contains-any");return e}();var Ki=function(e){B.__extends(t,e);function t(t,n,r){var i=e.call(this)||this;i.field=t;i.op=n;i.value=r;return i}t.prototype.matches=function(e){var t=e.field(this.field);return t!==undefined&&this.value.typeOrder===t.typeOrder&&this.matchesComparison(t.compareTo(this.value))};t.prototype.matchesComparison=function(e){switch(this.op){case zi.LESS_THAN:return e<0;case zi.LESS_THAN_OR_EQUAL:return e<=0;case zi.EQUAL:return e===0;case zi.GREATER_THAN:return e>0;case zi.GREATER_THAN_OR_EQUAL:return e>=0;default:return h("Unknown FieldFilter operator: "+this.op)}};t.prototype.isInequality=function(){return[zi.LESS_THAN,zi.LESS_THAN_OR_EQUAL,zi.GREATER_THAN,zi.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0};t.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()};t.prototype.isEqual=function(e){if(e instanceof t){return this.op.isEqual(e.op)&&this.field.isEqual(e.field)&&this.value.isEqual(e.value)}else{return false}};t.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()};return t}(Qi);var Wi=function(e){B.__extends(t,e);function t(t,n,r){return e.call(this,t,n,r)||this}t.prototype.matches=function(e){var t=this.value;var n=me.comparator(e.key,t.key);return this.matchesComparison(n)};return t}(Ki);var Gi=function(e){B.__extends(t,e);function t(t,n){return e.call(this,t,zi.ARRAY_CONTAINS,n)||this}t.prototype.matches=function(e){var t=e.field(this.field);return t instanceof br&&t.contains(this.value)};return t}(Ki);var Hi=function(e){B.__extends(t,e);function t(t,n){return e.call(this,t,zi.IN,n)||this}t.prototype.matches=function(e){var t=this.value;var n=e.field(this.field);return n!==undefined&&t.contains(n)};return t}(Ki);var Yi=function(e){B.__extends(t,e);function t(t,n){return e.call(this,t,zi.ARRAY_CONTAINS_ANY,n)||this}t.prototype.matches=function(e){var t=this.value;var n=e.field(this.field);return n instanceof br&&n.internalValue.some(function(e){return t.contains(e)})};return t}(Ki);var $i=function(){function e(e){this.name=e}e.prototype.toString=function(){return this.name};e.ASCENDING=new e("asc");e.DESCENDING=new e("desc");return e}();var Xi=function(){function e(e,t){this.position=e;this.before=t}e.prototype.canonicalId=function(){var e=this.before?"b:":"a:";for(var t=0,n=this.position;t<n.length;t++){var r=n[t];e+=r.toString()}return e};e.prototype.sortsBeforeDocument=function(e,t){d(this.position.length<=e.length,"Bound has more components than query's orderBy");var n=0;for(var r=0;r<this.position.length;r++){var i=e[r];var o=this.position[r];if(i.field.isKeyField()){d(o instanceof yr,"Bound has a non-key value where the key path is being used.");n=me.comparator(o.key,t.key)}else{var a=t.field(i.field);d(a!==undefined,"Field should exist since document matched the orderBy already.");n=o.compareTo(a)}if(i.dir===$i.DESCENDING){n=n*-1}if(n!==0){break}}return this.before?n<=0:n<0};e.prototype.isEqual=function(e){if(e===null){return false}if(this.before!==e.before||this.position.length!==e.position.length){return false}for(var t=0;t<this.position.length;t++){var n=this.position[t];var r=e.position[t];if(!n.isEqual(r)){return false}}return true};return e}();var Ji=function(){function e(e,t){this.field=e;if(t===undefined){t=$i.ASCENDING}this.dir=t;this.isKeyOrderBy=e.isKeyField()}e.prototype.compare=function(e,t){var n=this.isKeyOrderBy?_t.compareByKey(e,t):_t.compareByField(this.field,e,t);switch(this.dir){case $i.ASCENDING:return n;case $i.DESCENDING:return-1*n;default:return h("Unknown direction: "+this.dir)}};e.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()};e.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"};e.prototype.isEqual=function(e){return this.dir===e.dir&&this.field.isEqual(e.field)};return e}();var Zi=new Ji(pe.keyField(),$i.ASCENDING);var eo=new Ji(pe.keyField(),$i.DESCENDING);var to=function(){function e(){this.isIdempotent=true}e.prototype.applyToLocalView=function(e,t){return new pr(t,e)};e.prototype.applyToRemoteDocument=function(e,t){return t};e.prototype.isEqual=function(t){return t instanceof e};e.instance=new e;return e}();var no=function(){function e(e){this.elements=e;this.isIdempotent=true}e.prototype.applyToLocalView=function(e,t){return this.apply(e)};e.prototype.applyToRemoteDocument=function(e,t){return this.apply(e)};e.prototype.apply=function(e){var t=oo(e);var n=function(e){if(!t.find(function(t){return t.isEqual(e)})){t.push(e)}};for(var r=0,i=this.elements;r<i.length;r++){var o=i[r];n(o)}return new br(t)};e.prototype.isEqual=function(t){return t instanceof e&&ee(t.elements,this.elements)};return e}();var ro=function(){function e(e){this.elements=e;this.isIdempotent=true}e.prototype.applyToLocalView=function(e,t){return this.apply(e)};e.prototype.applyToRemoteDocument=function(e,t){return this.apply(e)};e.prototype.apply=function(e){var t=oo(e);var n=function(e){t=t.filter(function(t){return!t.isEqual(e)})};for(var r=0,i=this.elements;r<i.length;r++){var o=i[r];n(o)}return new br(t)};e.prototype.isEqual=function(t){return t instanceof e&&ee(t.elements,this.elements)};return e}();var io=function(){function e(e){this.operand=e;this.isIdempotent=false}e.prototype.applyToLocalView=function(e,t){if(e instanceof lr&&this.operand instanceof lr){var n=e.internalValue+this.operand.internalValue;return new lr(n)}else if(e instanceof sr){var n=e.internalValue+this.operand.internalValue;return new fr(n)}else{return this.operand}};e.prototype.applyToRemoteDocument=function(e,t){d(t!==null,"Didn't receive transformResult for NUMERIC_ADD transform");return t};e.prototype.isEqual=function(t){return t instanceof e&&this.operand.isEqual(t.operand)};return e}();function oo(e){if(e instanceof br){return e.internalValue.slice()}else{return[]}}var ao=function(){function e(e){this.count=e}e.prototype.isEqual=function(e){return e&&e.count===this.count};return e}();var so=function(){var e={};e[$i.ASCENDING.name]="ASCENDING";e[$i.DESCENDING.name]="DESCENDING";return e}();var uo=function(){var e={};e[zi.LESS_THAN.name]="LESS_THAN";e[zi.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL";e[zi.GREATER_THAN.name]="GREATER_THAN";e[zi.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL";e[zi.EQUAL.name]="EQUAL";e[zi.ARRAY_CONTAINS.name]="ARRAY_CONTAINS";e[zi.IN.name]="IN";e[zi.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY";return e}();var co=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lo(e,t){d(!Yr(e),t+" is missing")}function fo(e){if(typeof e==="number"){return e}else if(typeof e==="string"){return Number(e)}else{return h("can't parse "+e)}}var ho=function(){function e(e,t){this.databaseId=e;this.options=t}e.prototype.emptyByteString=function(){if(this.options.useProto3Json){return""}else{return new Uint8Array(0)}};e.prototype.unsafeCastProtoByteString=function(e){return e};e.prototype.fromRpcStatus=function(e){var t=e.code===undefined?y.UNKNOWN:wi(e.code);return new v(t,e.message||"")};e.prototype.toInt32Value=function(e){if(!Yr(e)){return{value:e}}else{return undefined}};e.prototype.fromInt32Value=function(e){var t;if(typeof e==="object"){t=e.value}else{t=e}return Yr(t)?null:t};e.prototype.toTimestamp=function(e){return{seconds:""+e.seconds,nanos:e.nanoseconds}};e.prototype.fromTimestamp=function(e){if(typeof e==="string"){return this.fromIso8601String(e)}else{d(!!e,"Cannot deserialize null or undefined timestamp.");var t=fo(e.seconds||"0");var n=e.nanos||0;return new Ae(t,n)}};e.prototype.fromIso8601String=function(e){var t=0;var n=co.exec(e);d(!!n,"invalid timestamp: "+e);if(n[1]){var r=n[1];r=(r+"000000000").substr(0,9);t=Number(r)}var i=new Date(e);var o=Math.floor(i.getTime()/1e3);return new Ae(o,t)};e.prototype.toBytes=function(e){if(this.options.useProto3Json){return e.toBase64()}else{return this.unsafeCastProtoByteString(e.toUint8Array())}};e.prototype.fromBlob=function(e){if(typeof e==="string"){d(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead.");return ie.fromBase64String(e)}else{d(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead.");return ie.fromUint8Array(e)}};e.prototype.toVersion=function(e){return this.toTimestamp(e.toTimestamp())};e.prototype.fromVersion=function(e){d(!!e,"Trying to deserialize version that isn't set");return Ne.fromTimestamp(this.fromTimestamp(e))};e.prototype.toResourceName=function(e,t){return this.fullyQualifiedPrefixPath(e).child("documents").child(t).canonicalString()};e.prototype.fromResourceName=function(e){var t=he.fromString(e);d(this.isValidResourceName(t),"Tried to deserialize invalid key "+t.toString());return t};e.prototype.toName=function(e){return this.toResourceName(this.databaseId,e.path)};e.prototype.fromName=function(e){var t=this.fromResourceName(e);d(t.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+t.get(1)+" vs "+this.databaseId.projectId);d(!t.get(3)&&!this.databaseId.database||t.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+t.get(3)+" vs "+this.databaseId.database);return new me(this.extractLocalPathFromResourceName(t))};e.prototype.toQueryPath=function(e){return this.toResourceName(this.databaseId,e)};e.prototype.fromQueryPath=function(e){var t=this.fromResourceName(e);if(t.length===4){return he.EMPTY_PATH}return this.extractLocalPathFromResourceName(t)};Object.defineProperty(e.prototype,"encodedDatabaseId",{get:function(){var e=new he(["projects",this.databaseId.projectId,"databases",this.databaseId.database]);return e.canonicalString()},enumerable:true,configurable:true});e.prototype.fullyQualifiedPrefixPath=function(e){return new he(["projects",e.projectId,"databases",e.database])};e.prototype.extractLocalPathFromResourceName=function(e){d(e.length>4&&e.get(4)==="documents","tried to deserialize invalid key "+e.toString());return e.popFirst(5)};e.prototype.isValidResourceName=function(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"};e.prototype.toValue=function(e){if(e instanceof or){return{nullValue:"NULL_VALUE"}}else if(e instanceof ar){return{booleanValue:e.value()}}else if(e instanceof lr){return{integerValue:""+e.value()}}else if(e instanceof fr){var t=e.value();if(this.options.useProto3Json){if(isNaN(t)){return{doubleValue:"NaN"}}else if(t===Infinity){return{doubleValue:"Infinity"}}else if(t===-Infinity){return{doubleValue:"-Infinity"}}}return{doubleValue:e.value()}}else if(e instanceof hr){return{stringValue:e.value()}}else if(e instanceof gr){return{mapValue:this.toMapValue(e)}}else if(e instanceof br){return{arrayValue:this.toArrayValue(e)}}else if(e instanceof dr){return{timestampValue:this.toTimestamp(e.internalValue)}}else if(e instanceof vr){return{geoPointValue:{latitude:e.value().latitude,longitude:e.value().longitude}}}else if(e instanceof mr){return{bytesValue:this.toBytes(e.value())}}else if(e instanceof yr){return{referenceValue:this.toResourceName(e.databaseId,e.key.path)}}else{return h("Unknown FieldValue "+JSON.stringify(e))}};e.prototype.fromValue=function(e){var t=this;if("nullValue"in e){return or.INSTANCE}else if("booleanValue"in e){return ar.of(e.booleanValue)}else if("integerValue"in e){return new lr(fo(e.integerValue))}else if("doubleValue"in e){if(this.options.useProto3Json){if(e.doubleValue==="NaN"){return fr.NAN}else if(e.doubleValue==="Infinity"){return fr.POSITIVE_INFINITY}else if(e.doubleValue==="-Infinity"){return fr.NEGATIVE_INFINITY}}return new fr(e.doubleValue)}else if("stringValue"in e){return new hr(e.stringValue)}else if("mapValue"in e){return this.fromFields(e.mapValue.fields||{})}else if("arrayValue"in e){lo(e.arrayValue,"arrayValue");var n=e.arrayValue.values||[];return new br(n.map(function(e){return t.fromValue(e)}))}else if("timestampValue"in e){lo(e.timestampValue,"timestampValue");return new dr(this.fromTimestamp(e.timestampValue))}else if("geoPointValue"in e){lo(e.geoPointValue,"geoPointValue");var r=e.geoPointValue.latitude||0;var i=e.geoPointValue.longitude||0;return new vr(new Bi(r,i))}else if("bytesValue"in e){lo(e.bytesValue,"bytesValue");var o=this.fromBlob(e.bytesValue);return new mr(o)}else if("referenceValue"in e){lo(e.referenceValue,"referenceValue");var a=this.fromResourceName(e.referenceValue);var s=new ue(a.get(1),a.get(3));var u=new me(this.extractLocalPathFromResourceName(a));return new yr(s,u)}else{return h("Unknown Value proto "+JSON.stringify(e))}};e.prototype.toMutationDocument=function(e,t){return{name:this.toName(e),fields:this.toFields(t)}};e.prototype.toDocument=function(e){d(!e.hasLocalMutations,"Can't serialize documents with mutations.");return{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toTimestamp(e.version.toTimestamp())}};e.prototype.fromDocument=function(e,t){return new _t(this.fromName(e.name),this.fromVersion(e.updateTime),this.fromFields(e.fields||{}),{hasCommittedMutations:!!t})};e.prototype.toFields=function(e){var t=this;var n={};e.forEach(function(e,r){n[e]=t.toValue(r)});return n};e.prototype.fromFields=function(e){var t=this;var n=e;var r=gr.EMPTY;T(n,function(e,n){r=r.set(new pe([e]),t.fromValue(n))});return r};e.prototype.toMapValue=function(e){return{fields:this.toFields(e)}};e.prototype.toArrayValue=function(e){var t=this;var n=[];e.forEach(function(e){n.push(t.toValue(e))});return{values:n}};e.prototype.fromFound=function(e){d(!!e.found,"Tried to deserialize a found document from a missing document.");lo(e.found.name,"doc.found.name");lo(e.found.updateTime,"doc.found.updateTime");var t=this.fromName(e.found.name);var n=this.fromVersion(e.found.updateTime);var r=this.fromFields(e.found.fields||{});return new _t(t,n,r,{},e.found)};e.prototype.fromMissing=function(e){d(!!e.missing,"Tried to deserialize a missing document from a found document.");d(!!e.readTime,"Tried to deserialize a missing document without a read time.");var t=this.fromName(e.missing);var n=this.fromVersion(e.readTime);return new Dt(t,n)};e.prototype.fromMaybeDocument=function(e){if("found"in e){return this.fromFound(e)}else if("missing"in e){return this.fromMissing(e)}return h("invalid batch get response: "+JSON.stringify(e))};e.prototype.toWatchTargetChangeState=function(e){switch(e){case xi.Added:return"ADD";case xi.Current:return"CURRENT";case xi.NoChange:return"NO_CHANGE";case xi.Removed:return"REMOVE";case xi.Reset:return"RESET";default:return h("Unknown WatchTargetChangeState: "+e)}};e.prototype.toTestWatchChange=function(e){if(e instanceof Oi){return{filter:{count:e.existenceFilter.count,targetId:e.targetId}}}if(e instanceof ki){if(e.newDoc instanceof _t){var t=e.newDoc;return{documentChange:{document:{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toVersion(t.version)},targetIds:e.updatedTargetIds,removedTargetIds:e.removedTargetIds}}}else if(e.newDoc instanceof Dt){var t=e.newDoc;return{documentDelete:{document:this.toName(t.key),readTime:this.toVersion(t.version),removedTargetIds:e.removedTargetIds}}}else if(e.newDoc===null){return{documentRemove:{document:this.toName(e.key),removedTargetIds:e.removedTargetIds}}}}if(e instanceof Ri){var n=undefined;if(e.cause){n={code:Ei(e.cause.code),message:e.cause.message}}return{targetChange:{targetChangeType:this.toWatchTargetChangeState(e.state),targetIds:e.targetIds,resumeToken:this.unsafeCastProtoByteString(e.resumeToken),cause:n}}}return h("Unrecognized watch change: "+JSON.stringify(e))};e.prototype.fromWatchChange=function(e){var t;if("targetChange"in e){lo(e.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(e.targetChange.targetChangeType||"NO_CHANGE");var r=e.targetChange.targetIds||[];var i=e.targetChange.resumeToken||this.emptyByteString();var o=e.targetChange.cause;var a=o&&this.fromRpcStatus(o);t=new Ri(n,r,i,a||null)}else if("documentChange"in e){lo(e.documentChange,"documentChange");lo(e.documentChange.document,"documentChange.name");lo(e.documentChange.document.name,"documentChange.document.name");lo(e.documentChange.document.updateTime,"documentChange.document.updateTime");var s=e.documentChange;var u=this.fromName(s.document.name);var c=this.fromVersion(s.document.updateTime);var l=this.fromFields(s.document.fields||{});var f=new _t(u,c,l,{},s.document);var d=s.targetIds||[];var p=s.removedTargetIds||[];t=new ki(d,p,f.key,f)}else if("documentDelete"in e){lo(e.documentDelete,"documentDelete");lo(e.documentDelete.document,"documentDelete.document");var m=e.documentDelete;var u=this.fromName(m.document);var c=m.readTime?this.fromVersion(m.readTime):Ne.forDeletedDoc();var f=new Dt(u,c);var p=m.removedTargetIds||[];t=new ki([],p,f.key,f)}else if("documentRemove"in e){lo(e.documentRemove,"documentRemove");lo(e.documentRemove.document,"documentRemove");var y=e.documentRemove;var u=this.fromName(y.document);var p=y.removedTargetIds||[];t=new ki([],p,u,null)}else if("filter"in e){lo(e.filter,"filter");lo(e.filter.targetId,"filter.targetId");var v=e.filter;var g=v.count||0;var b=new ao(g);var w=v.targetId;t=new Oi(w,b)}else{return h("Unknown change type "+JSON.stringify(e))}return t};e.prototype.fromWatchTargetChangeState=function(e){if(e==="NO_CHANGE"){return xi.NoChange}else if(e==="ADD"){return xi.Added}else if(e==="REMOVE"){return xi.Removed}else if(e==="CURRENT"){return xi.Current}else if(e==="RESET"){return xi.Reset}else{return h("Got unexpected TargetChange.state: "+e)}};e.prototype.versionFromListenResponse=function(e){if(!("targetChange"in e)){return Ne.MIN}var t=e.targetChange;if(t.targetIds&&t.targetIds.length){return Ne.MIN}if(!t.readTime){return Ne.MIN}return this.fromVersion(t.readTime)};e.prototype.toMutation=function(e){var t=this;var n;if(e instanceof Dr){n={update:this.toMutationDocument(e.key,e.value)}}else if(e instanceof Nr){n={delete:this.toName(e.key)}}else if(e instanceof Cr){n={update:this.toMutationDocument(e.key,e.data),updateMask:this.toDocumentMask(e.fieldMask)}}else if(e instanceof Ar){n={transform:{document:this.toName(e.key),fieldTransforms:e.fieldTransforms.map(function(e){return t.toFieldTransform(e)})}}}else{return h("Unknown mutation type "+e.type)}if(!e.precondition.isNone){n.currentDocument=this.toPrecondition(e.precondition)}return n};e.prototype.fromMutation=function(e){var t=this;var n=e.currentDocument?this.fromPrecondition(e.currentDocument):Ir.NONE;if(e.update){lo(e.update.name,"name");var r=this.fromName(e.update.name);var i=this.fromFields(e.update.fields||{});if(e.updateMask){var o=this.fromDocumentMask(e.updateMask);return new Cr(r,i,o,n)}else{return new Dr(r,i,n)}}else if(e.delete){var r=this.fromName(e.delete);return new Nr(r,n)}else if(e.transform){var r=this.fromName(e.transform.document);var a=e.transform.fieldTransforms.map(function(e){return t.fromFieldTransform(e)});d(n.exists===true,'Transforms only support precondition "exists == true"');return new Ar(r,a)}else{return h("unknown mutation proto: "+JSON.stringify(e))}};e.prototype.toPrecondition=function(e){d(!e.isNone,"Can't serialize an empty precondition");if(e.updateTime!==undefined){return{updateTime:this.toVersion(e.updateTime)}}else if(e.exists!==undefined){return{exists:e.exists}}else{return h("Unknown precondition")}};e.prototype.fromPrecondition=function(e){if(e.updateTime!==undefined){return Ir.updateTime(this.fromVersion(e.updateTime))}else if(e.exists!==undefined){return Ir.exists(e.exists)}else{return Ir.NONE}};e.prototype.fromWriteResult=function(e,t){var n=this;var r=e.updateTime?this.fromVersion(e.updateTime):this.fromVersion(t);var i=null;if(e.transformResults&&e.transformResults.length>0){i=e.transformResults.map(function(e){return n.fromValue(e)})}return new Sr(r,i)};e.prototype.fromWriteResults=function(e,t){var n=this;if(e&&e.length>0){d(t!==undefined,"Received a write result without a commit time");return e.map(function(e){return n.fromWriteResult(e,t)})}else{return[]}};e.prototype.toFieldTransform=function(e){var t=this;var n=e.transform;if(n instanceof to){return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"}}else if(n instanceof no){return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(e){return t.toValue(e)})}}}else if(n instanceof ro){return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(e){return t.toValue(e)})}}}else if(n instanceof io){return{fieldPath:e.field.canonicalString(),increment:this.toValue(n.operand)}}else{throw h("Unknown transform: "+e.transform)}};e.prototype.fromFieldTransform=function(e){var t=this;var n=null;if("setToServerValue"in e){d(e.setToServerValue==="REQUEST_TIME","Unknown server value transform proto: "+JSON.stringify(e));n=to.instance}else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new no(r.map(function(e){return t.fromValue(e)}))}else if("removeAllFromArray"in e){var r=e.removeAllFromArray.values||[];n=new ro(r.map(function(e){return t.fromValue(e)}))}else if("increment"in e){var i=this.fromValue(e.increment);d(i instanceof sr,"NUMERIC_ADD transform requires a NumberValue");n=new io(i)}else{h("Unknown transform proto: "+JSON.stringify(e))}var o=pe.fromServerFormat(e.fieldPath);return new Er(o,n)};e.prototype.toDocumentsTarget=function(e){return{documents:[this.toQueryPath(e.path)]}};e.prototype.fromDocumentsTarget=function(e){var t=e.documents.length;d(t===1,"DocumentsTarget contained other than 1 document: "+t);var n=e.documents[0];return ji.atPath(this.fromQueryPath(n))};e.prototype.toQueryTarget=function(e){var t={structuredQuery:{}};var n=e.path;if(e.collectionGroup!==null){d(n.length%2===0,"Collection Group queries should be within a document path or root.");t.parent=this.toQueryPath(n);t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:true}]}else{d(n.length%2!==0,"Document queries with filters are not supported.");t.parent=this.toQueryPath(n.popLast());t.structuredQuery.from=[{collectionId:n.lastSegment()}]}var r=this.toFilter(e.filters);if(r){t.structuredQuery.where=r}var i=this.toOrder(e.orderBy);if(i){t.structuredQuery.orderBy=i}var o=this.toInt32Value(e.limit);if(o!==undefined){t.structuredQuery.limit=o}if(e.startAt){t.structuredQuery.startAt=this.toCursor(e.startAt)}if(e.endAt){t.structuredQuery.endAt=this.toCursor(e.endAt)}return t};e.prototype.fromQueryTarget=function(e){var t=this.fromQueryPath(e.parent);var n=e.structuredQuery;var r=n.from?n.from.length:0;var i=null;if(r>0){d(r===1,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];if(o.allDescendants){i=o.collectionId}else{t=t.child(o.collectionId)}}var a=[];if(n.where){a=this.fromFilter(n.where)}var s=[];if(n.orderBy){s=this.fromOrder(n.orderBy)}var u=null;if(n.limit){u=this.fromInt32Value(n.limit)}var c=null;if(n.startAt){c=this.fromCursor(n.startAt)}var l=null;if(n.endAt){l=this.fromCursor(n.endAt)}return new ji(t,i,s,a,u,c,l)};e.prototype.toListenRequestLabels=function(e){var t=this.toLabel(e.purpose);if(t==null){return null}else{return{"goog-listen-tags":t}}};e.prototype.toLabel=function(e){switch(e){case In.Listen:return null;case In.ExistenceFilterMismatch:return"existence-filter-mismatch";case In.LimboResolution:return"limbo-document";default:return h("Unrecognized query purpose: "+e)}};e.prototype.toTarget=function(e){var t;var n=e.query;if(n.isDocumentQuery()){t={documents:this.toDocumentsTarget(n)}}else{t={query:this.toQueryTarget(n)}}t.targetId=e.targetId;if(e.resumeToken.length>0){t.resumeToken=this.unsafeCastProtoByteString(e.resumeToken)}return t};e.prototype.toFilter=function(e){var t=this;if(e.length===0)return;var n=e.map(function(e){if(e instanceof Ki){return t.toUnaryOrFieldFilter(e)}else{return h("Unrecognized filter: "+JSON.stringify(e))}});if(n.length===1){return n[0]}return{compositeFilter:{op:"AND",filters:n}}};e.prototype.fromFilter=function(e){var t=this;if(!e){return[]}else if(e.unaryFilter!==undefined){return[this.fromUnaryFilter(e)]}else if(e.fieldFilter!==undefined){return[this.fromFieldFilter(e)]}else if(e.compositeFilter!==undefined){return e.compositeFilter.filters.map(function(e){return t.fromFilter(e)}).reduce(function(e,t){return e.concat(t)})}else{return h("Unknown filter: "+JSON.stringify(e))}};e.prototype.toOrder=function(e){var t=this;if(e.length===0)return;return e.map(function(e){return t.toPropertyOrder(e)})};e.prototype.fromOrder=function(e){var t=this;return e.map(function(e){return t.fromPropertyOrder(e)})};e.prototype.toCursor=function(e){var t=this;return{before:e.before,values:e.position.map(function(e){return t.toValue(e)})}};e.prototype.fromCursor=function(e){var t=this;var n=!!e.before;var r=e.values.map(function(e){return t.fromValue(e)});return new Xi(r,n)};e.prototype.toDirection=function(e){return so[e.name]};e.prototype.fromDirection=function(e){switch(e){case"ASCENDING":return $i.ASCENDING;case"DESCENDING":return $i.DESCENDING;default:return undefined}};e.prototype.toOperatorName=function(e){return uo[e.name]};e.prototype.fromOperatorName=function(e){switch(e){case"EQUAL":return zi.EQUAL;case"GREATER_THAN":return zi.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return zi.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return zi.LESS_THAN;case"LESS_THAN_OR_EQUAL":return zi.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return zi.ARRAY_CONTAINS;case"IN":return zi.IN;case"ARRAY_CONTAINS_ANY":return zi.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return h("Unspecified operator");default:return h("Unknown operator")}};e.prototype.toFieldPathReference=function(e){return{fieldPath:e.canonicalString()}};e.prototype.fromFieldPathReference=function(e){return pe.fromServerFormat(e.fieldPath)};e.prototype.toPropertyOrder=function(e){return{field:this.toFieldPathReference(e.field),direction:this.toDirection(e.dir)}};e.prototype.fromPropertyOrder=function(e){return new Ji(this.fromFieldPathReference(e.field),this.fromDirection(e.direction))};e.prototype.fromFieldFilter=function(e){return new Ki(this.fromFieldPathReference(e.fieldFilter.field),this.fromOperatorName(e.fieldFilter.op),this.fromValue(e.fieldFilter.value))};e.prototype.toUnaryOrFieldFilter=function(e){if(e.op===zi.EQUAL){if(e.value.isEqual(fr.NAN)){return{unaryFilter:{field:this.toFieldPathReference(e.field),op:"IS_NAN"}}}else if(e.value.isEqual(or.INSTANCE)){return{unaryFilter:{field:this.toFieldPathReference(e.field),op:"IS_NULL"}}}}return{fieldFilter:{field:this.toFieldPathReference(e.field),op:this.toOperatorName(e.op),value:this.toValue(e.value)}}};e.prototype.fromUnaryFilter=function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=this.fromFieldPathReference(e.unaryFilter.field);return new Ki(t,zi.EQUAL,fr.NAN);case"IS_NULL":var n=this.fromFieldPathReference(e.unaryFilter.field);return new Ki(n,zi.EQUAL,or.INSTANCE);case"OPERATOR_UNSPECIFIED":return h("Unspecified filter");default:return h("Unknown filter")}};e.prototype.toDocumentMask=function(e){var t=[];e.fields.forEach(function(e){return t.push(e.canonicalString())});return{fieldPaths:t}};e.prototype.fromDocumentMask=function(e){var t=e.fieldPaths||[];var n=t.map(function(e){return pe.fromServerFormat(e)});return wr.fromArray(n)};return e}();var po=function(){function e(){this.listeners=[]}return e}();var mo=function(){function e(e){this.syncEngine=e;this.queries=new At(function(e){return e.canonicalId()});this.onlineState=li.Unknown;this.syncEngine.subscribe(this)}e.prototype.listen=function(e){var t=e.query;var n=false;var r=this.queries.get(t);if(!r){n=true;r=new po;this.queries.set(t,r)}r.listeners.push(e);e.applyOnlineStateChange(this.onlineState);if(r.viewSnap)e.onViewSnapshot(r.viewSnap);if(n){return this.syncEngine.listen(t).then(function(e){r.targetId=e;return e})}else{return Promise.resolve(r.targetId)}};e.prototype.unlisten=function(e){return B.__awaiter(this,void 0,void 0,function(){var t,n,r,i;return B.__generator(this,function(o){t=e.query;n=false;r=this.queries.get(t);if(r){i=r.listeners.indexOf(e);if(i>=0){r.listeners.splice(i,1);n=r.listeners.length===0}}if(n){this.queries.delete(t);return[2,this.syncEngine.unlisten(t)]}return[2]})})};e.prototype.onWatchChange=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];var i=r.query;var o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++){var u=s[a];u.onViewSnapshot(r)}o.viewSnap=r}}};e.prototype.onWatchError=function(e,t){var n=this.queries.get(e);if(n){for(var r=0,i=n.listeners;r<i.length;r++){var o=i[r];o.onError(t)}}this.queries.delete(e)};e.prototype.onOnlineStateChange=function(e){this.onlineState=e;this.queries.forEach(function(t,n){for(var r=0,i=n.listeners;r<i.length;r++){var o=i[r];o.applyOnlineStateChange(e)}})};return e}();var yo=function(){function e(e,t,n){this.query=e;this.queryObserver=t;this.raisedInitialEvent=false;this.onlineState=li.Unknown;this.options=n||{}}e.prototype.onViewSnapshot=function(e){d(e.docChanges.length>0||e.syncStateChanged,"We got a new snapshot with no changes?");if(!this.options.includeMetadataChanges){var t=[];for(var n=0,r=e.docChanges;n<r.length;n++){var i=r[n];if(i.type!==Ii.Metadata){t.push(i)}}e=new Ci(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,true)}if(!this.raisedInitialEvent){if(this.shouldRaiseInitialEvent(e,this.onlineState)){this.raiseInitialEvent(e)}}else if(this.shouldRaiseEvent(e)){this.queryObserver.next(e)}this.snap=e};e.prototype.onError=function(e){this.queryObserver.error(e)};e.prototype.applyOnlineStateChange=function(e){this.onlineState=e;if(this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)){this.raiseInitialEvent(this.snap)}};e.prototype.shouldRaiseInitialEvent=function(e,t){d(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event");if(!e.fromCache){return true}var n=t!==li.Offline;if(this.options.waitForSyncWhenOnline&&n){d(e.fromCache,"Waiting for sync, but snapshot is not from cache");return false}return!e.docs.isEmpty()||t===li.Offline};e.prototype.shouldRaiseEvent=function(e){if(e.docChanges.length>0){return true}var t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;if(e.syncStateChanged||t){return this.options.includeMetadataChanges===true}return false};e.prototype.raiseInitialEvent=function(e){d(!this.raisedInitialEvent,"Trying to raise initial events for second time");e=Ci.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache);this.raisedInitialEvent=true;this.queryObserver.next(e)};return e}();var vo=function(){function e(e,t,n){this.targetId=e;this.addedKeys=t;this.removedKeys=n}e.fromSnapshot=function(t,n){var r=ze();var i=ze();for(var o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case Ii.Added:r=r.add(s.doc.key);break;case Ii.Removed:i=i.add(s.doc.key);break;default:}}return new e(t,r,i)};return e}();var go=function(){function e(e){this.key=e}return e}();var bo=function(){function e(e){this.key=e}return e}();var wo=function(){function e(e,t){this.query=e;this._syncedDocuments=t;this.syncState=null;this.current=false;this.limboDocuments=ze();this.mutatedKeys=ze();this.documentSet=new Ti(e.docComparator.bind(e))}Object.defineProperty(e.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:true,configurable:true});e.prototype.computeDocChanges=function(e,t){var n=this;var r=t?t.changeSet:new Di;var i=t?t.documentSet:this.documentSet;var o=t?t.mutatedKeys:this.mutatedKeys;var a=i;var s=false;var u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;e.inorderTraversal(function(e,t){var c=i.get(e);var l=t instanceof _t?t:null;if(l){d(e.isEqual(l.key),"Mismatching keys found in document changes: "+e+" != "+l.key);l=n.query.matches(l)?l:null}var f=c?n.mutatedKeys.has(c.key):false;var h=l?l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations:false;var p=false;if(c&&l){var m=c.data.isEqual(l.data);if(!m){if(!n.shouldWaitForSyncedDocument(c,l)){r.track({type:Ii.Modified,doc:l});p=true;if(u&&n.query.docComparator(l,u)>0){s=true}}}else if(f!==h){r.track({type:Ii.Metadata,doc:l});p=true}}else if(!c&&l){r.track({type:Ii.Added,doc:l});p=true}else if(c&&!l){r.track({type:Ii.Removed,doc:c});p=true;if(u){s=true}}if(p){if(l){a=a.add(l);if(h){o=o.add(e)}else{o=o.delete(e)}}else{a=a.delete(e);o=o.delete(e)}}});if(this.query.hasLimit()){while(a.size>this.query.limit){var c=a.last();a=a.delete(c.key);o=o.delete(c.key);r.track({type:Ii.Removed,doc:c})}}d(!s||!t,"View was refilled using docs that themselves needed refilling.");return{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}};e.prototype.shouldWaitForSyncedDocument=function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations};e.prototype.applyChanges=function(e,t,n){var r=this;d(!e.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=e.documentSet;this.mutatedKeys=e.mutatedKeys;var o=e.changeSet.getChanges();o.sort(function(e,t){return So(e.type,t.type)||r.query.docComparator(e.doc,t.doc)});this.applyTargetChange(n);var a=t?this.updateLimboDocuments():[];var s=this.limboDocuments.size===0&&this.current;var u=s?_i.Synced:_i.Local;var c=u!==this.syncState;this.syncState=u;if(o.length===0&&!c){return{limboChanges:a}}else{var l=new Ci(this.query,e.documentSet,i,o,e.mutatedKeys,u===_i.Local,c,false);return{snapshot:l,limboChanges:a}}};e.prototype.applyOnlineStateChange=function(e){if(this.current&&e===li.Offline){this.current=false;return this.applyChanges({documentSet:this.documentSet,changeSet:new Di,mutatedKeys:this.mutatedKeys,needsRefill:false},false)}else{return{limboChanges:[]}}};e.prototype.shouldBeInLimbo=function(e){if(this._syncedDocuments.has(e)){return false}if(!this.documentSet.has(e)){return false}if(this.documentSet.get(e).hasLocalMutations){return false}return true};e.prototype.applyTargetChange=function(e){var t=this;if(e){e.addedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.add(e)});e.modifiedDocuments.forEach(function(e){return d(t._syncedDocuments.has(e),"Modified document "+e+" not found in view.")});e.removedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.delete(e)});this.current=e.current}};e.prototype.updateLimboDocuments=function(){var e=this;if(!this.current){return[]}var t=this.limboDocuments;this.limboDocuments=ze();this.documentSet.forEach(function(t){if(e.shouldBeInLimbo(t.key)){e.limboDocuments=e.limboDocuments.add(t.key)}});var n=[];t.forEach(function(t){if(!e.limboDocuments.has(t)){n.push(new bo(t))}});this.limboDocuments.forEach(function(e){if(!t.has(e)){n.push(new go(e))}});return n};e.prototype.synchronizeWithPersistedState=function(e,t){this._syncedDocuments=t;this.limboDocuments=ze();var n=this.computeDocChanges(e);return this.applyChanges(n,true)};e.prototype.computeInitialSnapshot=function(){return Ci.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===_i.Local)};return e}();function So(e,t){var n=function(e){switch(e){case Ii.Added:return 1;case Ii.Modified:return 2;case Ii.Metadata:return 2;case Ii.Removed:return 0;default:return h("Unknown ChangeType: "+e)}};return n(e)-n(t)}var To="SyncEngine";var Io=function(){function e(e,t,n){this.query=e;this.targetId=t;this.view=n}return e}();var _o=function(){function e(e){this.key=e}return e}();var Do=function(){function e(e,t,n,r){this.localStore=e;this.remoteStore=t;this.sharedClientState=n;this.currentUser=r;this.syncEngineListener=null;this.queryViewsByQuery=new At(function(e){return e.canonicalId()});this.queryViewsByTarget={};this.limboTargetsByKey=new ke(me.comparator);this.limboResolutionsByTarget={};this.limboDocumentRefs=new Or;this.mutationUserCallbacks={};this.limboTargetIdGenerator=ct.forSyncEngine();this.isPrimary=undefined;this.onlineState=li.Unknown}Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return this.isPrimary===true},enumerable:true,configurable:true});e.prototype.subscribe=function(e){d(e!==null,"SyncEngine listener cannot be null");d(this.syncEngineListener===null,"SyncEngine already has a subscriber.");this.syncEngineListener=e};e.prototype.listen=function(e){return B.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return B.__generator(this,function(a){switch(a.label){case 0:this.assertSubscribed("listen()");r=this.queryViewsByQuery.get(e);if(!r)return[3,1];t=r.targetId;this.sharedClientState.addLocalQueryTarget(t);n=r.view.computeInitialSnapshot();return[3,4];case 1:return[4,this.localStore.allocateQuery(e)];case 2:i=a.sent();o=this.sharedClientState.addLocalQueryTarget(i.targetId);t=i.targetId;return[4,this.initializeViewAndComputeSnapshot(i,o==="current")];case 3:n=a.sent();if(this.isPrimary){this.remoteStore.listen(i)}a.label=4;case 4:this.syncEngineListener.onWatchChange([n]);return[2,t]}})})};e.prototype.initializeViewAndComputeSnapshot=function(e,t){var n=this;var r=e.query;return this.localStore.executeQuery(r).then(function(i){return n.localStore.remoteDocumentKeys(e.targetId).then(function(o){var a=new wo(r,o);var s=a.computeDocChanges(i);var u=Ni.createSynthesizedTargetChangeForCurrentChange(e.targetId,t&&n.onlineState!==li.Offline);var c=a.applyChanges(s,n.isPrimary===true,u);d(c.limboChanges.length===0,"View returned limbo docs before target ack from the server.");d(!!c.snapshot,"applyChanges for new view should always return a snapshot");var l=new Io(r,e.targetId,a);n.queryViewsByQuery.set(r,l);n.queryViewsByTarget[e.targetId]=l;return c.snapshot})})};e.prototype.synchronizeViewAndComputeSnapshot=function(e){var t=this;return this.localStore.executeQuery(e.query).then(function(n){return t.localStore.remoteDocumentKeys(e.targetId).then(function(r){return B.__awaiter(t,void 0,void 0,function(){var t;return B.__generator(this,function(i){t=e.view.synchronizeWithPersistedState(n,r);if(this.isPrimary){this.updateTrackedLimbos(e.targetId,t.limboChanges)}return[2,t]})})})})};e.prototype.unlisten=function(e){return B.__awaiter(this,void 0,void 0,function(){var t,n;var r=this;return B.__generator(this,function(i){switch(i.label){case 0:this.assertSubscribed("unlisten()");t=this.queryViewsByQuery.get(e);d(!!t,"Trying to unlisten on query not found:"+e);if(!this.isPrimary)return[3,3];this.sharedClientState.removeLocalQueryTarget(t.targetId);n=this.sharedClientState.isActiveQueryTarget(t.targetId);if(!!n)return[3,2];return[4,this.localStore.releaseQuery(e,false).then(function(){r.sharedClientState.clearQueryState(t.targetId);r.remoteStore.unlisten(t.targetId);r.removeAndCleanupQuery(t)}).catch(Hn)];case 1:i.sent();i.label=2;case 2:return[3,5];case 3:this.removeAndCleanupQuery(t);return[4,this.localStore.releaseQuery(e,true)];case 4:i.sent();i.label=5;case 5:return[2]}})})};e.prototype.write=function(e,t){var n=this;this.assertSubscribed("write()");return this.localStore.localWrite(e).then(function(e){n.sharedClientState.addPendingMutation(e.batchId);n.addMutationCallback(e.batchId,t);return n.emitNewSnapsAndNotifyLocalStore(e.changes)}).then(function(){return n.remoteStore.fillWritePipeline()})};e.prototype.wrapUpdateFunctionError=function(e){return e};e.prototype.runTransaction=function(e,t){var n=this;if(t===void 0){t=5}d(t>=0,"Got negative number of retries for transaction.");var r=this.remoteStore.createTransaction();var i=function(){try{var t=e(r);if(Yr(t)||!t.catch||!t.then){return Promise.reject(Error("Transaction callback must return a Promise"))}return t.catch(function(e){return Promise.reject(n.wrapUpdateFunctionError(e))})}catch(e){return Promise.reject(n.wrapUpdateFunctionError(e))}};return i().then(function(i){return r.commit().then(function(){return i}).catch(function(r){if(t===0){return Promise.reject(r)}return n.runTransaction(e,t-1)})})};e.prototype.applyRemoteEvent=function(e){var t=this;this.assertSubscribed("applyRemoteEvent()");return this.localStore.applyRemoteEvent(e).then(function(n){T(e.targetChanges,function(e,n){var r=t.limboResolutionsByTarget[Number(e)];if(r){d(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes.");if(n.addedDocuments.size>0){r.receivedDocument=true}else if(n.modifiedDocuments.size>0){d(r.receivedDocument,"Received change for limbo target document without add.")}else if(n.removedDocuments.size>0){d(r.receivedDocument,"Received remove for limbo target document without add.");r.receivedDocument=false}}});return t.emitNewSnapsAndNotifyLocalStore(n,e)}).catch(Hn)};e.prototype.applyOnlineStateChange=function(e,t){if(this.isPrimary&&t===fi.RemoteStore||!this.isPrimary&&t===fi.SharedClientState){var n=[];this.queryViewsByQuery.forEach(function(t,r){var i=r.view.applyOnlineStateChange(e);d(i.limboChanges.length===0,"OnlineState should not affect limbo documents.");if(i.snapshot){n.push(i.snapshot)}});this.syncEngineListener.onOnlineStateChange(e);this.syncEngineListener.onWatchChange(n);this.onlineState=e;if(this.isPrimary){this.sharedClientState.setOnlineState(e)}}};e.prototype.rejectListen=function(e,t){return B.__awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s;var u=this;return B.__generator(this,function(c){switch(c.label){case 0:this.assertSubscribed("rejectListens()");this.sharedClientState.updateQueryState(e,"rejected",t);n=this.limboResolutionsByTarget[e];r=n&&n.key;if(!r)return[3,1];this.limboTargetsByKey=this.limboTargetsByKey.remove(r);delete this.limboResolutionsByTarget[e];i=new ke(me.comparator);i=i.insert(r,new Dt(r,Ne.forDeletedDoc()));o=ze().add(r);a=new Ai(Ne.MIN,{},new Me(J),i,o);return[2,this.applyRemoteEvent(a)];case 1:s=this.queryViewsByTarget[e];d(!!s,"Unknown targetId: "+e);return[4,this.localStore.releaseQuery(s.query,false).then(function(){return u.removeAndCleanupQuery(s)}).catch(Hn)];case 2:c.sent();this.syncEngineListener.onWatchError(s.query,t);c.label=3;case 3:return[2]}})})};e.prototype.applyBatchState=function(e,t,n){return B.__awaiter(this,void 0,void 0,function(){var r;return B.__generator(this,function(i){switch(i.label){case 0:this.assertSubscribed("applyBatchState()");return[4,this.localStore.lookupMutationDocuments(e)];case 1:r=i.sent();if(r===null){c(To,"Cannot apply mutation batch with id: "+e);return[2]}if(!(t==="pending"))return[3,3];return[4,this.remoteStore.fillWritePipeline()];case 2:i.sent();return[3,4];case 3:if(t==="acknowledged"||t==="rejected"){this.processUserCallback(e,n?n:null);this.localStore.removeCachedMutationBatchMetadata(e)}else{h("Unknown batchState: "+t)}i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:i.sent();return[2]}})})};e.prototype.applySuccessfulWrite=function(e){var t=this;this.assertSubscribed("applySuccessfulWrite()");var n=e.batch.batchId;this.processUserCallback(n,null);return this.localStore.acknowledgeBatch(e).then(function(e){t.sharedClientState.updateMutationState(n,"acknowledged");return t.emitNewSnapsAndNotifyLocalStore(e)}).catch(Hn)};e.prototype.rejectFailedWrite=function(e,t){var n=this;this.assertSubscribed("rejectFailedWrite()");this.processUserCallback(e,t);return this.localStore.rejectBatch(e).then(function(r){n.sharedClientState.updateMutationState(e,"rejected",t);return n.emitNewSnapsAndNotifyLocalStore(r)}).catch(Hn)};e.prototype.addMutationCallback=function(e,t){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(!n){n=new ke(J)}n=n.insert(e,t);this.mutationUserCallbacks[this.currentUser.toKey()]=n};e.prototype.processUserCallback=function(e,t){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(e);if(r){d(e===n.minKey(),"Mutation callbacks processed out-of-order?");if(t){r.reject(t)}else{r.resolve()}n=n.remove(e)}this.mutationUserCallbacks[this.currentUser.toKey()]=n}};e.prototype.removeAndCleanupQuery=function(e){var t=this;this.sharedClientState.removeLocalQueryTarget(e.targetId);this.queryViewsByQuery.delete(e.query);delete this.queryViewsByTarget[e.targetId];if(this.isPrimary){var n=this.limboDocumentRefs.referencesForId(e.targetId);this.limboDocumentRefs.removeReferencesForId(e.targetId);n.forEach(function(e){var n=t.limboDocumentRefs.containsKey(e);if(!n){t.removeLimboTarget(e)}})}};e.prototype.removeLimboTarget=function(e){var t=this.limboTargetsByKey.get(e);if(t===null){return}this.remoteStore.unlisten(t);this.limboTargetsByKey=this.limboTargetsByKey.remove(e);delete this.limboResolutionsByTarget[t]};e.prototype.updateTrackedLimbos=function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i instanceof go){this.limboDocumentRefs.addReference(i.key,e);this.trackLimboChange(i)}else if(i instanceof bo){c(To,"Document no longer in limbo: "+i.key);this.limboDocumentRefs.removeReference(i.key,e);var o=this.limboDocumentRefs.containsKey(i.key);if(!o){this.removeLimboTarget(i.key)}}else{h("Unknown limbo change: "+JSON.stringify(i))}}};e.prototype.trackLimboChange=function(e){var t=e.key;if(!this.limboTargetsByKey.get(t)){c(To,"New document in limbo: "+t);var n=this.limboTargetIdGenerator.next();var r=ji.atPath(t.path);this.limboResolutionsByTarget[n]=new _o(t);this.remoteStore.listen(new _n(r,n,In.LimboResolution,ce.INVALID));this.limboTargetsByKey=this.limboTargetsByKey.insert(t,n)}};e.prototype.currentLimboDocs=function(){return this.limboTargetsByKey};e.prototype.emitNewSnapsAndNotifyLocalStore=function(e,t){return B.__awaiter(this,void 0,void 0,function(){var n,r,i;var o=this;return B.__generator(this,function(a){switch(a.label){case 0:n=[];r=[];i=[];this.queryViewsByQuery.forEach(function(a,s){i.push(Promise.resolve().then(function(){var t=s.view.computeDocChanges(e);if(!t.needsRefill){return t}return o.localStore.executeQuery(s.query).then(function(e){return s.view.computeDocChanges(e,t)})}).then(function(e){var i=t&&t.targetChanges[s.targetId];var a=s.view.applyChanges(e,o.isPrimary===true,i);o.updateTrackedLimbos(s.targetId,a.limboChanges);if(a.snapshot){if(o.isPrimary){o.sharedClientState.updateQueryState(s.targetId,a.snapshot.fromCache?"not-current":"current")}n.push(a.snapshot);var u=vo.fromSnapshot(s.targetId,a.snapshot);r.push(u)}}))});return[4,Promise.all(i)];case 1:a.sent();this.syncEngineListener.onWatchChange(n);return[4,this.localStore.notifyLocalViewChanges(r)];case 2:a.sent();return[2]}})})};e.prototype.assertSubscribed=function(e){d(this.syncEngineListener!==null,"Trying to call "+e+" before calling subscribe().")};e.prototype.handleCredentialChange=function(e){return B.__awaiter(this,void 0,void 0,function(){var t,n;return B.__generator(this,function(r){switch(r.label){case 0:t=!this.currentUser.isEqual(e);this.currentUser=e;if(!t)return[3,3];return[4,this.localStore.handleUserChange(e)];case 1:n=r.sent();this.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds);return[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent();r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:r.sent();return[2]}})})};e.prototype.applyPrimaryState=function(e){return B.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s;var u=this;return B.__generator(this,function(c){switch(c.label){case 0:if(!(e===true&&this.isPrimary!==true))return[3,3];this.isPrimary=true;return[4,this.remoteStore.applyPrimaryState(true)];case 1:c.sent();t=this.sharedClientState.getAllActiveQueryTargets();return[4,this.synchronizeQueryViewsAndRaiseSnapshots(t.toArray())];case 2:n=c.sent();for(r=0,i=n;r<i.length;r++){o=i[r];this.remoteStore.listen(o)}return[3,7];case 3:if(!(e===false&&this.isPrimary!==false))return[3,7];this.isPrimary=false;a=[];s=Promise.resolve();E(this.queryViewsByTarget,function(e,t){if(u.sharedClientState.isLocalQueryTarget(e)){a.push(e)}else{s=s.then(function(){return u.unlisten(t.query)})}u.remoteStore.unlisten(t.targetId)});return[4,s];case 4:c.sent();return[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:c.sent();this.resetLimboDocuments();return[4,this.remoteStore.applyPrimaryState(false)];case 6:c.sent();c.label=7;case 7:return[2]}})})};e.prototype.resetLimboDocuments=function(){var e=this;E(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)});this.limboDocumentRefs.removeAllReferences();this.limboResolutionsByTarget=[];this.limboTargetsByKey=new ke(me.comparator)};e.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(e){var t=this;var n=Promise.resolve();var r=[];var i=[];var o=function(e){n=n.then(function(){return B.__awaiter(t,void 0,void 0,function(){var t,n,o,a;return B.__generator(this,function(s){switch(s.label){case 0:n=this.queryViewsByTarget[e];if(!n)return[3,4];return[4,this.localStore.releaseQuery(n.query,true)];case 1:s.sent();return[4,this.localStore.allocateQuery(n.query)];case 2:t=s.sent();return[4,this.synchronizeViewAndComputeSnapshot(n)];case 3:o=s.sent();if(o.snapshot){i.push(o.snapshot)}return[3,8];case 4:d(this.isPrimary===true,"A secondary tab should never have an active query without an active view.");return[4,this.localStore.getQueryForTarget(e)];case 5:a=s.sent();d(!!a,"Query data for target "+e+" not found");return[4,this.localStore.allocateQuery(a)];case 6:t=s.sent();return[4,this.initializeViewAndComputeSnapshot(t,false)];case 7:s.sent();s.label=8;case 8:r.push(t);return[2]}})})})};for(var a=0,s=e;a<s.length;a++){var u=s[a];o(u)}return n.then(function(){t.syncEngineListener.onWatchChange(i);return r})};e.prototype.getActiveClients=function(){return this.localStore.getActiveClients()};e.prototype.applyTargetState=function(e,t,n){return B.__awaiter(this,void 0,void 0,function(){var r,i;var o=this;return B.__generator(this,function(a){switch(a.label){case 0:if(this.isPrimary){c(To,"Ignoring unexpected query state notification.");return[2]}if(!this.queryViewsByTarget[e])return[3,5];r=t;switch(r){case"current":return[3,1];case"not-current":return[3,1];case"rejected":return[3,2]}return[3,4];case 1:{return[2,this.localStore.getNewDocumentChanges().then(function(n){return B.__awaiter(o,void 0,void 0,function(){var r;return B.__generator(this,function(i){switch(i.label){case 0:r=Ai.createSynthesizedRemoteEventForCurrentChange(e,t==="current");return[4,this.emitNewSnapsAndNotifyLocalStore(n,r)];case 1:i.sent();return[2]}})})},function(e){return B.__awaiter(o,void 0,void 0,function(){var t;return B.__generator(this,function(n){switch(n.label){case 0:if(!Mt(e))return[3,2];t=[];E(this.queryViewsByTarget,function(e){return t.push(e)});return[4,this.synchronizeQueryViewsAndRaiseSnapshots(t)];case 1:n.sent();return[3,3];case 2:throw e;case 3:return[2]}})})})]}a.label=2;case 2:i=this.queryViewsByTarget[e];this.removeAndCleanupQuery(i);return[4,this.localStore.releaseQuery(i.query,true)];case 3:a.sent();this.syncEngineListener.onWatchError(i.query,n);return[3,5];case 4:h("Unexpected target state: "+t);a.label=5;case 5:return[2]}})})};e.prototype.applyActiveTargetsChange=function(e,t){return B.__awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,i;var f=this;return B.__generator(this,function(h){switch(h.label){case 0:if(!this.isPrimary){return[2]}n=0,r=e;h.label=1;case 1:if(!(n<r.length))return[3,6];i=r[n];d(!this.queryViewsByTarget[i],"Trying to add an already active target");return[4,this.localStore.getQueryForTarget(i)];case 2:o=h.sent();d(!!o,"Query data for active target "+i+" not found");return[4,this.localStore.allocateQuery(o)];case 3:a=h.sent();return[4,this.initializeViewAndComputeSnapshot(a,false)];case 4:h.sent();this.remoteStore.listen(a);h.label=5;case 5:n++;return[3,1];case 6:s=function(e){var t;return B.__generator(this,function(n){switch(n.label){case 0:t=u.queryViewsByTarget[e];if(!t)return[3,2];return[4,u.localStore.releaseQuery(t.query,false).then(function(){f.remoteStore.unlisten(e);f.removeAndCleanupQuery(t)}).catch(Hn)];case 1:n.sent();n.label=2;case 2:return[2]}})};u=this;c=0,l=t;h.label=7;case 7:if(!(c<l.length))return[3,10];i=l[c];return[5,s(i)];case 8:h.sent();h.label=9;case 9:c++;return[3,7];case 10:return[2]}})})};e.prototype.enableNetwork=function(){this.localStore.setNetworkEnabled(true);return this.remoteStore.enableNetwork()};e.prototype.disableNetwork=function(){this.localStore.setNetworkEnabled(false);return this.remoteStore.disableNetwork()};e.prototype.getRemoteKeysForTarget=function(e){var t=this.limboResolutionsByTarget[e];if(t&&t.receivedDocument){return ze().add(t.key)}else{return this.queryViewsByTarget[e]?this.queryViewsByTarget[e].view.syncedDocuments:ze()}};return e}();var Co=function(){function e(e){this.uid=e}e.prototype.isAuthenticated=function(){return this.uid!=null};e.prototype.toKey=function(){if(this.isAuthenticated()){return"uid:"+this.uid}else{return"anonymous-user"}};e.prototype.isEqual=function(e){return e.uid===this.uid};e.UNAUTHENTICATED=new e(null);e.GOOGLE_CREDENTIALS=new e("google-credentials-uid");e.FIRST_PARTY=new e("first-party-uid");return e}();var Ao="SharedClientState";var No="firestore_clients";var ko="firestore_mutations";var Oo="firestore_targets";var xo="firestore_online_state";var Ro="firestore_sequence_number";var Mo=function(){function e(e,t,n,r){this.user=e;this.batchId=t;this.state=n;this.error=r;d(r!==undefined===(n==="rejected"),"MutationMetadata must contain an error iff state is 'rejected'")}e.fromWebStorageEntry=function(t,n,r){var i=JSON.parse(r);var o=typeof i==="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===undefined||typeof i.error==="object");var a=undefined;if(o&&i.error){o=typeof i.error.message==="string"&&typeof i.error.code==="string";if(o){a=new v(i.error.code,i.error.message)}}if(o){return new e(t,n,i.state,a)}else{l(Ao,"Failed to parse mutation state for ID '"+n+"': "+r);return null}};e.prototype.toWebStorageJSON=function(){var e={state:this.state,updateTimeMs:Date.now()};if(this.error){e.error={code:this.error.code,message:this.error.message}}return JSON.stringify(e)};return e}();var Po=function(){function e(e,t,n){this.targetId=e;this.state=t;this.error=n;d(n!==undefined===(t==="rejected"),"QueryTargetMetadata must contain an error iff state is 'rejected'")}e.fromWebStorageEntry=function(t,n){var r=JSON.parse(n);var i=typeof r==="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===undefined||typeof r.error==="object");var o=undefined;if(i&&r.error){i=typeof r.error.message==="string"&&typeof r.error.code==="string";if(i){o=new v(r.error.code,r.error.message)}}if(i){return new e(t,r.state,o)}else{l(Ao,"Failed to parse target state for ID '"+t+"': "+n);return null}};e.prototype.toWebStorageJSON=function(){var e={state:this.state,updateTimeMs:Date.now()};if(this.error){e.error={code:this.error.code,message:this.error.message}}return JSON.stringify(e)};return e}();var Lo=function(){function e(e,t){this.clientId=e;this.activeTargetIds=t}e.fromWebStorageEntry=function(t,n){var r=JSON.parse(n);var i=typeof r==="object"&&r.activeTargetIds instanceof Array;var o=He();for(var a=0;i&&a<r.activeTargetIds.length;++a){i=$r(r.activeTargetIds[a]);o=o.add(r.activeTargetIds[a])}if(i){return new e(t,o)}else{l(Ao,"Failed to parse client data for instance '"+t+"': "+n);return null}};return e}();var Fo=function(){function e(e,t){this.clientId=e;this.onlineState=t}e.fromWebStorageEntry=function(t){var n=JSON.parse(t);var r=typeof n==="object"&&n.onlineState in li&&typeof n.clientId==="string";if(r){return new e(n.clientId,li[n.onlineState])}else{l(Ao,"Failed to parse online state: "+t);return null}};return e}();var qo=function(){function e(){this.activeTargetIds=He()}e.prototype.addQueryTarget=function(e){d(!this.activeTargetIds.has(e),"Target with ID '"+e+"' already active.");this.activeTargetIds=this.activeTargetIds.add(e)};e.prototype.removeQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.delete(e)};e.prototype.toWebStorageJSON=function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)};return e}();var Uo=function(){function e(t,n,r,i,o){this.queue=t;this.platform=n;this.persistenceKey=r;this.localClientId=i;this.syncEngine=null;this.onlineStateHandler=null;this.sequenceNumberHandler=null;this.activeClients={};this.storageListener=this.handleWebStorageEvent.bind(this);this.started=false;this.earlyEvents=[];if(!e.isAvailable(this.platform)){throw new v(y.UNIMPLEMENTED,"LocalStorage is not available on this platform.")}var a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage;this.currentUser=o;this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId);this.sequenceNumberKey=Ro+"_"+r;this.activeClients[this.localClientId]=new qo;this.clientStateKeyRe=new RegExp("^"+No+"_"+a+"_([^_]*)$");this.mutationBatchKeyRe=new RegExp("^"+ko+"_"+a+"_(\\d+)(?:_(.*))?$");this.queryTargetKeyRe=new RegExp("^"+Oo+"_"+a+"_(\\d+)$");this.onlineStateKey=xo+"_"+r;this.platform.window.addEventListener("storage",this.storageListener)}e.isAvailable=function(e){return!!(e.window&&e.window.localStorage!=null)};e.prototype.start=function(){return B.__awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a,s,u,c,l;var f=this;return B.__generator(this,function(h){switch(h.label){case 0:d(!this.started,"WebStorageSharedClientState already started");d(this.syncEngine!==null,"syncEngine property must be set before calling start()");d(this.onlineStateHandler!==null,"onlineStateHandler property must be set before calling start()");return[4,this.syncEngine.getActiveClients()];case 1:e=h.sent();for(t=0,n=e;t<n.length;t++){r=n[t];if(r===this.localClientId){continue}i=this.getItem(this.toWebStorageClientStateKey(r));if(i){o=Lo.fromWebStorageEntry(r,i);if(o){this.activeClients[o.clientId]=o}}}this.persistClientState();a=this.storage.getItem(this.onlineStateKey);if(a){s=this.fromWebStorageOnlineState(a);if(s){this.handleOnlineStateEvent(s)}}for(u=0,c=this.earlyEvents;u<c.length;u++){l=c[u];this.handleWebStorageEvent(l)}this.earlyEvents=[];this.platform.window.addEventListener("unload",function(){return f.shutdown()});this.started=true;return[2]}})})};e.prototype.writeSequenceNumber=function(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))};e.prototype.getAllActiveQueryTargets=function(){var e=He();T(this.activeClients,function(t,n){e=e.unionWith(n.activeTargetIds)});return e};e.prototype.isActiveQueryTarget=function(e){for(var t in this.activeClients){if(this.activeClients.hasOwnProperty(t)){if(this.activeClients[t].activeTargetIds.has(e)){return true}}}return false};e.prototype.addPendingMutation=function(e){this.persistMutationState(e,"pending")};e.prototype.updateMutationState=function(e,t,n){this.persistMutationState(e,t,n);this.removeMutationState(e)};e.prototype.addLocalQueryTarget=function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(e));if(n){var r=Po.fromWebStorageEntry(e,n);if(r){t=r.state}}}this.localClientState.addQueryTarget(e);this.persistClientState();return t};e.prototype.removeLocalQueryTarget=function(e){this.localClientState.removeQueryTarget(e);this.persistClientState()};e.prototype.isLocalQueryTarget=function(e){return this.localClientState.activeTargetIds.has(e)};e.prototype.clearQueryState=function(e){this.removeItem(this.toWebStorageQueryTargetMetadataKey(e))};e.prototype.updateQueryState=function(e,t,n){this.persistQueryTargetState(e,t,n)};e.prototype.handleUserChange=function(e,t,n){var r=this;t.forEach(function(e){r.removeMutationState(e)});this.currentUser=e;n.forEach(function(e){r.addPendingMutation(e)})};e.prototype.setOnlineState=function(e){this.persistOnlineState(e)};e.prototype.shutdown=function(){if(this.started){this.platform.window.removeEventListener("storage",this.storageListener);this.removeItem(this.localClientStorageKey);this.started=false}};e.prototype.getItem=function(e){var t=this.storage.getItem(e);c(Ao,"READ",e,t);return t};e.prototype.setItem=function(e,t){c(Ao,"SET",e,t);this.storage.setItem(e,t)};e.prototype.removeItem=function(e){c(Ao,"REMOVE",e);this.storage.removeItem(e)};e.prototype.handleWebStorageEvent=function(e){var t=this;if(e.storageArea===this.storage){c(Ao,"EVENT",e.key,e.newValue);if(e.key===this.localClientStorageKey){l("Received WebStorage notification for local change. Another client might have "+"garbage-collected our state");return}this.queue.enqueueAndForget(function(){return B.__awaiter(t,void 0,void 0,function(){var t,n,r,i,o,a;return B.__generator(this,function(s){if(!this.started){this.earlyEvents.push(e);return[2]}if(e.key===null){return[2]}if(this.clientStateKeyRe.test(e.key)){if(e.newValue!=null){t=this.fromWebStorageClientState(e.key,e.newValue);if(t){return[2,this.handleClientStateEvent(t.clientId,t)]}}else{n=this.fromWebStorageClientStateKey(e.key);return[2,this.handleClientStateEvent(n,null)]}}else if(this.mutationBatchKeyRe.test(e.key)){if(e.newValue!==null){r=this.fromWebStorageMutationMetadata(e.key,e.newValue);if(r){return[2,this.handleMutationBatchEvent(r)]}}}else if(this.queryTargetKeyRe.test(e.key)){if(e.newValue!==null){i=this.fromWebStorageQueryTargetMetadata(e.key,e.newValue);if(i){return[2,this.handleQueryTargetEvent(i)]}}}else if(e.key===this.onlineStateKey){if(e.newValue!==null){o=this.fromWebStorageOnlineState(e.newValue);if(o){return[2,this.handleOnlineStateEvent(o)]}}}else if(e.key===this.sequenceNumberKey){d(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler");a=Vo(e.newValue);if(a!==ce.INVALID){this.sequenceNumberHandler(a)}}return[2]})})})}};Object.defineProperty(e.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:true,configurable:true});e.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())};e.prototype.persistMutationState=function(e,t,n){var r=new Mo(this.currentUser,e,t,n);var i=this.toWebStorageMutationBatchKey(e);this.setItem(i,r.toWebStorageJSON())};e.prototype.removeMutationState=function(e){var t=this.toWebStorageMutationBatchKey(e);this.removeItem(t)};e.prototype.persistOnlineState=function(e){var t={clientId:this.localClientId,onlineState:li[e]};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))};e.prototype.persistQueryTargetState=function(e,t,n){var r=this.toWebStorageQueryTargetMetadataKey(e);var i=new Po(e,t,n);this.setItem(r,i.toWebStorageJSON())};e.prototype.toWebStorageClientStateKey=function(e){d(e.indexOf("_")===-1,"Client key cannot contain '_', but was '"+e+"'");return No+"_"+this.persistenceKey+"_"+e};e.prototype.toWebStorageQueryTargetMetadataKey=function(e){return Oo+"_"+this.persistenceKey+"_"+e};e.prototype.toWebStorageMutationBatchKey=function(e){var t=ko+"_"+this.persistenceKey+"_"+e;if(this.currentUser.isAuthenticated()){t+="_"+this.currentUser.uid}return t};e.prototype.fromWebStorageClientStateKey=function(e){var t=this.clientStateKeyRe.exec(e);return t?t[1]:null};e.prototype.fromWebStorageClientState=function(e,t){var n=this.fromWebStorageClientStateKey(e);d(n!==null,"Cannot parse client state key '"+e+"'");return Lo.fromWebStorageEntry(n,t)};e.prototype.fromWebStorageMutationMetadata=function(e,t){var n=this.mutationBatchKeyRe.exec(e);d(n!==null,"Cannot parse mutation batch key '"+e+"'");var r=Number(n[1]);var i=n[2]!==undefined?n[2]:null;return Mo.fromWebStorageEntry(new Co(i),r,t)};e.prototype.fromWebStorageQueryTargetMetadata=function(e,t){var n=this.queryTargetKeyRe.exec(e);d(n!==null,"Cannot parse query target key '"+e+"'");var r=Number(n[1]);return Po.fromWebStorageEntry(r,t)};e.prototype.fromWebStorageOnlineState=function(e){return Fo.fromWebStorageEntry(e)};e.prototype.handleMutationBatchEvent=function(e){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){if(e.user.uid!==this.currentUser.uid){c(Ao,"Ignoring mutation for non-active user "+e.user.uid);return[2]}return[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})};e.prototype.handleQueryTargetEvent=function(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)};e.prototype.handleClientStateEvent=function(e,t){var n=this;var r=this.getAllActiveQueryTargets();if(t){this.activeClients[e]=t}else{delete this.activeClients[e]}var i=this.getAllActiveQueryTargets();var o=[];var a=[];i.forEach(function(e){return B.__awaiter(n,void 0,void 0,function(){return B.__generator(this,function(t){if(!r.has(e)){o.push(e)}return[2]})})});r.forEach(function(e){return B.__awaiter(n,void 0,void 0,function(){return B.__generator(this,function(t){if(!i.has(e)){a.push(e)}return[2]})})});return this.syncEngine.applyActiveTargetsChange(o,a)};e.prototype.handleOnlineStateEvent=function(e){if(this.activeClients[e.clientId]){this.onlineStateHandler(e.onlineState)}};return e}();function Vo(e){var t=ce.INVALID;if(e!=null){try{var n=JSON.parse(e);d(typeof n==="number","Found non-numeric sequence number");t=n}catch(e){l(Ao,"Failed to read sequence number from WebStorage",e)}}return t}var Bo=function(){function e(){this.localState=new qo;this.queryState={};this.syncEngine=null;this.onlineStateHandler=null;this.sequenceNumberHandler=null}e.prototype.addPendingMutation=function(e){};e.prototype.updateMutationState=function(e,t,n){};e.prototype.addLocalQueryTarget=function(e){this.localState.addQueryTarget(e);return this.queryState[e]||"not-current"};e.prototype.updateQueryState=function(e,t,n){this.queryState[e]=t};e.prototype.removeLocalQueryTarget=function(e){this.localState.removeQueryTarget(e)};e.prototype.isLocalQueryTarget=function(e){return this.localState.activeTargetIds.has(e)};e.prototype.clearQueryState=function(e){delete this.queryState[e]};e.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds};e.prototype.isActiveQueryTarget=function(e){return this.localState.activeTargetIds.has(e)};e.prototype.start=function(){this.localState=new qo;return Promise.resolve()};e.prototype.handleUserChange=function(e,t,n){};e.prototype.setOnlineState=function(e){};e.prototype.shutdown=function(){};e.prototype.writeSequenceNumber=function(e){};return e}();var jo="FirestoreClient";var Qo=11;var zo=20;var Ko=22;var Wo=function(){function e(e,t){this.cacheSizeBytes=e;this.synchronizeTabs=t}e.prototype.lruParams=function(){return On.withCacheSize(this.cacheSizeBytes)};return e}();var Go=function(){function e(){}return e}();var Ho=function(){function e(e,t,n,r){this.platform=e;this.databaseInfo=t;this.credentials=n;this.asyncQueue=r;this.clientId=X.newId();this._clientShutdown=false}e.prototype.start=function(e){var t=this;this.verifyNotShutdown();var n=new ye;var r=new ye;var i=false;this.credentials.setChangeListener(function(o){if(!i){i=true;t.initializePersistence(e,r,o).then(function(e){return t.initializeRest(o,e)}).then(n.resolve,n.reject)}else{t.asyncQueue.enqueueAndForget(function(){return t.handleCredentialChange(o)})}});this.asyncQueue.enqueueAndForget(function(){return n.promise});return r.promise};e.prototype.enableNetwork=function(){var e=this;this.verifyNotShutdown();return this.asyncQueue.enqueue(function(){return e.syncEngine.enableNetwork()})};e.prototype.initializePersistence=function(e,t,n){var r=this;if(e instanceof Wo){return this.startIndexedDbPersistence(n,e).then(function(e){t.resolve();return e}).catch(function(e){t.reject(e);if(!r.canFallback(e)){throw e}console.warn("Error enabling offline persistence. Falling back to"+" persistence disabled: "+e);return r.startMemoryPersistence()})}else{t.resolve();return this.startMemoryPersistence()}};e.prototype.canFallback=function(e){if(e instanceof v){return e.code===y.FAILED_PRECONDITION||e.code===y.UNIMPLEMENTED}else if(typeof DOMException!=="undefined"&&e instanceof DOMException){return e.code===Ko||e.code===zo||e.code===Qo}return true};e.prototype.verifyNotShutdown=function(){if(this._clientShutdown){throw new v(y.FAILED_PRECONDITION,"The client has already been shutdown.")}};e.prototype.startIndexedDbPersistence=function(e,t){var n=this;var r=Wn.buildStoragePrefix(this.databaseInfo);var i=new ho(this.databaseInfo.databaseId,{useProto3Json:true});return Promise.resolve().then(function(){return B.__awaiter(n,void 0,void 0,function(){var n,o;return B.__generator(this,function(a){switch(a.label){case 0:if(t.synchronizeTabs&&!Uo.isAvailable(this.platform)){throw new v(y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.")}o=t.lruParams();if(!t.synchronizeTabs)return[3,2];this.sharedClientState=new Uo(this.asyncQueue,this.platform,r,this.clientId,e);return[4,Wn.createMultiClientIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o,{sequenceNumberSyncer:this.sharedClientState})];case 1:n=a.sent();return[3,4];case 2:this.sharedClientState=new Bo;return[4,Wn.createIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o)];case 3:n=a.sent();a.label=4;case 4:this.persistence=n;return[2,n.referenceDelegate.garbageCollector]}})})})};e.prototype.startMemoryPersistence=function(){this.persistence=Br.createEagerPersistence(this.clientId);this.sharedClientState=new Bo;return Promise.resolve(null)};e.prototype.initializeRest=function(e,t){var n=this;c(jo,"Initializing. user=",e.uid);return this.platform.loadConnection(this.databaseInfo).then(function(r){return B.__awaiter(n,void 0,void 0,function(){var n,i,o,a,s;var u=this;return B.__generator(this,function(c){switch(c.label){case 0:this.localStore=new Mr(this.persistence,e);if(t){this.lruScheduler=new Mn(t,this.asyncQueue,this.localStore)}n=this.platform.newConnectivityMonitor();i=this.platform.newSerializer(this.databaseInfo.databaseId);o=new ui(this.asyncQueue,r,this.credentials,i);a=function(e){return u.syncEngine.applyOnlineStateChange(e,fi.RemoteStore)};s=function(e){return u.syncEngine.applyOnlineStateChange(e,fi.SharedClientState)};this.remoteStore=new Vi(this.localStore,o,this.asyncQueue,a,n);this.syncEngine=new Do(this.localStore,this.remoteStore,this.sharedClientState,e);this.sharedClientState.onlineStateHandler=s;this.remoteStore.syncEngine=this.syncEngine;this.sharedClientState.syncEngine=this.syncEngine;this.eventMgr=new mo(this.syncEngine);return[4,this.sharedClientState.start()];case 1:c.sent();return[4,this.remoteStore.start()];case 2:c.sent();return[4,this.persistence.setPrimaryStateListener(function(e){return B.__awaiter(u,void 0,void 0,function(){return B.__generator(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:t.sent();if(this.lruScheduler){if(e&&!this.lruScheduler.started){this.lruScheduler.start()}else if(!e){this.lruScheduler.stop()}}return[2]}})})})];case 3:c.sent();return[4,this.persistence.setDatabaseDeletedListener(function(){return B.__awaiter(u,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:return[4,this.shutdown()];case 1:e.sent();return[2]}})})})];case 4:c.sent();return[2]}})})})};e.prototype.handleCredentialChange=function(e){this.asyncQueue.verifyOperationInProgress();c(jo,"Credential Changed. Current user: "+e.uid);return this.syncEngine.handleCredentialChange(e)};e.prototype.disableNetwork=function(){var e=this;this.verifyNotShutdown();return this.asyncQueue.enqueue(function(){return e.syncEngine.disableNetwork()})};e.prototype.shutdown=function(){var e=this;return this.asyncQueue.enqueue(function(){return B.__awaiter(e,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:if(!!this._clientShutdown)return[3,4];if(this.lruScheduler){this.lruScheduler.stop()}return[4,this.remoteStore.shutdown()];case 1:e.sent();return[4,this.sharedClientState.shutdown()];case 2:e.sent();return[4,this.persistence.shutdown()];case 3:e.sent();this.credentials.removeChangeListener();this._clientShutdown=true;e.label=4;case 4:return[2]}})})})};e.prototype.listen=function(e,t,n){var r=this;this.verifyNotShutdown();var i=new yo(e,t,n);this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)});return i};e.prototype.unlisten=function(e){var t=this;this.verifyNotShutdown();this.asyncQueue.enqueueAndForget(function(){return t.eventMgr.unlisten(e)})};e.prototype.getDocumentFromLocalCache=function(e){var t=this;this.verifyNotShutdown();return this.asyncQueue.enqueue(function(){return t.localStore.readDocument(e)}).then(function(e){if(e instanceof _t){return e}else if(e instanceof Dt){return null}else{throw new v(y.UNAVAILABLE,"Failed to get document from cache. (However, this document may "+"exist on the server. Run again without setting 'source' in "+"the GetOptions to attempt to retrieve the document from the "+"server.)")}})};e.prototype.getDocumentsFromLocalCache=function(e){var t=this;this.verifyNotShutdown();return this.asyncQueue.enqueue(function(){return t.localStore.executeQuery(e)}).then(function(t){var n=ze();var r=new wo(e,n);var i=r.computeDocChanges(t);return r.applyChanges(i,false).snapshot})};e.prototype.write=function(e){var t=this;this.verifyNotShutdown();var n=new ye;this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.write(e,n)});return n.promise};e.prototype.databaseId=function(){return this.databaseInfo.databaseId};Object.defineProperty(e.prototype,"clientShutdown",{get:function(){return this._clientShutdown},enumerable:true,configurable:true});e.prototype.transaction=function(e){var t=this;this.verifyNotShutdown();return this.asyncQueue.enqueue(function(){return B.__awaiter(t,void 0,void 0,function(){return B.__generator(this,function(e){return[2]})})}).then(function(){return t.syncEngine.runTransaction(e)})};return e}();var Yo=function(){function e(e){this.observer=e;this.muted=false}e.prototype.next=function(e){this.scheduleEvent(this.observer.next,e)};e.prototype.error=function(e){this.scheduleEvent(this.observer.error,e)};e.prototype.mute=function(){this.muted=true};e.prototype.scheduleEvent=function(e,t){var n=this;if(!this.muted){setTimeout(function(){if(!n.muted){e(t)}},0)}};return e}();var $o=function(){function e(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}k("FieldPath",e,"fieldNames",1);for(var n=0;n<e.length;++n){O("FieldPath","string",n,e[n]);if(e[n].length===0){throw new v(y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). "+"Field names must not be empty.")}}this._internalPath=new pe(e)}e.documentId=function(){return e._DOCUMENT_ID};e.prototype.isEqual=function(t){if(!(t instanceof e)){throw H("isEqual","FieldPath",1,t)}return this._internalPath.isEqual(t._internalPath)};e._DOCUMENT_ID=new e(pe.keyField().canonicalString());return e}();var Xo=new RegExp("[~\\*/\\[\\]]");function Jo(e){var t=e.search(Xo);if(t>=0){throw new v(y.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain "+"'~', '*', '/', '[', or ']'")}try{return new($o.bind.apply($o,[void 0].concat(e.split("."))))}catch(t){throw new v(y.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, "+"begin with '.', end with '.', or contain '..'")}}var Zo=function(){function e(e,t){this.user=t;this.type="OAuth";this.authHeaders={Authorization:"Bearer "+e}}return e}();var ea=function(){function e(){this.changeListener=null}e.prototype.getToken=function(){return Promise.resolve(null)};e.prototype.invalidateToken=function(){};e.prototype.setChangeListener=function(e){d(!this.changeListener,"Can only call setChangeListener() once.");this.changeListener=e;e(Co.UNAUTHENTICATED)};e.prototype.removeChangeListener=function(){d(this.changeListener!==null,"removeChangeListener() when no listener registered");this.changeListener=null};return e}();var ta=function(){function e(e){var t=this;this.app=e;this.tokenListener=null;this.tokenCounter=0;this.changeListener=null;this.forceRefresh=false;this.tokenListener=function(){t.tokenCounter++;t.currentUser=t.getUser();if(t.changeListener){t.changeListener(t.currentUser)}};this.tokenCounter=0;this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}e.prototype.getToken=function(){var e=this;d(this.tokenListener!=null,"getToken cannot be called after listener removed.");var t=this.tokenCounter;var n=this.forceRefresh;this.forceRefresh=false;return this.app.INTERNAL.getToken(n).then(function(n){if(e.tokenCounter!==t){throw new v(y.ABORTED,"getToken aborted due to token change.")}else{if(n){d(typeof n.accessToken==="string","Invalid tokenData returned from getToken():"+n);return new Zo(n.accessToken,e.currentUser)}else{return null}}})};e.prototype.invalidateToken=function(){this.forceRefresh=true};e.prototype.setChangeListener=function(e){d(!this.changeListener,"Can only call setChangeListener() once.");this.changeListener=e;if(this.currentUser){e(this.currentUser)}};e.prototype.removeChangeListener=function(){d(this.tokenListener!=null,"removeChangeListener() called twice");d(this.changeListener!==null,"removeChangeListener() called when no listener registered");this.app.INTERNAL.removeAuthTokenListener(this.tokenListener);this.tokenListener=null;this.changeListener=null};e.prototype.getUser=function(){var e=this.app.INTERNAL.getUid();d(e===null||typeof e==="string","Received invalid UID: "+e);return new Co(e)};return e}();var na=function(){function e(e,t){this.gapi=e;this.sessionIndex=t;this.type="FirstParty";this.user=Co.FIRST_PARTY}Object.defineProperty(e.prototype,"authHeaders",{get:function(){var e={"X-Goog-AuthUser":this.sessionIndex};var t=this.gapi.auth.getAuthHeaderValueForFirstParty([]);if(t){e["Authorization"]=t}return e},enumerable:true,configurable:true});return e}();var ra=function(){function e(e,t){this.gapi=e;this.sessionIndex=t}e.prototype.getToken=function(){return Promise.resolve(new na(this.gapi,this.sessionIndex))};e.prototype.setChangeListener=function(e){e(Co.FIRST_PARTY)};e.prototype.removeChangeListener=function(){};e.prototype.invalidateToken=function(){};return e}();function ia(e){if(!e){return new ea}switch(e.type){case"gapi":var t=e.client;d(!!(typeof t==="object"&&t!==null&&t["auth"]&&t["auth"]["getAuthHeaderValueForFirstParty"]),"unexpected gapi interface");return new ra(t,e.sessionIndex||"0");case"provider":return e.client;default:throw new v(y.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}function oa(e){return aa(e,["next","error","complete"])}function aa(e,t){if(typeof e!=="object"||e===null){return false}var n=e;for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o in n&&typeof n[o]==="function"){return true}}return false}var sa=function(){function e(e){this._methodName=e}e.delete=function(){D("FieldValue.delete",arguments);return ua.instance};e.serverTimestamp=function(){D("FieldValue.serverTimestamp",arguments);return ca.instance};e.arrayUnion=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}A("FieldValue.arrayUnion",arguments,1);return new la(e)};e.arrayRemove=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}A("FieldValue.arrayRemove",arguments,1);return new fa(e)};e.increment=function(e){O("FieldValue.increment","number",1,e);C("FieldValue.increment",arguments,1);return new ha(e)};e.prototype.isEqual=function(e){return this===e};return e}();var ua=function(e){B.__extends(t,e);function t(){return e.call(this,"FieldValue.delete")||this}t.instance=new t;return t}(sa);var ca=function(e){B.__extends(t,e);function t(){return e.call(this,"FieldValue.serverTimestamp")||this}t.instance=new t;return t}(sa);var la=function(e){B.__extends(t,e);function t(t){var n=e.call(this,"FieldValue.arrayUnion")||this;n._elements=t;return n}return t}(sa);var fa=function(e){B.__extends(t,e);function t(t){var n=e.call(this,"FieldValue.arrayRemove")||this;n._elements=t;return n}return t}(sa);var ha=function(e){B.__extends(t,e);function t(t){var n=e.call(this,"FieldValue.increment")||this;n._operand=t;return n}return t}(sa);var da=g(sa,"Use FieldValue.<field>() instead.");var pa=/^__.*__$/;var ma=function(){function e(e,t,n){this.data=e;this.fieldMask=t;this.fieldTransforms=n}e.prototype.toMutations=function(e,t){var n=[];if(this.fieldMask!==null){n.push(new Cr(e,this.data,this.fieldMask,t))}else{n.push(new Dr(e,this.data,t))}if(this.fieldTransforms.length>0){n.push(new Ar(e,this.fieldTransforms))}return n};return e}();var ya=function(){function e(e,t,n){this.data=e;this.fieldMask=t;this.fieldTransforms=n}e.prototype.toMutations=function(e,t){var n=[new Cr(e,this.data,this.fieldMask,t)];if(this.fieldTransforms.length>0){n.push(new Ar(e,this.fieldTransforms))}return n};return e}();var va;(function(e){e[e["Set"]=0]="Set";e[e["Update"]=1]="Update";e[e["MergeSet"]=2]="MergeSet";e[e["Argument"]=3]="Argument"})(va||(va={}));function ga(e){switch(e){case va.Set:case va.MergeSet:case va.Update:return true;case va.Argument:return false;default:throw h("Unexpected case for UserDataSource: "+e)}}var ba=function(){function e(e,t,n,r,i,o){this.dataSource=e;this.methodName=t;this.path=n;this.arrayElement=r;if(i===undefined){this.validatePath()}this.arrayElement=r!==undefined?r:false;this.fieldTransforms=i||[];this.fieldMask=o||[]}e.prototype.childContextForField=function(t){var n=this.path==null?null:this.path.child(t);var r=new e(this.dataSource,this.methodName,n,false,this.fieldTransforms,this.fieldMask);r.validatePathSegment(t);return r};e.prototype.childContextForFieldPath=function(t){var n=this.path==null?null:this.path.child(t);var r=new e(this.dataSource,this.methodName,n,false,this.fieldTransforms,this.fieldMask);r.validatePath();return r};e.prototype.childContextForArray=function(t){return new e(this.dataSource,this.methodName,null,true,this.fieldTransforms,this.fieldMask)};e.prototype.createError=function(e){var t=this.path===null||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new v(y.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+e+t)};e.prototype.contains=function(e){return this.fieldMask.find(function(t){return e.isPrefixOf(t)})!==undefined||this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})!==undefined};e.prototype.validatePath=function(){if(this.path===null){return}for(var e=0;e<this.path.length;e++){this.validatePathSegment(this.path.get(e))}};e.prototype.validatePathSegment=function(e){if(ga(this.dataSource)&&pa.test(e)){throw this.createError("Document fields cannot begin and end with __")}};return e}();var wa=function(){function e(e,t){this.databaseId=e;this.key=t}return e}();var Ea=function(){function e(e){this.preConverter=e}e.prototype.parseSetData=function(e,t){var n=new ba(va.Set,e,pe.EMPTY_PATH);Ta("Data must be an object, but it was:",n,t);var r=this.parseData(t,n);return new ma(r,null,n.fieldTransforms)};e.prototype.parseMergeData=function(e,t,n){var r=new ba(va.MergeSet,e,pe.EMPTY_PATH);Ta("Data must be an object, but it was:",r,t);var i=this.parseData(t,r);var o;var a;if(!n){o=wr.fromArray(r.fieldMask);a=r.fieldTransforms}else{var s=new Me(pe.comparator);for(var u=0,c=n;u<c.length;u++){var l=c[u];var f=void 0;if(l instanceof $o){f=l._internalPath}else if(typeof l==="string"){f=_a(e,l)}else{throw h("Expected stringOrFieldPath to be a string or a FieldPath")}if(!r.contains(f)){throw new v(y.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.")}s=s.add(f)}o=wr.fromSet(s);a=r.fieldTransforms.filter(function(e){return o.covers(e.field)})}return new ma(i,o,a)};e.prototype.parseUpdateData=function(e,t){var n=this;var r=new ba(va.Update,e,pe.EMPTY_PATH);Ta("Data must be an object, but it was:",r,t);var i=new Me(pe.comparator);var o=gr.EMPTY;T(t,function(t,a){var s=_a(e,t);var u=r.childContextForFieldPath(s);a=n.runPreConverter(a,u);if(a instanceof ua){i=i.add(s)}else{var c=n.parseData(a,u);if(c!=null){i=i.add(s);o=o.set(s,c)}}});var a=wr.fromSet(i);return new ya(o,a,r.fieldTransforms)};e.prototype.parseUpdateVarargs=function(e,t,n,r){var i=new ba(va.Update,e,pe.EMPTY_PATH);var o=[Ia(e,t)];var a=[n];if(r.length%2!==0){throw new v(y.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number "+"of arguments that alternate between field names and values.")}for(var s=0;s<r.length;s+=2){o.push(Ia(e,r[s]));a.push(r[s+1])}var u=new Me(pe.comparator);var c=gr.EMPTY;for(var s=0;s<o.length;++s){var l=o[s];var f=i.childContextForFieldPath(l);var h=this.runPreConverter(a[s],f);if(h instanceof ua){u=u.add(l)}else{var d=this.parseData(h,f);if(d!=null){u=u.add(l);c=c.set(l,d)}}}var p=wr.fromSet(u);return new ya(c,p,i.fieldTransforms)};e.prototype.parseQueryValue=function(e,t){var n=new ba(va.Argument,e,pe.EMPTY_PATH);var r=this.parseData(t,n);d(r!=null,"Parsed data should not be null.");d(n.fieldTransforms.length===0,"Field transforms should have been disallowed.");return r};e.prototype.runPreConverter=function(e,t){try{return this.preConverter(e)}catch(e){var n=Da(e);throw t.createError(n)}};e.prototype.parseData=function(e,t){e=this.runPreConverter(e,t);if(Sa(e)){Ta("Unsupported field value:",t,e);return this.parseObject(e,t)}else if(e instanceof sa){this.parseSentinelFieldValue(e,t);return null}else{if(t.path){t.fieldMask.push(t.path)}if(e instanceof Array){if(t.arrayElement){throw t.createError("Nested arrays are not supported")}return this.parseArray(e,t)}else{return this.parseScalarValue(e,t)}}};e.prototype.parseObject=function(e,t){var n=this;var r=new ke(J);if(I(e)){if(t.path&&t.path.length>0){t.fieldMask.push(t.path)}}else{T(e,function(e,i){var o=n.parseData(i,t.childContextForField(e));if(o!=null){r=r.insert(e,o)}})}return new gr(r)};e.prototype.parseArray=function(e,t){var n=[];var r=0;for(var i=0,o=e;i<o.length;i++){var a=o[i];var s=this.parseData(a,t.childContextForArray(r));if(s==null){s=or.INSTANCE}n.push(s);r++}return new br(n)};e.prototype.parseSentinelFieldValue=function(e,t){if(!ga(t.dataSource)){throw t.createError(e._methodName+"() can only be used with update() and set()")}if(t.path===null){throw t.createError(e._methodName+"() is not currently supported inside arrays")}if(e instanceof ua){if(t.dataSource===va.MergeSet){t.fieldMask.push(t.path)}else if(t.dataSource===va.Update){d(t.path.length>0,"FieldValue.delete() at the top level should have already"+" been handled.");throw t.createError("FieldValue.delete() can only appear at the top level "+"of your update data")}else{throw t.createError("FieldValue.delete() cannot be used with set() unless you pass "+"{merge:true}")}}else if(e instanceof ca){t.fieldTransforms.push(new Er(t.path,to.instance))}else if(e instanceof la){var n=this.parseArrayTransformElements(e._methodName,e._elements);var r=new no(n);t.fieldTransforms.push(new Er(t.path,r))}else if(e instanceof fa){var n=this.parseArrayTransformElements(e._methodName,e._elements);var i=new ro(n);t.fieldTransforms.push(new Er(t.path,i))}else if(e instanceof ha){var o=this.parseQueryValue("FieldValue.increment",e._operand);var a=new io(o);t.fieldTransforms.push(new Er(t.path,a))}else{h("Unknown FieldValue type: "+e)}};e.prototype.parseScalarValue=function(e,t){if(e===null){return or.INSTANCE}else if(typeof e==="number"){if($r(e)){return new lr(e)}else{return new fr(e)}}else if(typeof e==="boolean"){return ar.of(e)}else if(typeof e==="string"){return new hr(e)}else if(e instanceof Date){return new dr(Ae.fromDate(e))}else if(e instanceof Ae){return new dr(new Ae(e.seconds,Math.floor(e.nanoseconds/1e3)*1e3))}else if(e instanceof Bi){return new vr(e)}else if(e instanceof ie){return new mr(e)}else if(e instanceof wa){return new yr(e.databaseId,e.key)}else{throw t.createError("Unsupported field value: "+z(e))}};e.prototype.parseArrayTransformElements=function(e,t){var n=this;return t.map(function(t,r){var i=new ba(va.Argument,e,pe.EMPTY_PATH);return n.parseData(t,i.childContextForArray(r))})};return e}();function Sa(e){return typeof e==="object"&&e!==null&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof Ae)&&!(e instanceof Bi)&&!(e instanceof ie)&&!(e instanceof wa)&&!(e instanceof sa)}function Ta(e,t,n){if(!Sa(n)||!Q(n)){var r=z(n);if(r==="an object"){throw t.createError(e+" a custom object")}else{throw t.createError(e+" "+r)}}}function Ia(e,t){if(t instanceof $o){return t._internalPath}else if(typeof t==="string"){return _a(e,t)}else{var n="Field path arguments must be of type string or FieldPath.";throw new v(y.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function _a(e,t){try{return Jo(t)._internalPath}catch(t){var n=Da(t);throw new v(y.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function Da(e){return e instanceof Error?e.message:e.toString()}var Ca="firestore.googleapis.com";var Aa=true;var Na=true;var ka=false;var Oa=On.COLLECTION_DISABLED;var xa=false;var Ra=function(){function e(e){if(e.host===undefined){if(e.ssl!==undefined){throw new v(y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set")}this.host=Ca;this.ssl=Aa}else{R("settings","non-empty string","host",e.host);this.host=e.host;M("settings","boolean","ssl",e.ssl);this.ssl=w(e.ssl,Aa)}G("settings",e,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]);M("settings","object","credentials",e.credentials);this.credentials=e.credentials;M("settings","boolean","timestampsInSnapshots",e.timestampsInSnapshots);if(e.timestampsInSnapshots===true){l("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now.")}else if(e.timestampsInSnapshots===false){l("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior.")}this.timestampsInSnapshots=w(e.timestampsInSnapshots,Na);M("settings","number","cacheSizeBytes",e.cacheSizeBytes);if(e.cacheSizeBytes===undefined){this.cacheSizeBytes=On.DEFAULT_CACHE_SIZE_BYTES}else{if(e.cacheSizeBytes!==Oa&&e.cacheSizeBytes<On.MINIMUM_CACHE_SIZE_BYTES){throw new v(y.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+On.MINIMUM_CACHE_SIZE_BYTES)}else{this.cacheSizeBytes=e.cacheSizeBytes}}M("settings","boolean","experimentalForceLongPolling",e.experimentalForceLongPolling);this.forceLongPolling=e.experimentalForceLongPolling===undefined?ka:e.experimentalForceLongPolling}e.prototype.isEqual=function(e){return this.host===e.host&&this.ssl===e.ssl&&this.timestampsInSnapshots===e.timestampsInSnapshots&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.forceLongPolling===e.forceLongPolling};return e}();var Ma=function(){function e(){}return e}();var Pa=function(){function e(t){var n=this;this._queue=new be;this.INTERNAL={delete:function(){return B.__awaiter(n,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:this.ensureClientConfigured();return[4,this._firestoreClient.shutdown()];case 1:e.sent();return[2]}})})}};var r=new Ma;if(typeof t.options==="object"){var i=t;r.firebaseApp=i;r.databaseId=e.databaseIdFromApp(i);r.persistenceKey=r.firebaseApp.name;r.credentials=new ta(i)}else{var o=t;if(!o.projectId){throw new v(y.INVALID_ARGUMENT,"Must provide projectId")}r.databaseId=new ue(o.projectId,o.database);r.persistenceKey="[DEFAULT]";r.credentials=new ea}r.settings=new Ra({});this._config=r;this._databaseId=r.databaseId}e.prototype.settings=function(e){C("Firestore.settings",arguments,1);O("Firestore.settings","object",1,e);if(b(e,"persistence")){throw new v(y.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to '+"firestore.enablePersistence().")}var t=new Ra(e);if(this._firestoreClient&&!this._config.settings.isEqual(t)){throw new v(y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer "+"be changed. You can only call settings() before calling any other "+"methods on a Firestore object.")}this._config.settings=t;if(t.credentials!==undefined){this._config.credentials=ia(t.credentials)}};e.prototype.enableNetwork=function(){this.ensureClientConfigured();return this._firestoreClient.enableNetwork()};e.prototype.disableNetwork=function(){this.ensureClientConfigured();return this._firestoreClient.disableNetwork()};e.prototype.enablePersistence=function(e){if(this._firestoreClient){throw new v(y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer "+"be enabled. You can only call enablePersistence() before calling "+"any other methods on a Firestore object.")}var t=false;if(e){if(e.experimentalTabSynchronization!==undefined){l("The 'experimentalTabSynchronization' setting has been renamed to "+"'synchronizeTabs'. In a future release, the setting will be removed "+"and it is recommended that you update your "+"firestore.enablePersistence() call to use 'synchronizeTabs'.")}t=w(e.synchronizeTabs!==undefined?e.synchronizeTabs:e.experimentalTabSynchronization,xa)}return this.configureClient(new Wo(this._config.settings.cacheSizeBytes,t))};e.prototype.clearPersistence=function(){var e=this;var t=Wn.buildStoragePrefix(this.makeDatabaseInfo());var n=new ye;this._queue.enqueueAndForget(function(){return B.__awaiter(e,void 0,void 0,function(){var e;return B.__generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);if(this._firestoreClient!==undefined&&!this._firestoreClient.clientShutdown){throw new v(y.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.")}return[4,Wn.clearPersistence(t)];case 1:r.sent();n.resolve();return[3,3];case 2:e=r.sent();n.reject(e);return[3,3];case 3:return[2]}})})});return n.promise};e.prototype.ensureClientConfigured=function(){if(!this._firestoreClient){this.configureClient(new Go)}return this._firestoreClient};e.prototype.makeDatabaseInfo=function(){return new ae(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl,this._config.settings.forceLongPolling)};e.prototype.configureClient=function(e){var t=this;d(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey");d(!this._firestoreClient,"configureClient() called multiple times");var n=this.makeDatabaseInfo();var r=function(e){if(e instanceof qa){var n=t._config.databaseId;var r=e.firestore._config.databaseId;if(!r.isEqual(n)){throw new v(y.INVALID_ARGUMENT,"Document reference is for database "+(r.projectId+"/"+r.database+" but should be ")+("for database "+n.projectId+"/"+n.database))}return new wa(t._config.databaseId,e._key)}else{return e}};this._dataConverter=new Ea(r);this._firestoreClient=new Ho(p.getPlatform(),n,this._config.credentials,this._queue);return this._firestoreClient.start(e)};e.databaseIdFromApp=function(e){var t=e.options;if(!b(t,"projectId")){throw new v(y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')}var n=t["projectId"];if(!n||typeof n!=="string"){throw new v(y.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options")}return new ue(n)};Object.defineProperty(e.prototype,"app",{get:function(){if(!this._config.firebaseApp){throw new v(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is "+"not available")}return this._config.firebaseApp},enumerable:true,configurable:true});e.prototype.collection=function(e){C("Firestore.collection",arguments,1);O("Firestore.collection","non-empty string",1,e);this.ensureClientConfigured();return new Wa(he.fromString(e),this)};e.prototype.doc=function(e){C("Firestore.doc",arguments,1);O("Firestore.doc","non-empty string",1,e);this.ensureClientConfigured();return qa.forPath(he.fromString(e),this)};e.prototype.collectionGroup=function(e){C("Firestore.collectionGroup",arguments,1);O("Firestore.collectionGroup","non-empty string",1,e);if(e.indexOf("/")>=0){throw new v(y.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function "+"Firestore.collectionGroup(). Collection IDs must not contain '/'.")}this.ensureClientConfigured();return new ja(new ji(he.EMPTY_PATH,e),this)};e.prototype.runTransaction=function(e){var t=this;C("Firestore.runTransaction",arguments,1);O("Firestore.runTransaction","function",1,e);return this.ensureClientConfigured().transaction(function(n){return e(new La(t,n))})};e.prototype.batch=function(){this.ensureClientConfigured();return new Fa(this)};Object.defineProperty(e,"logLevel",{get:function(){switch(s()){case a.DEBUG:return"debug";case a.ERROR:return"error";case a.SILENT:return"silent";default:return h("Unknown log level: "+s())}},enumerable:true,configurable:true});e.setLogLevel=function(e){C("Firestore.setLogLevel",arguments,1);O("Firestore.setLogLevel","non-empty string",1,e);switch(e){case"debug":u(a.DEBUG);break;case"error":u(a.ERROR);break;case"silent":u(a.SILENT);break;default:throw new v(y.INVALID_ARGUMENT,"Invalid log level: "+e)}};e.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots};return e}();var La=function(){function e(e,t){this._firestore=e;this._transaction=t}e.prototype.get=function(e){var t=this;C("Transaction.get",arguments,1);var n=$a("Transaction.get",e,this._firestore);return this._transaction.lookup([n._key]).then(function(e){if(!e||e.length!==1){return h("Mismatch in docs returned from document lookup.")}var r=e[0];if(r instanceof Dt){return new Va(t._firestore,n._key,null,false,false)}else if(r instanceof _t){return new Va(t._firestore,n._key,r,false,false)}else{throw h("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)}})};e.prototype.set=function(e,t,n){N("Transaction.set",arguments,2,3);var r=$a("Transaction.set",e,this._firestore);n=Ga("Transaction.set",n);var i=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",t,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",t);this._transaction.set(r._key,i);return this};e.prototype.update=function(e,t,n){var r=[];for(var i=3;i<arguments.length;i++){r[i-3]=arguments[i]}var o;var a;if(typeof t==="string"||t instanceof $o){A("Transaction.update",arguments,3);o=$a("Transaction.update",e,this._firestore);a=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",t,n,r)}else{C("Transaction.update",arguments,2);o=$a("Transaction.update",e,this._firestore);a=this._firestore._dataConverter.parseUpdateData("Transaction.update",t)}this._transaction.update(o._key,a);return this};e.prototype.delete=function(e){C("Transaction.delete",arguments,1);var t=$a("Transaction.delete",e,this._firestore);this._transaction.delete(t._key);return this};return e}();var Fa=function(){function e(e){this._firestore=e;this._mutations=[];this._committed=false}e.prototype.set=function(e,t,n){N("WriteBatch.set",arguments,2,3);this.verifyNotCommitted();var r=$a("WriteBatch.set",e,this._firestore);n=Ga("WriteBatch.set",n);var i=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",t,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",t);this._mutations=this._mutations.concat(i.toMutations(r._key,Ir.NONE));return this};e.prototype.update=function(e,t,n){var r=[];for(var i=3;i<arguments.length;i++){r[i-3]=arguments[i]}this.verifyNotCommitted();var o;var a;if(typeof t==="string"||t instanceof $o){A("WriteBatch.update",arguments,3);o=$a("WriteBatch.update",e,this._firestore);a=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",t,n,r)}else{C("WriteBatch.update",arguments,2);o=$a("WriteBatch.update",e,this._firestore);a=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",t)}this._mutations=this._mutations.concat(a.toMutations(o._key,Ir.exists(true)));return this};e.prototype.delete=function(e){C("WriteBatch.delete",arguments,1);this.verifyNotCommitted();var t=$a("WriteBatch.delete",e,this._firestore);this._mutations=this._mutations.concat(new Nr(t._key,Ir.NONE));return this};e.prototype.commit=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){this.verifyNotCommitted();this._committed=true;if(this._mutations.length>0){return[2,this._firestore.ensureClientConfigured().write(this._mutations)]}return[2]})})};e.prototype.verifyNotCommitted=function(){if(this._committed){throw new v(y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() "+"has been called.")}};return e}();var qa=function(){function e(e,t){this._key=e;this.firestore=t;this._firestoreClient=this.firestore.ensureClientConfigured()}e.forPath=function(t,n){if(t.length%2!==0){throw new v(y.INVALID_ARGUMENT,"Invalid document reference. Document "+"references must have an even number of segments, but "+(t.canonicalString()+" has "+t.length))}return new e(new me(t),n)};Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"parent",{get:function(){return new Wa(this._key.path.popLast(),this.firestore)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:true,configurable:true});e.prototype.collection=function(e){C("DocumentReference.collection",arguments,1);O("DocumentReference.collection","non-empty string",1,e);if(!e){throw new v(y.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()")}var t=he.fromString(e);return new Wa(this._key.path.child(t),this.firestore)};e.prototype.isEqual=function(t){if(!(t instanceof e)){throw H("isEqual","DocumentReference",1,t)}return this.firestore===t.firestore&&this._key.isEqual(t._key)};e.prototype.set=function(e,t){N("DocumentReference.set",arguments,1,2);t=Ga("DocumentReference.set",t);var n=t.merge||t.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",e,t.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",e);return this._firestoreClient.write(n.toMutations(this._key,Ir.NONE))};e.prototype.update=function(e,t){var n=[];for(var r=2;r<arguments.length;r++){n[r-2]=arguments[r]}var i;if(typeof e==="string"||e instanceof $o){A("DocumentReference.update",arguments,2);i=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",e,t,n)}else{C("DocumentReference.update",arguments,1);i=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",e)}return this._firestoreClient.write(i.toMutations(this._key,Ir.exists(true)))};e.prototype.delete=function(){C("DocumentReference.delete",arguments,0);return this._firestoreClient.write([new Nr(this._key,Ir.NONE)])};e.prototype.onSnapshot=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}N("DocumentReference.onSnapshot",arguments,1,4);var n={includeMetadataChanges:false};var r;var i=0;if(typeof e[i]==="object"&&!oa(e[i])){n=e[i];G("DocumentReference.onSnapshot",n,["includeMetadataChanges"]);M("DocumentReference.onSnapshot","boolean","includeMetadataChanges",n.includeMetadataChanges);i++}var o={includeMetadataChanges:n.includeMetadataChanges};if(oa(e[i])){r=e[i]}else{O("DocumentReference.onSnapshot","function",i,e[i]);x("DocumentReference.onSnapshot","function",i+1,e[i+1]);x("DocumentReference.onSnapshot","function",i+2,e[i+2]);r={next:e[i],error:e[i+1],complete:e[i+2]}}return this.onSnapshotInternal(o,r)};e.prototype.onSnapshotInternal=function(e,t){var n=this;var r=function(e){console.error("Uncaught Error in onSnapshot:",e)};if(t.error){r=t.error.bind(t)}var i=new Yo({next:function(e){if(t.next){d(e.docs.size<=1,"Too many documents returned on a document query");var r=e.docs.get(n._key);t.next(new Va(n.firestore,n._key,r,e.fromCache,e.hasPendingWrites))}},error:r});var o=this._firestoreClient.listen(ji.atPath(this._key.path),i,e);return function(){i.mute();n._firestoreClient.unlisten(o)}};e.prototype.get=function(e){var t=this;N("DocumentReference.get",arguments,0,1);Ya("DocumentReference.get",e);return new Promise(function(n,r){if(e&&e.source==="cache"){t.firestore.ensureClientConfigured().getDocumentFromLocalCache(t._key).then(function(e){n(new Va(t.firestore,t._key,e,true,e instanceof _t?e.hasLocalMutations:false))},r)}else{t.getViaSnapshotListener(n,r,e)}})};e.prototype.getViaSnapshotListener=function(e,t,n){var r=this.onSnapshotInternal({includeMetadataChanges:true,waitForSyncWhenOnline:true},{next:function(i){r();if(!i.exists&&i.metadata.fromCache){t(new v(y.UNAVAILABLE,"Failed to get document because the client is "+"offline."))}else if(i.exists&&i.metadata.fromCache&&n&&n.source==="server"){t(new v(y.UNAVAILABLE,"Failed to get document from server. (However, this "+"document does exist in the local cache. Run again "+'without setting source to "server" to '+"retrieve the cached document.)"))}else{e(i)}},error:t})};return e}();var Ua=function(){function e(e,t){this.hasPendingWrites=e;this.fromCache=t}e.prototype.isEqual=function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache};return e}();var Va=function(){function e(e,t,n,r,i){this._firestore=e;this._key=t;this._document=n;this._fromCache=r;this._hasPendingWrites=i}e.prototype.data=function(e){N("DocumentSnapshot.data",arguments,0,1);e=Ha("DocumentSnapshot.data",e);return!this._document?undefined:this.convertObject(this._document.data,rr.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))};e.prototype.get=function(e,t){N("DocumentSnapshot.get",arguments,1,2);t=Ha("DocumentSnapshot.get",t);if(this._document){var n=this._document.data.field(Ia("DocumentSnapshot.get",e));if(n!==undefined){return this.convertValue(n,rr.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}}return undefined};Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ref",{get:function(){return new qa(this._key,this._firestore)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"exists",{get:function(){return this._document!==null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"metadata",{get:function(){return new Ua(this._hasPendingWrites,this._fromCache)},enumerable:true,configurable:true});e.prototype.isEqual=function(t){if(!(t instanceof e)){throw H("isEqual","DocumentSnapshot",1,t)}return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(this._document===null?t._document===null:this._document.isEqual(t._document))};e.prototype.convertObject=function(e,t){var n=this;var r={};e.forEach(function(e,i){r[e]=n.convertValue(i,t)});return r};e.prototype.convertValue=function(e,t){if(e instanceof gr){return this.convertObject(e,t)}else if(e instanceof br){return this.convertArray(e,t)}else if(e instanceof yr){var n=e.value(t);var r=this._firestore.ensureClientConfigured().databaseId();if(!e.databaseId.isEqual(r)){l("Document "+this._key.path+" contains a document "+"reference within a different database ("+(e.databaseId.projectId+"/"+e.databaseId.database+") which is not ")+"supported. It will be treated as a reference in the current "+("database ("+r.projectId+"/"+r.database+") ")+"instead.")}return new qa(n,this._firestore)}else{return e.value(t)}};e.prototype.convertArray=function(e,t){var n=this;return e.internalValue.map(function(e){return n.convertValue(e,t)})};return e}();var Ba=function(e){B.__extends(t,e);function t(t,n,r,i,o){return e.call(this,t,n,r,i,o)||this}t.prototype.data=function(t){var n=e.prototype.data.call(this,t);d(typeof n==="object","Document in a QueryDocumentSnapshot should exist");return n};return t}(Va);var ja=function(){function e(e,t){this._query=e;this.firestore=t}e.prototype.where=function(t,n,r){C("Query.where",arguments,3);W("Query.where",3,r);if(n!=="in"&&n!=="array-contains-any"){var i=["<","<=","==",">=",">","array-contains"];U("Query.where",i,2,n)}var o;var a=Ia("Query.where",t);var s=zi.fromString(n);if(a.isKeyField()){if(s===zi.ARRAY_CONTAINS||s===zi.ARRAY_CONTAINS_ANY||s===zi.IN){throw new v(y.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+s.toString()+"' "+"queries on FieldPath.documentId().")}if(typeof r==="string"){if(r===""){throw new v(y.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a "+"valid document ID if the first parameter is "+"FieldPath.documentId(), but it was an empty string.")}if(!this._query.isCollectionGroupQuery()&&r.indexOf("/")!==-1){throw new v(y.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection by "+"FieldPath.documentId(), the value provided must be a plain document ID, but "+("'"+r+"' contains a slash."))}var u=this._query.path.child(he.fromString(r));if(!me.isDocumentKey(u)){throw new v(y.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection group by "+"FieldPath.documentId(), the value provided must result in a valid document path, "+("but '"+u+"' is not because it has an odd number of segments ("+u.length+")."))}o=new yr(this.firestore._databaseId,new me(u))}else if(r instanceof qa){var c=r;o=new yr(this.firestore._databaseId,c._key)}else{throw new v(y.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a "+"string or a DocumentReference if the first parameter is "+"FieldPath.documentId(), but it was: "+(z(r)+"."))}}else{if(s===zi.IN||s===zi.ARRAY_CONTAINS_ANY){if(!Array.isArray(r)||r.length===0){throw new v(y.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for "+("'"+s.toString()+"' filters."))}if(r.length>10){throw new v(y.INVALID_ARGUMENT,"Invalid Query. '"+s.toString()+"' filters support a "+"maximum of 10 elements in the value array.")}}o=this.firestore._dataConverter.parseQueryValue("Query.where",r)}var l=Qi.create(a,s,o);this.validateNewFilter(l);return new e(this._query.addFilter(l),this.firestore)};e.prototype.orderBy=function(t,n){N("Query.orderBy",arguments,1,2);x("Query.orderBy","non-empty string",2,n);var r;if(n===undefined||n==="asc"){r=$i.ASCENDING}else if(n==="desc"){r=$i.DESCENDING}else{throw new v(y.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', "+"expected 'asc' or 'desc'.")}if(this._query.startAt!==null){throw new v(y.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or "+"Query.startAfter() before calling Query.orderBy().")}if(this._query.endAt!==null){throw new v(y.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or "+"Query.endBefore() before calling Query.orderBy().")}var i=Ia("Query.orderBy",t);var o=new Ji(i,r);this.validateNewOrderBy(o);return new e(this._query.addOrderBy(o),this.firestore)};e.prototype.limit=function(t){C("Query.limit",arguments,1);O("Query.limit","number",1,t);if(t<=0){throw new v(y.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be "+"positive.")}return new e(this._query.withLimit(t),this.firestore)};e.prototype.startAt=function(t){var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}A("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",t,n,true);return new e(this._query.withStartAt(i),this.firestore)};e.prototype.startAfter=function(t){var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}A("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",t,n,false);return new e(this._query.withStartAt(i),this.firestore)};e.prototype.endBefore=function(t){var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}A("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",t,n,true);return new e(this._query.withEndAt(i),this.firestore)};e.prototype.endAt=function(t){var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}A("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",t,n,false);return new e(this._query.withEndAt(i),this.firestore)};e.prototype.isEqual=function(t){if(!(t instanceof e)){throw H("isEqual","Query",1,t)}return this.firestore===t.firestore&&this._query.isEqual(t._query)};e.prototype.boundFromDocOrFields=function(e,t,n,r){W(e,1,t);if(t instanceof Va){if(n.length>0){throw new v(y.INVALID_ARGUMENT,"Too many arguments provided to "+e+"().")}var i=t;if(!i.exists){throw new v(y.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+(e+"()."))}return this.boundFromDocument(e,i._document,r)}else{var o=[t].concat(n);return this.boundFromFields(e,o,r)}};e.prototype.boundFromDocument=function(e,t,n){var r=[];for(var i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField()){r.push(new yr(this.firestore._databaseId,t.key))}else{var s=t.field(a.field);if(s instanceof pr){throw new v(y.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a "+'document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of '+"this field is unknown, you cannot start/end a query with it.)")}else if(s!==undefined){r.push(s)}else{var u=a.field.canonicalString();throw new v(y.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a "+("document for which the field '"+u+"' (used as the ")+"orderBy) does not exist.")}}}return new Xi(r,n)};e.prototype.boundFromFields=function(e,t,n){var r=this._query.explicitOrderBy;if(t.length>r.length){throw new v(y.INVALID_ARGUMENT,"Too many arguments provided to "+e+"(). "+"The number of arguments must be less than or equal to the "+"number of Query.orderBy() clauses")}var i=[];for(var o=0;o<t.length;o++){var a=t[o];var s=r[o];if(s.field.isKeyField()){if(typeof a!=="string"){throw new v(y.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+(e+"(), but got a "+typeof a))}if(!this._query.isCollectionGroupQuery()&&a.indexOf("/")!==-1){throw new v(y.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), "+("the value passed to "+e+"() must be a plain document ID, but ")+("'"+a+"' contains a slash."))}var u=this._query.path.child(he.fromString(a));if(!me.isDocumentKey(u)){throw new v(y.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by "+("FieldPath.documentId(), the value passed to "+e+"() must result in a ")+("valid document path, but '"+u+"' is not because it contains an odd number ")+"of segments.")}var c=new me(u);i.push(new yr(this.firestore._databaseId,c))}else{var l=this.firestore._dataConverter.parseQueryValue(e,a);i.push(l)}}return new Xi(i,n)};e.prototype.onSnapshot=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}N("Query.onSnapshot",arguments,1,4);var n={};var r;var i=0;if(typeof e[i]==="object"&&!oa(e[i])){n=e[i];G("Query.onSnapshot",n,["includeMetadataChanges"]);M("Query.onSnapshot","boolean","includeMetadataChanges",n.includeMetadataChanges);i++}if(oa(e[i])){r=e[i]}else{O("Query.onSnapshot","function",i,e[i]);x("Query.onSnapshot","function",i+1,e[i+1]);x("Query.onSnapshot","function",i+2,e[i+2]);r={next:e[i],error:e[i+1],complete:e[i+2]}}return this.onSnapshotInternal(n,r)};e.prototype.onSnapshotInternal=function(e,t){var n=this;var r=function(e){console.error("Uncaught Error in onSnapshot:",e)};if(t.error){r=t.error.bind(t)}var i=new Yo({next:function(e){if(t.next){t.next(new Qa(n.firestore,n._query,e))}},error:r});var o=this.firestore.ensureClientConfigured();var a=o.listen(this._query,i,e);return function(){i.mute();o.unlisten(a)}};e.prototype.get=function(e){var t=this;N("Query.get",arguments,0,1);Ya("Query.get",e);return new Promise(function(n,r){if(e&&e.source==="cache"){t.firestore.ensureClientConfigured().getDocumentsFromLocalCache(t._query).then(function(e){n(new Qa(t.firestore,t._query,e))},r)}else{t.getViaSnapshotListener(n,r,e)}})};e.prototype.getViaSnapshotListener=function(e,t,n){var r=this.onSnapshotInternal({includeMetadataChanges:true,waitForSyncWhenOnline:true},{next:function(i){r();if(i.metadata.fromCache&&n&&n.source==="server"){t(new v(y.UNAVAILABLE,"Failed to get documents from server. (However, these "+"documents may exist in the local cache. Run again "+'without setting source to "server" to '+"retrieve the cached documents.)"))}else{e(i)}},error:t})};e.prototype.validateNewFilter=function(e){if(e instanceof Ki){var t=[zi.ARRAY_CONTAINS,zi.ARRAY_CONTAINS_ANY];var n=[zi.IN,zi.ARRAY_CONTAINS_ANY];var r=t.indexOf(e.op)>=0;var i=n.indexOf(e.op)>=0;if(e.isInequality()){var o=this._query.getInequalityFilterField();if(o!==null&&!o.isEqual(e.field)){throw new v(y.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality"+" (<, <=, >, or >=) must be on the same field. But you have"+(" inequality filters on '"+o.toString()+"'")+(" and '"+e.field.toString()+"'"))}var a=this._query.getFirstOrderByField();if(a!==null){this.validateOrderByAndInequalityMatch(e.field,a)}}else if(i||r){var s=null;if(i){s=this._query.findFilterOperator(n)}if(s===null&&r){s=this._query.findFilterOperator(t)}if(s!=null){if(s===e.op){throw new v(y.INVALID_ARGUMENT,"Invalid query. You cannot use more than one "+("'"+e.op.toString()+"' filter."))}else{throw new v(y.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters "+("with '"+s.toString()+"' filters."))}}}}};e.prototype.validateNewOrderBy=function(e){if(this._query.getFirstOrderByField()===null){var t=this._query.getInequalityFilterField();if(t!==null){this.validateOrderByAndInequalityMatch(t,e.field)}}};e.prototype.validateOrderByAndInequalityMatch=function(e,t){if(!t.isEqual(e)){throw new v(y.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality "+("(<, <=, >, or >=) on field '"+e.toString()+"' ")+("and so you must also use '"+e.toString()+"' ")+"as your first Query.orderBy(), but your first Query.orderBy() "+("is on field '"+t.toString()+"' instead."))}};return e}();var Qa=function(){function e(e,t,n){this._firestore=e;this._originalQuery=t;this._snapshot=n;this._cachedChanges=null;this._cachedChangesIncludeMetadataChanges=null;this.metadata=new Ua(n.hasPendingWrites,n.fromCache)}Object.defineProperty(e.prototype,"docs",{get:function(){var e=[];this.forEach(function(t){return e.push(t)});return e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:true,configurable:true});e.prototype.forEach=function(e,t){var n=this;N("QuerySnapshot.forEach",arguments,1,2);O("QuerySnapshot.forEach","function",1,e);this._snapshot.docs.forEach(function(r){e.call(t,n.convertToDocumentImpl(r))})};Object.defineProperty(e.prototype,"query",{get:function(){return new ja(this._originalQuery,this._firestore)},enumerable:true,configurable:true});e.prototype.docChanges=function(e){if(e){G("QuerySnapshot.docChanges",e,["includeMetadataChanges"]);M("QuerySnapshot.docChanges","boolean","includeMetadataChanges",e.includeMetadataChanges)}var t=!!(e&&e.includeMetadataChanges);if(t&&this._snapshot.excludesMetadataChanges){throw new v(y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must "+"also pass { includeMetadataChanges:true } to onSnapshot().")}if(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t){this._cachedChanges=Xa(this._firestore,t,this._snapshot);this._cachedChangesIncludeMetadataChanges=t}return this._cachedChanges};e.prototype.isEqual=function(t){if(!(t instanceof e)){throw H("isEqual","QuerySnapshot",1,t)}return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)};e.prototype.convertToDocumentImpl=function(e){return new Ba(this._firestore,e.key,e,this.metadata.fromCache,this._snapshot.mutatedKeys.has(e.key))};return e}();function za(){throw new v(y.INVALID_ARGUMENT,"QuerySnapshot.docChanges has been changed from a property into a "+'method, so usages like "querySnapshot.docChanges" should become '+'"querySnapshot.docChanges()"')}var Ka=["length","forEach","map"].concat(typeof Symbol!=="undefined"?[Symbol.iterator]:[]);Ka.forEach(function(e){try{Object.defineProperty(Qa.prototype.docChanges,e,{get:function(){return za()}})}catch(e){}});var Wa=function(e){B.__extends(t,e);function t(t,n){var r=e.call(this,ji.atPath(t),n)||this;if(t.length%2!==1){throw new v(y.INVALID_ARGUMENT,"Invalid collection reference. Collection "+"references must have an odd number of segments, but "+(t.canonicalString()+" has "+t.length))}return r}Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parent",{get:function(){var e=this._query.path.popLast();if(e.isEmpty()){return null}else{return new qa(new me(e),this.firestore)}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:true,configurable:true});t.prototype.doc=function(e){N("CollectionReference.doc",arguments,0,1);if(arguments.length===0){e=X.newId()}O("CollectionReference.doc","non-empty string",1,e);if(e===""){throw new v(y.INVALID_ARGUMENT,"Document path must be a non-empty string")}var t=he.fromString(e);return qa.forPath(this._query.path.child(t),this.firestore)};t.prototype.add=function(e){C("CollectionReference.add",arguments,1);O("CollectionReference.add","object",1,e);var t=this.doc();return t.set(e).then(function(){return t})};return t}(ja);function Ga(e,t){if(t===undefined){return{merge:false}}G(e,t,["merge","mergeFields"]);M(e,"boolean","merge",t.merge);L(e,"mergeFields","a string or a FieldPath",t.mergeFields,function(e){return typeof e==="string"||e instanceof $o});if(t.mergeFields!==undefined&&t.merge!==undefined){throw new v(y.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" '+'and "mergeFields".')}return t}function Ha(e,t){if(t===undefined){return{}}G(e,t,["serverTimestamps"]);q(e,"options","serverTimestamps",t.serverTimestamps,["estimate","previous","none"]);return t}function Ya(e,t){x(e,"object",1,t);if(t){G(e,t,["source"]);q(e,"options","source",t.source,["default","server","cache"])}}function $a(e,t,n){if(!(t instanceof qa)){throw H(e,"DocumentReference",1,t)}else if(t.firestore!==n){throw new v(y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}else{return t}}function Xa(e,t,n){if(n.oldDocs.isEmpty()){var r;var i=0;return n.docChanges.map(function(t){var o=new Ba(e,t.doc.key,t.doc,n.fromCache,n.mutatedKeys.has(t.doc.key));d(t.type===Ii.Added,"Invalid event type for first snapshot");d(!r||n.query.docComparator(r,t.doc)<0,"Got added events in wrong order");r=t.doc;return{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}else{var o=n.oldDocs;return n.docChanges.filter(function(e){return t||e.type!==Ii.Metadata}).map(function(t){var r=new Ba(e,t.doc.key,t.doc,n.fromCache,n.mutatedKeys.has(t.doc.key));var i=-1;var a=-1;if(t.type!==Ii.Added){i=o.indexOf(t.doc.key);d(i>=0,"Index for document not found");o=o.delete(t.doc.key)}if(t.type!==Ii.Removed){o=o.add(t.doc);a=o.indexOf(t.doc.key)}return{type:Ja(t.type),doc:r,oldIndex:i,newIndex:a}})}}function Ja(e){switch(e){case Ii.Added:return"added";case Ii.Modified:case Ii.Metadata:return"modified";case Ii.Removed:return"removed";default:return h("Unknown change type: "+e)}}var Za=g(Pa,"Use firebase.firestore() instead.");var es=g(La,"Use firebase.firestore().runTransaction() instead.");var ts=g(Fa,"Use firebase.firestore().batch() instead.");var ns=g(qa,"Use firebase.firestore().doc() instead.");var rs=g(Va);var is=g(Ba);var os=g(ja);var as=g(Qa);var ss=g(Wa,"Use firebase.firestore().collection() instead.");var us={Firestore:Za,GeoPoint:Bi,Timestamp:Ae,Blob:oe,Transaction:es,WriteBatch:ts,DocumentReference:ns,DocumentSnapshot:rs,Query:os,QueryDocumentSnapshot:is,QuerySnapshot:as,CollectionReference:ss,FieldPath:$o,FieldValue:da,setLogLevel:Pa.setLogLevel,CACHE_SIZE_UNLIMITED:Oa};function cs(e){e.INTERNAL.registerService("firestore",function(e){return new Pa(e)},_(us))}var ls=function(){function e(){}e.prototype.addCallback=function(e){};e.prototype.shutdown=function(){};return e}();var fs="ConnectivityMonitor";var hs=function(){function e(){var e=this;this.networkAvailableListener=function(){return e.onNetworkAvailable()};this.networkUnavailableListener=function(){return e.onNetworkUnavailable()};this.callbacks=[];this.configureNetworkMonitoring()}e.prototype.addCallback=function(e){this.callbacks.push(e)};e.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener);window.removeEventListener("offline",this.networkUnavailableListener)};e.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener);window.addEventListener("offline",this.networkUnavailableListener)};e.prototype.onNetworkAvailable=function(){c(fs,"Network connectivity changed: AVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++){var n=t[e];n(0)}};e.prototype.onNetworkUnavailable=function(){c(fs,"Network connectivity changed: UNAVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++){var n=t[e];n(1)}};e.isAvailable=function(){return typeof window!=="undefined"&&window.addEventListener!==undefined&&window.removeEventListener!==undefined};return e}();var ds=function(){function e(e){this.sendFn=e.sendFn;this.closeFn=e.closeFn}e.prototype.onOpen=function(e){d(!this.wrappedOnOpen,"Called onOpen on stream twice!");this.wrappedOnOpen=e};e.prototype.onClose=function(e){d(!this.wrappedOnClose,"Called onClose on stream twice!");this.wrappedOnClose=e};e.prototype.onMessage=function(e){d(!this.wrappedOnMessage,"Called onMessage on stream twice!");this.wrappedOnMessage=e};e.prototype.close=function(){this.closeFn()};e.prototype.send=function(e){this.sendFn(e)};e.prototype.callOnOpen=function(){d(this.wrappedOnOpen!==undefined,"Cannot call onOpen because no callback was set");this.wrappedOnOpen()};e.prototype.callOnClose=function(e){d(this.wrappedOnClose!==undefined,"Cannot call onClose because no callback was set");this.wrappedOnClose(e)};e.prototype.callOnMessage=function(e){d(this.wrappedOnMessage!==undefined,"Cannot call onMessage because no callback was set");this.wrappedOnMessage(e)};return e}();var ps="Connection";var ms="google.firestore.v1.Firestore";var ys="v1";var vs={BatchGetDocuments:"batchGet",Commit:"commit"};var gs="gl-js/ fire/"+i;var bs=15;var ws=function(){function e(e){this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.baseUrl=t+"://"+e.host;this.forceLongPolling=e.forceLongPolling}e.prototype.modifyHeadersForRequest=function(e,t){if(t){for(var n in t.authHeaders){if(t.authHeaders.hasOwnProperty(n)){e[n]=t.authHeaders[n]}}}e["X-Goog-Api-Client"]=gs};e.prototype.invokeRPC=function(e,t,n){var r=this;var i=this.makeUrl(e);return new Promise(function(o,a){var s=new Eo.XhrIo;s.listenOnce(Eo.EventType.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Eo.ErrorCode.NO_ERROR:var t=s.getResponseJson();c(ps,"XHR received:",JSON.stringify(t));o(t);break;case Eo.ErrorCode.TIMEOUT:c(ps,'RPC "'+e+'" timed out');a(new v(y.DEADLINE_EXCEEDED,"Request time out"));break;case Eo.ErrorCode.HTTP_ERROR:var n=s.getStatus();c(ps,'RPC "'+e+'" failed with status:',n,"response text:",s.getResponseText());if(n>0){a(new v(Si(n),"Server responded with status "+s.getStatusText()))}else{c(ps,'RPC "'+e+'" failed');a(new v(y.UNAVAILABLE,"Connection failed."))}break;default:h('RPC "'+e+'" failed with unanticipated '+"webchannel error "+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{c(ps,'RPC "'+e+'" completed.')}});var u=JSON.stringify(t);c(ps,"XHR sending: ",i+" "+u);var l={"Content-Type":"text/plain"};r.modifyHeadersForRequest(l,n);s.send(i,"POST",u,l,bs)})};e.prototype.invokeStreamingRPC=function(e,t,n){return this.invokeRPC(e,t,n)};e.prototype.openStream=function(e,t){var n=[this.baseUrl,"/",ms,"/",e,"/channel"];var r=Eo.createWebChannelTransport();var i={backgroundChannelTest:true,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:true,supportsCrossDomainXhr:true,internalChannelParams:{forwardChannelRequestTimeoutMs:10*60*1e3},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,t);if(!j.isReactNative()){i.httpHeadersOverwriteParam="$httpHeaders"}var o=n.join("");c(ps,"Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i);var s=false;var u=false;var l=new ds({sendFn:function(e){if(!u){if(!s){c(ps,"Opening WebChannel transport.");a.open();s=true}c(ps,"WebChannel sending:",e);a.send(e)}else{c(ps,"Not sending because WebChannel is closed:",e)}},closeFn:function(){return a.close()}});var f=function(e,t){a.listen(e,function(e){try{t(e)}catch(e){setTimeout(function(){throw e},0)}})};f(Eo.WebChannel.EventType.OPEN,function(){if(!u){c(ps,"WebChannel transport opened.")}});f(Eo.WebChannel.EventType.CLOSE,function(){if(!u){u=true;c(ps,"WebChannel transport closed");l.callOnClose()}});f(Eo.WebChannel.EventType.ERROR,function(e){if(!u){u=true;c(ps,"WebChannel transport errored:",e);l.callOnClose(new v(y.UNAVAILABLE,"The operation could not be completed"))}});f(Eo.WebChannel.EventType.MESSAGE,function(e){if(!u){var t=e.data[0];d(!!t,"Got a webchannel message without data.");var n=t;var r=n.error||n[0]&&n[0].error;if(r){c(ps,"WebChannel received error:",r);var i=r.status;var o=bi(i);var s=r.message;if(o===undefined){o=y.INTERNAL;s="Unknown error status: "+i+" with message "+r.message}u=true;l.callOnClose(new v(o,s));a.close()}else{c(ps,"WebChannel received:",t);l.callOnMessage(t)}}});setTimeout(function(){l.callOnOpen()},0);return l};e.prototype.makeUrl=function(e){var t=vs[e];d(t!==undefined,"Unknown REST mapping for: "+e);var n=[this.baseUrl,"/",ys];n.push("/projects/");n.push(this.databaseId.projectId);n.push("/databases/");n.push(this.databaseId.database);n.push("/documents");n.push(":");n.push(t);return n.join("")};return e}();var Es=function(){function e(){this.emptyByteString="";this.base64Available=typeof atob!=="undefined"}Object.defineProperty(e.prototype,"document",{get:function(){return typeof document!=="undefined"?document:null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"window",{get:function(){return typeof window!=="undefined"?window:null},enumerable:true,configurable:true});e.prototype.loadConnection=function(e){return Promise.resolve(new ws(e))};e.prototype.newConnectivityMonitor=function(){if(hs.isAvailable()){return new hs}else{return new ls}};e.prototype.newSerializer=function(e){return new ho(e,{useProto3Json:true})};e.prototype.formatJSON=function(e){return JSON.stringify(e)};e.prototype.atob=function(e){return atob(e)};e.prototype.btoa=function(e){return btoa(e)};return e}();p.setPlatform(new Es);function Ss(e){cs(e)}Ss(r);t.registerFirestore=Ss});d(So);var To=So.registerFirestore;var Io={apiKey:"AIzaSyA42mJ5aKLQI-8kFt24thcEVIoInKkEQDk",authDomain:"fontumibots.firebaseapp.com",databaseURL:"https://fontumibots.firebaseio.com",projectId:"fontumibots",storageBucket:"fontumibots.appspot.com",messagingSenderId:"1047975832929",appId:"1:1047975832929:web:3778f496fc1321d8"};var _o=$e.initializeApp(Io);var Do=_o.firestore();var Co=function(e){return function(t){return Do.collection(e).doc(t)}};var Ao=function(){function e(e){var n=this;t(this,e);this.opened=false;this.error=true;this.toggle=function(e){var t=e.detail;return n.opened=t}}e.prototype.componentWillLoad=function(){return A(this,void 0,void 0,function(){var e=this;return N(this,function(t){return[2,new Promise(function(t,n){return A(e,void 0,void 0,function(){var e,r,i,o,a,s,u,c,l;return N(this,function(f){switch(f.label){case 0:f.trys.push([0,2,,3]);return[4,Co("bots")(this.botId).get()];case 1:e=f.sent();if(e.exists){r=e.data(),i=r.name,o=r.email,a=r.description,s=r.escene,u=r.user_id,c=r.colors;this.bot={name:i,email:o,description:a,escene:s,user_id:u,colors:c};this.error=false;return[2,t()]}return[3,3];case 2:l=f.sent();return[2,n(l)];case 3:return[2,n("FONTUMIBOT: Bot with id: "+this.botId+" doesnt exists.")]}})})})]})})};e.prototype.render=function(){return this.error?r("div",null):r("div",{id:"fontumibots-widget"},r("fontumibots-chat-container",{style:{visibility:this.opened?"visible":"hidden",padding:"10px"},bot:this.bot}),r("fontumibots-bubble-button",{onToggled:this.toggle,color:this.bot.colors.a}))};Object.defineProperty(e,"style",{get:function(){return"\@import url(\"https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.5/css/uikit.min.css\");:host{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:16px;font-weight:400;line-height:1.5;-webkit-text-size-adjust:100%;background:#fff;color:#666;--fontumibots-border:3px;--fontumibots-z-index:99999999;--fontumibots-shadow:0 5px 15px rgba(0,0,0,0.08);--fontumibots-chat-borders:25px;--fontumibots-color-a:red;--fontumibots-color-b:#00f}"},enumerable:true,configurable:true});return e}();e("fontumibots_widget",Ao)}}});