var __awaiter=this&&this.__awaiter||function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n["throw"](e))}catch(e){a(e)}}function u(e){e.done?r(e.value):i(e.value).then(o,s)}u((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(a=o[0]&2?i["return"]:o[0]?i["throw"]||((a=i["return"])&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;if(i=0,a)o=[o[0]&2,a.value];switch(o[0]){case 0:case 1:a=o;break;case 4:r.label++;return{value:o[1],done:false};case 5:r.label++;i=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(a=r.trys,a=a.length>0&&a[a.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(o[0]===6&&r.label<a[1]){r.label=a[1];a=o;break}if(a&&r.label<a[2]){r.label=a[2];r.ops.push(o);break}if(a[2])r.ops.pop();r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e];i=0}finally{n=a=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n};System.register(["./p-146e9099.system.js"],(function(e){"use strict";var t,r,n,i;return{setters:[function(e){t=e.r;r=e.c;n=e.h;i=e.g}],execute:function(){var a=this;function o(e){var t,r,n,i;if(e.match(/^rgb/)){e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);t=e[1];r=e[2];n=e[3]}else{e=+("0x"+e.slice(1).replace(e.length<5&&/./g,"$&$&"));t=e>>16;r=e>>8&255;n=e&255}i=Math.sqrt(.299*(t*t)+.587*(r*r)+.114*(n*n));return i>127.5?"light":"dark"}function s(e){return o(e)==="dark"?"white":"black"}var u=e("fontumibots_bubble_button",function(){function e(e){t(this,e);this.toggleEvent=r(this,"toggled",7)}e.prototype.render=function(){var e=this;var t=function(){switch(e.icon){case"call":return n("fontumibots-icon-call",{fill:s(e.color)});case"message":return n("fontumibots-icon-messages",{height:20,width:20,fill:s(e.color)});default:return n("fontumibots-icon-close",{height:20,width:20,fill:s(e.color)})}};return n("div",{id:"fontumibots-bubble-button",style:{background:this.color},onClick:function(){return e.toggleEvent.emit()}},t())};Object.defineProperty(e,"style",{get:function(){return"#fontumibots-bubble-button{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;-webkit-box-shadow:var(--fontumibots-shadow);box-shadow:var(--fontumibots-shadow);border-radius:50%;height:55px;width:55px;z-index:var(--fontumibots-z-index);margin-left:5px;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}"},enumerable:true,configurable:true});return e}());var c=function(){function e(e,t,r,n){this.id=e;this.name=t;this.title=r;this.values=n}e.prototype.props=function(){return this.values.property};e.prototype.question=function(){var e;switch(this.name){case"end":{e="goodbye_text";break}case"start":{e="welcome_text";break}default:{e="question";break}}var t=this.values.property[e].value||"";return{type:this.name,value:t}};return e}();var l=function(){function e(e,t,r,n,i){this.id=e;this.originID=t;this.originSlot=r;this.targetID=n;this.targetSlot=i}return e}();var f=function(){function e(e,t){var r=this;this.blocks=[];this.links=[];t.map((function(e){return r.blocks.push(new c(e.id,e.name,e.title,e.values))}));e.map((function(e){return r.links.push(new l(e.id,e.originID,e.originSlot,e.targetID,e.targetSlot))}));this.startBlock=this.blockByName("start")[0];this.actualBlock=this.startBlock}e.prototype.blockByName=function(e){return this.blocks.filter((function(t){return t.name===e}))};e.prototype.blockById=function(e){return this.blocks.find((function(t){return t.id===e}))};e.prototype.next=function(e){var t=this;if(e===void 0){e=0}if(this.actualBlock.name==="end")return;var r=this.links.find((function(r){return r.originID===t.actualBlock.id&&r.originSlot===e}));var n=this.blockById(r.targetID);this.actualBlock=n;return n};return e}();var h=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function d(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}function v(e,t){return t={exports:{}},e(t,t.exports),t.exports}var m=function(e,t){m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return m(e,t)};function y(e,t){m(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var g=function(){g=Object.assign||function e(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))t[a]=r[a]}return t};return g.apply(this,arguments)};function b(e,t){var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0)r[n]=e[n];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++){if(t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i]))r[n[i]]=e[n[i]]}return r}function w(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a}function _(e,t){return function(r,n){t(r,n,e)}}function S(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function E(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n["throw"](e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new r((function(t){t(e.value)})).then(o,s)}u((n=n.apply(e,t||[])).next())}))}function T(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(a=o[0]&2?i["return"]:o[0]?i["throw"]||((a=i["return"])&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;if(i=0,a)o=[o[0]&2,a.value];switch(o[0]){case 0:case 1:a=o;break;case 4:r.label++;return{value:o[1],done:false};case 5:r.label++;i=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(a=r.trys,a=a.length>0&&a[a.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(o[0]===6&&r.label<a[1]){r.label=a[1];a=o;break}if(a&&r.label<a[2]){r.label=a[2];r.ops.push(o);break}if(a[2])r.ops.pop();r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e];i=0}finally{n=a=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}function I(e,t){for(var r in e)if(!t.hasOwnProperty(r))t[r]=e[r]}function D(e){var t=typeof Symbol==="function"&&e[Symbol.iterator],r=0;if(t)return t.call(e);return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}}}function C(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],o;try{while((t===void 0||t-- >0)&&!(i=n.next()).done)a.push(i.value)}catch(e){o={error:e}}finally{try{if(i&&!i.done&&(r=n["return"]))r.call(n)}finally{if(o)throw o.error}}return a}function A(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(C(arguments[t]));return e}function N(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n}function k(e){return this instanceof k?(this.v=e,this):new k(e)}function O(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,a=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){if(n[e])i[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||s(e,t)}))}}function s(e,t){try{u(n[e](t))}catch(e){f(a[0][3],e)}}function u(e){e.value instanceof k?Promise.resolve(e.value.v).then(c,l):f(a[0][2],e)}function c(e){s("next",e)}function l(e){s("throw",e)}function f(e,t){if(e(t),a.shift(),a.length)s(a[0][0],a[0][1])}}function M(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:k(e[n](t)),done:n==="return"}:i?i(t):t}:i}}function x(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof D==="function"?D(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(t){r[t]=e[t]&&function(r){return new Promise((function(n,a){r=e[t](r),i(n,a,r.done,r.value)}))}}function i(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}}function P(e,t){if(Object.defineProperty){Object.defineProperty(e,"raw",{value:t})}else{e.raw=t}return e}function R(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(Object.hasOwnProperty.call(e,r))t[r]=e[r];t.default=e;return t}function L(e){return e&&e.__esModule?e:{default:e}}var F=Object.freeze({__extends:y,get __assign(){return g},__rest:b,__decorate:w,__param:_,__metadata:S,__awaiter:E,__generator:T,__exportStar:I,__values:D,__read:C,__spread:A,__spreadArrays:N,__await:k,__asyncGenerator:O,__asyncDelegator:M,__asyncValues:x,__makeTemplateObject:P,__importStar:R,__importDefault:L});var V=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={NODE_CLIENT:false,NODE_ADMIN:false,SDK_VERSION:"${JSCORE_VERSION}"};var n=function(e,t){if(!e){throw i(t)}};var i=function(e){return new Error("Firebase Database ("+r.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)};var a=function(e){var t=[];var r=0;for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);if(i<128){t[r++]=i}else if(i<2048){t[r++]=i>>6|192;t[r++]=i&63|128}else if((i&64512)===55296&&n+1<e.length&&(e.charCodeAt(n+1)&64512)===56320){i=65536+((i&1023)<<10)+(e.charCodeAt(++n)&1023);t[r++]=i>>18|240;t[r++]=i>>12&63|128;t[r++]=i>>6&63|128;t[r++]=i&63|128}else{t[r++]=i>>12|224;t[r++]=i>>6&63|128;t[r++]=i&63|128}}return t};var o=function(e){var t=[];var r=0,n=0;while(r<e.length){var i=e[r++];if(i<128){t[n++]=String.fromCharCode(i)}else if(i>191&&i<224){var a=e[r++];t[n++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){var a=e[r++];var o=e[r++];var s=e[r++];var u=((i&7)<<18|(a&63)<<12|(o&63)<<6|s&63)-65536;t[n++]=String.fromCharCode(55296+(u>>10));t[n++]=String.fromCharCode(56320+(u&1023))}else{var a=e[r++];var o=e[r++];t[n++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return t.join("")};var s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"abcdefghijklmnopqrstuvwxyz"+"0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(e,t){if(!Array.isArray(e)){throw Error("encodeByteArray takes an array as a parameter")}this.init_();var r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_;var n=[];for(var i=0;i<e.length;i+=3){var a=e[i];var o=i+1<e.length;var s=o?e[i+1]:0;var u=i+2<e.length;var c=u?e[i+2]:0;var l=a>>2;var f=(a&3)<<4|s>>4;var h=(s&15)<<2|c>>6;var d=c&63;if(!u){d=64;if(!o){h=64}}n.push(r[l],r[f],r[h],r[d])}return n.join("")},encodeString:function(e,t){if(this.HAS_NATIVE_SUPPORT&&!t){return btoa(e)}return this.encodeByteArray(a(e),t)},decodeString:function(e,t){if(this.HAS_NATIVE_SUPPORT&&!t){return atob(e)}return o(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();var r=t?this.charToByteMapWebSafe_:this.charToByteMap_;var n=[];for(var i=0;i<e.length;){var a=r[e.charAt(i++)];var o=i<e.length;var s=o?r[e.charAt(i)]:0;++i;var u=i<e.length;var c=u?r[e.charAt(i)]:64;++i;var l=i<e.length;var f=l?r[e.charAt(i)]:64;++i;if(a==null||s==null||c==null||f==null){throw Error()}var h=a<<2|s>>4;n.push(h);if(c!==64){var d=s<<4&240|c>>2;n.push(d);if(f!==64){var p=c<<6&192|f;n.push(p)}}}return n},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={};this.charToByteMap_={};this.byteToCharMapWebSafe_={};this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++){this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e);this.charToByteMap_[this.byteToCharMap_[e]]=e;this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e);this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e;if(e>=this.ENCODED_VALS_BASE.length){this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e;this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e}}}}};var u=function(e){var t=a(e);return s.encodeByteArray(t,true)};var c=function(e){try{return s.decodeString(e,true)}catch(e){console.error("base64Decode failed: ",e)}return null};function l(e){return f(undefined,e)}function f(e,t){if(!(t instanceof Object)){return t}switch(t.constructor){case Date:var r=t;return new Date(r.getTime());case Object:if(e===undefined){e={}}break;case Array:e=[];break;default:return t}for(var n in t){if(!t.hasOwnProperty(n)){continue}e[n]=f(e[n],t[n])}return e}var d=function(){function e(){var e=this;this.reject=function(){};this.resolve=function(){};this.promise=new Promise((function(t,r){e.resolve=t;e.reject=r}))}e.prototype.wrapCallback=function(e){var t=this;return function(r,n){if(r){t.reject(r)}else{t.resolve(n)}if(typeof e==="function"){t.promise.catch((function(){}));if(e.length===1){e(r)}else{e(r,n)}}}};return e}();function p(){if(typeof navigator!=="undefined"&&typeof navigator["userAgent"]==="string"){return navigator["userAgent"]}else{return""}}function v(){return typeof window!=="undefined"&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())}function m(){try{return Object.prototype.toString.call(h.process)==="[object process]"}catch(e){return false}}function y(){return typeof self==="object"&&self.self===self}function g(){return typeof navigator==="object"&&navigator["product"]==="ReactNative"}function b(){return r.NODE_CLIENT===true||r.NODE_ADMIN===true}var w="FirebaseError";var _=function(e){F.__extends(t,e);function t(r,n){var i=e.call(this,n)||this;i.code=r;i.name=w;Object.setPrototypeOf(i,t.prototype);if(Error.captureStackTrace){Error.captureStackTrace(i,S.prototype.create)}return i}return t}(Error);var S=function(){function e(e,t,r){this.service=e;this.serviceName=t;this.errors=r}e.prototype.create=function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}var n=t[0]||{};var i=this.service+"/"+e;var a=this.errors[e];var o=a?E(a,n):"Error";var s=this.serviceName+": "+o+" ("+i+").";var u=new _(i,s);for(var c=0,l=Object.keys(n);c<l.length;c++){var f=l[c];if(f.slice(-1)!=="_"){if(f in u){console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.')}u[f]=n[f]}}return u};return e}();function E(e,t){return e.replace(T,(function(e,r){var n=t[r];return n!=null?n.toString():"<"+r+"?>"}))}var T=/\{\$([^}]+)}/g;function I(e){return JSON.parse(e)}function D(e){return JSON.stringify(e)}var C=function(e){var t={},r={},n={},i="";try{var a=e.split(".");t=I(c(a[0])||"");r=I(c(a[1])||"");i=a[2];n=r["d"]||{};delete r["d"]}catch(e){}return{header:t,claims:r,data:n,signature:i}};var A=function(e){var t=C(e).claims;var r=Math.floor((new Date).getTime()/1e3);var n=0,i=0;if(typeof t==="object"){if(t.hasOwnProperty("nbf")){n=t["nbf"]}else if(t.hasOwnProperty("iat")){n=t["iat"]}if(t.hasOwnProperty("exp")){i=t["exp"]}else{i=n+86400}}return!!r&&!!n&&!!i&&r>=n&&r<=i};var N=function(e){var t=C(e).claims;if(typeof t==="object"&&t.hasOwnProperty("iat")){return t["iat"]}return null};var k=function(e){var t=C(e),r=t.claims;return!!r&&typeof r==="object"&&r.hasOwnProperty("iat")};var O=function(e){var t=C(e).claims;return typeof t==="object"&&t["admin"]===true};function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function x(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){return e[t]}else{return undefined}}function P(e){for(var t in e){if(Object.prototype.hasOwnProperty.call(e,t)){return false}}return true}function R(e,t,r){var n={};for(var i in e){if(Object.prototype.hasOwnProperty.call(e,i)){n[i]=t.call(r,e[i],i,e)}}return n}function L(e){var t=[];var r=function(e,r){if(Array.isArray(r)){r.forEach((function(r){t.push(encodeURIComponent(e)+"="+encodeURIComponent(r))}))}else{t.push(encodeURIComponent(e)+"="+encodeURIComponent(r))}};for(var n=0,i=Object.entries(e);n<i.length;n++){var a=i[n],o=a[0],s=a[1];r(o,s)}return t.length?"&"+t.join("&"):""}function V(e){var t={};var r=e.replace(/^\?/,"").split("&");r.forEach((function(e){if(e){var r=e.split("=");t[r[0]]=r[1]}}));return t}var q=function(){function e(){this.chain_=[];this.buf_=[];this.W_=[];this.pad_=[];this.inbuf_=0;this.total_=0;this.blockSize=512/8;this.pad_[0]=128;for(var e=1;e<this.blockSize;++e){this.pad_[e]=0}this.reset()}e.prototype.reset=function(){this.chain_[0]=1732584193;this.chain_[1]=4023233417;this.chain_[2]=2562383102;this.chain_[3]=271733878;this.chain_[4]=3285377520;this.inbuf_=0;this.total_=0};e.prototype.compress_=function(e,t){if(!t){t=0}var r=this.W_;if(typeof e==="string"){for(var n=0;n<16;n++){r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3);t+=4}}else{for(var n=0;n<16;n++){r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];t+=4}}for(var n=16;n<80;n++){var i=r[n-3]^r[n-8]^r[n-14]^r[n-16];r[n]=(i<<1|i>>>31)&4294967295}var a=this.chain_[0];var o=this.chain_[1];var s=this.chain_[2];var u=this.chain_[3];var c=this.chain_[4];var l,f;for(var n=0;n<80;n++){if(n<40){if(n<20){l=u^o&(s^u);f=1518500249}else{l=o^s^u;f=1859775393}}else{if(n<60){l=o&s|u&(o|s);f=2400959708}else{l=o^s^u;f=3395469782}}var i=(a<<5|a>>>27)+l+c+f+r[n]&4294967295;c=u;u=s;s=(o<<30|o>>>2)&4294967295;o=a;a=i}this.chain_[0]=this.chain_[0]+a&4294967295;this.chain_[1]=this.chain_[1]+o&4294967295;this.chain_[2]=this.chain_[2]+s&4294967295;this.chain_[3]=this.chain_[3]+u&4294967295;this.chain_[4]=this.chain_[4]+c&4294967295};e.prototype.update=function(e,t){if(e==null){return}if(t===undefined){t=e.length}var r=t-this.blockSize;var n=0;var i=this.buf_;var a=this.inbuf_;while(n<t){if(a===0){while(n<=r){this.compress_(e,n);n+=this.blockSize}}if(typeof e==="string"){while(n<t){i[a]=e.charCodeAt(n);++a;++n;if(a===this.blockSize){this.compress_(i);a=0;break}}}else{while(n<t){i[a]=e[n];++a;++n;if(a===this.blockSize){this.compress_(i);a=0;break}}}}this.inbuf_=a;this.total_+=t};e.prototype.digest=function(){var e=[];var t=this.total_*8;if(this.inbuf_<56){this.update(this.pad_,56-this.inbuf_)}else{this.update(this.pad_,this.blockSize-(this.inbuf_-56))}for(var r=this.blockSize-1;r>=56;r--){this.buf_[r]=t&255;t/=256}this.compress_(this.buf_);var n=0;for(var r=0;r<5;r++){for(var i=24;i>=0;i-=8){e[n]=this.chain_[r]>>i&255;++n}}return e};return e}();function j(e,t){var r=new B(e,t);return r.subscribe.bind(r)}var B=function(){function e(e,t){var r=this;this.observers=[];this.unsubscribes=[];this.observerCount=0;this.task=Promise.resolve();this.finalized=false;this.onNoObservers=t;this.task.then((function(){e(r)})).catch((function(e){r.error(e)}))}e.prototype.next=function(e){this.forEachObserver((function(t){t.next(e)}))};e.prototype.error=function(e){this.forEachObserver((function(t){t.error(e)}));this.close(e)};e.prototype.complete=function(){this.forEachObserver((function(e){e.complete()}));this.close()};e.prototype.subscribe=function(e,t,r){var n=this;var i;if(e===undefined&&t===undefined&&r===undefined){throw new Error("Missing Observer.")}if(W(e,["next","error","complete"])){i=e}else{i={next:e,error:t,complete:r}}if(i.next===undefined){i.next=z}if(i.error===undefined){i.error=z}if(i.complete===undefined){i.complete=z}var a=this.unsubscribeOne.bind(this,this.observers.length);if(this.finalized){this.task.then((function(){try{if(n.finalError){i.error(n.finalError)}else{i.complete()}}catch(e){}return}))}this.observers.push(i);return a};e.prototype.unsubscribeOne=function(e){if(this.observers===undefined||this.observers[e]===undefined){return}delete this.observers[e];this.observerCount-=1;if(this.observerCount===0&&this.onNoObservers!==undefined){this.onNoObservers(this)}};e.prototype.forEachObserver=function(e){if(this.finalized){return}for(var t=0;t<this.observers.length;t++){this.sendOne(t,e)}};e.prototype.sendOne=function(e,t){var r=this;this.task.then((function(){if(r.observers!==undefined&&r.observers[e]!==undefined){try{t(r.observers[e])}catch(e){if(typeof console!=="undefined"&&console.error){console.error(e)}}}}))};e.prototype.close=function(e){var t=this;if(this.finalized){return}this.finalized=true;if(e!==undefined){this.finalError=e}this.task.then((function(){t.observers=undefined;t.onNoObservers=undefined}))};return e}();function U(e,t){return function(){var r=[];for(var n=0;n<arguments.length;n++){r[n]=arguments[n]}Promise.resolve(true).then((function(){e.apply(void 0,r)})).catch((function(e){if(t){t(e)}}))}}function W(e,t){if(typeof e!=="object"||e===null){return false}for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i in e&&typeof e[i]==="function"){return true}}return false}function z(){}var Q=function(e,t,r,n){var i;if(n<t){i="at least "+t}else if(n>r){i=r===0?"none":"no more than "+r}if(i){var a=e+" failed: Was called with "+n+(n===1?" argument.":" arguments.")+" Expects "+i+".";throw new Error(a)}};function K(e,t,r){var n="";switch(t){case 1:n=r?"first":"First";break;case 2:n=r?"second":"Second";break;case 3:n=r?"third":"Third";break;case 4:n=r?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=e+" failed: ";i+=n+" argument ";return i}function G(e,t,r,n){if(n&&!r){return}if(typeof r!=="string"){throw new Error(K(e,t,n)+"must be a valid firebase namespace.")}}function H(e,t,r,n){if(n&&!r){return}if(typeof r!=="function"){throw new Error(K(e,t,n)+"must be a valid function.")}}function Y(e,t,r,n){if(n&&!r){return}if(typeof r!=="object"||r===null){throw new Error(K(e,t,n)+"must be a valid context object.")}}var $=function(e){var t=[];var r=0;for(var i=0;i<e.length;i++){var a=e.charCodeAt(i);if(a>=55296&&a<=56319){var o=a-55296;i++;n(i<e.length,"Surrogate pair missing trail surrogate.");var s=e.charCodeAt(i)-56320;a=65536+(o<<10)+s}if(a<128){t[r++]=a}else if(a<2048){t[r++]=a>>6|192;t[r++]=a&63|128}else if(a<65536){t[r++]=a>>12|224;t[r++]=a>>6&63|128;t[r++]=a&63|128}else{t[r++]=a>>18|240;t[r++]=a>>12&63|128;t[r++]=a>>6&63|128;t[r++]=a&63|128}}return t};var X=function(e){var t=0;for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n<128){t++}else if(n<2048){t+=2}else if(n>=55296&&n<=56319){t+=4;r++}else{t+=3}}return t};t.CONSTANTS=r;t.Deferred=d;t.ErrorFactory=S;t.FirebaseError=_;t.Sha1=q;t.assert=n;t.assertionError=i;t.async=U;t.base64=s;t.base64Decode=c;t.base64Encode=u;t.contains=M;t.createSubscribe=j;t.decode=C;t.deepCopy=l;t.deepExtend=f;t.errorPrefix=K;t.getUA=p;t.isAdmin=O;t.isBrowser=y;t.isEmpty=P;t.isMobileCordova=v;t.isNode=m;t.isNodeSdk=b;t.isReactNative=g;t.isValidFormat=k;t.isValidTimestamp=A;t.issuedAtTime=N;t.jsonEval=I;t.map=R;t.querystring=L;t.querystringDecode=V;t.safeGet=x;t.stringLength=X;t.stringToByteArray=$;t.stringify=D;t.validateArgCount=Q;t.validateCallback=H;t.validateContextObject=Y;t.validateNamespace=G}));p(V);var q=[];var j;(function(e){e[e["DEBUG"]=0]="DEBUG";e[e["VERBOSE"]=1]="VERBOSE";e[e["INFO"]=2]="INFO";e[e["WARN"]=3]="WARN";e[e["ERROR"]=4]="ERROR";e[e["SILENT"]=5]="SILENT"})(j||(j={}));var B=j.INFO;var U=function(e,t){var r=[];for(var n=2;n<arguments.length;n++){r[n-2]=arguments[n]}if(t<e.logLevel){return}var i=(new Date).toISOString();switch(t){case j.DEBUG:console.log.apply(console,["["+i+"]  "+e.name+":"].concat(r));break;case j.VERBOSE:console.log.apply(console,["["+i+"]  "+e.name+":"].concat(r));break;case j.INFO:console.info.apply(console,["["+i+"]  "+e.name+":"].concat(r));break;case j.WARN:console.warn.apply(console,["["+i+"]  "+e.name+":"].concat(r));break;case j.ERROR:console.error.apply(console,["["+i+"]  "+e.name+":"].concat(r));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}};var W=function(){function e(e){this.name=e;this._logLevel=B;this._logHandler=U;q.push(this)}Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in j)){throw new TypeError("Invalid value assigned to `logLevel`")}this._logLevel=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if(typeof e!=="function"){throw new TypeError("Value assigned to `logHandler` must be a function")}this._logHandler=e},enumerable:true,configurable:true});e.prototype.debug=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,j.DEBUG].concat(e))};e.prototype.log=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,j.VERBOSE].concat(e))};e.prototype.info=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,j.INFO].concat(e))};e.prototype.warn=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,j.WARN].concat(e))};e.prototype.error=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this._logHandler.apply(this,[this,j.ERROR].concat(e))};return e}();function z(e){q.forEach((function(t){t.logLevel=e}))}var Q=Object.freeze({get LogLevel(){return j},Logger:W,setLogLevel:z});var K=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r;var n=(r={},r["no-app"]="No Firebase App '{$appName}' has been created - "+"call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a "+"Firebase App instance.",r);var i=new V.ErrorFactory("app","Firebase",n);var a="[DEFAULT]";var o=[];var s=function(){function e(e,t,r){this.firebase_=r;this.isDeleted_=false;this.services_={};this.name_=t.name;this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||false;this.options_=V.deepCopy(e);this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(e){o.push(e);setTimeout((function(){return e(null)}),0)},removeAuthTokenListener:function(e){o=o.filter((function(t){return t!==e}))}}}Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){this.checkDestroyed_();return this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_();this.automaticDataCollectionEnabled_=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"name",{get:function(){this.checkDestroyed_();return this.name_},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"options",{get:function(){this.checkDestroyed_();return this.options_},enumerable:true,configurable:true});e.prototype.delete=function(){var e=this;return new Promise((function(t){e.checkDestroyed_();t()})).then((function(){e.firebase_.INTERNAL.removeApp(e.name_);var t=[];for(var r=0,n=Object.keys(e.services_);r<n.length;r++){var i=n[r];for(var a=0,o=Object.keys(e.services_[i]);a<o.length;a++){var s=o[a];t.push(e.services_[i][s])}}return Promise.all(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})))})).then((function(){e.isDeleted_=true;e.services_={}}))};e.prototype._getService=function(e,t){if(t===void 0){t=a}this.checkDestroyed_();if(!this.services_[e]){this.services_[e]={}}if(!this.services_[e][t]){var r=t!==a?t:undefined;var n=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),r);this.services_[e][t]=n}return this.services_[e][t]};e.prototype._removeServiceInstance=function(e,t){if(t===void 0){t=a}if(this.services_[e]&&this.services_[e][t]){delete this.services_[e][t]}};e.prototype.extendApp=function(e){var t=this;V.deepExtend(this,e);if(e.INTERNAL&&e.INTERNAL.addAuthTokenListener){o.forEach((function(e){t.INTERNAL.addAuthTokenListener(e)}));o=[]}};e.prototype.checkDestroyed_=function(){if(this.isDeleted_){throw i.create("app-deleted",{appName:this.name_})}};return e}();s.prototype.name&&s.prototype.options||s.prototype.delete||console.log("dc");var u="6.6.2";var c=new Q.Logger("@firebase/app");function l(e){var t={};var r={};var n={};var o={__esModule:true,initializeApp:f,app:l,apps:null,SDK_VERSION:u,INTERNAL:{registerService:d,removeApp:s,factories:r,useAsService:v}};o["default"]=o;Object.defineProperty(o,"apps",{get:h});function s(e){var r=t[e];p(r,"delete");delete t[e]}function l(e){e=e||a;if(!V.contains(t,e)){throw i.create("no-app",{appName:e})}return t[e]}l["App"]=e;function f(r,n){if(n===void 0){n={}}if(typeof n!=="object"||n===null){var s=n;n={name:s}}var u=n;if(u.name===undefined){u.name=a}var c=u.name;if(typeof c!=="string"||!c){throw i.create("bad-app-name",{appName:String(c)})}if(V.contains(t,c)){throw i.create("duplicate-app",{appName:c})}var l=new e(r,u,o);t[c]=l;p(l,"create");return l}function h(){return Object.keys(t).map((function(e){return t[e]}))}function d(t,a,s,u,f){if(f===void 0){f=false}if(r[t]){c.debug("There were multiple attempts to register service "+t+".");return o[t]}r[t]=a;if(u){n[t]=u;h().forEach((function(e){u("create",e)}))}function d(e){if(e===void 0){e=l()}if(typeof e[t]!=="function"){throw i.create("invalid-app-argument",{appName:t})}return e[t]()}if(s!==undefined){V.deepExtend(d,s)}o[t]=d;e.prototype[t]=function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}var n=this._getService.bind(this,t);return n.apply(this,f?e:[])};return d}function p(e,t){for(var i=0,a=Object.keys(r);i<a.length;i++){var o=a[i];var s=v(e,o);if(s===null){return}if(n[s]){n[s](t,e)}}}function v(e,t){if(t==="serverAuth"){return null}var r=t;return r}return o}function f(){var e=l(s);e.INTERNAL=F.__assign({},e.INTERNAL,{createFirebaseNamespace:f,extendNamespace:t,createSubscribe:V.createSubscribe,ErrorFactory:V.ErrorFactory,deepExtend:V.deepExtend});function t(t){V.deepExtend(e,t)}return e}if(V.isBrowser()&&self.firebase!==undefined){c.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var h=self.firebase.SDK_VERSION;if(h&&h.indexOf("LITE")>=0){c.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}}var d=f();var p=d.initializeApp;d.initializeApp=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(V.isNode()){c.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      ')}return p.apply(undefined,e)};var v=d;t.default=v;t.firebase=v}));p(K);function G(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var H=G(K);var Y=H;var $=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var X,J=J||{},Z=$;function ee(e){return"string"==typeof e}function te(e){return"number"==typeof e}function re(e,t){e=e.split(".");t=t||Z;for(var r=0;r<e.length;r++)if(t=t[e[r]],null==t)return null;return t}function ne(){}function ie(e){var t=typeof e;if("object"==t)if(e){if(e instanceof Array)return"array";if(e instanceof Object)return t;var r=Object.prototype.toString.call(e);if("[object Window]"==r)return"object";if("[object Array]"==r||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==r||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==t&&"undefined"==typeof e.call)return"object";return t}function ae(e){return"array"==ie(e)}function oe(e){var t=ie(e);return"array"==t||"object"==t&&"number"==typeof e.length}function se(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var ue="closure_uid_"+(1e9*Math.random()>>>0),ce=0;function le(e,t,r){return e.call.apply(e.bind,arguments)}function fe(e,t,r){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(r,n);return e.apply(t,r)}}return function(){return e.apply(t,arguments)}}function he(e,t,r){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?he=le:he=fe;return he.apply(null,arguments)}function de(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();t.push.apply(t,arguments);return e.apply(this,t)}}var pe=Date.now||function(){return+new Date};function ve(e,t){function r(){}r.prototype=t.prototype;e.N=t.prototype;e.prototype=new r;e.prototype.constructor=e;e.yb=function(e,r,n){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[r].apply(e,i)}}function me(){this.j=this.j;this.i=this.i}var ye=0;me.prototype.j=!1;me.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0!=ye)){var e=this[ue]||(this[ue]=++ce)}};me.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var ge=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(ee(e))return ee(t)&&1==t.length?e.indexOf(t,0):-1;for(var r=0;r<e.length;r++)if(r in e&&e[r]===t)return r;return-1},be=Array.prototype.forEach?function(e,t,r){Array.prototype.forEach.call(e,t,r)}:function(e,t,r){for(var n=e.length,i=ee(e)?e.split(""):e,a=0;a<n;a++)a in i&&t.call(r,i[a],a,e)};function we(e){e:{var t=Vn;for(var r=e.length,n=ee(e)?e.split(""):e,i=0;i<r;i++)if(i in n&&t.call(void 0,n[i],i,e)){t=i;break e}t=-1}return 0>t?null:ee(e)?e.charAt(t):e[t]}function _e(e){return Array.prototype.concat.apply([],arguments)}function Se(e){var t=e.length;if(0<t){for(var r=Array(t),n=0;n<t;n++)r[n]=e[n];return r}return[]}function Ee(e){return/^[\s\xa0]*$/.test(e)}var Te=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Ie(e,t){return-1!=e.indexOf(t)}function De(e,t){return e<t?-1:e>t?1:0}var Ce;e:{var Ae=Z.navigator;if(Ae){var Ne=Ae.userAgent;if(Ne){Ce=Ne;break e}}Ce=""}function ke(e,t,r){for(var n in e)t.call(r,e[n],n,e)}function Oe(e){var t={},r;for(r in e)t[r]=e[r];return t}var Me="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xe(e,t){for(var r,n,i=1;i<arguments.length;i++){n=arguments[i];for(r in n)e[r]=n[r];for(var a=0;a<Me.length;a++)r=Me[a],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function Pe(e){Pe[" "](e);return e}Pe[" "]=ne;function Re(e,t){var r=Ge;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}var Le=Ie(Ce,"Opera"),Fe=Ie(Ce,"Trident")||Ie(Ce,"MSIE"),Ve=Ie(Ce,"Edge"),qe=Ve||Fe,je=Ie(Ce,"Gecko")&&!(Ie(Ce.toLowerCase(),"webkit")&&!Ie(Ce,"Edge"))&&!(Ie(Ce,"Trident")||Ie(Ce,"MSIE"))&&!Ie(Ce,"Edge"),Be=Ie(Ce.toLowerCase(),"webkit")&&!Ie(Ce,"Edge");function Ue(){var e=Z.document;return e?e.documentMode:void 0}var We;e:{var ze="",Qe=function(){var e=Ce;if(je)return/rv:([^\);]+)(\)|;)/.exec(e);if(Ve)return/Edge\/([\d\.]+)/.exec(e);if(Fe)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(Be)return/WebKit\/(\S+)/.exec(e);if(Le)return/(?:Version)[ \/]?(\S+)/.exec(e)}();Qe&&(ze=Qe?Qe[1]:"");if(Fe){var Ke=Ue();if(null!=Ke&&Ke>parseFloat(ze)){We=String(Ke);break e}}We=ze}var Ge={};function He(e){return Re(e,(function(){for(var t=0,r=Te(String(We)).split("."),n=Te(String(e)).split("."),i=Math.max(r.length,n.length),a=0;0==t&&a<i;a++){var o=r[a]||"",s=n[a]||"";do{o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""];s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""];if(0==o[0].length&&0==s[0].length)break;t=De(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||De(0==o[2].length,0==s[2].length)||De(o[2],s[2]);o=o[3];s=s[3]}while(0==t)}return 0<=t}))}var Ye;var $e=Z.document;Ye=$e&&Fe?Ue()||("CSS1Compat"==$e.compatMode?parseInt(We,10):5):void 0;var Xe=!Fe||9<=Number(Ye),Je=Fe&&!He("9"),Ze=function(){if(!Z.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Z.addEventListener("test",ne,t),Z.removeEventListener("test",ne,t)}catch(e){}return e}();function et(e,t){this.type=e;this.a=this.target=t;this.Ja=!0}et.prototype.b=function(){this.Ja=!1};function tt(e,t){et.call(this,e?e.type:"");this.relatedTarget=this.a=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType="";this.c=null;if(e){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement;this.a=t;if(t=e.relatedTarget){if(je){e:{try{Pe(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement);this.relatedTarget=t;n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0);this.button=e.button;this.key=e.key||"";this.ctrlKey=e.ctrlKey;this.altKey=e.altKey;this.shiftKey=e.shiftKey;this.metaKey=e.metaKey;this.pointerId=e.pointerId||0;this.pointerType=ee(e.pointerType)?e.pointerType:rt[e.pointerType]||"";this.c=e;e.defaultPrevented&&this.b()}}ve(tt,et);var rt={2:"touch",3:"pen",4:"mouse"};tt.prototype.b=function(){tt.N.b.call(this);var e=this.c;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,Je)try{if(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)e.keyCode=-1}catch(e){}};var nt="closure_listenable_"+(1e6*Math.random()|0),it=0;function at(e,t,r,n,i){this.listener=e;this.proxy=null;this.src=t;this.type=r;this.capture=!!n;this.da=i;this.key=++it;this.X=this.Z=!1}function ot(e){e.X=!0;e.listener=null;e.proxy=null;e.src=null;e.da=null}function st(e){this.src=e;this.a={};this.b=0}st.prototype.add=function(e,t,r,n,i){var a=e.toString();e=this.a[a];e||(e=this.a[a]=[],this.b++);var o=ct(e,t,n,i);-1<o?(t=e[o],r||(t.Z=!1)):(t=new at(t,this.src,a,!!n,i),t.Z=r,e.push(t));return t};function ut(e,t){var r=t.type;if(r in e.a){var n=e.a[r],i=ge(n,t),a;(a=0<=i)&&Array.prototype.splice.call(n,i,1);a&&(ot(t),0==e.a[r].length&&(delete e.a[r],e.b--))}}function ct(e,t,r,n){for(var i=0;i<e.length;++i){var a=e[i];if(!a.X&&a.listener==t&&a.capture==!!r&&a.da==n)return i}return-1}var lt="closure_lm_"+(1e6*Math.random()|0),ft={};function ht(e,t,r,n,i){if(n&&n.once)return vt(e,t,r,n,i);if(ae(t)){for(var a=0;a<t.length;a++)ht(e,t[a],r,n,i);return null}r=Et(r);return e&&e[nt]?e.Aa(t,r,se(n)?!!n.capture:!!n,i):dt(e,t,r,!1,n,i)}function dt(e,t,r,n,i,a){if(!t)throw Error("Invalid event type");var o=se(i)?!!i.capture:!!i;if(o&&!Xe)return null;var s=_t(e);s||(e[lt]=s=new st(e));r=s.add(t,r,n,o,a);if(r.proxy)return r;n=pt();r.proxy=n;n.src=e;n.listener=r;if(e.addEventListener)Ze||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(gt(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function pt(){var e=wt,t=Xe?function(r){return e.call(t.src,t.listener,r)}:function(r){r=e.call(t.src,t.listener,r);if(!r)return r};return t}function vt(e,t,r,n,i){if(ae(t)){for(var a=0;a<t.length;a++)vt(e,t[a],r,n,i);return null}r=Et(r);return e&&e[nt]?e.Ba(t,r,se(n)?!!n.capture:!!n,i):dt(e,t,r,!0,n,i)}function mt(e,t,r,n,i){if(ae(t))for(var a=0;a<t.length;a++)mt(e,t[a],r,n,i);else(n=se(n)?!!n.capture:!!n,r=Et(r),e&&e[nt])?(e=e.c,t=String(t).toString(),t in e.a&&(a=e.a[t],r=ct(a,r,n,i),-1<r&&(ot(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[t],e.b--)))):e&&(e=_t(e))&&(t=e.a[t.toString()],e=-1,t&&(e=ct(t,r,n,i)),(r=-1<e?t[e]:null)&&yt(r))}function yt(e){if(!te(e)&&e&&!e.X){var t=e.src;if(t&&t[nt])ut(t.c,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(gt(r),n):t.addListener&&t.removeListener&&t.removeListener(n);(r=_t(t))?(ut(r,e),0==r.b&&(r.src=null,t[lt]=null)):ot(e)}}}function gt(e){return e in ft?ft[e]:ft[e]="on"+e}function bt(e,t){var r=e.listener,n=e.da||e.src;e.Z&&yt(e);return r.call(n,t)}function wt(e,t){return e.X?!0:Xe?bt(e,new tt(t,this)):(t=new tt(t||re("window.event"),this),bt(e,t))}function _t(e){e=e[lt];return e instanceof st?e:null}var St="__closure_events_fn_"+(1e9*Math.random()>>>0);function Et(e){if("function"==ie(e))return e;e[St]||(e[St]=function(t){return e.handleEvent(t)});return e[St]}function Tt(){me.call(this);this.c=new st(this);this.J=this;this.B=null}ve(Tt,me);Tt.prototype[nt]=!0;X=Tt.prototype;X.addEventListener=function(e,t,r,n){ht(this,e,t,r,n)};X.removeEventListener=function(e,t,r,n){mt(this,e,t,r,n)};X.dispatchEvent=function(e){var t,r=this.B;if(r)for(t=[];r;r=r.B)t.push(r);r=this.J;var n=e.type||e;if(ee(e))e=new et(e,r);else if(e instanceof et)e.target=e.target||r;else{var i=e;e=new et(n,r);xe(e,i)}i=!0;if(t)for(var a=t.length-1;0<=a;a--){var o=e.a=t[a];i=It(o,n,!0,e)&&i}o=e.a=r;i=It(o,n,!0,e)&&i;i=It(o,n,!1,e)&&i;if(t)for(a=0;a<t.length;a++)o=e.a=t[a],i=It(o,n,!1,e)&&i;return i};X.G=function(){Tt.N.G.call(this);if(this.c){var e=this.c,t;for(t in e.a){for(var r=e.a[t],n=0;n<r.length;n++)ot(r[n]);delete e.a[t];e.b--}}this.B=null};X.Aa=function(e,t,r,n){return this.c.add(String(e),t,!1,r,n)};X.Ba=function(e,t,r,n){return this.c.add(String(e),t,!0,r,n)};function It(e,t,r,n){t=e.c.a[String(t)];if(!t)return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.X&&o.capture==r){var s=o.listener,u=o.da||o.src;o.Z&&ut(e.c,o);i=!1!==s.call(u,n)&&i}}return i&&0!=n.Ja}var Dt=Z.JSON.stringify;function Ct(e,t){this.c=e;this.f=t;this.b=0;this.a=null}Ct.prototype.get=function(){if(0<this.b){this.b--;var e=this.a;this.a=e.next;e.next=null}else e=this.c();return e};function At(){this.b=this.a=null}var Nt=new Ct((function(){return new Ot}),(function(e){e.reset()}));At.prototype.add=function(e,t){var r=Nt.get();r.set(e,t);this.b?this.b.next=r:this.a=r;this.b=r};function kt(){var e=Ft,t=null;e.a&&(t=e.a,e.a=e.a.next,e.a||(e.b=null),t.next=null);return t}function Ot(){this.next=this.b=this.a=null}Ot.prototype.set=function(e,t){this.a=e;this.b=t;this.next=null};Ot.prototype.reset=function(){this.next=this.b=this.a=null};function Mt(e){Z.setTimeout((function(){throw e}),0)}function xt(e,t){Pt||Rt();Lt||(Pt(),Lt=!0);Ft.add(e,t)}var Pt;function Rt(){var e=Z.Promise.resolve(void 0);Pt=function(){e.then(Vt)}}var Lt=!1,Ft=new At;function Vt(){for(var e;e=kt();){try{e.a.call(e.b)}catch(e){Mt(e)}var t=Nt;t.f(e);100>t.b&&(t.b++,e.next=t.a,t.a=e)}Lt=!1}function qt(e,t){Tt.call(this);this.b=e||1;this.a=t||Z;this.f=he(this.gb,this);this.g=pe()}ve(qt,Tt);X=qt.prototype;X.ba=!1;X.L=null;X.gb=function(){if(this.ba){var e=pe()-this.g;0<e&&e<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-e):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(jt(this),this.start()))}};X.start=function(){this.ba=!0;this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=pe())};function jt(e){e.ba=!1;e.L&&(e.a.clearTimeout(e.L),e.L=null)}X.G=function(){qt.N.G.call(this);jt(this);delete this.a};function Bt(e,t,r){if("function"==ie(e))r&&(e=he(e,r));else if(e&&"function"==typeof e.handleEvent)e=he(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:Z.setTimeout(e,t||0)}function Ut(e,t,r){me.call(this);this.f=null!=r?he(e,r):e;this.c=t;this.b=he(this.ab,this);this.a=[]}ve(Ut,me);X=Ut.prototype;X.ea=!1;X.U=null;X.Ua=function(e){this.a=arguments;this.U?this.ea=!0:Wt(this)};X.G=function(){Ut.N.G.call(this);this.U&&(Z.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])};X.ab=function(){this.U=null;this.ea&&(this.ea=!1,Wt(this))};function Wt(e){e.U=Bt(e.b,e.c);e.f.apply(null,e.a)}function zt(e){me.call(this);this.b=e;this.a={}}ve(zt,me);var Qt=[];function Kt(e,t,r,n){ae(r)||(r&&(Qt[0]=r.toString()),r=Qt);for(var i=0;i<r.length;i++){var a=ht(t,r[i],n||e.handleEvent,!1,e.b||e);if(!a)break;e.a[a.key]=a}}function Gt(e){ke(e.a,(function(e,t){this.a.hasOwnProperty(t)&&yt(e)}),e);e.a={}}zt.prototype.G=function(){zt.N.G.call(this);Gt(this)};zt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Ht(){}var Yt=new Tt;function $t(e){et.call(this,"serverreachability",e)}ve($t,et);function Xt(e){Yt.dispatchEvent(new $t(Yt,e))}function Jt(e){et.call(this,"statevent",e)}ve(Jt,et);function Zt(e){Yt.dispatchEvent(new Jt(Yt,e))}function er(e){et.call(this,"timingevent",e)}ve(er,et);function tr(e,t){if("function"!=ie(e))throw Error("Fn must not be null and must be a function");return Z.setTimeout((function(){e()}),t)}var rr={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9};var nr={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function ir(){}ir.prototype.a=null;function ar(e){var t;(t=e.a)||(t=e.a={});return t}function or(){}var sr={OPEN:"a",ib:"b",Na:"c",rb:"d"};function ur(){et.call(this,"d")}ve(ur,et);function cr(){et.call(this,"c")}ve(cr,et);var lr;function fr(){}ve(fr,ir);lr=new fr;function hr(e,t,r){this.g=e;this.W=t;this.V=r||1;this.I=new zt(this);this.O=dr;e=qe?125:void 0;this.P=new qt(e);this.h=null;this.b=!1;this.l=this.D=this.f=this.F=this.v=this.R=this.i=null;this.j=[];this.a=null;this.A=0;this.c=this.w=null;this.o=-1;this.m=!1;this.J=0;this.B=null;this.s=this.S=this.H=!1}var dr=45e3,pr={},vr={};X=hr.prototype;X.setTimeout=function(e){this.O=e};function mr(e,t,r){e.F=1;e.f=zr(Fr(t));e.l=r;e.H=!0;gr(e,null)}function yr(e,t,r,n){e.F=1;e.f=zr(Fr(t));e.l=null;e.H=r;gr(e,n)}function gr(e,t){e.v=pe();_r(e);e.D=Fr(e.f);Wr(e.D,"t",e.V);e.A=0;e.a=e.g.$(e.g.Y()?t:null);0<e.J&&(e.B=new Ut(he(e.Ka,e,e.a),e.J));Kt(e.I,e.a,"readystatechange",e.eb);t=e.h?Oe(e.h):{};e.l?(e.w||(e.w="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.a.ca(e.D,e.w,e.l,t)):(e.w="GET",e.a.ca(e.D,e.w,null,t));Xt(1)}X.eb=function(e){e=e.target;var t=this.B;t&&3==zn(e)?t.Ua():this.Ka(e)};X.Ka=function(e){try{if(e==this.a)e:{var t=zn(this.a),r=this.a.ya(),n=this.a.T();if(!(3>t||3==t&&!qe&&!this.a.aa())){this.m||4!=t||7==r||(8==r||0>=n?Xt(3):Xt(2));Er(this);var i=this.a.T();this.o=i;var a=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){t:{if(this.a){var o=Qn(this.a,"X-HTTP-Initial-Response");if(o&&!Ee(o)){var s=o;break t}}s=null}if(s)this.s=!0,Dr(this,s);else{this.b=!1;this.c=3;Zt(12);Ir(this);Tr(this);break e}}this.H?(br(this,t,a),qe&&this.b&&3==t&&(Kt(this.I,this.P,"tick",this.cb),this.P.start())):Dr(this,a);4==t&&Ir(this);this.b&&!this.m&&(4==t?this.g.na(this):(this.b=!1,_r(this)))}else 400==i&&0<a.indexOf("Unknown SID")?(this.c=3,Zt(12)):(this.c=0,Zt(13)),Ir(this),Tr(this)}}}catch(e){}finally{}};function br(e,t,r){for(var n=!0;!e.m&&e.A<r.length;){var i=wr(e,r);if(i==vr){4==t&&(e.c=4,Zt(14),n=!1);break}else if(i==pr){e.c=4;Zt(15);n=!1;break}else Dr(e,i)}4==t&&0==r.length&&(e.c=1,Zt(16),n=!1);e.b=e.b&&n;n||(Ir(e),Tr(e))}X.cb=function(){if(this.a){var e=zn(this.a),t=this.a.aa();this.A<t.length&&(Er(this),br(this,e,t),this.b&&4!=e&&_r(this))}};function wr(e,t){var r=e.A,n=t.indexOf("\n",r);if(-1==n)return vr;r=Number(t.substring(r,n));if(isNaN(r))return pr;n+=1;if(n+r>t.length)return vr;t=t.substr(n,r);e.A=n+r;return t}X.cancel=function(){this.m=!0;Ir(this)};function _r(e){e.R=pe()+e.O;Sr(e,e.O)}function Sr(e,t){if(null!=e.i)throw Error("WatchDog timer not null");e.i=tr(he(e.bb,e),t)}function Er(e){e.i&&(Z.clearTimeout(e.i),e.i=null)}X.bb=function(){this.i=null;var e=pe();0<=e-this.R?(2!=this.F&&(Xt(3),Zt(17)),Ir(this),this.c=2,Tr(this)):Sr(this,this.R-e)};function Tr(e){e.g.Da()||e.m||e.g.na(e)}function Ir(e){Er(e);var t=e.B;t&&"function"==typeof t.la&&t.la();e.B=null;jt(e.P);Gt(e.I);e.a&&(t=e.a,e.a=null,t.abort(),t.la())}function Dr(e,t){try{e.g.Ga(e,t),Xt(4)}catch(e){}}function Cr(e){if(e.C&&"function"==typeof e.C)return e.C();if(ee(e))return e.split("");if(oe(e)){for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n]);return t}t=[];r=0;for(n in e)t[r++]=e[n];return t}function Ar(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(oe(e)||ee(e))be(e,t,void 0);else{if(e.K&&"function"==typeof e.K)var r=e.K();else if(e.C&&"function"==typeof e.C)r=void 0;else if(oe(e)||ee(e)){r=[];for(var n=e.length,i=0;i<n;i++)r.push(i)}else for(i in r=[],n=0,e)r[n++]=i;n=Cr(e);i=n.length;for(var a=0;a<i;a++)t.call(void 0,n[a],r&&r[a],e)}}function Nr(e,t){this.b={};this.a=[];this.c=0;var r=arguments.length;if(1<r){if(r%2)throw Error("Uneven number of arguments");for(var n=0;n<r;n+=2)this.set(arguments[n],arguments[n+1])}else if(e)if(e instanceof Nr)for(r=e.K(),n=0;n<r.length;n++)this.set(r[n],e.get(r[n]));else for(n in e)this.set(n,e[n])}X=Nr.prototype;X.C=function(){Mr(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e};X.K=function(){Mr(this);return this.a.concat()};function kr(e){e.b={};e.a.length=0;e.c=0}function Or(e,t){xr(e.b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&Mr(e))}function Mr(e){if(e.c!=e.a.length){for(var t=0,r=0;t<e.a.length;){var n=e.a[t];xr(e.b,n)&&(e.a[r++]=n);t++}e.a.length=r}if(e.c!=e.a.length){var i={};for(r=t=0;t<e.a.length;)n=e.a[t],xr(i,n)||(e.a[r++]=n,i[n]=1),t++;e.a.length=r}}X.get=function(e,t){return xr(this.b,e)?this.b[e]:t};X.set=function(e,t){xr(this.b,e)||(this.c++,this.a.push(e));this.b[e]=t};X.forEach=function(e,t){for(var r=this.K(),n=0;n<r.length;n++){var i=r[n],a=this.get(i);e.call(t,a,i,this)}};function xr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Pr=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Rr(e,t){if(e){e=e.split("&");for(var r=0;r<e.length;r++){var n=e[r].indexOf("="),i=null;if(0<=n){var a=e[r].substring(0,n);i=e[r].substring(n+1)}else a=e[r];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Lr(e,t){this.b=this.j=this.f="";this.i=null;this.g=this.a="";this.h=!1;var r;e instanceof Lr?(this.h=void 0!==t?t:e.h,Vr(this,e.f),this.j=e.j,qr(this,e.b),jr(this,e.i),this.a=e.a,Br(this,sn(e.c)),this.g=e.g):e&&(r=String(e).match(Pr))?(this.h=!!t,Vr(this,r[1]||"",!0),this.j=Gr(r[2]||""),qr(this,r[3]||"",!0),jr(this,r[4]),this.a=Gr(r[5]||"",!0),Br(this,r[6]||"",!0),this.g=Gr(r[7]||"")):(this.h=!!t,this.c=new tn(null,this.h))}Lr.prototype.toString=function(){var e=[],t=this.f;t&&e.push(Hr(t,$r,!0),":");var r=this.b;if(r||"file"==t)e.push("//"),(t=this.j)&&e.push(Hr(t,$r,!0),"@"),e.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),r=this.i,null!=r&&e.push(":",String(r));if(r=this.a)this.b&&"/"!=r.charAt(0)&&e.push("/"),e.push(Hr(r,"/"==r.charAt(0)?Jr:Xr,!0));(r=this.c.toString())&&e.push("?",r);(r=this.g)&&e.push("#",Hr(r,en));return e.join("")};Lr.prototype.resolve=function(e){var t=Fr(this),r=!!e.f;r?Vr(t,e.f):r=!!e.j;r?t.j=e.j:r=!!e.b;r?qr(t,e.b):r=null!=e.i;var n=e.a;if(r)jr(t,e.i);else if(r=!!e.a){if("/"!=n.charAt(0))if(this.b&&!this.a)n="/"+n;else{var i=t.a.lastIndexOf("/");-1!=i&&(n=t.a.substr(0,i+1)+n)}i=n;if(".."==i||"."==i)n="";else if(Ie(i,"./")||Ie(i,"/.")){n=0==i.lastIndexOf("/",0);i=i.split("/");for(var a=[],o=0;o<i.length;){var s=i[o++];"."==s?n&&o==i.length&&a.push(""):".."==s?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),n&&o==i.length&&a.push("")):(a.push(s),n=!0)}n=a.join("/")}else n=i}r?t.a=n:r=""!==e.c.toString();r?Br(t,sn(e.c)):r=!!e.g;r&&(t.g=e.g);return t};function Fr(e){return new Lr(e)}function Vr(e,t,r){e.f=r?Gr(t,!0):t;e.f&&(e.f=e.f.replace(/:$/,""))}function qr(e,t,r){e.b=r?Gr(t,!0):t}function jr(e,t){if(t){t=Number(t);if(isNaN(t)||0>t)throw Error("Bad port number "+t);e.i=t}else e.i=null}function Br(e,t,r){t instanceof tn?(e.c=t,cn(e.c,e.h)):(r||(t=Hr(t,Zr)),e.c=new tn(t,e.h))}function Ur(e,t,r){e.c.set(t,r)}function Wr(e,t,r){ae(r)||(r=[String(r)]);on(e.c,t,r)}function zr(e){Ur(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^pe()).toString(36));return e}function Qr(e){return e instanceof Lr?Fr(e):new Lr(e,void 0)}function Kr(e,t,r,n){var i=new Lr(null,void 0);e&&Vr(i,e);t&&qr(i,t);r&&jr(i,r);n&&(i.a=n);return i}function Gr(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Hr(e,t,r){return ee(e)?(e=encodeURI(e).replace(t,Yr),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Yr(e){e=e.charCodeAt(0);return"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var $r=/[#\/\?@]/g,Xr=/[#\?:]/g,Jr=/[#\?]/g,Zr=/[#\?@]/g,en=/#/g;function tn(e,t){this.b=this.a=null;this.c=e||null;this.f=!!t}function rn(e){e.a||(e.a=new Nr,e.b=0,e.c&&Rr(e.c,(function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)})))}X=tn.prototype;X.add=function(e,t){rn(this);this.c=null;e=un(this,e);var r=this.a.get(e);r||this.a.set(e,r=[]);r.push(t);this.b+=1;return this};function nn(e,t){rn(e);t=un(e,t);xr(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,Or(e.a,t))}function an(e,t){rn(e);t=un(e,t);return xr(e.a.b,t)}X.forEach=function(e,t){rn(this);this.a.forEach((function(r,n){be(r,(function(r){e.call(t,r,n,this)}),this)}),this)};X.K=function(){rn(this);for(var e=this.a.C(),t=this.a.K(),r=[],n=0;n<t.length;n++)for(var i=e[n],a=0;a<i.length;a++)r.push(t[n]);return r};X.C=function(e){rn(this);var t=[];if(ee(e))an(this,e)&&(t=_e(t,this.a.get(un(this,e))));else{e=this.a.C();for(var r=0;r<e.length;r++)t=_e(t,e[r])}return t};X.set=function(e,t){rn(this);this.c=null;e=un(this,e);an(this,e)&&(this.b-=this.a.get(e).length);this.a.set(e,[t]);this.b+=1;return this};X.get=function(e,t){if(!e)return t;e=this.C(e);return 0<e.length?String(e[0]):t};function on(e,t,r){nn(e,t);0<r.length&&(e.c=null,e.a.set(un(e,t),Se(r)),e.b+=r.length)}X.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.K(),r=0;r<t.length;r++){var n=t[r],i=encodeURIComponent(String(n));n=this.C(n);for(var a=0;a<n.length;a++){var o=i;""!==n[a]&&(o+="="+encodeURIComponent(String(n[a])));e.push(o)}}return this.c=e.join("&")};function sn(e){var t=new tn;t.c=e.c;e.a&&(t.a=new Nr(e.a),t.b=e.b);return t}function un(e,t){t=String(t);e.f&&(t=t.toLowerCase());return t}function cn(e,t){t&&!e.f&&(rn(e),e.c=null,e.a.forEach((function(e,t){var r=t.toLowerCase();t!=r&&(nn(this,t),on(this,r,e))}),e));e.f=t}function ln(){}function fn(){}ve(fn,ln);function hn(e){this.a=e;this.b=this.h=null;this.g=!1;this.i=null;this.c=-1;this.l=this.f=null}X=hn.prototype;X.M=null;function dn(e){var t=e.a.F.a;if(null!=t)Zt(4),t?(Zt(10),ai(e.a,e,!1)):(Zt(11),ai(e.a,e,!0));else{e.b=new hr(e,void 0,void 0);e.b.h=e.h;t=e.a;t=li(t,t.Y()?e.f:null,e.i);Zt(4);Wr(t,"TYPE","xmlhttp");var r=e.a.j,n=e.a.I;r&&n&&Ur(t,r,n);yr(e.b,t,!1,e.f)}}X.$=function(e){return this.a.$(e)};X.abort=function(){this.b&&(this.b.cancel(),this.b=null);this.c=-1};X.Da=function(){return!1};X.Ga=function(e,t){this.c=e.o;if(0==this.M){if(!this.a.o&&(e=e.a)){var r=Qn(e,"X-Client-Wire-Protocol");this.l=r?r:null;this.a.j&&(e=Qn(e,"X-HTTP-Session-Id"))&&(this.a.I=e)}if(t){try{var n=this.a.ja.a.parse(t)}catch(e){t=this.a;t.m=this.c;ui(t,2);return}this.f=n[0]}else t=this.a,t.m=this.c,ui(t,2)}else if(1==this.M)if(this.g)Zt(6);else if("11111"==t){if(Zt(5),this.g=!0,!Fe||10<=Number(Ye))this.c=200,this.b.cancel(),Zt(11),ai(this.a,this,!0)}else Zt(7),this.g=!1};X.na=function(){this.c=this.b.o;if(this.b.b)0==this.M?(this.M=1,dn(this)):1==this.M&&(this.g?(Zt(11),ai(this.a,this,!0)):(Zt(10),ai(this.a,this,!1)));else{0==this.M?Zt(8):1==this.M&&Zt(9);var e=this.a;e.m=this.c;ui(e,2)}};X.Y=function(){return this.a.Y()};X.ma=function(){return this.a.ma()};function pn(){this.a=this.b=null}function vn(){this.a=new Nr}function mn(e){var t=typeof e;return"object"==t&&e||"function"==t?"o"+(e[ue]||(e[ue]=++ce)):t.charAt(0)+e}vn.prototype.add=function(e){this.a.set(mn(e),e)};vn.prototype.C=function(){return this.a.C()};function yn(e,t){this.b=e;this.a=t}function gn(e){this.g=e||bn;Z.PerformanceNavigationTiming?(e=Z.performance.getEntriesByType("navigation"),e=0<e.length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol)):e=!!(Z.ka&&Z.ka.Ea&&Z.ka.Ea()&&Z.ka.Ea().zb);this.f=e?this.g:1;this.a=null;1<this.f&&(this.a=new vn);this.b=null;this.c=[]}var bn=10;function wn(e,t){!e.a&&(Ie(t,"spdy")||Ie(t,"quic")||Ie(t,"h2"))&&(e.f=e.g,e.a=new vn,e.b&&(Tn(e,e.b),e.b=null))}function _n(e){return e.b?!0:e.a?e.a.a.c>=e.f:!1}function Sn(e){return e.b?1:e.a?e.a.a.c:0}function En(e,t){e.b?e=e.b==t:e.a?(t=mn(t),e=xr(e.a.a.b,t)):e=!1;return e}function Tn(e,t){e.a?e.a.add(t):e.b=t}function In(e,t){if(e.b&&e.b==t)e.b=null;else{var r;if(r=e.a)r=mn(t),r=xr(e.a.a.b,r);r&&Or(e.a.a,mn(t))}}gn.prototype.cancel=function(){this.c=Dn(this);this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(be(this.a.C(),(function(e){e.cancel()})),kr(this.a.a))};function Dn(e){if(null!=e.b)return e.c.concat(e.b.j);if(null!=e.a&&0!=e.a.a.c){var t=e.c;be(e.a.C(),(function(e){t=t.concat(e.j)}));return t}return Se(e.c)}function Cn(){}Cn.prototype.stringify=function(e){return Z.JSON.stringify(e,void 0)};Cn.prototype.parse=function(e){return Z.JSON.parse(e,void 0)};function An(){this.a=new Cn}function Nn(e,t,r){var n=r||"";try{Ar(e,(function(e,r){var i=e;se(e)&&(i=Dt(e));t.push(n+r+"="+encodeURIComponent(i))}))}catch(e){throw t.push(n+"type="+encodeURIComponent("_badmap")),e}}function kn(e,t){var r=new Ht;if(Z.Image){var n=new Image;n.onload=de(On,r,n,"TestLoadImage: loaded",!0,t);n.onerror=de(On,r,n,"TestLoadImage: error",!1,t);n.onabort=de(On,r,n,"TestLoadImage: abort",!1,t);n.ontimeout=de(On,r,n,"TestLoadImage: timeout",!1,t);Z.setTimeout((function(){if(n.ontimeout)n.ontimeout()}),1e4);n.src=e}else t(!1)}function On(e,t,r,n,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(n)}catch(e){}}var Mn=Z.JSON.parse;function xn(e){Tt.call(this);this.headers=new Nr;this.H=e||null;this.b=!1;this.s=this.a=null;this.A="";this.h=0;this.f="";this.g=this.w=this.l=this.v=!1;this.o=0;this.m=null;this.I=Pn;this.D=this.F=!1}ve(xn,Tt);var Pn="",Rn=/^https?$/i,Ln=["POST","PUT"];X=xn.prototype;X.ca=function(e,t,r,n){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+e);t=t?t.toUpperCase():"GET";this.A=e;this.f="";this.h=0;this.v=!1;this.b=!0;this.a=new XMLHttpRequest;this.s=this.H?ar(this.H):ar(lr);this.a.onreadystatechange=he(this.Fa,this);try{this.w=!0,this.a.open(t,String(e),!0),this.w=!1}catch(e){qn(this,e);return}e=r||"";var i=new Nr(this.headers);n&&Ar(n,(function(e,t){i.set(t,e)}));n=we(i.K());r=Z.FormData&&e instanceof Z.FormData;!(0<=ge(Ln,t))||n||r||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");i.forEach((function(e,t){this.a.setRequestHeader(t,e)}),this);this.I&&(this.a.responseType=this.I);"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Wn(this),0<this.o&&((this.D=Fn(this.a))?(this.a.timeout=this.o,this.a.ontimeout=he(this.Ca,this)):this.m=Bt(this.Ca,this.o,this)),this.l=!0,this.a.send(e),this.l=!1}catch(e){qn(this,e)}};function Fn(e){return Fe&&He(9)&&te(e.timeout)&&void 0!==e.ontimeout}function Vn(e){return"content-type"==e.toLowerCase()}X.Ca=function(){"undefined"!=typeof J&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))};function qn(e,t){e.b=!1;e.a&&(e.g=!0,e.a.abort(),e.g=!1);e.f=t;e.h=5;jn(e);Un(e)}function jn(e){e.v||(e.v=!0,e.dispatchEvent("complete"),e.dispatchEvent("error"))}X.abort=function(e){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=e||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Un(this))};X.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Un(this,!0));xn.N.G.call(this)};X.Fa=function(){this.j||(this.w||this.l||this.g?Bn(this):this.$a())};X.$a=function(){Bn(this)};function Bn(e){if(e.b&&"undefined"!=typeof J&&(!e.s[1]||4!=zn(e)||2!=e.T()))if(e.l&&4==zn(e))Bt(e.Fa,0,e);else if(e.dispatchEvent("readystatechange"),4==zn(e)){e.b=!1;try{var t=e.T();e:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}var n;if(!(n=r)){var i;if(i=0===t){var a=String(e.A).match(Pr)[1]||null;if(!a&&Z.self&&Z.self.location){var o=Z.self.location.protocol;a=o.substr(0,o.length-1)}i=!Rn.test(a?a.toLowerCase():"")}n=i}n?(e.dispatchEvent("complete"),e.dispatchEvent("success")):(e.h=6,e.f=e.za()+" ["+e.T()+"]",jn(e))}finally{Un(e)}}}function Un(e,t){if(e.a){Wn(e);var r=e.a,n=e.s[0]?ne:null;e.a=null;e.s=null;t||e.dispatchEvent("ready");try{r.onreadystatechange=n}catch(e){}}}function Wn(e){e.a&&e.D&&(e.a.ontimeout=null);e.m&&(Z.clearTimeout(e.m),e.m=null)}function zn(e){return e.a?e.a.readyState:0}X.T=function(){try{return 2<zn(this)?this.a.status:-1}catch(e){return-1}};X.za=function(){try{return 2<zn(this)?this.a.statusText:""}catch(e){return""}};X.aa=function(){try{return this.a?this.a.responseText:""}catch(e){return""}};X.Va=function(e){if(this.a){var t=this.a.responseText;e&&0==t.indexOf(e)&&(t=t.substring(e.length));return Mn(t)}};function Qn(e,t){return e.a?e.a.getResponseHeader(t):null}X.ya=function(){return this.h};X.Ya=function(){return ee(this.f)?this.f:String(this.f)};function Kn(e){var t="";ke(e,(function(e,r){t+=r;t+=":";t+=e;t+="\r\n"}));return t}function Gn(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}if(n)return e;r=Kn(r);if(ee(e)){t=encodeURIComponent(String(t));r=null!=r?"="+encodeURIComponent(String(r)):"";if(t+=r){r=e.indexOf("#");0>r&&(r=e.length);n=e.indexOf("?");if(0>n||n>r){n=r;var i=""}else i=e.substring(n+1,r);e=[e.substr(0,n),i,e.substr(r)];r=e[1];e[1]=t?r?r+"&"+t:t:r;e=e[0]+(e[1]?"?"+e[1]:"")+e[2]}return e}Ur(e,t,r);return e}function Hn(e){this.f=[];this.F=new pn;this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null;this.Ra=this.P=0;this.Pa=!!re("internalChannelParams.failFast",e);this.ia=this.w=this.s=this.l=this.h=this.c=null;this.oa=!0;this.m=this.ra=this.O=-1;this.S=this.v=this.A=0;this.Oa=re("internalChannelParams.baseRetryDelayMs",e)||5e3;this.Sa=re("internalChannelParams.retryDelaySeedMs",e)||1e4;this.Qa=re("internalChannelParams.forwardChannelMaxRetries",e)||2;this.qa=re("internalChannelParams.forwardChannelRequestTimeoutMs",e)||2e4;this.La=e&&e.Ab||void 0;this.D=void 0;this.R=e&&e.supportsCrossDomainXhr||!1;this.H="";this.b=new gn(e&&e.concurrentRequestLimit);this.ja=new An;this.o=e&&void 0!==e.backgroundChannelTest?e.backgroundChannelTest:!0;(this.W=e&&e.fastHandshake||!1)&&!this.o&&(this.o=!0);e&&e.forceLongPolling&&(this.oa=!1);this.fa=void 0}X=Hn.prototype;X.wa=8;X.u=1;function Yn(e){$n(e);if(3==e.u){var t=e.P++,r=Fr(e.B);Ur(r,"SID",e.H);Ur(r,"RID",t);Ur(r,"TYPE","terminate");ti(e,r);t=new hr(e,t,void 0);t.F=2;t.f=zr(Fr(r));r=!1;Z.navigator&&Z.navigator.sendBeacon&&(r=Z.navigator.sendBeacon(t.f.toString(),""));!r&&Z.Image&&((new Image).src=t.f,r=!0);r||(t.a=t.g.$(null),t.a.ca(t.f));t.v=pe();_r(t)}ci(e)}function $n(e){e.w&&(e.w.abort(),e.w=null);e.a&&(e.a.cancel(),e.a=null);e.l&&(Z.clearTimeout(e.l),e.l=null);oi(e);e.b.cancel();e.h&&(te(e.h)&&Z.clearTimeout(e.h),e.h=null)}function Xn(e,t){e.f.push(new yn(e.Ra++,t));3==e.u&&Jn(e)}X.Da=function(){return 0==this.u};function Jn(e){_n(e.b)||e.h||(e.h=!0,xt(e.Ia,e),e.A=0)}function Zn(e,t){if(Sn(e.b)>=e.b.f-(e.h?1:0))return!1;if(e.h)return e.f=t.j.concat(e.f),!0;if(1==e.u||2==e.u||e.A>=(e.Pa?0:e.Qa))return!1;e.h=tr(he(e.Ia,e,t),si(e,e.A));e.A++;return!0}X.Ia=function(e){if(this.h)if(this.h=null,1==this.u){if(!e){this.P=Math.floor(1e5*Math.random());e=this.P++;var t=new hr(this,e,void 0),r=this.i;this.J&&(r?(r=Oe(r),xe(r,this.J)):r=this.J);null===this.g&&(t.h=r);var n;if(this.W)e:{for(var i=n=0;i<this.f.length;i++){t:{var a=this.f[i];if("__data__"in a.a&&(a=a.a.__data__,ee(a))){a=a.length;break t}a=void 0}if(void 0===a)break;n+=a;if(4096<n){n=i;break e}if(4096===n||i===this.f.length-1){n=i+1;break e}}n=1e3}else n=1e3;n=ri(this,t,n);i=Fr(this.B);Ur(i,"RID",e);Ur(i,"CVER",22);this.o&&this.j&&Ur(i,"X-HTTP-Session-Id",this.j);ti(this,i);this.g&&r&&Gn(i,this.g,r);Tn(this.b,t);this.W?(Ur(i,"$req",n),Ur(i,"SID","null"),t.S=!0,mr(t,i,null)):mr(t,i,n);this.u=2}}else 3==this.u&&(e?ei(this,e):0==this.f.length||_n(this.b)||ei(this))};function ei(e,t){var r;t?r=t.W:r=e.P++;var n=Fr(e.B);Ur(n,"SID",e.H);Ur(n,"RID",r);Ur(n,"AID",e.O);ti(e,n);e.g&&e.i&&Gn(n,e.g,e.i);r=new hr(e,r,e.A+1);null===e.g&&(r.h=e.i);t&&(e.f=t.j.concat(e.f));t=ri(e,r,1e3);r.setTimeout(Math.round(.5*e.qa)+Math.round(.5*e.qa*Math.random()));Tn(e.b,r);mr(r,n,t)}function ti(e,t){e.c&&Ar({},(function(e,r){Ur(t,r,e)}))}function ri(e,t,r){r=Math.min(e.f.length,r);var n=e.c?he(e.c.Ta,e.c,e):null;e:for(var i=e.f,a=-1;;){var o=["count="+r];-1==a?0<r?(a=i[0].b,o.push("ofs="+a)):a=0:o.push("ofs="+a);for(var s=!0,u=0;u<r;u++){var c=i[u].b,l=i[u].a;c-=a;if(0>c)a=Math.max(0,i[u].b-100),s=!1;else try{Nn(l,o,"req"+c+"_")}catch(e){n&&n(l)}}if(s){n=o.join("&");break e}}e=e.f.splice(0,r);t.j=e;return n}function ni(e){e.a||e.l||(e.S=1,xt(e.Ha,e),e.v=0)}function ii(e){if(e.a||e.l||3<=e.v)return!1;e.S++;e.l=tr(he(e.Ha,e),si(e,e.v));e.v++;return!0}X.Ha=function(){this.l=null;this.a=new hr(this,"rpc",this.S);null===this.g&&(this.a.h=this.i);this.a.J=0;var e=Fr(this.pa);Ur(e,"RID","rpc");Ur(e,"SID",this.H);Ur(e,"CI",this.ia?"0":"1");Ur(e,"AID",this.O);ti(this,e);Ur(e,"TYPE","xmlhttp");this.g&&this.i&&Gn(e,this.g,this.i);this.D&&this.a.setTimeout(this.D);yr(this.a,e,!0,this.ga)};function ai(e,t,r){var n=t.l;n&&wn(e.b,n);e.ia=e.oa&&r;e.m=t.c;e.B=li(e,null,e.ha);Jn(e)}X.Ga=function(e,t){if(0!=this.u&&(this.a==e||En(this.b,e)))if(this.m=e.o,!e.s&&En(this.b,e)&&3==this.u){try{var r=this.ja.a.parse(t)}catch(e){r=null}if(ae(r)&&3==r.length){t=r;if(0==t[0])e:{if(!this.l){if(this.a)if(this.a.v+3e3<e.v)oi(this),this.a.cancel(),this.a=null;else break e;ii(this);Zt(18)}}else this.ra=t[1],0<this.ra-this.O&&37500>t[2]&&this.ia&&0==this.v&&!this.s&&(this.s=tr(he(this.Za,this),6e3));if(1>=Sn(this.b)&&this.fa){try{this.fa()}catch(e){}this.fa=void 0}}else ui(this,11)}else if((e.s||this.a==e)&&oi(this),!Ee(t))for(t=r=this.ja.a.parse(t),r=0;r<t.length;r++){var n=t[r];this.O=n[0];n=n[1];if(2==this.u)if("c"==n[0]){this.H=n[1];this.ga=n[2];var i=n[3];null!=i&&(this.wa=i);n=n[5];null!=n&&te(n)&&0<n&&(this.D=1.5*n);this.o&&(n=e.a)&&((i=Qn(n,"X-Client-Wire-Protocol"))&&wn(this.b,i),this.j&&(n=Qn(n,"X-HTTP-Session-Id")))&&(this.I=n,Ur(this.B,this.j,n));this.u=3;this.c&&this.c.va();n=e;this.pa=li(this,this.Y()?this.ga:null,this.ha);n.s?(In(this.b,n),(i=this.D)&&n.setTimeout(i),n.i&&(Er(n),_r(n)),this.a=n):ni(this);0<this.f.length&&Jn(this)}else"stop"!=n[0]&&"close"!=n[0]||ui(this,7);else 3==this.u&&("stop"==n[0]||"close"==n[0]?"stop"==n[0]?ui(this,7):Yn(this):"noop"!=n[0]&&this.c&&this.c.ua(n),this.v=0)}};X.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,ii(this),Zt(19))};function oi(e){null!=e.s&&(Z.clearTimeout(e.s),e.s=null)}X.na=function(e){var t=null;if(this.a==e){oi(this);this.a=null;var r=2}else if(En(this.b,e))t=e.j,In(this.b,e),r=1;else return;this.m=e.o;if(0!=this.u)if(e.b)1==r?(t=pe()-e.v,Yt.dispatchEvent(new er(Yt,e.l?e.l.length:0,t,this.A)),Jn(this)):ni(this);else{var n=e.c;if(3==n||0==n&&0<this.m||!(1==r&&Zn(this,e)||2==r&&ii(this)))switch(t&&0<t.length&&(e=this.b,e.c=e.c.concat(t)),n){case 1:ui(this,5);break;case 4:ui(this,10);break;case 3:ui(this,6);break;default:ui(this,2)}}};function si(e,t){var r=e.Oa+Math.floor(Math.random()*e.Sa);e.ma()||(r*=2);return r*t}function ui(e,t){if(2==t){var r=null;e.c&&(r=null);var n=he(e.fb,e);r||(r=new Lr("//www.google.com/images/cleardot.gif"),Z.location&&"http"==Z.location.protocol||Vr(r,"https"),zr(r));kn(r.toString(),n)}else Zt(2);e.u=0;e.c&&e.c.ta(t);ci(e);$n(e)}X.fb=function(e){e?Zt(2):Zt(1)};function ci(e){e.u=0;e.m=-1;if(e.c){if(0!=Dn(e.b).length||0!=e.f.length)e.b.c.length=0,Se(e.f),e.f.length=0;e.c.sa()}}function li(e,t,r){var n=Qr(r);if(""!=n.b)t&&qr(n,t+"."+n.b),jr(n,n.i);else{var i=Z.location,a;t?a=t+"."+i.hostname:a=i.hostname;n=Kr(i.protocol,a,+i.port,r)}e.V&&ke(e.V,(function(e,t){Ur(n,t,e)}));t=e.j;r=e.I;t&&r&&Ur(n,t,r);Ur(n,"VER",e.wa);ti(e,n);return n}X.$=function(e){if(e&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");e=new xn(this.La);e.F=this.R;return e};X.ma=function(){return!!this.c&&!0};X.Y=function(){return this.R};function fi(){}X=fi.prototype;X.va=function(){};X.ua=function(){};X.ta=function(){};X.sa=function(){};X.Ta=function(){};function hi(e){for(var t=arguments[0],r=1;r<arguments.length;r++){var n=arguments[r];if(0==n.lastIndexOf("/",0))t=n;else{var i;(i=""==t)||(i=t.length-1,i=0<=i&&t.indexOf("/",i)==i);i?t+=n:t+="/"+n}}return t}function di(){if(Fe&&!(10<=Number(Ye)))throw Error("Environmental error: no available transport.")}di.prototype.a=function(e,t){return new pi(e,t)};function pi(e,t){Tt.call(this);this.a=new Hn(t);this.g=e;this.m=t&&t.testUrl?t.testUrl:hi(this.g,"test");this.b=t&&t.messageUrlParams||null;e=t&&t.messageHeaders||null;t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"});this.a.i=e;e=t&&t.initMessageHeaders||null;t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType});t&&t.xa&&(e?e["X-WebChannel-Client-Profile"]=t.xa:e={"X-WebChannel-Client-Profile":t.xa});this.a.J=e;(e=t&&t.httpHeadersOverwriteParam)&&!Ee(e)&&(this.a.g=e);this.l=t&&t.supportsCrossDomainXhr||!1;this.h=t&&t.sendRawJson||!1;(t=t&&t.httpSessionIdParam)&&!Ee(t)&&(this.a.j=t,e=this.b,null!==e&&t in e&&(e=this.b,t in e&&delete e[t]));this.f=new yi(this)}ve(pi,Tt);X=pi.prototype;X.addEventListener=function(e,t,r,n){pi.N.addEventListener.call(this,e,t,r,n)};X.removeEventListener=function(e,t,r,n){pi.N.removeEventListener.call(this,e,t,r,n)};X.Wa=function(){this.a.c=this.f;this.l&&(this.a.R=!0);var e=this.a,t=this.m,r=this.g,n=this.b||void 0;Zt(0);e.ha=r;e.V=n||{};e.o&&(e.F.b=[],e.F.a=!1);e.w=new hn(e);null===e.g&&(e.w.h=e.i);r=t;e.g&&e.i&&(r=Gn(t,e.g,e.i));e=e.w;e.i=r;t=li(e.a,null,e.i);Zt(3);r=e.a.F.b;null!=r?(e.f=r[0],e.M=1,dn(e)):(Wr(t,"MODE","init"),!e.a.o&&e.a.j&&Wr(t,"X-HTTP-Session-Id",e.a.j),e.b=new hr(e,void 0,void 0),e.b.h=e.h,yr(e.b,t,!1,null),e.M=0)};X.close=function(){Yn(this.a)};X.Xa=function(e){if(ee(e)){var t={};t.__data__=e;Xn(this.a,t)}else this.h?(t={},t.__data__=Dt(e),Xn(this.a,t)):Xn(this.a,e)};X.G=function(){this.a.c=null;delete this.f;Yn(this.a);delete this.a;pi.N.G.call(this)};function vi(e){ur.call(this);var t=e.__sm__;if(t){e:{for(var r in t){e=r;break e}e=void 0}(this.c=e)?(e=this.c,this.data=null!==t&&e in t?t[e]:void 0):this.data=t}else this.data=e}ve(vi,ur);function mi(){cr.call(this);this.status=1}ve(mi,cr);function yi(e){this.a=e}ve(yi,fi);yi.prototype.va=function(){this.a.dispatchEvent("a")};yi.prototype.ua=function(e){this.a.dispatchEvent(new vi(e))};yi.prototype.ta=function(e){this.a.dispatchEvent(new mi(e))};yi.prototype.sa=function(){this.a.dispatchEvent("b")};var gi=de((function(e,t){function r(){}r.prototype=e.prototype;var n=new r;e.apply(n,Array.prototype.slice.call(arguments,1));return n}),di);di.prototype.createWebChannel=di.prototype.a;pi.prototype.send=pi.prototype.Xa;pi.prototype.open=pi.prototype.Wa;pi.prototype.close=pi.prototype.close;rr.NO_ERROR=0;rr.TIMEOUT=8;rr.HTTP_ERROR=6;nr.COMPLETE="complete";or.EventType=sr;sr.OPEN="a";sr.CLOSE="b";sr.ERROR="c";sr.MESSAGE="d";Tt.prototype.listen=Tt.prototype.Aa;xn.prototype.listenOnce=xn.prototype.Ba;xn.prototype.getLastError=xn.prototype.Ya;xn.prototype.getLastErrorCode=xn.prototype.ya;xn.prototype.getStatus=xn.prototype.T;xn.prototype.getStatusText=xn.prototype.za;xn.prototype.getResponseJson=xn.prototype.Va;xn.prototype.getResponseText=xn.prototype.aa;xn.prototype.send=xn.prototype.ca;var bi={createWebChannelTransport:gi,ErrorCode:rr,EventType:nr,WebChannel:or,XhrIo:xn};var wi=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var n=r(K);var i=n.SDK_VERSION;var a=new Q.Logger("@firebase/firestore");var o;(function(e){e[e["DEBUG"]=0]="DEBUG";e[e["ERROR"]=1]="ERROR";e[e["SILENT"]=2]="SILENT"})(o||(o={}));function s(){if(a.logLevel===Q.LogLevel.DEBUG){return o.DEBUG}else if(a.logLevel===Q.LogLevel.SILENT){return o.SILENT}else{return o.ERROR}}function u(e){switch(e){case o.DEBUG:a.logLevel=Q.LogLevel.DEBUG;break;case o.ERROR:a.logLevel=Q.LogLevel.ERROR;break;case o.SILENT:a.logLevel=Q.LogLevel.SILENT;break;default:a.error("Firestore ("+i+"): Invalid value passed to `setLogLevel`")}}function c(e,t){var r=[];for(var n=2;n<arguments.length;n++){r[n-2]=arguments[n]}if(a.logLevel<=Q.LogLevel.DEBUG){var o=r.map(f);a.debug.apply(a,["Firestore ("+i+") ["+e+"]: "+t].concat(o))}}function l(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}if(a.logLevel<=Q.LogLevel.ERROR){var n=t.map(f);a.error.apply(a,["Firestore ("+i+"): "+e].concat(n))}}function f(e){if(typeof e==="string"){return e}else{var t=p.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}}function h(e){var t="FIRESTORE ("+i+") INTERNAL ASSERTION FAILED: "+e;l(t);throw new Error(t)}function d(e,t){if(!e){h(t)}}var p=function(){function e(){}e.setPlatform=function(t){if(e.platform){h("Platform already defined")}e.platform=t};e.getPlatform=function(){if(!e.platform){h("Platform not set")}return e.platform};return e}();function v(){return p.getPlatform().emptyByteString}var m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};var y=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this,r)||this;n.code=t;n.message=r;n.name="FirebaseError";n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message};return n}return t}(Error);function g(e,t){function r(){var e="This constructor is private.";if(t){e+=" ";e+=t}throw new y(m.INVALID_ARGUMENT,e)}r.prototype=e.prototype;for(var n in e){if(e.hasOwnProperty(n)){r[n]=e[n]}}return r}function b(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function w(e,t){return e!==undefined?e:t}function _(e,t){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r)){var n=Number(r);if(!isNaN(n)){t(n,e[r])}}}}function S(e){var t=[];E(e,(function(e,r){return t.push(r)}));return t}function E(e,t){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r)){t(r,e[r])}}}function T(e){d(e!=null&&typeof e==="object","isEmpty() expects object parameter.");for(var t in e){if(Object.prototype.hasOwnProperty.call(e,t)){return false}}return true}function I(e){d(e&&typeof e==="object","shallowCopy() expects object parameter.");var t={};for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r)){t[r]=e[r]}}return t}function D(e,t){if(t.length!==0){throw new y(m.INVALID_ARGUMENT,"Function "+e+"() does not support arguments, "+"but was called with "+J(t.length,"argument")+".")}}function C(e,t,r){if(t.length!==r){throw new y(m.INVALID_ARGUMENT,"Function "+e+"() requires "+J(r,"argument")+", but was called with "+J(t.length,"argument")+".")}}function A(e,t,r){if(t.length<r){throw new y(m.INVALID_ARGUMENT,"Function "+e+"() requires at least "+J(r,"argument")+", but was called with "+J(t.length,"argument")+".")}}function N(e,t,r,n){if(t.length<r||t.length>n){throw new y(m.INVALID_ARGUMENT,"Function "+e+"() requires between "+r+" and "+(n+" arguments, but was called with ")+J(t.length,"argument")+".")}}function k(e,t,r,n){if(!(t instanceof Array)||t.length<n){throw new y(m.INVALID_ARGUMENT,"Function "+e+"() requires its "+r+" argument to be an "+"array with at least "+(J(n,"element")+"."))}}function O(e,t,r,n){U(e,t,X(r)+" argument",n)}function M(e,t,r,n){if(n!==undefined){O(e,t,r,n)}}function x(e,t,r,n){U(e,t,r+" option",n)}function P(e,t,r,n){if(n!==undefined){x(e,t,r,n)}}function R(e,t,r,n,i){if(!(n instanceof Array)){throw new y(m.INVALID_ARGUMENT,"Function "+e+"() requires its "+t+" "+("option to be an array, but it was: "+z(n)))}for(var a=0;a<n.length;++a){if(!i(n[a])){throw new y(m.INVALID_ARGUMENT,"Function "+e+"() requires all "+t+" "+("elements to be "+r+", but the value at index "+a+" ")+("was: "+z(n[a])))}}}function L(e,t,r,n,i){if(n!==undefined){R(e,t,r,n,i)}}function q(e,t,r,n,i){var a=[];for(var o=0,s=i;o<s.length;o++){var u=s[o];if(u===n){return}a.push(z(u))}var c=z(n);throw new y(m.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+e+"() for option "+('"'+r+'". Acceptable values: '+a.join(", ")))}function j(e,t,r,n,i){if(n!==undefined){q(e,t,r,n,i)}}function B(e,t,r,n){if(!t.some((function(e){return e===n}))){throw new y(m.INVALID_ARGUMENT,"Invalid value "+z(n)+" provided to function "+(e+"() for its "+X(r)+" argument. Acceptable ")+("values: "+t.join(", ")))}}function U(e,t,r,n){var i=false;if(t==="object"){i=W(n)}else if(t==="non-empty string"){i=typeof n==="string"&&n!==""}else{i=typeof n===t}if(!i){var a=z(n);throw new y(m.INVALID_ARGUMENT,"Function "+e+"() requires its "+r+" "+("to be of type "+t+", but it was: "+a))}}function W(e){return typeof e==="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function z(e){if(e===undefined){return"undefined"}else if(e===null){return"null"}else if(typeof e==="string"){if(e.length>20){e=e.substring(0,20)+"..."}return JSON.stringify(e)}else if(typeof e==="number"||typeof e==="boolean"){return""+e}else if(typeof e==="object"){if(e instanceof Array){return"an array"}else{var t=G(e);if(t){return"a custom "+t+" object"}else{return"an object"}}}else if(typeof e==="function"){return"a function"}else{return h("Unknown wrong type: "+typeof e)}}function G(e){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/;var r=t.exec(e.constructor.toString());if(r&&r.length>1){return r[1]}}return null}function H(e,t,r){if(r===undefined){throw new y(m.INVALID_ARGUMENT,"Function "+e+"() requires a valid "+X(t)+" "+"argument, but it was undefined.")}}function Y(e,t,r){E(t,(function(t,n){if(r.indexOf(t)<0){throw new y(m.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+e+"(). "+"Available options: "+r.join(", "))}}))}function $(e,t,r,n){var i=z(n);return new y(m.INVALID_ARGUMENT,"Function "+e+"() requires its "+X(r)+" "+("argument to be a "+t+", but it was: "+i))}function X(e){switch(e){case 1:return"first";case 2:return"second";case 3:return"third";default:return e+"th"}}function J(e,t){return e+" "+t+(e===1?"":"s")}var Z=function(){function e(){}e.newId=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";var t="";for(var r=0;r<20;r++){t+=e.charAt(Math.floor(Math.random()*e.length))}d(t.length===20,"Invalid auto ID: "+t);return t};return e}();function ee(e,t){if(e<t){return-1}if(e>t){return 1}return 0}function te(e,t){if(e!==null&&e!==undefined){return!!(t&&e.isEqual(t))}else{return e===t}}function re(e,t){if(e.length!==t.length){return false}for(var r=0;r<e.length;r++){if(!e[r].isEqual(t[r])){return false}}return true}function ne(e){return e+"\0"}function ie(){if(typeof Uint8Array==="undefined"){throw new y(m.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}}function ae(){if(!p.getPlatform().base64Available){throw new y(m.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}}var oe=function(){function e(e){ae();this._binaryString=e}e.fromBase64String=function(t){C("Blob.fromBase64String",arguments,1);O("Blob.fromBase64String","string",1,t);ae();try{var r=p.getPlatform().atob(t);return new e(r)}catch(e){throw new y(m.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+e)}};e.fromUint8Array=function(t){C("Blob.fromUint8Array",arguments,1);ie();if(!(t instanceof Uint8Array)){throw $("Blob.fromUint8Array","Uint8Array",1,t)}var r=Array.prototype.map.call(t,(function(e){return String.fromCharCode(e)})).join("");return new e(r)};e.prototype.toBase64=function(){C("Blob.toBase64",arguments,0);ae();return p.getPlatform().btoa(this._binaryString)};e.prototype.toUint8Array=function(){C("Blob.toUint8Array",arguments,0);ie();var e=new Uint8Array(this._binaryString.length);for(var t=0;t<this._binaryString.length;t++){e[t]=this._binaryString.charCodeAt(t)}return e};e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"};e.prototype.isEqual=function(e){return this._binaryString===e._binaryString};e.prototype._compareTo=function(e){return ee(this._binaryString,e._binaryString)};return e}();var se=g(oe,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead.");var ue=function(){function e(e,t,r,n,i){this.databaseId=e;this.persistenceKey=t;this.host=r;this.ssl=n;this.forceLongPolling=i}return e}();var ce="(default)";var le=function(){function e(e,t){this.projectId=e;this.database=t?t:ce}Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database===ce},enumerable:true,configurable:true});e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database};e.prototype.compareTo=function(e){return ee(this.projectId,e.projectId)||ee(this.database,e.database)};return e}();var fe=function(){function e(e,t){var r=this;this.previousValue=e;if(t){t.sequenceNumberHandler=function(e){return r.setPreviousValue(e)};this.writeNewSequenceNumber=function(e){return t.writeSequenceNumber(e)}}}e.prototype.setPreviousValue=function(e){this.previousValue=Math.max(e,this.previousValue);return this.previousValue};e.prototype.next=function(){var e=++this.previousValue;if(this.writeNewSequenceNumber){this.writeNewSequenceNumber(e)}return e};e.INVALID=-1;return e}();var he="__name__";var de=function(){function e(e,t,r){if(t===undefined){t=0}else if(t>e.length){h("offset "+t+" out of range "+e.length)}if(r===undefined){r=e.length-t}else if(r>e.length-t){h("length "+r+" out of range "+(e.length-t))}this.segments=e;this.offset=t;this.len=r}Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:true,configurable:true});e.prototype.isEqual=function(t){return e.comparator(this,t)===0};e.prototype.child=function(t){var r=this.segments.slice(this.offset,this.limit());if(t instanceof e){t.forEach((function(e){r.push(e)}))}else{r.push(t)}return this.construct(r)};e.prototype.limit=function(){return this.offset+this.length};e.prototype.popFirst=function(e){e=e===undefined?1:e;d(this.length>=e,"Can't call popFirst() with less segments");return this.construct(this.segments,this.offset+e,this.length-e)};e.prototype.popLast=function(){d(!this.isEmpty(),"Can't call popLast() on empty path");return this.construct(this.segments,this.offset,this.length-1)};e.prototype.firstSegment=function(){d(!this.isEmpty(),"Can't call firstSegment() on empty path");return this.segments[this.offset]};e.prototype.lastSegment=function(){return this.get(this.length-1)};e.prototype.get=function(e){d(e<this.length,"Index out of range");return this.segments[this.offset+e]};e.prototype.isEmpty=function(){return this.length===0};e.prototype.isPrefixOf=function(e){if(e.length<this.length){return false}for(var t=0;t<this.length;t++){if(this.get(t)!==e.get(t)){return false}}return true};e.prototype.isImmediateParentOf=function(e){if(this.length+1!==e.length){return false}for(var t=0;t<this.length;t++){if(this.get(t)!==e.get(t)){return false}}return true};e.prototype.forEach=function(e){for(var t=this.offset,r=this.limit();t<r;t++){e(this.segments[t])}};e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())};e.comparator=function(e,t){var r=Math.min(e.length,t.length);for(var n=0;n<r;n++){var i=e.get(n);var a=t.get(n);if(i<a){return-1}if(i>a){return 1}}if(e.length<t.length){return-1}if(e.length>t.length){return 1}return 0};return e}();var pe=function(e){F.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.construct=function(e,r,n){return new t(e,r,n)};t.prototype.canonicalString=function(){return this.toArray().join("/")};t.prototype.toString=function(){return this.canonicalString()};t.fromString=function(e){if(e.indexOf("//")>=0){throw new y(m.INVALID_ARGUMENT,"Invalid path ("+e+"). Paths must not contain // in them.")}var r=e.split("/").filter((function(e){return e.length>0}));return new t(r)};t.EMPTY_PATH=new t([]);return t}(de);var ve=/^[_a-zA-Z][_a-zA-Z0-9]*$/;var me=function(e){F.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.construct=function(e,r,n){return new t(e,r,n)};t.isValidIdentifier=function(e){return ve.test(e)};t.prototype.canonicalString=function(){return this.toArray().map((function(e){e=e.replace("\\","\\\\").replace("`","\\`");if(!t.isValidIdentifier(e)){e="`"+e+"`"}return e})).join(".")};t.prototype.toString=function(){return this.canonicalString()};t.prototype.isKeyField=function(){return this.length===1&&this.get(0)===he};t.keyField=function(){return new t([he])};t.fromServerFormat=function(e){var r=[];var n="";var i=0;var a=function(){if(n.length===0){throw new y(m.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin "+"with '.', end with '.', or contain '..'")}r.push(n);n=""};var o=false;while(i<e.length){var s=e[i];if(s==="\\"){if(i+1===e.length){throw new y(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e)}var u=e[i+1];if(!(u==="\\"||u==="."||u==="`")){throw new y(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e)}n+=u;i+=2}else if(s==="`"){o=!o;i++}else if(s==="."&&!o){a();i++}else{n+=s;i++}}a();if(o){throw new y(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e)}return new t(r)};t.EMPTY_PATH=new t([]);return t}(de);var ye=function(){function e(t){this.path=t;d(e.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}e.prototype.hasCollectionId=function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e};e.prototype.isEqual=function(e){return e!==null&&pe.comparator(this.path,e.path)===0};e.prototype.toString=function(){return this.path.toString()};e.comparator=function(e,t){return pe.comparator(e.path,t.path)};e.isDocumentKey=function(e){return e.length%2===0};e.fromSegments=function(t){return new e(new pe(t.slice()))};e.fromPathString=function(t){return new e(pe.fromString(t))};e.EMPTY=new e(new pe([]));return e}();var ge=function(){function e(){var e=this;this.promise=new Promise((function(t,r){e.resolve=t;e.reject=r}))}return e}();var be;(function(e){e["All"]="all";e["ListenStreamIdle"]="listen_stream_idle";e["ListenStreamConnectionBackoff"]="listen_stream_connection_backoff";e["WriteStreamIdle"]="write_stream_idle";e["WriteStreamConnectionBackoff"]="write_stream_connection_backoff";e["OnlineStateTimeout"]="online_state_timeout";e["ClientMetadataRefresh"]="client_metadata_refresh";e["LruGarbageCollection"]="lru_garbage_collection";e["RetryTransaction"]="retry_transaction"})(be||(be={}));var we=function(){function e(e,t,r,n,i){this.asyncQueue=e;this.timerId=t;this.targetTimeMs=r;this.op=n;this.removalCallback=i;this.deferred=new ge;this.then=this.deferred.promise.then.bind(this.deferred.promise);this.catch=this.deferred.promise.catch.bind(this.deferred.promise);this.deferred.promise.catch((function(e){}))}e.createAndSchedule=function(t,r,n,i,a){var o=Date.now()+n;var s=new e(t,r,o,i,a);s.start(n);return s};e.prototype.start=function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)};e.prototype.skipDelay=function(){return this.handleDelayElapsed()};e.prototype.cancel=function(e){if(this.timerHandle!==null){this.clearTimeout();this.deferred.reject(new y(m.CANCELLED,"Operation cancelled"+(e?": "+e:"")))}};e.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget((function(){if(e.timerHandle!==null){e.clearTimeout();return e.op().then((function(t){return e.deferred.resolve(t)}))}else{return Promise.resolve()}}))};e.prototype.clearTimeout=function(){if(this.timerHandle!==null){this.removalCallback(this);clearTimeout(this.timerHandle);this.timerHandle=null}};return e}();var _e=function(){function e(){this.tail=Promise.resolve();this._isShuttingDown=false;this.delayedOperations=[];this.failure=null;this.operationInProgress=false;this.timerIdsToSkip=[]}Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:true,configurable:true});e.prototype.enqueueAndForget=function(e){this.enqueue(e)};e.prototype.enqueueAndForgetEvenAfterShutdown=function(e){this.verifyNotFailed();this.enqueueInternal(e)};e.prototype.enqueueEvenAfterShutdown=function(e){this.verifyNotFailed();return this.enqueueInternal(e)};e.prototype.enqueueAndInitiateShutdown=function(e){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(t){switch(t.label){case 0:this.verifyNotFailed();if(!!this._isShuttingDown)return[3,2];this._isShuttingDown=true;return[4,this.enqueueEvenAfterShutdown(e)];case 1:t.sent();t.label=2;case 2:return[2]}}))}))};e.prototype.enqueue=function(e){this.verifyNotFailed();if(this._isShuttingDown){return new Promise((function(e){}))}return this.enqueueInternal(e)};e.prototype.enqueueInternal=function(e){var t=this;var r=this.tail.then((function(){t.operationInProgress=true;return e().catch((function(e){t.failure=e;t.operationInProgress=false;var r=e.stack||e.message||"";l("INTERNAL UNHANDLED ERROR: ",r);if(r.indexOf("Firestore Test Simulated Error")<0){setTimeout((function(){throw e}),0)}throw e})).then((function(e){t.operationInProgress=false;return e}))}));this.tail=r;return r};e.prototype.enqueueAfterDelay=function(e,t,r){var n=this;this.verifyNotFailed();d(t>=0,"Attempted to schedule an operation with a negative delay of "+t);if(this.timerIdsToSkip.indexOf(e)>-1){t=0}var i=we.createAndSchedule(this,e,t,r,(function(e){return n.removeDelayedOperation(e)}));this.delayedOperations.push(i);return i};e.prototype.verifyNotFailed=function(){if(this.failure){h("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))}};e.prototype.verifyOperationInProgress=function(){d(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")};e.prototype.drain=function(){return this.enqueueEvenAfterShutdown((function(){return Promise.resolve()}))};e.prototype.containsDelayedOperation=function(e){for(var t=0,r=this.delayedOperations;t<r.length;t++){var n=r[t];if(n.timerId===e){return true}}return false};e.prototype.runDelayedOperationsEarly=function(e){var t=this;return this.drain().then((function(){d(e===be.All||t.containsDelayedOperation(e),"Attempted to drain to missing operation "+e);t.delayedOperations.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));for(var r=0,n=t.delayedOperations;r<n.length;r++){var i=n[r];i.skipDelay();if(e!==be.All&&i.timerId===e){break}}return t.drain()}))};e.prototype.skipDelaysForTimerId=function(e){this.timerIdsToSkip.push(e)};e.prototype.removeDelayedOperation=function(e){var t=this.delayedOperations.indexOf(e);d(t>=0,"Delayed operation not found.");this.delayedOperations.splice(t,1)};return e}();var Se="";var Ee="";var Te="";var Ie="";function De(e){var t="";for(var r=0;r<e.length;r++){if(t.length>0){t=Ae(t)}t=Ce(e.get(r),t)}return Ae(t)}function Ce(e,t){var r=t;var n=e.length;for(var i=0;i<n;i++){var a=e.charAt(i);switch(a){case"\0":r+=Se+Te;break;case Se:r+=Se+Ie;break;default:r+=a}}return r}function Ae(e){return e+Se+Ee}function Ne(e){var t=e.length;d(t>=2,"Invalid path "+e);if(t===2){d(e.charAt(0)===Se&&e.charAt(1)===Ee,"Non-empty path "+e+" had length 2");return pe.EMPTY_PATH}var r=t-2;var n=[];var i="";for(var a=0;a<t;){var o=e.indexOf(Se,a);if(o<0||o>r){h('Invalid encoded resource path: "'+e+'"')}var s=e.charAt(o+1);switch(s){case Ee:var u=e.substring(a,o);var c=void 0;if(i.length===0){c=u}else{i+=u;c=i;i=""}n.push(c);break;case Te:i+=e.substring(a,o);i+="\0";break;case Ie:i+=e.substring(a,o+1);break;default:h('Invalid encoded resource path: "'+e+'"')}a=o+2}return new pe(n)}var ke=function(){function e(e,t){this.seconds=e;this.nanoseconds=t;if(t<0){throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t)}if(t>=1e9){throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t)}if(e<-62135596800){throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}if(e>=253402300800){throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}}e.now=function(){return e.fromMillis(Date.now())};e.fromDate=function(t){return e.fromMillis(t.getTime())};e.fromMillis=function(t){var r=Math.floor(t/1e3);var n=(t-r*1e3)*1e6;return new e(r,n)};e.prototype.toDate=function(){return new Date(this.toMillis())};e.prototype.toMillis=function(){return this.seconds*1e3+this.nanoseconds/1e6};e.prototype._compareTo=function(e){if(this.seconds===e.seconds){return ee(this.nanoseconds,e.nanoseconds)}return ee(this.seconds,e.seconds)};e.prototype.isEqual=function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds};e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"};return e}();var Oe=function(){function e(e){this.timestamp=e}e.fromMicroseconds=function(t){var r=Math.floor(t/1e6);var n=t%1e6*1e3;return new e(new ke(r,n))};e.fromTimestamp=function(t){return new e(t)};e.forDeletedDoc=function(){return e.MIN};e.prototype.compareTo=function(e){return this.timestamp._compareTo(e.timestamp)};e.prototype.isEqual=function(e){return this.timestamp.isEqual(e.timestamp)};e.prototype.toMicroseconds=function(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3};e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"};e.prototype.toTimestamp=function(){return this.timestamp};e.MIN=new e(new ke(0,0));return e}();var Me=function(){function e(e,t){this.comparator=e;this.root=t?t:Pe.EMPTY}e.prototype.insert=function(t,r){return new e(this.comparator,this.root.insert(t,r,this.comparator).copy(null,null,Pe.BLACK,null,null))};e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Pe.BLACK,null,null))};e.prototype.get=function(e){var t=this.root;while(!t.isEmpty()){var r=this.comparator(e,t.key);if(r===0){return t.value}else if(r<0){t=t.left}else if(r>0){t=t.right}}return null};e.prototype.indexOf=function(e){var t=0;var r=this.root;while(!r.isEmpty()){var n=this.comparator(e,r.key);if(n===0){return t+r.left.size}else if(n<0){r=r.left}else{t+=r.left.size+1;r=r.right}}return-1};e.prototype.isEmpty=function(){return this.root.isEmpty()};Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:true,configurable:true});e.prototype.minKey=function(){return this.root.minKey()};e.prototype.maxKey=function(){return this.root.maxKey()};e.prototype.inorderTraversal=function(e){return this.root.inorderTraversal(e)};e.prototype.forEach=function(e){this.inorderTraversal((function(t,r){e(t,r);return false}))};e.prototype.toString=function(){var e=[];this.inorderTraversal((function(t,r){e.push(t+":"+r);return false}));return"{"+e.join(", ")+"}"};e.prototype.reverseTraversal=function(e){return this.root.reverseTraversal(e)};e.prototype.getIterator=function(){return new xe(this.root,null,this.comparator,false)};e.prototype.getIteratorFrom=function(e){return new xe(this.root,e,this.comparator,false)};e.prototype.getReverseIterator=function(){return new xe(this.root,null,this.comparator,true)};e.prototype.getReverseIteratorFrom=function(e){return new xe(this.root,e,this.comparator,true)};return e}();var xe=function(){function e(e,t,r,n){this.isReverse=n;this.nodeStack=[];var i=1;while(!e.isEmpty()){i=t?r(e.key,t):1;if(n){i*=-1}if(i<0){if(this.isReverse){e=e.left}else{e=e.right}}else if(i===0){this.nodeStack.push(e);break}else{this.nodeStack.push(e);if(this.isReverse){e=e.right}else{e=e.left}}}}e.prototype.getNext=function(){d(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse){e=e.left;while(!e.isEmpty()){this.nodeStack.push(e);e=e.right}}else{e=e.right;while(!e.isEmpty()){this.nodeStack.push(e);e=e.left}}return t};e.prototype.hasNext=function(){return this.nodeStack.length>0};e.prototype.peek=function(){if(this.nodeStack.length===0){return null}var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}};return e}();var Pe=function(){function e(t,r,n,i,a){this.key=t;this.value=r;this.color=n!=null?n:e.RED;this.left=i!=null?i:e.EMPTY;this.right=a!=null?a:e.EMPTY;this.size=this.left.size+1+this.right.size}e.prototype.copy=function(t,r,n,i,a){return new e(t!=null?t:this.key,r!=null?r:this.value,n!=null?n:this.color,i!=null?i:this.left,a!=null?a:this.right)};e.prototype.isEmpty=function(){return false};e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)};e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)};e.prototype.min=function(){if(this.left.isEmpty()){return this}else{return this.left.min()}};e.prototype.minKey=function(){return this.min().key};e.prototype.maxKey=function(){if(this.right.isEmpty()){return this.key}else{return this.right.maxKey()}};e.prototype.insert=function(e,t,r){var n=this;var i=r(e,n.key);if(i<0){n=n.copy(null,null,null,n.left.insert(e,t,r),null)}else if(i===0){n=n.copy(null,t,null,null,null)}else{n=n.copy(null,null,null,null,n.right.insert(e,t,r))}return n.fixUp()};e.prototype.removeMin=function(){if(this.left.isEmpty()){return e.EMPTY}var t=this;if(!t.left.isRed()&&!t.left.left.isRed()){t=t.moveRedLeft()}t=t.copy(null,null,null,t.left.removeMin(),null);return t.fixUp()};e.prototype.remove=function(t,r){var n;var i=this;if(r(t,i.key)<0){if(!i.left.isEmpty()&&!i.left.isRed()&&!i.left.left.isRed()){i=i.moveRedLeft()}i=i.copy(null,null,null,i.left.remove(t,r),null)}else{if(i.left.isRed()){i=i.rotateRight()}if(!i.right.isEmpty()&&!i.right.isRed()&&!i.right.left.isRed()){i=i.moveRedRight()}if(r(t,i.key)===0){if(i.right.isEmpty()){return e.EMPTY}else{n=i.right.min();i=i.copy(n.key,n.value,null,null,i.right.removeMin())}}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp()};e.prototype.isRed=function(){return this.color};e.prototype.fixUp=function(){var e=this;if(e.right.isRed()&&!e.left.isRed()){e=e.rotateLeft()}if(e.left.isRed()&&e.left.left.isRed()){e=e.rotateRight()}if(e.left.isRed()&&e.right.isRed()){e=e.colorFlip()}return e};e.prototype.moveRedLeft=function(){var e=this.colorFlip();if(e.right.left.isRed()){e=e.copy(null,null,null,null,e.right.rotateRight());e=e.rotateLeft();e=e.colorFlip()}return e};e.prototype.moveRedRight=function(){var e=this.colorFlip();if(e.left.left.isRed()){e=e.rotateRight();e=e.colorFlip()}return e};e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)};e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)};e.prototype.colorFlip=function(){var e=this.left.copy(null,null,!this.left.color,null,null);var t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)};e.prototype.checkMaxDepth=function(){var e=this.check();if(Math.pow(2,e)<=this.size+1){return true}else{return false}};e.prototype.check=function(){if(this.isRed()&&this.left.isRed()){throw h("Red node has red child("+this.key+","+this.value+")")}if(this.right.isRed()){throw h("Right child of ("+this.key+","+this.value+") is red")}var e=this.left.check();if(e!==this.right.check()){throw h("Black depths differ")}else{return e+(this.isRed()?0:1)}};e.EMPTY=null;e.RED=true;e.BLACK=false;return e}();var Re=function(){function e(){this.size=0}Object.defineProperty(e.prototype,"key",{get:function(){throw h("LLRBEmptyNode has no key.")},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"value",{get:function(){throw h("LLRBEmptyNode has no value.")},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"color",{get:function(){throw h("LLRBEmptyNode has no color.")},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"left",{get:function(){throw h("LLRBEmptyNode has no left child.")},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"right",{get:function(){throw h("LLRBEmptyNode has no right child.")},enumerable:true,configurable:true});e.prototype.copy=function(e,t,r,n,i){return this};e.prototype.insert=function(e,t,r){return new Pe(e,t)};e.prototype.remove=function(e,t){return this};e.prototype.isEmpty=function(){return true};e.prototype.inorderTraversal=function(e){return false};e.prototype.reverseTraversal=function(e){return false};e.prototype.minKey=function(){return null};e.prototype.maxKey=function(){return null};e.prototype.isRed=function(){return false};e.prototype.checkMaxDepth=function(){return true};e.prototype.check=function(){return 0};return e}();Pe.EMPTY=new Re;var Le=function(){function e(e){this.comparator=e;this.data=new Me(this.comparator)}e.fromMapKeys=function(t){var r=new e(t.comparator);t.forEach((function(e){r=r.add(e)}));return r};e.prototype.has=function(e){return this.data.get(e)!==null};e.prototype.first=function(){return this.data.minKey()};e.prototype.last=function(){return this.data.maxKey()};Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:true,configurable:true});e.prototype.indexOf=function(e){return this.data.indexOf(e)};e.prototype.forEach=function(e){this.data.inorderTraversal((function(t,r){e(t);return false}))};e.prototype.forEachInRange=function(e,t){var r=this.data.getIteratorFrom(e[0]);while(r.hasNext()){var n=r.getNext();if(this.comparator(n.key,e[1])>=0){return}t(n.key)}};e.prototype.forEachWhile=function(e,t){var r;if(t!==undefined){r=this.data.getIteratorFrom(t)}else{r=this.data.getIterator()}while(r.hasNext()){var n=r.getNext();var i=e(n.key);if(!i){return}}};e.prototype.firstAfterOrEqual=function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null};e.prototype.getIterator=function(){return new Fe(this.data.getIterator())};e.prototype.getIteratorFrom=function(e){return new Fe(this.data.getIteratorFrom(e))};e.prototype.add=function(e){return this.copy(this.data.remove(e).insert(e,true))};e.prototype.delete=function(e){if(!this.has(e)){return this}return this.copy(this.data.remove(e))};e.prototype.isEmpty=function(){return this.data.isEmpty()};e.prototype.unionWith=function(e){var t=this;e.forEach((function(e){t=t.add(e)}));return t};e.prototype.isEqual=function(t){if(!(t instanceof e)){return false}if(this.size!==t.size){return false}var r=this.data.getIterator();var n=t.data.getIterator();while(r.hasNext()){var i=r.getNext().key;var a=n.getNext().key;if(this.comparator(i,a)!==0){return false}}return true};e.prototype.toArray=function(){var e=[];this.forEach((function(t){e.push(t)}));return e};e.prototype.toString=function(){var e=[];this.forEach((function(t){return e.push(t)}));return"SortedSet("+e.toString()+")"};e.prototype.copy=function(t){var r=new e(this.comparator);r.data=t;return r};return e}();var Fe=function(){function e(e){this.iter=e}e.prototype.getNext=function(){return this.iter.getNext().key};e.prototype.hasNext=function(){return this.iter.hasNext()};return e}();var Ve=new Me(ye.comparator);function qe(){return Ve}function je(){return qe()}var Be=new Me(ye.comparator);function Ue(){return Be}var We=new Me(ye.comparator);function ze(){return We}var Qe=new Le(ye.comparator);function Ke(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=Qe;for(var n=0,i=e;n<i.length;n++){var a=i[n];r=r.add(a)}return r}var Ge=new Le(ee);function He(){return Ge}var Ye=-1;var $e=function(){function e(e,t,r,n){this.batchId=e;this.localWriteTime=t;this.baseMutations=r;this.mutations=n;d(n.length>0,"Cannot create an empty mutation batch")}e.prototype.applyToRemoteDocument=function(e,t,r){if(t){d(t.key.isEqual(e),"applyToRemoteDocument: key "+e+" should match maybeDoc key\n        "+t.key)}var n=r.mutationResults;d(n.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+n.length+").");for(var i=0;i<this.mutations.length;i++){var a=this.mutations[i];if(a.key.isEqual(e)){var o=n[i];t=a.applyToRemoteDocument(t,o)}}return t};e.prototype.applyToLocalView=function(e,t){if(t){d(t.key.isEqual(e),"applyToLocalDocument: key "+e+" should match maybeDoc key\n        "+t.key)}for(var r=0,n=this.baseMutations;r<n.length;r++){var i=n[r];if(i.key.isEqual(e)){t=i.applyToLocalView(t,t,this.localWriteTime)}}var a=t;for(var o=0,s=this.mutations;o<s.length;o++){var i=s[o];if(i.key.isEqual(e)){t=i.applyToLocalView(t,a,this.localWriteTime)}}return t};e.prototype.applyToLocalDocumentSet=function(e){var t=this;var r=e;this.mutations.forEach((function(n){var i=t.applyToLocalView(n.key,e.get(n.key));if(i){r=r.insert(n.key,i)}}));return r};e.prototype.keys=function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),Ke())};e.prototype.isEqual=function(e){return this.batchId===e.batchId&&re(this.mutations,e.mutations)&&re(this.baseMutations,e.baseMutations)};return e}();var Xe=function(){function e(e,t,r,n,i){this.batch=e;this.commitVersion=t;this.mutationResults=r;this.streamToken=n;this.docVersions=i}e.from=function(t,r,n,i){d(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);var a=ze();var o=t.mutations;for(var s=0;s<o.length;s++){a=a.insert(o[s].key,n[s].version)}return new e(t,r,n,i,a)};return e}();var Je=function(){function e(e){var t=this;this.nextCallback=null;this.catchCallback=null;this.result=undefined;this.error=undefined;this.isDone=false;this.callbackAttached=false;e((function(e){t.isDone=true;t.result=e;if(t.nextCallback){t.nextCallback(e)}}),(function(e){t.isDone=true;t.error=e;if(t.catchCallback){t.catchCallback(e)}}))}e.prototype.catch=function(e){return this.next(undefined,e)};e.prototype.next=function(t,r){var n=this;if(this.callbackAttached){h("Called next() or catch() twice for PersistencePromise")}this.callbackAttached=true;if(this.isDone){if(!this.error){return this.wrapSuccess(t,this.result)}else{return this.wrapFailure(r,this.error)}}else{return new e((function(e,i){n.nextCallback=function(r){n.wrapSuccess(t,r).next(e,i)};n.catchCallback=function(t){n.wrapFailure(r,t).next(e,i)}}))}};e.prototype.toPromise=function(){var e=this;return new Promise((function(t,r){e.next(t,r)}))};e.prototype.wrapUserFunction=function(t){try{var r=t();if(r instanceof e){return r}else{return e.resolve(r)}}catch(t){return e.reject(t)}};e.prototype.wrapSuccess=function(t,r){if(t){return this.wrapUserFunction((function(){return t(r)}))}else{return e.resolve(r)}};e.prototype.wrapFailure=function(t,r){if(t){return this.wrapUserFunction((function(){return t(r)}))}else{return e.reject(r)}};e.resolve=function(t){return new e((function(e,r){e(t)}))};e.reject=function(t){return new e((function(e,r){r(t)}))};e.waitFor=function(t){return new e((function(e,r){var n=0;var i=0;var a=false;t.forEach((function(t){++n;t.next((function(){++i;if(a&&i===n){e()}}),(function(e){return r(e)}))}));a=true;if(i===n){e()}}))};e.or=function(t){var r=e.resolve(false);var n=function(t){r=r.next((function(r){if(r){return e.resolve(r)}else{return t()}}))};for(var i=0,a=t;i<a.length;i++){var o=a[i];n(o)}return r};e.forEach=function(e,t){var r=this;var n=[];e.forEach((function(e,i){n.push(t.call(r,e,i))}));return this.waitFor(n)};return e}();var Ze=function(){function e(e,t,r,n){this.userId=e;this.serializer=t;this.indexManager=r;this.referenceDelegate=n;this.documentKeysByBatchId={}}e.forUser=function(t,r,n,i){d(t.uid!=="","UserID must not be an empty string.");var a=t.isAuthenticated()?t.uid:"";return new e(a,r,n,i)};e.prototype.checkEmpty=function(e){var t=true;var r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return it(e).iterate({index:Sr.userMutationsIndex,range:r},(function(e,r,n){t=false;n.done()})).next((function(){return t}))};e.prototype.acknowledgeBatch=function(e,t,r){return this.getMutationQueueMetadata(e).next((function(t){t.lastStreamToken=nt(r);return ot(e).put(t)}))};e.prototype.getLastStreamToken=function(e){return this.getMutationQueueMetadata(e).next((function(e){return e.lastStreamToken}))};e.prototype.setLastStreamToken=function(e,t){return this.getMutationQueueMetadata(e).next((function(r){r.lastStreamToken=nt(t);return ot(e).put(r)}))};e.prototype.addMutationBatch=function(e,t,r,n){var i=this;var a=at(e);var o=it(e);return o.add({}).next((function(s){d(typeof s==="number","Auto-generated key is not a number");var u=new $e(s,t,r,n);var c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();var l=[];for(var f=0,h=n;f<h.length;f++){var p=h[f];var v=Ir.key(i.userId,p.key.path,s);l.push(o.put(c));l.push(a.put(v,Ir.PLACEHOLDER));l.push(i.indexManager.addToCollectionParentIndex(e,p.key.path.popLast()))}return Je.waitFor(l).next((function(){return u}))}))};e.prototype.lookupMutationBatch=function(e,t){var r=this;return it(e).get(t).next((function(e){if(e){d(e.userId===r.userId,"Unexpected user '"+e.userId+"' for mutation batch "+t);return r.serializer.fromDbMutationBatch(e)}return null}))};e.prototype.lookupMutationKeys=function(e,t){var r=this;if(this.documentKeysByBatchId[t]){return Je.resolve(this.documentKeysByBatchId[t])}else{return this.lookupMutationBatch(e,t).next((function(e){if(e){var n=e.keys();r.documentKeysByBatchId[t]=n;return n}else{return null}}))}};e.prototype.getNextMutationBatchAfterBatchId=function(e,t){var r=this;var n=t+1;var i=IDBKeyRange.lowerBound([this.userId,n]);var a=null;return it(e).iterate({index:Sr.userMutationsIndex,range:i},(function(e,t,i){if(t.userId===r.userId){d(t.batchId>=n,"Should have found mutation after "+n);a=r.serializer.fromDbMutationBatch(t)}i.done()})).next((function(){return a}))};e.prototype.getHighestUnacknowledgedBatchId=function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);var r=Ye;return it(e).iterate({index:Sr.userMutationsIndex,range:t,reverse:true},(function(e,t,n){r=t.batchId;n.done()})).next((function(){return r}))};e.prototype.getAllMutationBatches=function(e){var t=this;var r=IDBKeyRange.bound([this.userId,Ye],[this.userId,Number.POSITIVE_INFINITY]);return it(e).loadAll(Sr.userMutationsIndex,r).next((function(e){return e.map((function(e){return t.serializer.fromDbMutationBatch(e)}))}))};e.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,t){var r=this;var n=Ir.prefixForPath(this.userId,t.path);var i=IDBKeyRange.lowerBound(n);var a=[];return at(e).iterate({range:i},(function(n,i,o){var s=n[0],u=n[1],c=n[2];var l=Ne(u);if(s!==r.userId||!t.path.isEqual(l)){o.done();return}return it(e).get(c).next((function(e){if(!e){throw h("Dangling document-mutation reference found: "+n+" which points to "+c)}d(e.userId===r.userId,"Unexpected user '"+e.userId+"' for mutation batch "+c);a.push(r.serializer.fromDbMutationBatch(e))}))})).next((function(){return a}))};e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var r=this;var n=new Le(ee);var i=[];t.forEach((function(t){var a=Ir.prefixForPath(r.userId,t.path);var o=IDBKeyRange.lowerBound(a);var s=at(e).iterate({range:o},(function(e,i,a){var o=e[0],s=e[1],u=e[2];var c=Ne(s);if(o!==r.userId||!t.path.isEqual(c)){a.done();return}n=n.add(u)}));i.push(s)}));return Je.waitFor(i).next((function(){return r.lookupMutationBatches(e,n)}))};e.prototype.getAllMutationBatchesAffectingQuery=function(e,t){var r=this;d(!t.isDocumentQuery(),"Document queries shouldn't go down this path");d(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=t.path;var i=n.length+1;var a=Ir.prefixForPath(this.userId,n);var o=IDBKeyRange.lowerBound(a);var s=new Le(ee);return at(e).iterate({range:o},(function(e,t,a){var o=e[0],u=e[1],c=e[2];var l=Ne(u);if(o!==r.userId||!n.isPrefixOf(l)){a.done();return}if(l.length!==i){return}s=s.add(c)})).next((function(){return r.lookupMutationBatches(e,s)}))};e.prototype.lookupMutationBatches=function(e,t){var r=this;var n=[];var i=[];t.forEach((function(t){i.push(it(e).get(t).next((function(e){if(e===null){throw h("Dangling document-mutation reference found, "+"which points to "+t)}d(e.userId===r.userId,"Unexpected user '"+e.userId+"' for mutation batch "+t);n.push(r.serializer.fromDbMutationBatch(e))})))}));return Je.waitFor(i).next((function(){return n}))};e.prototype.removeMutationBatch=function(e,t){var r=this;return rt(e.simpleDbTransaction,this.userId,t).next((function(n){r.removeCachedMutationKeys(t.batchId);return Je.forEach(n,(function(t){return r.referenceDelegate.removeMutationReference(e,t)}))}))};e.prototype.removeCachedMutationKeys=function(e){delete this.documentKeysByBatchId[e]};e.prototype.performConsistencyCheck=function(e){var t=this;return this.checkEmpty(e).next((function(r){if(!r){return Je.resolve()}var n=IDBKeyRange.lowerBound(Ir.prefixForUser(t.userId));var i=[];return at(e).iterate({range:n},(function(e,r,n){var a=e[0];if(a!==t.userId){n.done();return}else{var o=Ne(e[1]);i.push(o)}})).next((function(){d(i.length===0,"Document leak -- detected dangling mutation references when queue is empty. "+"Dangling keys: "+i.map((function(e){return e.canonicalString()})))}))}))};e.prototype.containsKey=function(e,t){return et(e,this.userId,t)};e.prototype.getMutationQueueMetadata=function(e){var t=this;return ot(e).get(this.userId).next((function(e){return e||new _r(t.userId,Ye,"")}))};return e}();function et(e,t,r){var n=Ir.prefixForPath(t,r.path);var i=n[1];var a=IDBKeyRange.lowerBound(n);var o=false;return at(e).iterate({range:a,keysOnly:true},(function(e,r,n){var a=e[0],s=e[1];if(a===t&&s===i){o=true}n.done()})).next((function(){return o}))}function tt(e,t){var r=false;return ot(e).iterateSerial((function(n){return et(e,n,t).next((function(e){if(e){r=true}return Je.resolve(!e)}))})).next((function(){return r}))}function rt(e,t,r){var n=e.store(Sr.store);var i=e.store(Ir.store);var a=[];var o=IDBKeyRange.only(r.batchId);var s=0;var u=n.iterate({range:o},(function(e,t,r){s++;return r.delete()}));a.push(u.next((function(){d(s===1,"Dangling document-mutation reference found: Missing batch "+r.batchId)})));var c=[];for(var l=0,f=r.mutations;l<f.length;l++){var h=f[l];var p=Ir.key(t,h.key.path,r.batchId);a.push(i.delete(p));c.push(h.key)}return Je.waitFor(a).next((function(){return c}))}function nt(e){if(e instanceof Uint8Array){d(process.env.USE_MOCK_PERSISTENCE==="YES","Persisting non-string stream tokens is only supported with mock persistence.");return e.toString()}else{return e}}function it(e){return wn.getStore(e,Sr.store)}function at(e){return wn.getStore(e,Ir.store)}function ot(e){return wn.getStore(e,_r.store)}var st=1;var ut;(function(e){e[e["QueryCache"]=0]="QueryCache";e[e["SyncEngine"]=1]="SyncEngine"})(ut||(ut={}));var ct=function(){function e(e,t){this.generatorId=e;d((e&st)===e,"Generator ID "+e+" contains more than "+st+" reserved bits");this.seek(t!==undefined?t:this.generatorId)}e.prototype.next=function(){var e=this.nextId;this.nextId+=1<<st;return e};e.prototype.after=function(e){this.seek(e+(1<<st));return this.next()};e.prototype.seek=function(e){d((e&st)===this.generatorId,"Cannot supply target ID from different generator ID");this.nextId=e};e.forQueryCache=function(){var t=new e(ut.QueryCache,2);return t};e.forSyncEngine=function(){return new e(ut.SyncEngine)};return e}();var lt="SimpleDb";var ft=function(){function e(t){this.db=t;var r=e.getIOSVersion(V.getUA());if(r===12.2){l("Firestore persistence suffers from a bug in iOS 12.2 "+"Safari that may cause your app to stop working. See "+"https://stackoverflow.com/q/56496296/110915 for details "+"and a potential workaround.")}}e.openOrCreate=function(t,r,n){d(e.isAvailable(),"IndexedDB not supported in current environment.");c(lt,"Opening database:",t);return new Je((function(i,a){var o=window.indexedDB.open(t,r);o.onsuccess=function(t){var r=t.target.result;i(new e(r))};o.onblocked=function(){a(new y(m.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. "+"Close all tabs that access Firestore and reload this page to proceed."))};o.onerror=function(e){var t=e.target.error;if(t.name==="VersionError"){a(new y(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted "+"data is not compatible with the version of the SDK you are now using. The SDK "+"will operate with persistence disabled. If you need persistence, please "+"re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB "+"data for your app to start fresh."))}else{a(t)}};o.onupgradeneeded=function(e){c(lt,'Database "'+t+'" requires upgrade from version:',e.oldVersion);var r=e.target.result;var i=new dt(o.transaction);n.createOrUpgrade(r,i,e.oldVersion,vr).next((function(){c(lt,"Database upgrade to version "+vr+" complete")}))}})).toPromise()};e.delete=function(e){c(lt,"Removing database:",e);return vt(window.indexedDB.deleteDatabase(e)).toPromise()};e.isAvailable=function(){if(typeof window==="undefined"||window.indexedDB==null){return false}if(window.navigator===undefined){return process.env.USE_MOCK_PERSISTENCE==="YES"}var t=V.getUA();var r=e.getIOSVersion(t);var n=0<r&&r<10;var i=e.getAndroidVersion(t);var a=0<i&&i<4.5;if(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||a){return false}else{return true}};e.getStore=function(e,t){return e.store(t)};e.getIOSVersion=function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);var r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)};e.getAndroidVersion=function(e){var t=e.match(/Android ([\d.]+)/i);var r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)};e.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}};e.prototype.runTransaction=function(e,t,r){var n=dt.open(this.db,e,t);var i=r(n).catch((function(e){n.abort(e);return Je.reject(e)})).toPromise();i.catch((function(){}));return n.completionPromise.then((function(){return i}))};e.prototype.close=function(){this.db.close()};return e}();var ht=function(){function e(e){this.dbCursor=e;this.shouldStop=false;this.nextKey=null}Object.defineProperty(e.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cursor",{set:function(e){this.dbCursor=e},enumerable:true,configurable:true});e.prototype.done=function(){this.shouldStop=true};e.prototype.skip=function(e){this.nextKey=e};e.prototype.delete=function(){return vt(this.dbCursor.delete())};return e}();var dt=function(){function e(e){var t=this;this.transaction=e;this.aborted=false;this.completionDeferred=new ge;this.transaction.oncomplete=function(){t.completionDeferred.resolve()};this.transaction.onabort=function(){if(e.error){t.completionDeferred.reject(e.error)}else{t.completionDeferred.resolve()}};this.transaction.onerror=function(e){var r=yt(e.target.error);t.completionDeferred.reject(r)}}e.open=function(t,r,n){return new e(t.transaction(n,r))};Object.defineProperty(e.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:true,configurable:true});e.prototype.abort=function(e){if(e){this.completionDeferred.reject(e)}if(!this.aborted){c(lt,"Aborting transaction:",e?e.message:"Client-initiated abort");this.aborted=true;this.transaction.abort()}};e.prototype.store=function(e){var t=this.transaction.objectStore(e);d(!!t,"Object store not part of transaction: "+e);return new pt(t)};return e}();var pt=function(){function e(e){this.store=e}e.prototype.put=function(e,t){var r;if(t!==undefined){c(lt,"PUT",this.store.name,e,t);r=this.store.put(t,e)}else{c(lt,"PUT",this.store.name,"<auto-key>",e);r=this.store.put(e)}return vt(r)};e.prototype.add=function(e){c(lt,"ADD",this.store.name,e,e);var t=this.store.add(e);return vt(t)};e.prototype.get=function(e){var t=this;var r=this.store.get(e);return vt(r).next((function(r){if(r===undefined){r=null}c(lt,"GET",t.store.name,e,r);return r}))};e.prototype.delete=function(e){c(lt,"DELETE",this.store.name,e);var t=this.store.delete(e);return vt(t)};e.prototype.count=function(){c(lt,"COUNT",this.store.name);var e=this.store.count();return vt(e)};e.prototype.loadAll=function(e,t){var r=this.cursor(this.options(e,t));var n=[];return this.iterateCursor(r,(function(e,t){n.push(t)})).next((function(){return n}))};e.prototype.deleteAll=function(e,t){c(lt,"DELETE ALL",this.store.name);var r=this.options(e,t);r.keysOnly=false;var n=this.cursor(r);return this.iterateCursor(n,(function(e,t,r){return r.delete()}))};e.prototype.iterate=function(e,t){var r;if(!t){r={};t=e}else{r=e}var n=this.cursor(r);return this.iterateCursor(n,t)};e.prototype.iterateSerial=function(e){var t=this.cursor({});return new Je((function(r,n){t.onerror=function(e){var t=yt(e.target.error);n(t)};t.onsuccess=function(t){var n=t.target.result;if(!n){r();return}e(n.primaryKey,n.value).next((function(e){if(e){n.continue()}else{r()}}))}}))};e.prototype.iterateCursor=function(e,t){var r=[];return new Je((function(n,i){e.onerror=function(e){i(e.target.error)};e.onsuccess=function(e){var i=e.target.result;if(!i){n();return}var a=new ht(i);var o=t(i.primaryKey,i.value,a);if(o instanceof Je){var s=o.catch((function(e){a.done();return Je.reject(e)}));r.push(s)}if(a.isDone){n()}else if(a.skipToKey===null){i.continue()}else{i.continue(a.skipToKey)}}})).next((function(){return Je.waitFor(r)}))};e.prototype.options=function(e,t){var r=undefined;if(e!==undefined){if(typeof e==="string"){r=e}else{d(t===undefined,"3rd argument must not be defined if 2nd is a range.");t=e}}return{index:r,range:t}};e.prototype.cursor=function(e){var t="next";if(e.reverse){t="prev"}if(e.index){var r=this.store.index(e.index);if(e.keysOnly){return r.openKeyCursor(e.range,t)}else{return r.openCursor(e.range,t)}}else{return this.store.openCursor(e.range,t)}};return e}();function vt(e){return new Je((function(t,r){e.onsuccess=function(e){var r=e.target.result;t(r)};e.onerror=function(e){var t=yt(e.target.error);r(t)}}))}var mt=false;function yt(e){var t=ft.getIOSVersion(V.getUA());if(t>=12.2&&t<13){var r="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(r)>=0){var n=new y("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+r+"'. This is likely "+"due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 "+"for details and a potential workaround.");if(!mt){mt=true;setTimeout((function(){throw n}),0)}return n}}return e}var gt=function(){function e(e,t){this.referenceDelegate=e;this.serializer=t;this.targetIdGenerator=ct.forQueryCache()}e.prototype.allocateTargetId=function(e){var t=this;return this.retrieveMetadata(e).next((function(r){r.highestTargetId=t.targetIdGenerator.after(r.highestTargetId);return t.saveMetadata(e,r).next((function(){return r.highestTargetId}))}))};e.prototype.getLastRemoteSnapshotVersion=function(e){return this.retrieveMetadata(e).next((function(e){return Oe.fromTimestamp(new ke(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))};e.prototype.getHighestSequenceNumber=function(e){return St(e.simpleDbTransaction)};e.prototype.setTargetsMetadata=function(e,t,r){var n=this;return this.retrieveMetadata(e).next((function(i){i.highestListenSequenceNumber=t;if(r){i.lastRemoteSnapshotVersion=r.toTimestamp()}if(t>i.highestListenSequenceNumber){i.highestListenSequenceNumber=t}return n.saveMetadata(e,i)}))};e.prototype.addQueryData=function(e,t){var r=this;return this.saveQueryData(e,t).next((function(){return r.retrieveMetadata(e).next((function(n){n.targetCount+=1;r.updateMetadataFromQueryData(t,n);return r.saveMetadata(e,n)}))}))};e.prototype.updateQueryData=function(e,t){return this.saveQueryData(e,t)};e.prototype.removeQueryData=function(e,t){var r=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return bt(e).delete(t.targetId)})).next((function(){return r.retrieveMetadata(e)})).next((function(t){d(t.targetCount>0,"Removing from an empty query cache");t.targetCount-=1;return r.saveMetadata(e,t)}))};e.prototype.removeTargets=function(e,t,r){var n=this;var i=0;var a=[];return bt(e).iterate((function(o,s){var u=n.serializer.fromDbTarget(s);if(u.sequenceNumber<=t&&r[u.targetId]===undefined){i++;a.push(n.removeQueryData(e,u))}})).next((function(){return Je.waitFor(a)})).next((function(){return i}))};e.prototype.forEachTarget=function(e,t){var r=this;return bt(e).iterate((function(e,n){var i=r.serializer.fromDbTarget(n);t(i)}))};e.prototype.retrieveMetadata=function(e){return _t(e.simpleDbTransaction)};e.prototype.saveMetadata=function(e,t){return wt(e).put(Pr.key,t)};e.prototype.saveQueryData=function(e,t){return bt(e).put(this.serializer.toDbTarget(t))};e.prototype.updateMetadataFromQueryData=function(e,t){var r=false;if(e.targetId>t.highestTargetId){t.highestTargetId=e.targetId;r=true}if(e.sequenceNumber>t.highestListenSequenceNumber){t.highestListenSequenceNumber=e.sequenceNumber;r=true}return r};e.prototype.getQueryCount=function(e){return this.retrieveMetadata(e).next((function(e){return e.targetCount}))};e.prototype.getQueryData=function(e,t){var r=this;var n=t.canonicalId();var i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);var a=null;return bt(e).iterate({range:i,index:Mr.queryTargetsIndexName},(function(e,n,i){var o=r.serializer.fromDbTarget(n);if(t.isEqual(o.query)){a=o;i.done()}})).next((function(){return a}))};e.prototype.addMatchingKeys=function(e,t,r){var n=this;var i=[];var a=Et(e);t.forEach((function(t){var o=De(t.path);i.push(a.put(new xr(r,o)));i.push(n.referenceDelegate.addReference(e,t))}));return Je.waitFor(i)};e.prototype.removeMatchingKeys=function(e,t,r){var n=this;var i=Et(e);return Je.forEach(t,(function(t){var a=De(t.path);return Je.waitFor([i.delete([r,a]),n.referenceDelegate.removeReference(e,t)])}))};e.prototype.removeMatchingKeysForTargetId=function(e,t){var r=Et(e);var n=IDBKeyRange.bound([t],[t+1],false,true);return r.delete(n)};e.prototype.getMatchingKeysForTargetId=function(e,t){var r=IDBKeyRange.bound([t],[t+1],false,true);var n=Et(e);var i=Ke();return n.iterate({range:r,keysOnly:true},(function(e,t,r){var n=Ne(e[1]);var a=new ye(n);i=i.add(a)})).next((function(){return i}))};e.prototype.containsKey=function(e,t){var r=De(t.path);var n=IDBKeyRange.bound([r],[ne(r)],false,true);var i=0;return Et(e).iterate({index:xr.documentTargetsIndex,keysOnly:true,range:n},(function(e,t,r){var n=e[0];if(n!==0){i++;r.done()}})).next((function(){return i>0}))};e.prototype.getQueryDataForTarget=function(e,t){var r=this;return bt(e).get(t).next((function(e){if(e){return r.serializer.fromDbTarget(e)}else{return null}}))};return e}();function bt(e){return wn.getStore(e,Mr.store)}function wt(e){return wn.getStore(e,Pr.store)}function _t(e){var t=ft.getStore(e,Pr.store);return t.get(Pr.key).next((function(e){d(e!==null,"Missing metadata row.");return e}))}function St(e){return _t(e).next((function(e){return e.highestListenSequenceNumber}))}function Et(e){return wn.getStore(e,xr.store)}var Tt=function(){function e(e){this.fields=e}e.fromSet=function(t){return new e(t)};e.fromArray=function(t){var r=new Le(me.comparator);t.forEach((function(e){return r=r.add(e)}));return new e(r)};e.prototype.covers=function(e){var t=false;this.fields.forEach((function(r){if(r.isPrefixOf(e)){t=true}}));return t};e.prototype.isEqual=function(e){return this.fields.isEqual(e.fields)};return e}();var It=function(){function e(e,t){this.field=e;this.transform=t}e.prototype.isEqual=function(e){return this.field.isEqual(e.field)&&this.transform.isEqual(e.transform)};return e}();var Dt=function(){function e(e,t){this.version=e;this.transformResults=t}return e}();var Ct;(function(e){e[e["Set"]=0]="Set";e[e["Patch"]=1]="Patch";e[e["Transform"]=2]="Transform";e[e["Delete"]=3]="Delete"})(Ct||(Ct={}));var At=function(){function e(e,t){this.updateTime=e;this.exists=t;d(e===undefined||t===undefined,'Precondition can specify "exists" or "updateTime" but not both')}e.exists=function(t){return new e(undefined,t)};e.updateTime=function(t){return new e(t)};Object.defineProperty(e.prototype,"isNone",{get:function(){return this.updateTime===undefined&&this.exists===undefined},enumerable:true,configurable:true});e.prototype.isValidFor=function(e){if(this.updateTime!==undefined){return e instanceof er&&e.version.isEqual(this.updateTime)}else if(this.exists!==undefined){return this.exists===e instanceof er}else{d(this.isNone,"Precondition should be empty");return true}};e.prototype.isEqual=function(e){return te(this.updateTime,e.updateTime)&&this.exists===e.exists};e.NONE=new e;return e}();var Nt=function(){function e(){}e.prototype.verifyKeyMatches=function(e){if(e!=null){d(e.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")}};e.getPostMutationVersion=function(e){if(e instanceof er){return e.version}else{return Oe.MIN}};return e}();var kt=function(e){F.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.key=t;i.value=r;i.precondition=n;i.type=Ct.Set;return i}t.prototype.applyToRemoteDocument=function(e,t){this.verifyKeyMatches(e);d(t.transformResults==null,"Transform results received by SetMutation.");var r=t.version;return new er(this.key,r,{hasCommittedMutations:true},this.value)};t.prototype.applyToLocalView=function(e,t,r){this.verifyKeyMatches(e);if(!this.precondition.isValidFor(e)){return e}var n=Nt.getPostMutationVersion(e);return new er(this.key,n,{hasLocalMutations:true},this.value)};t.prototype.extractBaseValue=function(e){return null};t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.value.isEqual(e.value)&&this.precondition.isEqual(e.precondition)};return t}(Nt);var Ot=function(e){F.__extends(t,e);function t(t,r,n,i){var a=e.call(this)||this;a.key=t;a.data=r;a.fieldMask=n;a.precondition=i;a.type=Ct.Patch;return a}t.prototype.applyToRemoteDocument=function(e,t){this.verifyKeyMatches(e);d(t.transformResults==null,"Transform results received by PatchMutation.");if(!this.precondition.isValidFor(e)){return new rr(this.key,t.version)}var r=this.patchDocument(e);return new er(this.key,t.version,{hasCommittedMutations:true},r)};t.prototype.applyToLocalView=function(e,t,r){this.verifyKeyMatches(e);if(!this.precondition.isValidFor(e)){return e}var n=Nt.getPostMutationVersion(e);var i=this.patchDocument(e);return new er(this.key,n,{hasLocalMutations:true},i)};t.prototype.extractBaseValue=function(e){return null};t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.fieldMask.isEqual(e.fieldMask)&&this.precondition.isEqual(e.precondition)};t.prototype.patchDocument=function(e){var t;if(e instanceof er){t=e.data()}else{t=Xt.EMPTY}return this.patchObject(t)};t.prototype.patchObject=function(e){var t=this;this.fieldMask.fields.forEach((function(r){if(!r.isEmpty()){var n=t.data.field(r);if(n!==null){e=e.set(r,n)}else{e=e.delete(r)}}}));return e};return t}(Nt);var Mt=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.key=t;n.fieldTransforms=r;n.type=Ct.Transform;n.precondition=At.exists(true);return n}t.prototype.applyToRemoteDocument=function(e,t){this.verifyKeyMatches(e);d(t.transformResults!=null,"Transform results missing for TransformMutation.");if(!this.precondition.isValidFor(e)){return new rr(this.key,t.version)}var r=this.requireDocument(e);var n=this.serverTransformResults(e,t.transformResults);var i=t.version;var a=this.transformObject(r.data(),n);return new er(this.key,i,{hasCommittedMutations:true},a)};t.prototype.applyToLocalView=function(e,t,r){this.verifyKeyMatches(e);if(!this.precondition.isValidFor(e)){return e}var n=this.requireDocument(e);var i=this.localTransformResults(r,e,t);var a=this.transformObject(n.data(),i);return new er(this.key,n.version,{hasLocalMutations:true},a)};t.prototype.extractBaseValue=function(e){var t=null;for(var r=0,n=this.fieldTransforms;r<n.length;r++){var i=n[r];var a=e instanceof er?e.field(i.field):undefined;var o=i.transform.computeBaseValue(a||null);if(o!=null){if(t==null){t=Xt.EMPTY.set(i.field,o)}else{t=t.set(i.field,o)}}}return t};t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&re(this.fieldTransforms,e.fieldTransforms)&&this.precondition.isEqual(e.precondition)};t.prototype.requireDocument=function(e){d(e instanceof er,"Unknown MaybeDocument type "+e);var t=e;d(t.key.isEqual(this.key),"Can only transform a document with the same key");return t};t.prototype.serverTransformResults=function(e,t){var r=[];d(this.fieldTransforms.length===t.length,"server transform result count ("+t.length+") "+("should match field transform count ("+this.fieldTransforms.length+")"));for(var n=0;n<t.length;n++){var i=this.fieldTransforms[n];var a=i.transform;var o=null;if(e instanceof er){o=e.field(i.field)}r.push(a.applyToRemoteDocument(o,t[n]))}return r};t.prototype.localTransformResults=function(e,t,r){var n=[];for(var i=0,a=this.fieldTransforms;i<a.length;i++){var o=a[i];var s=o.transform;var u=null;if(t instanceof er){u=t.field(o.field)}if(u===null&&r instanceof er){u=r.field(o.field)}n.push(s.applyToLocalView(u,e))}return n};t.prototype.transformObject=function(e,t){d(t.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var r=0;r<this.fieldTransforms.length;r++){var n=this.fieldTransforms[r];var i=n.field;e=e.set(i,t[r])}return e};return t}(Nt);var xt=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.key=t;n.precondition=r;n.type=Ct.Delete;return n}t.prototype.applyToRemoteDocument=function(e,t){this.verifyKeyMatches(e);d(t.transformResults==null,"Transform results received by DeleteMutation.");return new tr(this.key,t.version,{hasCommittedMutations:true})};t.prototype.applyToLocalView=function(e,t,r){this.verifyKeyMatches(e);if(!this.precondition.isValidFor(e)){return e}if(e){d(e.key.isEqual(this.key),"Can only apply mutation to document with same key")}return new tr(this.key,Oe.forDeletedDoc())};t.prototype.extractBaseValue=function(e){return null};t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.precondition.isEqual(e.precondition)};return t}(Nt);var Pt;(function(e){e[e["NullValue"]=0]="NullValue";e[e["BooleanValue"]=1]="BooleanValue";e[e["NumberValue"]=2]="NumberValue";e[e["TimestampValue"]=3]="TimestampValue";e[e["StringValue"]=4]="StringValue";e[e["BlobValue"]=5]="BlobValue";e[e["RefValue"]=6]="RefValue";e[e["GeoPointValue"]=7]="GeoPointValue";e[e["ArrayValue"]=8]="ArrayValue";e[e["ObjectValue"]=9]="ObjectValue"})(Pt||(Pt={}));var Rt;(function(e){e[e["Default"]=0]="Default";e[e["Estimate"]=1]="Estimate";e[e["Previous"]=2]="Previous"})(Rt||(Rt={}));var Lt=function(){function e(e,t){this.serverTimestampBehavior=e;this.timestampsInSnapshots=t}e.fromSnapshotOptions=function(t,r){switch(t.serverTimestamps){case"estimate":return new e(Rt.Estimate,r);case"previous":return new e(Rt.Previous,r);case"none":case undefined:return new e(Rt.Default,r);default:return h("fromSnapshotOptions() called with invalid options.")}};return e}();var Ft=function(){function e(){}e.prototype.toString=function(){var e=this.value();return e===null?"null":e.toString()};e.prototype.defaultCompareTo=function(e){d(this.typeOrder!==e.typeOrder,"Default compareTo should not be used for values of same type.");var t=ee(this.typeOrder,e.typeOrder);return t};return e}();var Vt=function(e){F.__extends(t,e);function t(){var t=e.call(this)||this;t.typeOrder=Pt.NullValue;t.internalValue=null;return t}t.prototype.value=function(e){return null};t.prototype.isEqual=function(e){return e instanceof t};t.prototype.compareTo=function(e){if(e instanceof t){return 0}return this.defaultCompareTo(e)};t.INSTANCE=new t;return t}(Ft);var qt=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.internalValue=t;r.typeOrder=Pt.BooleanValue;return r}t.prototype.value=function(e){return this.internalValue};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue===e.internalValue};t.prototype.compareTo=function(e){if(e instanceof t){return ee(this,e)}return this.defaultCompareTo(e)};t.of=function(e){return e?t.TRUE:t.FALSE};t.TRUE=new t(true);t.FALSE=new t(false);return t}(Ft);var jt=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.internalValue=t;r.typeOrder=Pt.NumberValue;return r}t.prototype.value=function(e){return this.internalValue};t.prototype.compareTo=function(e){if(e instanceof t){return Bt(this.internalValue,e.internalValue)}return this.defaultCompareTo(e)};return t}(Ft);function Bt(e,t){if(e<t){return-1}else if(e>t){return 1}else if(e===t){return 0}else{if(isNaN(e)){return isNaN(t)?0:-1}else{return 1}}}function Ut(e,t){if(e===t){return e!==0||1/e===1/t}else{return e!==e&&t!==t}}var Wt=function(e){F.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.isEqual=function(e){if(e instanceof t){return Ut(this.internalValue,e.internalValue)}else{return false}};return t}(jt);var zt=function(e){F.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.isEqual=function(e){if(e instanceof t){return Ut(this.internalValue,e.internalValue)}else{return false}};t.NAN=new t(NaN);t.POSITIVE_INFINITY=new t(Infinity);t.NEGATIVE_INFINITY=new t(-Infinity);return t}(jt);var Qt=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.internalValue=t;r.typeOrder=Pt.StringValue;return r}t.prototype.value=function(e){return this.internalValue};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue===e.internalValue};t.prototype.compareTo=function(e){if(e instanceof t){return ee(this.internalValue,e.internalValue)}return this.defaultCompareTo(e)};return t}(Ft);var Kt=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.internalValue=t;r.typeOrder=Pt.TimestampValue;return r}t.prototype.value=function(e){if(!e||e.timestampsInSnapshots){return this.internalValue}else{return this.internalValue.toDate()}};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue.isEqual(e.internalValue)};t.prototype.compareTo=function(e){if(e instanceof t){return this.internalValue._compareTo(e.internalValue)}else if(e instanceof Gt){return-1}else{return this.defaultCompareTo(e)}};return t}(Ft);var Gt=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.localWriteTime=t;n.previousValue=r;n.typeOrder=Pt.TimestampValue;return n}t.prototype.value=function(e){if(e&&e.serverTimestampBehavior===Rt.Estimate){return new Kt(this.localWriteTime).value(e)}else if(e&&e.serverTimestampBehavior===Rt.Previous){return this.previousValue?this.previousValue.value(e):null}else{return null}};t.prototype.isEqual=function(e){return e instanceof t&&this.localWriteTime.isEqual(e.localWriteTime)};t.prototype.compareTo=function(e){if(e instanceof t){return this.localWriteTime._compareTo(e.localWriteTime)}else if(e instanceof Kt){return 1}else{return this.defaultCompareTo(e)}};t.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"};return t}(Ft);var Ht=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.internalValue=t;r.typeOrder=Pt.BlobValue;return r}t.prototype.value=function(e){return this.internalValue};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue.isEqual(e.internalValue)};t.prototype.compareTo=function(e){if(e instanceof t){return this.internalValue._compareTo(e.internalValue)}return this.defaultCompareTo(e)};return t}(Ft);var Yt=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.databaseId=t;n.key=r;n.typeOrder=Pt.RefValue;return n}t.prototype.value=function(e){return this.key};t.prototype.isEqual=function(e){if(e instanceof t){return this.key.isEqual(e.key)&&this.databaseId.isEqual(e.databaseId)}else{return false}};t.prototype.compareTo=function(e){if(e instanceof t){var r=this.databaseId.compareTo(e.databaseId);return r!==0?r:ye.comparator(this.key,e.key)}return this.defaultCompareTo(e)};return t}(Ft);var $t=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.internalValue=t;r.typeOrder=Pt.GeoPointValue;return r}t.prototype.value=function(e){return this.internalValue};t.prototype.isEqual=function(e){return e instanceof t&&this.internalValue.isEqual(e.internalValue)};t.prototype.compareTo=function(e){if(e instanceof t){return this.internalValue._compareTo(e.internalValue)}return this.defaultCompareTo(e)};return t}(Ft);var Xt=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.internalValue=t;r.typeOrder=Pt.ObjectValue;return r}t.prototype.value=function(e){var t={};this.internalValue.inorderTraversal((function(r,n){t[r]=n.value(e)}));return t};t.prototype.forEach=function(e){this.internalValue.inorderTraversal(e)};t.prototype.isEqual=function(e){if(e instanceof t){var r=this.internalValue.getIterator();var n=e.internalValue.getIterator();while(r.hasNext()&&n.hasNext()){var i=r.getNext();var a=n.getNext();if(i.key!==a.key||!i.value.isEqual(a.value)){return false}}return!r.hasNext()&&!n.hasNext()}return false};t.prototype.compareTo=function(e){if(e instanceof t){var r=this.internalValue.getIterator();var n=e.internalValue.getIterator();while(r.hasNext()&&n.hasNext()){var i=r.getNext();var a=n.getNext();var o=ee(i.key,a.key)||i.value.compareTo(a.value);if(o){return o}}return ee(r.hasNext(),n.hasNext())}else{return this.defaultCompareTo(e)}};t.prototype.set=function(e,r){d(!e.isEmpty(),"Cannot set field for empty path on ObjectValue");if(e.length===1){return this.setChild(e.firstSegment(),r)}else{var n=this.child(e.firstSegment());if(!(n instanceof t)){n=t.EMPTY}var i=n.set(e.popFirst(),r);return this.setChild(e.firstSegment(),i)}};t.prototype.delete=function(e){d(!e.isEmpty(),"Cannot delete field for empty path on ObjectValue");if(e.length===1){return new t(this.internalValue.remove(e.firstSegment()))}else{var r=this.child(e.firstSegment());if(r instanceof t){var n=r.delete(e.popFirst());return new t(this.internalValue.insert(e.firstSegment(),n))}else{return this}}};t.prototype.contains=function(e){return this.field(e)!==null};t.prototype.field=function(e){d(!e.isEmpty(),"Can't get field of empty path");var r=this;e.forEach((function(e){if(r instanceof t){r=r.internalValue.get(e)}else{r=null}}));return r};t.prototype.fieldMask=function(){var e=new Le(me.comparator);this.internalValue.forEach((function(r,n){var i=new me([r]);if(n instanceof t){var a=n.fieldMask();var o=a.fields;if(o.isEmpty()){e=e.add(i)}else{o.forEach((function(t){e=e.add(i.child(t))}))}}else{e=e.add(i)}}));return Tt.fromSet(e)};t.prototype.toString=function(){return this.internalValue.toString()};t.prototype.child=function(e){return this.internalValue.get(e)||undefined};t.prototype.setChild=function(e,r){return new t(this.internalValue.insert(e,r))};t.EMPTY=new t(new Me(ee));return t}(Ft);var Jt=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.internalValue=t;r.typeOrder=Pt.ArrayValue;return r}t.prototype.value=function(e){return this.internalValue.map((function(t){return t.value(e)}))};t.prototype.contains=function(e){for(var t=0,r=this.internalValue;t<r.length;t++){var n=r[t];if(n.isEqual(e)){return true}}return false};t.prototype.forEach=function(e){this.internalValue.forEach(e)};t.prototype.isEqual=function(e){if(e instanceof t){if(this.internalValue.length!==e.internalValue.length){return false}for(var r=0;r<this.internalValue.length;r++){if(!this.internalValue[r].isEqual(e.internalValue[r])){return false}}return true}return false};t.prototype.compareTo=function(e){if(e instanceof t){var r=Math.min(this.internalValue.length,e.internalValue.length);for(var n=0;n<r;n++){var i=this.internalValue[n].compareTo(e.internalValue[n]);if(i){return i}}return ee(this.internalValue.length,e.internalValue.length)}else{return this.defaultCompareTo(e)}};t.prototype.toString=function(){var e=this.internalValue.map((function(e){return e.toString()}));return"["+e.join(",")+"]"};return t}(Ft);var Zt=function(){function e(e,t){this.key=e;this.version=t}e.compareByKey=function(e,t){return ye.comparator(e.key,t.key)};return e}();var er=function(e){F.__extends(t,e);function t(t,r,n,i,a,o){var s=e.call(this,t,r)||this;s.objectValue=i;s.proto=a;s.converter=o;d(s.objectValue!==undefined||s.proto!==undefined&&s.converter!==undefined,"If objectValue is not defined, proto and converter need to be set.");s.hasLocalMutations=!!n.hasLocalMutations;s.hasCommittedMutations=!!n.hasCommittedMutations;return s}t.prototype.field=function(e){if(this.objectValue){return this.objectValue.field(e)}else{if(!this.fieldValueCache){this.fieldValueCache=new Map}var t=e.canonicalString();var r=this.fieldValueCache.get(t);if(r===undefined){var n=this.getProtoField(e);if(n===undefined){r=null}else{r=this.converter(n)}this.fieldValueCache.set(t,r)}return r}};t.prototype.data=function(){var e=this;if(!this.objectValue){var t=Xt.EMPTY;E(this.proto.fields,(function(r,n){t=t.set(new me([r]),e.converter(n))}));this.objectValue=t;this.fieldValueCache=undefined}return this.objectValue};t.prototype.value=function(){return this.data().value()};t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.hasLocalMutations===e.hasLocalMutations&&this.hasCommittedMutations===e.hasCommittedMutations&&this.data().isEqual(e.data())};t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", "+("{hasLocalMutations: "+this.hasLocalMutations+"}), ")+("{hasCommittedMutations: "+this.hasCommittedMutations+"})")};Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:true,configurable:true});t.prototype.getProtoField=function(e){d(this.proto!==undefined,"Can only call getProtoField() when proto is defined");var t=this.proto.fields[e.firstSegment()];for(var r=1;r<e.length;++r){if(!t||!t.mapValue){return undefined}t=t.mapValue.fields[e.get(r)]}return t};t.compareByField=function(e,t,r){var n=t.field(e);var i=r.field(e);if(n!==null&&i!==null){return n.compareTo(i)}else{return h("Trying to compare documents on fields that don't exist")}};return t}(Zt);var tr=function(e){F.__extends(t,e);function t(t,r,n){var i=e.call(this,t,r)||this;i.hasCommittedMutations=!!(n&&n.hasCommittedMutations);return i}t.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"};Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:true,configurable:true});t.prototype.isEqual=function(e){return e instanceof t&&e.hasCommittedMutations===this.hasCommittedMutations&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)};return t}(Zt);var rr=function(e){F.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"};Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return true},enumerable:true,configurable:true});t.prototype.isEqual=function(e){return e instanceof t&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)};return t}(Zt);var nr=function(){function e(e){this.mapKeyFn=e;this.inner={}}e.prototype.get=function(e){var t=this.mapKeyFn(e);var r=this.inner[t];if(r===undefined){return undefined}for(var n=0,i=r;n<i.length;n++){var a=i[n],o=a[0],s=a[1];if(o.isEqual(e)){return s}}return undefined};e.prototype.has=function(e){return this.get(e)!==undefined};e.prototype.set=function(e,t){var r=this.mapKeyFn(e);var n=this.inner[r];if(n===undefined){this.inner[r]=[[e,t]];return}for(var i=0;i<n.length;i++){if(n[i][0].isEqual(e)){n[i]=[e,t];return}}n.push([e,t])};e.prototype.delete=function(e){var t=this.mapKeyFn(e);var r=this.inner[t];if(r===undefined){return false}for(var n=0;n<r.length;n++){if(r[n][0].isEqual(e)){if(r.length===1){delete this.inner[t]}else{r.splice(n,1)}return true}}return false};e.prototype.forEach=function(e){E(this.inner,(function(t,r){for(var n=0,i=r;n<i.length;n++){var a=i[n],o=a[0],s=a[1];e(o,s)}}))};e.prototype.isEmpty=function(){return T(this.inner)};return e}();var ir=function(){function e(){this.changes=new nr((function(e){return e.toString()}));this.changesApplied=false}e.prototype.addEntry=function(e){this.assertNotApplied();this.changes.set(e.key,e)};e.prototype.removeEntry=function(e){this.assertNotApplied();this.changes.set(e,null)};e.prototype.getEntry=function(e,t){this.assertNotApplied();var r=this.changes.get(t);if(r!==undefined){return Je.resolve(r)}else{return this.getFromCache(e,t)}};e.prototype.getEntries=function(e,t){return this.getAllFromCache(e,t)};e.prototype.apply=function(e){this.assertNotApplied();this.changesApplied=true;return this.applyChanges(e)};e.prototype.assertNotApplied=function(){d(!this.changesApplied,"Changes have already been applied.")};return e}();var ar="The remote document changelog no longer contains all changes for all "+"local query views. It may be necessary to rebuild these views.";var or=function(){function e(e,t,r){this.serializer=e;this.indexManager=t;this.keepDocumentChangeLog=r;this._lastProcessedDocumentChangeId=0}Object.defineProperty(e.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:true,configurable:true});e.prototype.start=function(e){var t=ft.getStore(e,qr.store);return this.synchronizeLastDocumentChangeId(t)};e.prototype.addEntry=function(e,t,r){var n=this;var i=cr(e);return i.put(fr(t),r).next((function(){n.indexManager.addToCollectionParentIndex(e,t.path.popLast())}))};e.prototype.removeEntry=function(e,t){var r=cr(e);var n=fr(t);return r.delete(n)};e.prototype.updateMetadata=function(e,t,r){var n=this;return this.getMetadata(e).next((function(i){i.byteSize+=r;return n.setMetadata(e,i).next((function(){if(n.keepDocumentChangeLog){return lr(e).put({changes:n.serializer.toDbResourcePaths(t)})}}))}))};e.prototype.getEntry=function(e,t){var r=this;return cr(e).get(fr(t)).next((function(e){return e?r.serializer.fromDbRemoteDocument(e):null}))};e.prototype.getSizedEntry=function(e,t){var r=this;return cr(e).get(fr(t)).next((function(e){return e?{maybeDocument:r.serializer.fromDbRemoteDocument(e),size:hr(e)}:null}))};e.prototype.getEntries=function(e,t){var r=this;var n=je();return this.forEachDbEntry(e,t,(function(e,t){if(t){n=n.insert(e,r.serializer.fromDbRemoteDocument(t))}else{n=n.insert(e,null)}})).next((function(){return n}))};e.prototype.getSizedEntries=function(e,t){var r=this;var n=je();var i=new Me(ye.comparator);return this.forEachDbEntry(e,t,(function(e,t){if(t){n=n.insert(e,r.serializer.fromDbRemoteDocument(t));i=i.insert(e,hr(t))}else{n=n.insert(e,null);i=i.insert(e,0)}})).next((function(){return{maybeDocuments:n,sizeMap:i}}))};e.prototype.forEachDbEntry=function(e,t,r){if(t.isEmpty()){return Je.resolve()}var n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray());var i=t.getIterator();var a=i.getNext();return cr(e).iterate({range:n},(function(e,t,n){var o=ye.fromSegments(e);while(a&&ye.comparator(a,o)<0){r(a,null);a=i.getNext()}if(a&&a.isEqual(o)){r(a,t);a=i.hasNext()?i.getNext():null}if(a){n.skip(a.path.toArray())}else{n.done()}})).next((function(){while(a){r(a,null);a=i.hasNext()?i.getNext():null}}))};e.prototype.getDocumentsMatchingQuery=function(e,t){var r=this;d(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=Ue();var i=t.path.length+1;var a=t.path.toArray();var o=IDBKeyRange.lowerBound(a);return cr(e).iterate({range:o},(function(e,a,o){if(e.length!==i){return}var s=r.serializer.fromDbRemoteDocument(a);if(!t.path.isPrefixOf(s.key.path)){o.done()}else if(s instanceof er&&t.matches(s)){n=n.insert(s.key,s)}})).next((function(){return n}))};e.prototype.getNewDocumentChanges=function(e){var t=this;d(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var r=Ke();var n=qe();var i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1);var a=true;var o=lr(e);return o.iterate({range:i},(function(e,n){if(a){a=false;if(t._lastProcessedDocumentChangeId+1!==n.id){return t.synchronizeLastDocumentChangeId(o).next((function(){return Je.reject(new y(m.DATA_LOSS,ar))}))}}r=r.unionWith(t.serializer.fromDbResourcePaths(n.changes));t._lastProcessedDocumentChangeId=n.id})).next((function(){var i=[];r.forEach((function(r){i.push(t.getEntry(e,r).next((function(e){var t=e||new tr(r,Oe.forDeletedDoc());n=n.insert(r,t)})))}));return Je.waitFor(i)})).next((function(){return n}))};e.prototype.removeDocumentChangesThroughChangeId=function(e,t){var r=IDBKeyRange.upperBound(t);return lr(e).delete(r)};e.prototype.synchronizeLastDocumentChangeId=function(e){var t=this;this._lastProcessedDocumentChangeId=0;return e.iterate({keysOnly:true,reverse:true},(function(e,r,n){t._lastProcessedDocumentChangeId=e;n.done()}))};e.prototype.newChangeBuffer=function(){return new e.RemoteDocumentChangeBuffer(this)};e.prototype.getSize=function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))};e.prototype.getMetadata=function(e){return sr(e).get(kr.key).next((function(e){d(!!e,"Missing document cache metadata");return e}))};e.prototype.setMetadata=function(e,t){return sr(e).put(kr.key,t)};e.RemoteDocumentChangeBuffer=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.documentCache=t;r.documentSizes=new nr((function(e){return e.toString()}));return r}t.prototype.applyChanges=function(e){var t=this;var r=[];var n=0;var i=Ke();this.changes.forEach((function(a,o){var s=t.documentSizes.get(a);d(s!==undefined,"Cannot modify a document that wasn't read (for "+a+")");if(o){var u=t.documentCache.serializer.toDbRemoteDocument(o);var c=hr(u);n+=c-s;r.push(t.documentCache.addEntry(e,a,u))}else{n-=s;r.push(t.documentCache.removeEntry(e,a))}i=i.add(a)}));r.push(this.documentCache.updateMetadata(e,i,n));return Je.waitFor(r)};t.prototype.getFromCache=function(e,t){var r=this;return this.documentCache.getSizedEntry(e,t).next((function(e){if(e===null){r.documentSizes.set(t,0);return null}else{r.documentSizes.set(t,e.size);return e.maybeDocument}}))};t.prototype.getAllFromCache=function(e,t){var r=this;return this.documentCache.getSizedEntries(e,t).next((function(e){var t=e.maybeDocuments,n=e.sizeMap;n.forEach((function(e,t){r.documentSizes.set(e,t)}));return t}))};return t}(ir);return e}();function sr(e){return wn.getStore(e,kr.store)}function ur(e){return e.code===m.DATA_LOSS&&e.message===ar}function cr(e){return wn.getStore(e,Nr.store)}function lr(e){return wn.getStore(e,qr.store)}function fr(e){return e.path.toArray()}function hr(e){var t;if(e.document){t=e.document}else if(e.unknownDocument){t=e.unknownDocument}else if(e.noDocument){t=e.noDocument}else{throw h("Unknown remote document type")}return JSON.stringify(t).length}var dr=function(){function e(){this.collectionParentIndex=new pr}e.prototype.addToCollectionParentIndex=function(e,t){this.collectionParentIndex.add(t);return Je.resolve()};e.prototype.getCollectionParents=function(e,t){return Je.resolve(this.collectionParentIndex.getEntries(t))};return e}();var pr=function(){function e(){this.index={}}e.prototype.add=function(e){d(e.length%2===1,"Expected a collection path.");var t=e.lastSegment();var r=e.popLast();var n=this.index[t]||new Le(pe.comparator);var i=!n.has(r);this.index[t]=n.add(r);return i};e.prototype.getEntries=function(e){var t=this.index[e]||new Le(pe.comparator);return t.toArray()};return e}();var vr=8;var mr=function(){function e(e){this.serializer=e}e.prototype.createOrUpgrade=function(e,t,r,n){var i=this;d(r<n&&r>=0&&n<=vr,"Unexpected schema upgrade from v"+r+" to v{toVersion}.");if(r<1&&n>=1){wr(e);Er(e);Lr(e);Dr(e)}var a=Je.resolve();if(r<3&&n>=3){if(r!==0){Fr(e);Lr(e)}a=a.next((function(){return Vr(t)}))}if(r<4&&n>=4){if(r!==0){a=a.next((function(){return Tr(e,t)}))}a=a.next((function(){Ur(e);jr(e)}))}if(r<5&&n>=5){a=a.next((function(){return i.removeAcknowledgedMutations(t)}))}if(r<6&&n>=6){a=a.next((function(){Or(e);return i.addDocumentGlobal(t)}))}if(r<7&&n>=7){a=a.next((function(){return i.ensureSequenceNumbers(t)}))}if(r<8&&n>=8){a=a.next((function(){return i.createCollectionParentIndex(e,t)}))}return a};e.prototype.addDocumentGlobal=function(e){var t=0;return e.store(Nr.store).iterate((function(e,r){t+=hr(r)})).next((function(){var r=new kr(t);return e.store(kr.store).put(kr.key,r)}))};e.prototype.removeAcknowledgedMutations=function(e){var t=this;var r=e.store(_r.store);var n=e.store(Sr.store);return r.loadAll().next((function(r){return Je.forEach(r,(function(r){var i=IDBKeyRange.bound([r.userId,Ye],[r.userId,r.lastAcknowledgedBatchId]);return n.loadAll(Sr.userMutationsIndex,i).next((function(n){return Je.forEach(n,(function(n){d(n.userId===r.userId,"Cannot process batch "+n.batchId+" from unexpected user");var i=t.serializer.fromDbMutationBatch(n);return rt(e,r.userId,i).next((function(){}))}))}))}))}))};e.prototype.ensureSequenceNumbers=function(e){var t=e.store(xr.store);var r=e.store(Nr.store);return St(e).next((function(e){var n=function(r){return t.put(new xr(0,De(r),e))};var i=[];return r.iterate((function(e,r){var a=new pe(e);var o=yr(a);i.push(t.get(o).next((function(e){if(!e){return n(a)}else{return Je.resolve()}})))})).next((function(){return Je.waitFor(i)}))}))};e.prototype.createCollectionParentIndex=function(e,t){e.createObjectStore(Rr.store,{keyPath:Rr.keyPath});var r=t.store(Rr.store);var n=new pr;var i=function(e){if(n.add(e)){var t=e.lastSegment();var i=e.popLast();return r.put({collectionId:t,parent:De(i)})}};return t.store(Nr.store).iterate({keysOnly:true},(function(e,t){var r=new pe(e);return i(r.popLast())})).next((function(){return t.store(Ir.store).iterate({keysOnly:true},(function(e,t){var r=e[1];var n=Ne(r);return i(n.popLast())}))}))};return e}();function yr(e){return[0,De(e)]}var gr=function(){function e(e,t){this.seconds=e;this.nanoseconds=t}return e}();var br=function(){function e(e,t,r){this.ownerId=e;this.allowTabSynchronization=t;this.leaseTimestampMs=r}e.store="owner";e.key="owner";return e}();function wr(e){e.createObjectStore(br.store)}var _r=function(){function e(e,t,r){this.userId=e;this.lastAcknowledgedBatchId=t;this.lastStreamToken=r}e.store="mutationQueues";e.keyPath="userId";return e}();var Sr=function(){function e(e,t,r,n,i){this.userId=e;this.batchId=t;this.localWriteTimeMs=r;this.baseMutations=n;this.mutations=i}e.store="mutations";e.keyPath="batchId";e.userMutationsIndex="userMutationsIndex";e.userMutationsKeyPath=["userId","batchId"];return e}();function Er(e){e.createObjectStore(_r.store,{keyPath:_r.keyPath});var t=e.createObjectStore(Sr.store,{keyPath:Sr.keyPath,autoIncrement:true});t.createIndex(Sr.userMutationsIndex,Sr.userMutationsKeyPath,{unique:true});e.createObjectStore(Ir.store)}function Tr(e,t){var r=t.store(Sr.store);return r.loadAll().next((function(r){e.deleteObjectStore(Sr.store);var n=e.createObjectStore(Sr.store,{keyPath:Sr.keyPath,autoIncrement:true});n.createIndex(Sr.userMutationsIndex,Sr.userMutationsKeyPath,{unique:true});var i=t.store(Sr.store);var a=r.map((function(e){return i.put(e)}));return Je.waitFor(a)}))}var Ir=function(){function e(){}e.prefixForUser=function(e){return[e]};e.prefixForPath=function(e,t){return[e,De(t)]};e.key=function(e,t,r){return[e,De(t),r]};e.store="documentMutations";e.PLACEHOLDER=new e;return e}();function Dr(e){e.createObjectStore(Nr.store)}var Cr=function(){function e(e,t){this.path=e;this.readTime=t}return e}();var Ar=function(){function e(e,t){this.path=e;this.version=t}return e}();var Nr=function(){function e(e,t,r,n){this.unknownDocument=e;this.noDocument=t;this.document=r;this.hasCommittedMutations=n}e.store="remoteDocuments";return e}();var kr=function(){function e(e){this.byteSize=e}e.store="remoteDocumentGlobal";e.key="remoteDocumentGlobalKey";return e}();function Or(e){e.createObjectStore(kr.store)}var Mr=function(){function e(e,t,r,n,i,a){this.targetId=e;this.canonicalId=t;this.readTime=r;this.resumeToken=n;this.lastListenSequenceNumber=i;this.query=a}e.store="targets";e.keyPath="targetId";e.queryTargetsIndexName="queryTargetsIndex";e.queryTargetsKeyPath=["canonicalId","targetId"];return e}();var xr=function(){function e(e,t,r){this.targetId=e;this.path=t;this.sequenceNumber=r;d(e===0===(r!==undefined),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}e.store="targetDocuments";e.keyPath=["targetId","path"];e.documentTargetsIndex="documentTargetsIndex";e.documentTargetsKeyPath=["path","targetId"];return e}();var Pr=function(){function e(e,t,r,n){this.highestTargetId=e;this.highestListenSequenceNumber=t;this.lastRemoteSnapshotVersion=r;this.targetCount=n}e.key="targetGlobalKey";e.store="targetGlobal";return e}();var Rr=function(){function e(e,t){this.collectionId=e;this.parent=t}e.store="collectionParents";e.keyPath=["collectionId","parent"];return e}();function Lr(e){var t=e.createObjectStore(xr.store,{keyPath:xr.keyPath});t.createIndex(xr.documentTargetsIndex,xr.documentTargetsKeyPath,{unique:true});var r=e.createObjectStore(Mr.store,{keyPath:Mr.keyPath});r.createIndex(Mr.queryTargetsIndexName,Mr.queryTargetsKeyPath,{unique:true});e.createObjectStore(Pr.store)}function Fr(e){e.deleteObjectStore(xr.store);e.deleteObjectStore(Mr.store);e.deleteObjectStore(Pr.store)}function Vr(e){var t=e.store(Pr.store);var r=new Pr(0,0,Oe.MIN.toTimestamp(),0);return t.put(Pr.key,r)}var qr=function(){function e(e){this.changes=e}e.store="remoteDocumentChanges";e.keyPath="id";return e}();function jr(e){e.createObjectStore(qr.store,{keyPath:"id",autoIncrement:true})}var Br=function(){function e(e,t,r,n,i){this.clientId=e;this.updateTimeMs=t;this.networkEnabled=r;this.inForeground=n;this.lastProcessedDocumentChangeId=i}e.store="clientMetadata";e.keyPath="clientId";return e}();function Ur(e){e.createObjectStore(Br.store,{keyPath:Br.keyPath})}var Wr=[_r.store,Sr.store,Ir.store,Nr.store,Mr.store,br.store,Pr.store,xr.store];var zr=Wr;var Qr=zr.concat([Br.store,qr.store]);var Kr=Qr.concat([kr.store]);var Gr=Kr.concat([Rr.store]);var Hr=Gr;var Yr=function(){function e(){this.collectionParentsCache=new pr}e.prototype.addToCollectionParentIndex=function(e,t){d(t.length%2===1,"Expected a collection path.");if(this.collectionParentsCache.add(t)){d(t.length>=1,"Invalid collection path.");var r=t.lastSegment();var n=t.popLast();return $r(e).put({collectionId:r,parent:De(n)})}return Je.resolve()};e.prototype.getCollectionParents=function(e,t){var r=[];var n=IDBKeyRange.bound([t,""],[ne(t),""],false,true);return $r(e).loadAll(n).next((function(e){for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.collectionId!==t){break}r.push(Ne(a.parent))}return r}))};return e}();function $r(e){return wn.getStore(e,Rr.store)}var Xr;(function(e){e[e["Listen"]=0]="Listen";e[e["ExistenceFilterMismatch"]=1]="ExistenceFilterMismatch";e[e["LimboResolution"]=2]="LimboResolution"})(Xr||(Xr={}));var Jr=function(){function e(e,t,r,n,i,a){if(i===void 0){i=Oe.MIN}if(a===void 0){a=v()}this.query=e;this.targetId=t;this.purpose=r;this.sequenceNumber=n;this.snapshotVersion=i;this.resumeToken=a}e.prototype.withSequenceNumber=function(t){return new e(this.query,this.targetId,this.purpose,t,this.snapshotVersion,this.resumeToken)};e.prototype.withResumeToken=function(t,r){return new e(this.query,this.targetId,this.purpose,this.sequenceNumber,r,t)};e.prototype.isEqual=function(e){return this.targetId===e.targetId&&this.purpose===e.purpose&&this.sequenceNumber===e.sequenceNumber&&this.snapshotVersion.isEqual(e.snapshotVersion)&&this.resumeToken===e.resumeToken&&this.query.isEqual(e.query)};return e}();var Zr=function(){function e(e){this.remoteSerializer=e}e.prototype.fromDbRemoteDocument=function(e){if(e.document){return this.remoteSerializer.fromDocument(e.document,!!e.hasCommittedMutations)}else if(e.noDocument){var t=ye.fromSegments(e.noDocument.path);var r=this.fromDbTimestamp(e.noDocument.readTime);return new tr(t,r,{hasCommittedMutations:!!e.hasCommittedMutations})}else if(e.unknownDocument){var t=ye.fromSegments(e.unknownDocument.path);var r=this.fromDbTimestamp(e.unknownDocument.version);return new rr(t,r)}else{return h("Unexpected DbRemoteDocument")}};e.prototype.toDbRemoteDocument=function(e){if(e instanceof er){var t=e.proto?e.proto:this.remoteSerializer.toDocument(e);var r=e.hasCommittedMutations;return new Nr(null,null,t,r)}else if(e instanceof tr){var n=e.key.path.toArray();var i=this.toDbTimestamp(e.version);var r=e.hasCommittedMutations;return new Nr(null,new Cr(n,i),null,r)}else if(e instanceof rr){var n=e.key.path.toArray();var i=this.toDbTimestamp(e.version);return new Nr(new Ar(n,i),null,null,true)}else{return h("Unexpected MaybeDocumment")}};e.prototype.toDbTimestamp=function(e){var t=e.toTimestamp();return new gr(t.seconds,t.nanoseconds)};e.prototype.fromDbTimestamp=function(e){var t=new ke(e.seconds,e.nanoseconds);return Oe.fromTimestamp(t)};e.prototype.toDbMutationBatch=function(e,t){var r=this;var n=t.baseMutations.map((function(e){return r.remoteSerializer.toMutation(e)}));var i=t.mutations.map((function(e){return r.remoteSerializer.toMutation(e)}));return new Sr(e,t.batchId,t.localWriteTime.toMillis(),n,i)};e.prototype.fromDbMutationBatch=function(e){var t=this;var r=(e.baseMutations||[]).map((function(e){return t.remoteSerializer.fromMutation(e)}));var n=e.mutations.map((function(e){return t.remoteSerializer.fromMutation(e)}));var i=ke.fromMillis(e.localWriteTimeMs);return new $e(e.batchId,i,r,n)};e.prototype.toDbResourcePaths=function(e){var t=[];e.forEach((function(e){t.push(De(e.path))}));return t};e.prototype.fromDbResourcePaths=function(e){var t=Ke();for(var r=0,n=e;r<n.length;r++){var i=n[r];t=t.add(new ye(Ne(i)))}return t};e.prototype.fromDbTarget=function(e){var t=this.fromDbTimestamp(e.readTime);var r;if(en(e.query)){r=this.remoteSerializer.fromDocumentsTarget(e.query)}else{r=this.remoteSerializer.fromQueryTarget(e.query)}return new Jr(r,e.targetId,Xr.Listen,e.lastListenSequenceNumber,t,e.resumeToken)};e.prototype.toDbTarget=function(e){d(Xr.Listen===e.purpose,"Only queries with purpose "+Xr.Listen+" may be stored, got "+e.purpose);var t=this.toDbTimestamp(e.snapshotVersion);var r;if(e.query.isDocumentQuery()){r=this.remoteSerializer.toDocumentsTarget(e.query)}else{r=this.remoteSerializer.toQueryTarget(e.query)}var n;if(e.resumeToken instanceof Uint8Array){d(process.env.USE_MOCK_PERSISTENCE==="YES","Persisting non-string stream tokens is only supported with mock persistence .");n=e.resumeToken.toString()}else{n=e.resumeToken}return new Mr(e.targetId,e.query.canonicalId(),t,n,e.sequenceNumber,r)};return e}();function en(e){return e.documents!==undefined}function tn(e,t){var r=e[0],n=e[1];var i=t[0],a=t[1];var o=ee(r,i);if(o===0){return ee(n,a)}else{return o}}var rn=function(){function e(e){this.maxElements=e;this.buffer=new Le(tn);this.previousIndex=0}e.prototype.nextIndex=function(){return++this.previousIndex};e.prototype.addElement=function(e){var t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements){this.buffer=this.buffer.add(t)}else{var r=this.buffer.last();if(tn(t,r)<0){this.buffer=this.buffer.delete(r).add(t)}}};Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:true,configurable:true});return e}();var nn={didRun:false,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};var an=function(){function e(e,t,r){this.cacheSizeCollectionThreshold=e;this.percentileToCollect=t;this.maximumSequenceNumbersToCollect=r}e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)};e.COLLECTION_DISABLED=-1;e.MINIMUM_CACHE_SIZE_BYTES=1*1024*1024;e.DEFAULT_CACHE_SIZE_BYTES=40*1024*1024;e.DEFAULT_COLLECTION_PERCENTILE=10;e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;e.DEFAULT=new e(e.DEFAULT_CACHE_SIZE_BYTES,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);e.DISABLED=new e(e.COLLECTION_DISABLED,0,0);return e}();var on=1*60*1e3;var sn=5*60*1e3;var un=function(){function e(e,t,r){this.garbageCollector=e;this.asyncQueue=t;this.localStore=r;this.hasRun=false;this.gcTask=null}e.prototype.start=function(){d(this.gcTask===null,"Cannot start an already started LruScheduler");if(this.garbageCollector.params.cacheSizeCollectionThreshold!==an.COLLECTION_DISABLED){this.scheduleGC()}};e.prototype.stop=function(){if(this.gcTask){this.gcTask.cancel();this.gcTask=null}};Object.defineProperty(e.prototype,"started",{get:function(){return this.gcTask!==null},enumerable:true,configurable:true});e.prototype.scheduleGC=function(){var e=this;d(this.gcTask===null,"Cannot schedule GC while a task is pending");var t=this.hasRun?sn:on;c("LruGarbageCollector","Garbage collection scheduled in "+t+"ms");this.gcTask=this.asyncQueue.enqueueAfterDelay(be.LruGarbageCollection,t,(function(){e.gcTask=null;e.hasRun=true;return e.localStore.collectGarbage(e.garbageCollector).then((function(){return e.scheduleGC()})).catch(Sn)}))};return e}();var cn=function(){function e(e,t){this.delegate=e;this.params=t}e.prototype.calculateTargetCount=function(e,t){return this.delegate.getSequenceNumberCount(e).next((function(e){return Math.floor(t/100*e)}))};e.prototype.nthSequenceNumber=function(e,t){var r=this;if(t===0){return Je.resolve(fe.INVALID)}var n=new rn(t);return this.delegate.forEachTarget(e,(function(e){return n.addElement(e.sequenceNumber)})).next((function(){return r.delegate.forEachOrphanedDocumentSequenceNumber(e,(function(e){return n.addElement(e)}))})).next((function(){return n.maxValue}))};e.prototype.removeTargets=function(e,t,r){return this.delegate.removeTargets(e,t,r)};e.prototype.removeOrphanedDocuments=function(e,t){return this.delegate.removeOrphanedDocuments(e,t)};e.prototype.collect=function(e,t){var r=this;if(this.params.cacheSizeCollectionThreshold===an.COLLECTION_DISABLED){c("LruGarbageCollector","Garbage collection skipped; disabled");return Je.resolve(nn)}return this.getCacheSize(e).next((function(n){if(n<r.params.cacheSizeCollectionThreshold){c("LruGarbageCollector","Garbage collection skipped; Cache size "+n+" "+("is lower than threshold "+r.params.cacheSizeCollectionThreshold));return nn}else{return r.runGarbageCollection(e,t)}}))};e.prototype.getCacheSize=function(e){return this.delegate.getCacheSize(e)};e.prototype.runGarbageCollection=function(e,t){var r=this;var n;var i,a;var u,l,f,h;var d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){if(t>r.params.maximumSequenceNumbersToCollect){c("LruGarbageCollector","Capping sequence numbers to collect down "+("to the maximum of "+r.params.maximumSequenceNumbersToCollect+" ")+("from "+t));i=r.params.maximumSequenceNumbersToCollect}else{i=t}u=Date.now();return r.nthSequenceNumber(e,i)})).next((function(i){n=i;l=Date.now();return r.removeTargets(e,n,t)})).next((function(t){a=t;f=Date.now();return r.removeOrphanedDocuments(e,n)})).next((function(e){h=Date.now();if(s()<=o.DEBUG){var t="LRU Garbage Collection\n"+("\tCounted targets in "+(u-d)+"ms\n")+("\tDetermined least recently used "+i+" in ")+(l-u+"ms\n")+("\tRemoved "+a+" targets in ")+(f-l+"ms\n")+("\tRemoved "+e+" documents in ")+(h-f+"ms\n")+("Total Duration: "+(h-d)+"ms");c("LruGarbageCollector",t)}return Je.resolve({didRun:true,sequenceNumbersCollected:i,targetsRemoved:a,documentsRemoved:e})}))};return e}();var ln=function(){function e(){}return e}();var fn="IndexedDbPersistence";var hn=30*60*1e3;var dn=5e3;var pn=4e3;var vn="The current tab is not in the required state to perform this operation. "+"It might be necessary to refresh the browser tab.";var mn="Another tab has exclusive access to the persistence layer. "+"To allow shared access, make sure to invoke "+"`enablePersistence()` with `synchronizeTabs:true` in all tabs.";var yn="This platform is either missing"+" IndexedDB or is known to have an incomplete implementation. Offline"+" persistence has been disabled.";var gn="firestore_zombie";var bn=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.simpleDbTransaction=t;n.currentSequenceNumber=r;return n}return t}(ln);var wn=function(){function e(t,r,n,i,a,o,s,u){this.allowTabSynchronization=t;this.persistenceKey=r;this.clientId=n;this.queue=o;this.sequenceNumberSyncer=u;this._started=false;this.isPrimary=false;this.networkEnabled=true;this.windowUnloadHandler=null;this.inForeground=false;this.documentVisibilityHandler=null;this.clientMetadataRefresher=null;this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY;this.primaryStateListener=function(e){return Promise.resolve()};this.referenceDelegate=new In(this,a);this.dbName=r+e.MAIN_DATABASE;this.serializer=new Zr(s);this.document=i.document;this.queryCache=new gt(this.referenceDelegate,this.serializer);this.indexManager=new Yr;this.remoteDocumentCache=new or(this.serializer,this.indexManager,this.allowTabSynchronization);if(i.window&&i.window.localStorage){this.window=i.window;this.webStorage=this.window.localStorage}else{throw new y(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.")}}e.getStore=function(e,t){if(e instanceof bn){return ft.getStore(e.simpleDbTransaction,t)}else{throw h("IndexedDbPersistence must use instances of IndexedDbTransaction")}};e.createIndexedDbPersistence=function(t){return F.__awaiter(this,void 0,void 0,(function(){var r;return F.__generator(this,(function(n){switch(n.label){case 0:if(!e.isAvailable()){throw new y(m.UNIMPLEMENTED,yn)}r=new e(t.allowTabSynchronization,t.persistenceKey,t.clientId,t.platform,t.lruParams,t.queue,t.serializer,t.sequenceNumberSyncer);return[4,r.start()];case 1:n.sent();return[2,r]}}))}))};e.prototype.start=function(){var e=this;d(!this.started,"IndexedDbPersistence double-started!");d(this.window!==null,"Expected 'window' to be defined");return ft.openOrCreate(this.dbName,vr,new mr(this.serializer)).then((function(t){e.simpleDb=t;return e.updateClientMetadataAndTryBecomePrimary()})).then((function(){e.attachVisibilityHandler();e.attachWindowUnloadHook();e.scheduleClientMetadataAndPrimaryLeaseRefreshes();return e.startRemoteDocumentCache()})).then((function(){return e.simpleDb.runTransaction("readonly",[Pr.store],(function(t){return St(t).next((function(t){e.listenSequence=new fe(t,e.sequenceNumberSyncer)}))}))})).then((function(){e._started=true})).catch((function(t){e.simpleDb&&e.simpleDb.close();return Promise.reject(t)}))};e.prototype.startRemoteDocumentCache=function(){var e=this;return this.simpleDb.runTransaction("readonly",Hr,(function(t){return e.remoteDocumentCache.start(t)}))};e.prototype.setPrimaryStateListener=function(e){var t=this;this.primaryStateListener=function(r){return F.__awaiter(t,void 0,void 0,(function(){return F.__generator(this,(function(t){if(this.started){return[2,e(r)]}return[2]}))}))};return e(this.isPrimary)};e.prototype.setDatabaseDeletedListener=function(e){var t=this;this.simpleDb.setVersionChangeListener((function(r){return F.__awaiter(t,void 0,void 0,(function(){return F.__generator(this,(function(t){switch(t.label){case 0:if(!(r.newVersion===null))return[3,2];return[4,e()];case 1:t.sent();t.label=2;case 2:return[2]}}))}))}))};e.prototype.setNetworkEnabled=function(e){var t=this;if(this.networkEnabled!==e){this.networkEnabled=e;this.queue.enqueueAndForget((function(){return F.__awaiter(t,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:if(!this.started)return[3,2];return[4,this.updateClientMetadataAndTryBecomePrimary()];case 1:e.sent();e.label=2;case 2:return[2]}}))}))}))}};e.prototype.updateClientMetadataAndTryBecomePrimary=function(){var e=this;return this.simpleDb.runTransaction("readwrite",Hr,(function(t){var r=Tn(t);return r.put(new Br(e.clientId,Date.now(),e.networkEnabled,e.inForeground,e.remoteDocumentCache.lastProcessedDocumentChangeId)).next((function(){if(e.isPrimary){return e.verifyPrimaryLease(t).next((function(t){if(!t){e.isPrimary=false;e.queue.enqueueAndForget((function(){return e.primaryStateListener(false)}))}}))}})).next((function(){return e.canActAsPrimary(t)})).next((function(r){var n=e.isPrimary;e.isPrimary=r;if(n!==e.isPrimary){e.queue.enqueueAndForget((function(){return e.primaryStateListener(e.isPrimary)}))}if(n&&!e.isPrimary){return e.releasePrimaryLeaseIfHeld(t)}else if(e.isPrimary){return e.acquireOrExtendPrimaryLease(t)}}))}))};e.prototype.verifyPrimaryLease=function(e){var t=this;var r=En(e);return r.get(br.key).next((function(e){return Je.resolve(t.isLocalClient(e))}))};e.prototype.removeClientMetadata=function(e){var t=Tn(e);return t.delete(this.clientId)};e.prototype.maybeGarbageCollectMultiClientState=function(){return F.__awaiter(this,void 0,void 0,(function(){var t,r;var n=this;return F.__generator(this,(function(i){switch(i.label){case 0:if(!(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,hn)))return[3,2];this.lastGarbageCollectionTime=Date.now();r=[];return[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(i){var a=e.getStore(i,Br.store);return a.loadAll().next((function(e){t=n.filterActiveClients(e,hn);r=e.filter((function(e){return t.indexOf(e)===-1}))})).next((function(){return Je.forEach(r,(function(e){return a.delete(e.clientId)}))})).next((function(){t=t.filter((function(e){return e.clientId!==n.clientId}));if(t.length>0){var e=t.map((function(e){return e.lastProcessedDocumentChangeId||0}));var r=Math.min.apply(Math,e);return n.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,r)}}))}))];case 1:i.sent();r.forEach((function(e){n.window.localStorage.removeItem(n.zombiedClientLocalStorageKey(e.clientId))}));i.label=2;case 2:return[2]}}))}))};e.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var e=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(be.ClientMetadataRefresh,pn,(function(){return e.updateClientMetadataAndTryBecomePrimary().then((function(){return e.maybeGarbageCollectMultiClientState()})).then((function(){return e.scheduleClientMetadataAndPrimaryLeaseRefreshes()}))}))};e.prototype.isLocalClient=function(e){return e?e.ownerId===this.clientId:false};e.prototype.canActAsPrimary=function(e){var t=this;var r=En(e);return r.get(br.key).next((function(r){var n=r!==null&&t.isWithinAge(r.leaseTimestampMs,dn)&&!t.isClientZombied(r.ownerId);if(n){if(t.isLocalClient(r)&&t.networkEnabled){return true}if(!t.isLocalClient(r)){if(!r.allowTabSynchronization){throw new y(m.FAILED_PRECONDITION,mn)}return false}}if(t.networkEnabled&&t.inForeground){return true}return Tn(e).loadAll().next((function(e){var r=t.filterActiveClients(e,dn).find((function(e){if(t.clientId!==e.clientId){var r=!t.networkEnabled&&e.networkEnabled;var n=!t.inForeground&&e.inForeground;var i=t.networkEnabled===e.networkEnabled;if(r||n&&i){return true}}return false}));return r===undefined}))})).next((function(e){if(t.isPrimary!==e){c(fn,"Client "+(e?"is":"is not")+" eligible for a primary lease.")}return e}))};e.prototype.shutdown=function(){return F.__awaiter(this,void 0,void 0,(function(){var e=this;return F.__generator(this,(function(t){switch(t.label){case 0:this._started=false;this.markClientZombied();if(this.clientMetadataRefresher){this.clientMetadataRefresher.cancel();this.clientMetadataRefresher=null}this.detachVisibilityHandler();this.detachWindowUnloadHook();return[4,this.simpleDb.runTransaction("readwrite",[br.store,Br.store],(function(t){return e.releasePrimaryLeaseIfHeld(t).next((function(){return e.removeClientMetadata(t)}))}))];case 1:t.sent();this.simpleDb.close();this.removeClientZombiedEntry();return[2]}}))}))};e.prototype.filterActiveClients=function(e,t){var r=this;return e.filter((function(e){return r.isWithinAge(e.updateTimeMs,t)&&!r.isClientZombied(e.clientId)}))};e.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly",[Br.store],(function(t){return Tn(t).loadAll().next((function(t){return e.filterActiveClients(t,hn).map((function(e){return e.clientId}))}))}))};e.clearPersistence=function(t){return F.__awaiter(this,void 0,void 0,(function(){var r;return F.__generator(this,(function(n){switch(n.label){case 0:if(!e.isAvailable()){return[2,Promise.resolve()]}r=t+e.MAIN_DATABASE;return[4,ft.delete(r)];case 1:n.sent();return[2]}}))}))};Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:true,configurable:true});e.prototype.getMutationQueue=function(e){d(this.started,"Cannot initialize MutationQueue before persistence is started.");return Ze.forUser(e,this.serializer,this.indexManager,this.referenceDelegate)};e.prototype.getQueryCache=function(){d(this.started,"Cannot initialize QueryCache before persistence is started.");return this.queryCache};e.prototype.getRemoteDocumentCache=function(){d(this.started,"Cannot initialize RemoteDocumentCache before persistence is started.");return this.remoteDocumentCache};e.prototype.getIndexManager=function(){d(this.started,"Cannot initialize IndexManager before persistence is started.");return this.indexManager};e.prototype.runTransaction=function(e,t,r){var n=this;c(fn,"Starting transaction:",e);return this.simpleDb.runTransaction(t==="readonly"?"readonly":"readwrite",Hr,(function(i){if(t==="readwrite-primary"){return n.verifyPrimaryLease(i).next((function(t){if(!t){l("Failed to obtain primary lease for action '"+e+"'.");n.isPrimary=false;n.queue.enqueueAndForget((function(){return n.primaryStateListener(false)}));throw new y(m.FAILED_PRECONDITION,vn)}return r(new bn(i,n.listenSequence.next()))})).next((function(e){return n.acquireOrExtendPrimaryLease(i).next((function(){return e}))}))}else{return n.verifyAllowTabSynchronization(i).next((function(){return r(new bn(i,n.listenSequence.next()))}))}}))};e.prototype.verifyAllowTabSynchronization=function(e){var t=this;var r=En(e);return r.get(br.key).next((function(e){var r=e!==null&&t.isWithinAge(e.leaseTimestampMs,dn)&&!t.isClientZombied(e.ownerId);if(r&&!t.isLocalClient(e)){if(!e.allowTabSynchronization){throw new y(m.FAILED_PRECONDITION,mn)}}}))};e.prototype.acquireOrExtendPrimaryLease=function(e){var t=new br(this.clientId,this.allowTabSynchronization,Date.now());return En(e).put(br.key,t)};e.isAvailable=function(){return ft.isAvailable()};e.buildStoragePrefix=function(e){var t=e.databaseId.projectId;if(!e.databaseId.isDefaultDatabase){t+="."+e.databaseId.database}return"firestore/"+e.persistenceKey+"/"+t+"/"};e.prototype.releasePrimaryLeaseIfHeld=function(e){var t=this;var r=En(e);return r.get(br.key).next((function(e){if(t.isLocalClient(e)){c(fn,"Releasing primary lease.");return r.delete(br.key)}else{return Je.resolve()}}))};e.prototype.isWithinAge=function(e,t){var r=Date.now();var n=r-t;var i=r;if(e<n){return false}else if(e>i){l("Detected an update time that is in the future: "+e+" > "+i);return false}return true};e.prototype.attachVisibilityHandler=function(){var e=this;if(this.document!==null&&typeof this.document.addEventListener==="function"){this.documentVisibilityHandler=function(){e.queue.enqueueAndForget((function(){e.inForeground=e.document.visibilityState==="visible";return e.updateClientMetadataAndTryBecomePrimary()}))};this.document.addEventListener("visibilitychange",this.documentVisibilityHandler);this.inForeground=this.document.visibilityState==="visible"}};e.prototype.detachVisibilityHandler=function(){if(this.documentVisibilityHandler){d(this.document!==null&&typeof this.document.addEventListener==="function","Expected 'document.addEventListener' to be a function");this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler);this.documentVisibilityHandler=null}};e.prototype.attachWindowUnloadHook=function(){var e=this;if(typeof this.window.addEventListener==="function"){this.windowUnloadHandler=function(){e.markClientZombied();e.queue.enqueueAndForget((function(){return e.shutdown()}))};this.window.addEventListener("unload",this.windowUnloadHandler)}};e.prototype.detachWindowUnloadHook=function(){if(this.windowUnloadHandler){d(typeof this.window.removeEventListener==="function","Expected 'window.removeEventListener' to be a function");this.window.removeEventListener("unload",this.windowUnloadHandler);this.windowUnloadHandler=null}};e.prototype.isClientZombied=function(e){try{var t=this.webStorage.getItem(this.zombiedClientLocalStorageKey(e))!==null;c(fn,"Client '"+e+"' "+(t?"is":"is not")+" zombied in LocalStorage");return t}catch(e){l(fn,"Failed to get zombied client id.",e);return false}};e.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){l("Failed to set zombie client id.",e)}};e.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}};e.prototype.zombiedClientLocalStorageKey=function(e){return gn+"_"+this.persistenceKey+"_"+e};e.MAIN_DATABASE="main";return e}();function _n(e){return e.code===m.FAILED_PRECONDITION&&e.message===vn}function Sn(e){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(t){if(_n(e)){c(fn,"Unexpectedly lost primary lease")}else{throw e}return[2]}))}))}function En(e){return e.store(br.store)}function Tn(e){return e.store(Br.store)}var In=function(){function e(e,t){this.db=e;this.inMemoryPins=null;this.garbageCollector=new cn(this,t)}e.prototype.getSequenceNumberCount=function(e){var t=this.orphanedDocmentCount(e);var r=this.db.getQueryCache().getQueryCount(e);return r.next((function(e){return t.next((function(t){return e+t}))}))};e.prototype.orphanedDocmentCount=function(e){var t=0;return this.forEachOrphanedDocumentSequenceNumber(e,(function(e){t++})).next((function(){return t}))};e.prototype.forEachTarget=function(e,t){return this.db.getQueryCache().forEachTarget(e,t)};e.prototype.forEachOrphanedDocumentSequenceNumber=function(e,t){return this.forEachOrphanedDocument(e,(function(e,r){return t(r)}))};e.prototype.setInMemoryPins=function(e){this.inMemoryPins=e};e.prototype.addReference=function(e,t){return An(e,t)};e.prototype.removeReference=function(e,t){return An(e,t)};e.prototype.removeTargets=function(e,t,r){return this.db.getQueryCache().removeTargets(e,t,r)};e.prototype.removeMutationReference=function(e,t){return An(e,t)};e.prototype.isPinned=function(e,t){if(this.inMemoryPins.containsKey(t)){return Je.resolve(true)}else{return tt(e,t)}};e.prototype.removeOrphanedDocuments=function(e,t){var r=this;var n=this.db.getRemoteDocumentCache();var i=n.newChangeBuffer();var a=[];var o=0;var s=this.forEachOrphanedDocument(e,(function(n,s){if(s<=t){var u=r.isPinned(e,n).next((function(t){if(!t){o++;return i.getEntry(e,n).next((function(){i.removeEntry(n);return Et(e).delete(Dn(n))}))}}));a.push(u)}}));return s.next((function(){return Je.waitFor(a)})).next((function(){return i.apply(e)})).next((function(){return o}))};e.prototype.removeTarget=function(e,t){var r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getQueryCache().updateQueryData(e,r)};e.prototype.updateLimboDocument=function(e,t){return An(e,t)};e.prototype.forEachOrphanedDocument=function(e,t){var r=Et(e);var n=fe.INVALID;var i;return r.iterate({index:xr.documentTargetsIndex},(function(e,r){var a=e[0];var o=r.path,s=r.sequenceNumber;if(a===0){if(n!==fe.INVALID){t(new ye(Ne(i)),n)}n=s;i=o}else{n=fe.INVALID}})).next((function(){if(n!==fe.INVALID){t(new ye(Ne(i)),n)}}))};e.prototype.getCacheSize=function(e){return this.db.getRemoteDocumentCache().getSize(e)};return e}();function Dn(e){return[0,De(e.path)]}function Cn(e,t){return new xr(0,De(e.path),t)}function An(e,t){return Et(e).put(Cn(t,e.currentSequenceNumber))}var Nn=function(){function e(e,t,r){this.remoteDocumentCache=e;this.mutationQueue=t;this.indexManager=r}e.prototype.getDocument=function(e,t){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,t).next((function(n){return r.getDocumentInternal(e,t,n)}))};e.prototype.getDocumentInternal=function(e,t,r){return this.remoteDocumentCache.getEntry(e,t).next((function(e){for(var n=0,i=r;n<i.length;n++){var a=i[n];e=a.applyToLocalView(t,e)}return e}))};e.prototype.applyLocalMutationsToDocuments=function(e,t,r){var n=je();t.forEach((function(e,t){for(var i=0,a=r;i<a.length;i++){var o=a[i];t=o.applyToLocalView(e,t)}n=n.insert(e,t)}));return n};e.prototype.getDocuments=function(e,t){var r=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return r.getLocalViewOfDocuments(e,t)}))};e.prototype.getLocalViewOfDocuments=function(e,t){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(n){var i=r.applyLocalMutationsToDocuments(e,t,n);var a=qe();i.forEach((function(e,t){if(!t){t=new tr(e,Oe.forDeletedDoc())}a=a.insert(e,t)}));return a}))};e.prototype.getDocumentsMatchingQuery=function(e,t){if(t.isDocumentQuery()){return this.getDocumentsMatchingDocumentQuery(e,t.path)}else if(t.isCollectionGroupQuery()){return this.getDocumentsMatchingCollectionGroupQuery(e,t)}else{return this.getDocumentsMatchingCollectionQuery(e,t)}};e.prototype.getDocumentsMatchingDocumentQuery=function(e,t){return this.getDocument(e,new ye(t)).next((function(e){var t=Ue();if(e instanceof er){t=t.insert(e.key,e)}return t}))};e.prototype.getDocumentsMatchingCollectionGroupQuery=function(e,t){var r=this;d(t.path.isEmpty(),"Currently we only support collection group queries at the root.");var n=t.collectionGroup;var i=Ue();return this.indexManager.getCollectionParents(e,n).next((function(a){return Je.forEach(a,(function(a){var o=t.asCollectionQueryAtPath(a.child(n));return r.getDocumentsMatchingCollectionQuery(e,o).next((function(e){e.forEach((function(e,t){i=i.insert(e,t)}))}))})).next((function(){return i}))}))};e.prototype.getDocumentsMatchingCollectionQuery=function(e,t){var r=this;var n;var i;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,t).next((function(i){n=i;return r.mutationQueue.getAllMutationBatchesAffectingQuery(e,t)})).next((function(t){i=t;return r.addMissingBaseDocuments(e,i,n).next((function(e){n=e;for(var t=0,r=i;t<r.length;t++){var a=r[t];for(var o=0,s=a.mutations;o<s.length;o++){var u=s[o];var c=u.key;var l=n.get(c);var f=u.applyToLocalView(l,l,a.localWriteTime);if(f instanceof er){n=n.insert(c,f)}else{n=n.remove(c)}}}}))})).next((function(){n.forEach((function(e,r){if(!t.matches(r)){n=n.remove(e)}}));return n}))};e.prototype.addMissingBaseDocuments=function(e,t,r){var n=Ke();for(var i=0,a=t;i<a.length;i++){var o=a[i];for(var s=0,u=o.mutations;s<u.length;s++){var c=u[s];if(c instanceof Ot&&r.get(c.key)===null){n=n.add(c.key)}}}var l=r;return this.remoteDocumentCache.getEntries(e,n).next((function(e){e.forEach((function(e,t){if(t!==null&&t instanceof er){l=l.insert(e,t)}}));return l}))};return e}();var kn=function(){function e(){this.refsByKey=new Le(On.compareByKey);this.refsByTarget=new Le(On.compareByTargetId)}e.prototype.isEmpty=function(){return this.refsByKey.isEmpty()};e.prototype.addReference=function(e,t){var r=new On(e,t);this.refsByKey=this.refsByKey.add(r);this.refsByTarget=this.refsByTarget.add(r)};e.prototype.addReferences=function(e,t){var r=this;e.forEach((function(e){return r.addReference(e,t)}))};e.prototype.removeReference=function(e,t){this.removeRef(new On(e,t))};e.prototype.removeReferences=function(e,t){var r=this;e.forEach((function(e){return r.removeReference(e,t)}))};e.prototype.removeReferencesForId=function(e){var t=this;var r=ye.EMPTY;var n=new On(r,e);var i=new On(r,e+1);var a=[];this.refsByTarget.forEachInRange([n,i],(function(e){t.removeRef(e);a.push(e.key)}));return a};e.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach((function(t){return e.removeRef(t)}))};e.prototype.removeRef=function(e){this.refsByKey=this.refsByKey.delete(e);this.refsByTarget=this.refsByTarget.delete(e)};e.prototype.referencesForId=function(e){var t=ye.EMPTY;var r=new On(t,e);var n=new On(t,e+1);var i=Ke();this.refsByTarget.forEachInRange([r,n],(function(e){i=i.add(e.key)}));return i};e.prototype.containsKey=function(e){var t=new On(e,0);var r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)};return e}();var On=function(){function e(e,t){this.key=e;this.targetOrBatchId=t}e.compareByKey=function(e,t){return ye.comparator(e.key,t.key)||ee(e.targetOrBatchId,t.targetOrBatchId)};e.compareByTargetId=function(e,t){return ee(e.targetOrBatchId,t.targetOrBatchId)||ye.comparator(e.key,t.key)};return e}();var Mn="LocalStore";var xn=function(){function e(e,t){this.persistence=e;this.localViewReferences=new kn;this.queryDataByTarget={};d(e.started,"LocalStore was passed an unstarted persistence implementation");this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences);this.mutationQueue=e.getMutationQueue(t);this.remoteDocuments=e.getRemoteDocumentCache();this.queryCache=e.getQueryCache();this.localDocuments=new Nn(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}e.prototype.handleUserChange=function(e){var t=this;return this.persistence.runTransaction("Handle user change","readonly",(function(r){var n;return t.mutationQueue.getAllMutationBatches(r).next((function(i){n=i;t.mutationQueue=t.persistence.getMutationQueue(e);t.localDocuments=new Nn(t.remoteDocuments,t.mutationQueue,t.persistence.getIndexManager());return t.mutationQueue.getAllMutationBatches(r)})).next((function(e){var i=[];var a=[];var o=Ke();for(var s=0,u=n;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var l=0,f=c.mutations;l<f.length;l++){var h=f[l];o=o.add(h.key)}}for(var d=0,p=e;d<p.length;d++){var c=p[d];a.push(c.batchId);for(var v=0,m=c.mutations;v<m.length;v++){var h=m[v];o=o.add(h.key)}}return t.localDocuments.getDocuments(r,o).next((function(e){return{affectedDocuments:e,removedBatchIds:i,addedBatchIds:a}}))}))}))};e.prototype.localWrite=function(e){var t=this;var r=ke.now();var n=e.reduce((function(e,t){return e.add(t.key)}),Ke());return this.persistence.runTransaction("Locally write mutations","readwrite",(function(i){return t.localDocuments.getDocuments(i,n).next((function(n){var a=[];for(var o=0,s=e;o<s.length;o++){var u=s[o];var c=u.extractBaseValue(n.get(u.key));if(c!=null){a.push(new Ot(u.key,c,c.fieldMask(),At.exists(true)))}}return t.mutationQueue.addMutationBatch(i,r,a,e).next((function(e){var t=e.applyToLocalDocumentSet(n);return{batchId:e.batchId,changes:t}}))}))}))};e.prototype.lookupMutationDocuments=function(e){var t=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",(function(r){return t.mutationQueue.lookupMutationKeys(r,e).next((function(e){if(e){return t.localDocuments.getDocuments(r,e)}else{return Je.resolve(null)}}))}))};e.prototype.acknowledgeBatch=function(e){var t=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(r){var n=e.batch.keys();var i=t.remoteDocuments.newChangeBuffer();return t.mutationQueue.acknowledgeBatch(r,e.batch,e.streamToken).next((function(){return t.applyWriteToRemoteDocuments(r,e,i)})).next((function(){return i.apply(r)})).next((function(){return t.mutationQueue.performConsistencyCheck(r)})).next((function(){return t.localDocuments.getDocuments(r,n)}))}))};e.prototype.rejectBatch=function(e){var t=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",(function(r){var n;return t.mutationQueue.lookupMutationBatch(r,e).next((function(e){d(e!==null,"Attempt to reject nonexistent batch!");n=e.keys();return t.mutationQueue.removeMutationBatch(r,e)})).next((function(){return t.mutationQueue.performConsistencyCheck(r)})).next((function(){return t.localDocuments.getDocuments(r,n)}))}))};e.prototype.getHighestUnacknowledgedBatchId=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.mutationQueue.getHighestUnacknowledgedBatchId(t)}))};e.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",(function(t){return e.mutationQueue.getLastStreamToken(t)}))};e.prototype.setLastStreamToken=function(e){var t=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",(function(r){return t.mutationQueue.setLastStreamToken(r,e)}))};e.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.queryCache.getLastRemoteSnapshotVersion(t)}))};e.prototype.applyRemoteEvent=function(t){var r=this;var n=this.remoteDocuments.newChangeBuffer();var i=t.snapshotVersion;return this.persistence.runTransaction("Apply remote event","readwrite-primary",(function(a){var o=[];_(t.targetChanges,(function(t,n){var s=r.queryDataByTarget[t];if(!s){return}o.push(r.queryCache.removeMatchingKeys(a,n.removedDocuments,t).next((function(){return r.queryCache.addMatchingKeys(a,n.addedDocuments,t)})));var u=n.resumeToken;if(u.length>0){var c=s.withResumeToken(u,i);r.queryDataByTarget[t]=c;if(e.shouldPersistQueryData(s,c,n)){o.push(r.queryCache.updateQueryData(a,c))}}}));var s=qe();var u=Ke();t.documentUpdates.forEach((function(e,t){u=u.add(e)}));o.push(n.getEntries(a,u).next((function(e){t.documentUpdates.forEach((function(i,u){var f=e.get(i);if(u instanceof tr&&u.version.isEqual(Oe.MIN)){n.removeEntry(i);s=s.insert(i,u)}else if(f==null||u.version.compareTo(f.version)>0||u.version.compareTo(f.version)===0&&f.hasPendingWrites){if(Oe.MIN.isEqual(t.snapshotVersion)){l(Mn,"Cannot add a document when the remote version is zero")}n.addEntry(u);s=s.insert(i,u)}else{c(Mn,"Ignoring outdated watch update for ",i,". Current version:",f.version," Watch version:",u.version)}if(t.resolvedLimboDocuments.has(i)){o.push(r.persistence.referenceDelegate.updateLimboDocument(a,i))}}))})));if(!i.isEqual(Oe.MIN)){var f=r.queryCache.getLastRemoteSnapshotVersion(a).next((function(e){d(i.compareTo(e)>=0,"Watch stream reverted to previous snapshot?? "+i+" < "+e);return r.queryCache.setTargetsMetadata(a,a.currentSequenceNumber,i)}));o.push(f)}return Je.waitFor(o).next((function(){return n.apply(a)})).next((function(){return r.localDocuments.getLocalViewOfDocuments(a,s)}))}))};e.shouldPersistQueryData=function(e,t,r){d(t.resumeToken.length>0,"Attempted to persist query data with no resume token");if(e.resumeToken.length===0){return true}var n=t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds();if(n>=this.RESUME_TOKEN_MAX_AGE_MICROS){return true}var i=r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size;return i>0};e.prototype.notifyLocalViewChanges=function(e){var t=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(r){return Je.forEach(e,(function(e){t.localViewReferences.addReferences(e.addedKeys,e.targetId);t.localViewReferences.removeReferences(e.removedKeys,e.targetId);return Je.forEach(e.removedKeys,(function(e){return t.persistence.referenceDelegate.removeReference(r,e)}))}))}))};e.prototype.nextMutationBatch=function(e){var t=this;return this.persistence.runTransaction("Get next mutation batch","readonly",(function(r){if(e===undefined){e=Ye}return t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)}))};e.prototype.readDocument=function(e){var t=this;return this.persistence.runTransaction("read document","readonly",(function(r){return t.localDocuments.getDocument(r,e)}))};e.prototype.allocateQuery=function(e){var t=this;return this.persistence.runTransaction("Allocate query","readwrite",(function(r){var n;return t.queryCache.getQueryData(r,e).next((function(i){if(i){n=i;return Je.resolve()}else{return t.queryCache.allocateTargetId(r).next((function(i){n=new Jr(e,i,Xr.Listen,r.currentSequenceNumber);return t.queryCache.addQueryData(r,n)}))}})).next((function(){d(!t.queryDataByTarget[n.targetId],"Tried to allocate an already allocated query: "+e);t.queryDataByTarget[n.targetId]=n;return n}))}))};e.prototype.releaseQuery=function(e,t){var r=this;var n=t?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",n,(function(n){return r.queryCache.getQueryData(n,e).next((function(i){d(i!=null,"Tried to release nonexistent query: "+e);var a=i.targetId;var o=r.queryDataByTarget[a];var s=r.localViewReferences.removeReferencesForId(a);delete r.queryDataByTarget[a];if(!t){return Je.forEach(s,(function(e){return r.persistence.referenceDelegate.removeReference(n,e)})).next((function(){return r.persistence.referenceDelegate.removeTarget(n,o)}))}else{return Je.resolve()}}))}))};e.prototype.executeQuery=function(e){var t=this;return this.persistence.runTransaction("Execute query","readonly",(function(r){return t.localDocuments.getDocumentsMatchingQuery(r,e)}))};e.prototype.remoteDocumentKeys=function(e){var t=this;return this.persistence.runTransaction("Remote document keys","readonly",(function(r){return t.queryCache.getMatchingKeysForTargetId(r,e)}))};e.prototype.getActiveClients=function(){return this.persistence.getActiveClients()};e.prototype.removeCachedMutationBatchMetadata=function(e){this.mutationQueue.removeCachedMutationKeys(e)};e.prototype.setNetworkEnabled=function(e){this.persistence.setNetworkEnabled(e)};e.prototype.applyWriteToRemoteDocuments=function(e,t,r){var n=this;var i=t.batch;var a=i.keys();var o=Je.resolve();a.forEach((function(n){o=o.next((function(){return r.getEntry(e,n)})).next((function(e){var a=e;var o=t.docVersions.get(n);d(o!==null,"ackVersions should contain every doc in the write.");if(!a||a.version.compareTo(o)<0){a=i.applyToRemoteDocument(n,a,t);if(!a){d(!e,"Mutation batch "+i+" applied to document "+e+" resulted in null")}else{r.addEntry(a)}}}))}));return o.next((function(){return n.mutationQueue.removeMutationBatch(e,i)}))};e.prototype.collectGarbage=function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(r){return e.collect(r,t.queryDataByTarget)}))};e.prototype.getQueryForTarget=function(e){var t=this;if(this.queryDataByTarget[e]){return Promise.resolve(this.queryDataByTarget[e].query)}else{return this.persistence.runTransaction("Get query data","readonly",(function(r){return t.queryCache.getQueryDataForTarget(r,e).next((function(e){return e?e.query:null}))}))}};e.prototype.getNewDocumentChanges=function(){var e=this;return this.persistence.runTransaction("Get new document changes","readonly",(function(t){return e.remoteDocuments.getNewDocumentChanges(t)}))};e.RESUME_TOKEN_MAX_AGE_MICROS=5*60*1e6;return e}();var Pn=function(){function e(e,t){this.indexManager=e;this.referenceDelegate=t;this.mutationQueue=[];this.nextBatchId=1;this.lastStreamToken=v();this.batchesByDocumentKey=new Le(On.compareByKey)}e.prototype.checkEmpty=function(e){return Je.resolve(this.mutationQueue.length===0)};e.prototype.acknowledgeBatch=function(e,t,r){var n=t.batchId;var i=this.indexOfExistingBatchId(n,"acknowledged");d(i===0,"Can only acknowledge the first batch in the mutation queue");var a=this.mutationQueue[i];d(n===a.batchId,"Queue ordering failure: expected batch "+n+", got batch "+a.batchId);this.lastStreamToken=r;return Je.resolve()};e.prototype.getLastStreamToken=function(e){return Je.resolve(this.lastStreamToken)};e.prototype.setLastStreamToken=function(e,t){this.lastStreamToken=t;return Je.resolve()};e.prototype.addMutationBatch=function(e,t,r,n){d(n.length!==0,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++;if(this.mutationQueue.length>0){var a=this.mutationQueue[this.mutationQueue.length-1];d(a.batchId<i,"Mutation batchIDs must be monotonically increasing order")}var o=new $e(i,t,r,n);this.mutationQueue.push(o);for(var s=0,u=n;s<u.length;s++){var c=u[s];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new On(c.key,i));this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast())}return Je.resolve(o)};e.prototype.lookupMutationBatch=function(e,t){return Je.resolve(this.findMutationBatch(t))};e.prototype.lookupMutationKeys=function(e,t){var r=this.findMutationBatch(t);d(r!=null,"Failed to find local mutation batch.");return Je.resolve(r.keys())};e.prototype.getNextMutationBatchAfterBatchId=function(e,t){var r=t+1;var n=this.indexOfBatchId(r);var i=n<0?0:n;return Je.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)};e.prototype.getHighestUnacknowledgedBatchId=function(){return Je.resolve(this.mutationQueue.length===0?Ye:this.nextBatchId-1)};e.prototype.getAllMutationBatches=function(e){return Je.resolve(this.mutationQueue.slice())};e.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,t){var r=this;var n=new On(t,0);var i=new On(t,Number.POSITIVE_INFINITY);var a=[];this.batchesByDocumentKey.forEachInRange([n,i],(function(e){d(t.isEqual(e.key),"Should only iterate over a single key's batches");var n=r.findMutationBatch(e.targetOrBatchId);d(n!==null,"Batches in the index must exist in the main table");a.push(n)}));return Je.resolve(a)};e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var r=this;var n=new Le(ee);t.forEach((function(e){var t=new On(e,0);var i=new On(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,i],(function(t){d(e.isEqual(t.key),"For each key, should only iterate over a single key's batches");n=n.add(t.targetOrBatchId)}))}));return Je.resolve(this.findMutationBatches(n))};e.prototype.getAllMutationBatchesAffectingQuery=function(e,t){d(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=t.path;var n=r.length+1;var i=r;if(!ye.isDocumentKey(i)){i=i.child("")}var a=new On(new ye(i),0);var o=new Le(ee);this.batchesByDocumentKey.forEachWhile((function(e){var t=e.key.path;if(!r.isPrefixOf(t)){return false}else{if(t.length===n){o=o.add(e.targetOrBatchId)}return true}}),a);return Je.resolve(this.findMutationBatches(o))};e.prototype.findMutationBatches=function(e){var t=this;var r=[];e.forEach((function(e){var n=t.findMutationBatch(e);if(n!==null){r.push(n)}}));return r};e.prototype.removeMutationBatch=function(e,t){var r=this;var n=this.indexOfExistingBatchId(t.batchId,"removed");d(n===0,"Can only remove the first entry of the mutation queue");this.mutationQueue.shift();var i=this.batchesByDocumentKey;return Je.forEach(t.mutations,(function(n){var a=new On(n.key,t.batchId);i=i.delete(a);return r.referenceDelegate.removeMutationReference(e,n.key)})).next((function(){r.batchesByDocumentKey=i}))};e.prototype.removeCachedMutationKeys=function(e){};e.prototype.containsKey=function(e,t){var r=new On(t,0);var n=this.batchesByDocumentKey.firstAfterOrEqual(r);return Je.resolve(t.isEqual(n&&n.key))};e.prototype.performConsistencyCheck=function(e){if(this.mutationQueue.length===0){d(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty.")}return Je.resolve()};e.prototype.indexOfExistingBatchId=function(e,t){var r=this.indexOfBatchId(e);d(r>=0&&r<this.mutationQueue.length,"Batches must exist to be "+t);return r};e.prototype.indexOfBatchId=function(e){if(this.mutationQueue.length===0){return 0}var t=this.mutationQueue[0].batchId;return e-t};e.prototype.findMutationBatch=function(e){var t=this.indexOfBatchId(e);if(t<0||t>=this.mutationQueue.length){return null}var r=this.mutationQueue[t];d(r.batchId===e,"If found batch must match");return r};return e}();var Rn=function(){function e(e){this.persistence=e;this.queries=new nr((function(e){return e.canonicalId()}));this.lastRemoteSnapshotVersion=Oe.MIN;this.highestTargetId=0;this.highestSequenceNumber=0;this.references=new kn;this.targetCount=0;this.targetIdGenerator=ct.forQueryCache()}e.prototype.getTargetCount=function(e){return Je.resolve(this.targetCount)};e.prototype.forEachTarget=function(e,t){this.queries.forEach((function(e,r){return t(r)}));return Je.resolve()};e.prototype.getLastRemoteSnapshotVersion=function(e){return Je.resolve(this.lastRemoteSnapshotVersion)};e.prototype.getHighestSequenceNumber=function(e){return Je.resolve(this.highestSequenceNumber)};e.prototype.allocateTargetId=function(e){var t=this.targetIdGenerator.after(this.highestTargetId);this.highestTargetId=t;return Je.resolve(t)};e.prototype.setTargetsMetadata=function(e,t,r){if(r){this.lastRemoteSnapshotVersion=r}if(t>this.highestSequenceNumber){this.highestSequenceNumber=t}return Je.resolve()};e.prototype.saveQueryData=function(e){this.queries.set(e.query,e);var t=e.targetId;if(t>this.highestTargetId){this.highestTargetId=t}if(e.sequenceNumber>this.highestSequenceNumber){this.highestSequenceNumber=e.sequenceNumber}};e.prototype.addQueryData=function(e,t){d(!this.queries.has(t.query),"Adding a query that already exists");this.saveQueryData(t);this.targetCount+=1;return Je.resolve()};e.prototype.updateQueryData=function(e,t){d(this.queries.has(t.query),"Updating a non-existent query");this.saveQueryData(t);return Je.resolve()};e.prototype.removeQueryData=function(e,t){d(this.targetCount>0,"Removing a target from an empty cache");d(this.queries.has(t.query),"Removing a non-existent target from the cache");this.queries.delete(t.query);this.references.removeReferencesForId(t.targetId);this.targetCount-=1;return Je.resolve()};e.prototype.removeTargets=function(e,t,r){var n=this;var i=0;var a=[];this.queries.forEach((function(o,s){if(s.sequenceNumber<=t&&!r[s.targetId]){n.queries.delete(o);a.push(n.removeMatchingKeysForTargetId(e,s.targetId));i++}}));return Je.waitFor(a).next((function(){return i}))};e.prototype.getQueryCount=function(e){return Je.resolve(this.targetCount)};e.prototype.getQueryData=function(e,t){var r=this.queries.get(t)||null;return Je.resolve(r)};e.prototype.getQueryDataForTarget=function(e,t){return h("Not yet implemented.")};e.prototype.addMatchingKeys=function(e,t,r){this.references.addReferences(t,r);var n=this.persistence.referenceDelegate;var i=[];if(n){t.forEach((function(t){i.push(n.addReference(e,t))}))}return Je.waitFor(i)};e.prototype.removeMatchingKeys=function(e,t,r){this.references.removeReferences(t,r);var n=this.persistence.referenceDelegate;var i=[];if(n){t.forEach((function(t){i.push(n.removeReference(e,t))}))}return Je.waitFor(i)};e.prototype.removeMatchingKeysForTargetId=function(e,t){this.references.removeReferencesForId(t);return Je.resolve()};e.prototype.getMatchingKeysForTargetId=function(e,t){var r=this.references.referencesForId(t);return Je.resolve(r)};e.prototype.containsKey=function(e,t){return Je.resolve(this.references.containsKey(t))};return e}();function Ln(){return new Me(ye.comparator)}var Fn=function(){function e(e,t){this.indexManager=e;this.sizer=t;this.docs=Ln();this.newDocumentChanges=Ke();this.size=0}e.prototype.addEntry=function(e,t){var r=t.key;var n=this.docs.get(r);var i=n?n.size:0;var a=this.sizer(t);this.docs=this.docs.insert(r,{maybeDocument:t,size:a});this.newDocumentChanges=this.newDocumentChanges.add(r);this.size+=a-i;return this.indexManager.addToCollectionParentIndex(e,r.path.popLast())};e.prototype.removeEntry=function(e){var t=this.docs.get(e);if(t){this.docs=this.docs.remove(e);this.size-=t.size}};e.prototype.getEntry=function(e,t){var r=this.docs.get(t);return Je.resolve(r?r.maybeDocument:null)};e.prototype.getEntries=function(e,t){var r=this;var n=je();t.forEach((function(e){var t=r.docs.get(e);n=n.insert(e,t?t.maybeDocument:null)}));return Je.resolve(n)};e.prototype.getDocumentsMatchingQuery=function(e,t){d(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=Ue();var n=new ye(t.path.child(""));var i=this.docs.getIteratorFrom(n);while(i.hasNext()){var a=i.getNext(),o=a.key,s=a.value.maybeDocument;if(!t.path.isPrefixOf(o.path)){break}if(s instanceof er&&t.matches(s)){r=r.insert(s.key,s)}}return Je.resolve(r)};e.prototype.forEachDocumentKey=function(e,t){return Je.forEach(this.docs,(function(e){return t(e)}))};e.prototype.getNewDocumentChanges=function(e){var t=this;var r=qe();this.newDocumentChanges.forEach((function(e){var n=t.docs.get(e);var i=n?n.maybeDocument:new tr(e,Oe.forDeletedDoc());r=r.insert(e,i)}));this.newDocumentChanges=Ke();return Je.resolve(r)};e.prototype.newChangeBuffer=function(){return new e.RemoteDocumentChangeBuffer(this)};e.prototype.getSize=function(e){return Je.resolve(this.size)};e.RemoteDocumentChangeBuffer=function(e){F.__extends(t,e);function t(t){var r=e.call(this)||this;r.documentCache=t;return r}t.prototype.applyChanges=function(e){var t=this;var r=[];this.changes.forEach((function(n,i){if(i){r.push(t.documentCache.addEntry(e,i))}else{t.documentCache.removeEntry(n)}}));return Je.waitFor(r)};t.prototype.getFromCache=function(e,t){return this.documentCache.getEntry(e,t)};t.prototype.getAllFromCache=function(e,t){return this.documentCache.getEntries(e,t)};return t}(ir);return e}();var Vn="MemoryPersistence";var qn=function(){function e(e,t){var r=this;this.clientId=e;this.mutationQueues={};this.listenSequence=new fe(0);this._started=false;this._started=true;this.referenceDelegate=t(this);this.queryCache=new Rn(this);var n=function(e){return r.referenceDelegate.documentSize(e)};this.indexManager=new dr;this.remoteDocumentCache=new Fn(this.indexManager,n)}e.createLruPersistence=function(t,r,n){var i=function(e){return new Un(e,new Zr(r),n)};return new e(t,i)};e.createEagerPersistence=function(t){var r=function(e){return new Bn(e)};return new e(t,r)};e.prototype.shutdown=function(){this._started=false;return Promise.resolve()};Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:true,configurable:true});e.prototype.getActiveClients=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){return[2,[this.clientId]]}))}))};e.prototype.setPrimaryStateListener=function(e){return e(true)};e.prototype.setDatabaseDeletedListener=function(){};e.prototype.setNetworkEnabled=function(e){};e.prototype.getIndexManager=function(){return this.indexManager};e.prototype.getMutationQueue=function(e){var t=this.mutationQueues[e.toKey()];if(!t){t=new Pn(this.indexManager,this.referenceDelegate);this.mutationQueues[e.toKey()]=t}return t};e.prototype.getQueryCache=function(){return this.queryCache};e.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache};e.prototype.runTransaction=function(e,t,r){var n=this;c(Vn,"Starting transaction:",e);var i=new jn(this.listenSequence.next());this.referenceDelegate.onTransactionStarted();return r(i).next((function(e){return n.referenceDelegate.onTransactionCommitted(i).next((function(){return e}))})).toPromise()};e.prototype.mutationQueuesContainKey=function(e,t){return Je.or(S(this.mutationQueues).map((function(r){return function(){return r.containsKey(e,t)}})))};return e}();var jn=function(){function e(e){this.currentSequenceNumber=e}return e}();var Bn=function(){function e(e){this.persistence=e;this.inMemoryPins=null;this._orphanedDocuments=null}Object.defineProperty(e.prototype,"orphanedDocuments",{get:function(){if(!this._orphanedDocuments){throw h("orphanedDocuments is only valid during a transaction.")}else{return this._orphanedDocuments}},enumerable:true,configurable:true});e.prototype.setInMemoryPins=function(e){this.inMemoryPins=e};e.prototype.addReference=function(e,t){this.orphanedDocuments.delete(t);return Je.resolve()};e.prototype.removeReference=function(e,t){this.orphanedDocuments.add(t);return Je.resolve()};e.prototype.removeMutationReference=function(e,t){this.orphanedDocuments.add(t);return Je.resolve()};e.prototype.removeTarget=function(e,t){var r=this;var n=this.persistence.getQueryCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return r.orphanedDocuments.add(e)}))})).next((function(){return n.removeQueryData(e,t)}))};e.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set};e.prototype.onTransactionCommitted=function(e){var t=this;var r=this.persistence.getRemoteDocumentCache();var n=r.newChangeBuffer();return Je.forEach(this.orphanedDocuments,(function(r){return t.isReferenced(e,r).next((function(e){if(!e){n.removeEntry(r)}}))})).next((function(){t._orphanedDocuments=null;return n.apply(e)}))};e.prototype.updateLimboDocument=function(e,t){var r=this;return this.isReferenced(e,t).next((function(e){if(e){r.orphanedDocuments.delete(t)}else{r.orphanedDocuments.add(t)}}))};e.prototype.documentSize=function(e){return 0};e.prototype.isReferenced=function(e,t){var r=this;return Je.or([function(){return r.persistence.getQueryCache().containsKey(e,t)},function(){return r.persistence.mutationQueuesContainKey(e,t)},function(){return Je.resolve(r.inMemoryPins.containsKey(t))}])};return e}();var Un=function(){function e(e,t,r){this.persistence=e;this.serializer=t;this.inMemoryPins=null;this.orphanedSequenceNumbers=new nr((function(e){return De(e.path)}));this.garbageCollector=new cn(this,r)}e.prototype.onTransactionStarted=function(){};e.prototype.onTransactionCommitted=function(e){return Je.resolve()};e.prototype.forEachTarget=function(e,t){return this.persistence.getQueryCache().forEachTarget(e,t)};e.prototype.getSequenceNumberCount=function(e){var t=this.orphanedDocumentCount(e);var r=this.persistence.getQueryCache().getTargetCount(e);return r.next((function(e){return t.next((function(t){return e+t}))}))};e.prototype.orphanedDocumentCount=function(e){var t=0;return this.forEachOrphanedDocumentSequenceNumber(e,(function(e){t++})).next((function(){return t}))};e.prototype.forEachOrphanedDocumentSequenceNumber=function(e,t){var r=this;return Je.forEach(this.orphanedSequenceNumbers,(function(n,i){return r.isPinned(e,n,i).next((function(e){if(!e){return t(i)}else{return Je.resolve()}}))}))};e.prototype.setInMemoryPins=function(e){this.inMemoryPins=e};e.prototype.removeTargets=function(e,t,r){return this.persistence.getQueryCache().removeTargets(e,t,r)};e.prototype.removeOrphanedDocuments=function(e,t){var r=this;var n=0;var i=this.persistence.getRemoteDocumentCache();var a=i.newChangeBuffer();var o=i.forEachDocumentKey(e,(function(i){return r.isPinned(e,i,t).next((function(e){if(!e){n++;a.removeEntry(i)}}))}));return o.next((function(){return a.apply(e)})).next((function(){return n}))};e.prototype.removeMutationReference=function(e,t){this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber);return Je.resolve()};e.prototype.removeTarget=function(e,t){var r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getQueryCache().updateQueryData(e,r)};e.prototype.addReference=function(e,t){this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber);return Je.resolve()};e.prototype.removeReference=function(e,t){this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber);return Je.resolve()};e.prototype.updateLimboDocument=function(e,t){this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber);return Je.resolve()};e.prototype.documentSize=function(e){var t=this.serializer.toDbRemoteDocument(e);var r;if(t.document){r=t.document}else if(t.unknownDocument){r=t.unknownDocument}else if(t.noDocument){r=t.noDocument}else{throw h("Unknown remote document type")}return JSON.stringify(r).length};e.prototype.isPinned=function(e,t,r){var n=this;return Je.or([function(){return n.persistence.mutationQueuesContainKey(e,t)},function(){return Je.resolve(n.inMemoryPins.containsKey(t))},function(){return n.persistence.getQueryCache().containsKey(e,t)},function(){var e=n.orphanedSequenceNumbers.get(t);return Je.resolve(e!==undefined&&e>r)}])};e.prototype.getCacheSize=function(e){return this.persistence.getRemoteDocumentCache().getSize(e)};return e}();var Wn=Number;var zn=Wn.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1);var Qn=Wn.MAX_SAFE_INTEGER||Math.pow(2,53)-1;var Kn=Wn.isInteger||function(e){return typeof e==="number"&&isFinite(e)&&Math.floor(e)===e};function Gn(e){return e===null||e===undefined}function Hn(e){return Kn(e)&&e<=Qn&&e>=zn}var Yn="ExponentialBackoff";var $n=1e3;var Xn=1.5;var Jn=60*1e3;var Zn=function(){function e(e,t,r,n,i){if(r===void 0){r=$n}if(n===void 0){n=Xn}if(i===void 0){i=Jn}this.queue=e;this.timerId=t;this.initialDelayMs=r;this.backoffFactor=n;this.maxDelayMs=i;this.currentBaseMs=0;this.timerPromise=null;this.lastAttemptTime=Date.now();this.reset()}e.prototype.reset=function(){this.currentBaseMs=0};e.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs};e.prototype.backoffAndRun=function(e){var t=this;this.cancel();var r=Math.floor(this.currentBaseMs+this.jitterDelayMs());var n=Math.max(0,Date.now()-this.lastAttemptTime);var i=Math.max(0,r-n);if(this.currentBaseMs>0){c(Yn,"Backing off for "+i+" ms "+("(base delay: "+this.currentBaseMs+" ms, ")+("delay with jitter: "+r+" ms, ")+("last attempt: "+n+" ms ago)"))}this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,(function(){t.lastAttemptTime=Date.now();return e()}));this.currentBaseMs*=this.backoffFactor;if(this.currentBaseMs<this.initialDelayMs){this.currentBaseMs=this.initialDelayMs}if(this.currentBaseMs>this.maxDelayMs){this.currentBaseMs=this.maxDelayMs}};e.prototype.cancel=function(){if(this.timerPromise!==null){this.timerPromise.cancel();this.timerPromise=null}};e.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs};return e}();var ei="PersistentStream";var ti;(function(e){e[e["Initial"]=0]="Initial";e[e["Starting"]=1]="Starting";e[e["Open"]=2]="Open";e[e["Error"]=3]="Error";e[e["Backoff"]=4]="Backoff"})(ti||(ti={}));var ri=60*1e3;var ni=function(){function e(e,t,r,n,i,a){this.queue=e;this.idleTimerId=r;this.connection=n;this.credentialsProvider=i;this.listener=a;this.state=ti.Initial;this.closeCount=0;this.idleTimer=null;this.stream=null;this.backoff=new Zn(e,t)}e.prototype.isStarted=function(){return this.state===ti.Starting||this.state===ti.Open||this.state===ti.Backoff};e.prototype.isOpen=function(){return this.state===ti.Open};e.prototype.start=function(){if(this.state===ti.Error){this.performBackoff();return}d(this.state===ti.Initial,"Already started");this.auth()};e.prototype.stop=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:if(!this.isStarted())return[3,2];return[4,this.close(ti.Initial)];case 1:e.sent();e.label=2;case 2:return[2]}}))}))};e.prototype.inhibitBackoff=function(){d(!this.isStarted(),"Can only inhibit backoff in a stopped state");this.state=ti.Initial;this.backoff.reset()};e.prototype.markIdle=function(){var e=this;if(this.isOpen()&&this.idleTimer===null){this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,ri,(function(){return e.handleIdleCloseTimer()}))}};e.prototype.sendRequest=function(e){this.cancelIdleCheck();this.stream.send(e)};e.prototype.handleIdleCloseTimer=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){if(this.isOpen()){return[2,this.close(ti.Initial)]}return[2]}))}))};e.prototype.cancelIdleCheck=function(){if(this.idleTimer){this.idleTimer.cancel();this.idleTimer=null}};e.prototype.close=function(e,t){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(r){switch(r.label){case 0:d(this.isStarted(),"Only started streams should be closed.");d(e===ti.Error||Gn(t),"Can't provide an error when not in an error state.");this.cancelIdleCheck();this.backoff.cancel();this.closeCount++;if(e!==ti.Error){this.backoff.reset()}else if(t&&t.code===m.RESOURCE_EXHAUSTED){l(t.toString());l("Using maximum backoff delay to prevent overloading the backend.");this.backoff.resetToMax()}else if(t&&t.code===m.UNAUTHENTICATED){this.credentialsProvider.invalidateToken()}if(this.stream!==null){this.tearDown();this.stream.close();this.stream=null}this.state=e;return[4,this.listener.onClose(t)];case 1:r.sent();return[2]}}))}))};e.prototype.tearDown=function(){};e.prototype.auth=function(){var e=this;d(this.state===ti.Initial,"Must be in initial state to auth");this.state=ti.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount);var r=this.closeCount;this.credentialsProvider.getToken().then((function(t){if(e.closeCount===r){e.startStream(t)}}),(function(r){t((function(){var t=new y(m.UNKNOWN,"Fetching auth token failed: "+r.message);return e.handleStreamClose(t)}))}))};e.prototype.startStream=function(e){var t=this;d(this.state===ti.Starting,"Trying to start stream in a non-starting state");var r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e);this.stream.onOpen((function(){r((function(){d(t.state===ti.Starting,"Expected stream to be in state Starting, but was "+t.state);t.state=ti.Open;return t.listener.onOpen()}))}));this.stream.onClose((function(e){r((function(){return t.handleStreamClose(e)}))}));this.stream.onMessage((function(e){r((function(){return t.onMessage(e)}))}))};e.prototype.performBackoff=function(){var e=this;d(this.state===ti.Error,"Should only perform backoff when in Error state");this.state=ti.Backoff;this.backoff.backoffAndRun((function(){return F.__awaiter(e,void 0,void 0,(function(){return F.__generator(this,(function(e){d(this.state===ti.Backoff,"Backoff elapsed but state is now: "+this.state);this.state=ti.Initial;this.start();d(this.isStarted(),"PersistentStream should have started");return[2]}))}))}))};e.prototype.handleStreamClose=function(e){d(this.isStarted(),"Can't handle server close on non-started stream");c(ei,"close with error: "+e);this.stream=null;return this.close(ti.Error,e)};e.prototype.getCloseGuardedDispatcher=function(e){var t=this;return function(r){t.queue.enqueueAndForget((function(){if(t.closeCount===e){return r()}else{c(ei,"stream callback skipped by getCloseGuardedDispatcher.");return Promise.resolve()}}))}};return e}();var ii=function(e){F.__extends(t,e);function t(t,r,n,i,a){var o=e.call(this,t,be.ListenStreamConnectionBackoff,be.ListenStreamIdle,r,n,a)||this;o.serializer=i;return o}t.prototype.startRpc=function(e){return this.connection.openStream("Listen",e)};t.prototype.onMessage=function(e){this.backoff.reset();var t=this.serializer.fromWatchChange(e);var r=this.serializer.versionFromListenResponse(e);return this.listener.onWatchChange(t,r)};t.prototype.watch=function(e){var t={};t.database=this.serializer.encodedDatabaseId;t.addTarget=this.serializer.toTarget(e);var r=this.serializer.toListenRequestLabels(e);if(r){t.labels=r}this.sendRequest(t)};t.prototype.unwatch=function(e){var t={};t.database=this.serializer.encodedDatabaseId;t.removeTarget=e;this.sendRequest(t)};return t}(ni);var ai=function(e){F.__extends(t,e);function t(t,r,n,i,a){var o=e.call(this,t,be.WriteStreamConnectionBackoff,be.WriteStreamIdle,r,n,a)||this;o.serializer=i;o.handshakeComplete_=false;o.lastStreamToken=v();return o}Object.defineProperty(t.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:true,configurable:true});t.prototype.start=function(){this.handshakeComplete_=false;e.prototype.start.call(this)};t.prototype.tearDown=function(){if(this.handshakeComplete_){this.writeMutations([])}};t.prototype.startRpc=function(e){return this.connection.openStream("Write",e)};t.prototype.onMessage=function(e){d(!!e.streamToken,"Got a write response without a stream token");this.lastStreamToken=e.streamToken;if(!this.handshakeComplete_){d(!e.writeResults||e.writeResults.length===0,"Got mutation results for handshake");this.handshakeComplete_=true;return this.listener.onHandshakeComplete()}else{this.backoff.reset();var t=this.serializer.fromWriteResults(e.writeResults,e.commitTime);var r=this.serializer.fromVersion(e.commitTime);return this.listener.onMutationResult(r,t)}};t.prototype.writeHandshake=function(){d(this.isOpen(),"Writing handshake requires an opened stream");d(!this.handshakeComplete_,"Handshake already completed");var e={};e.database=this.serializer.encodedDatabaseId;this.sendRequest(e)};t.prototype.writeMutations=function(e){var t=this;d(this.isOpen(),"Writing mutations requires an opened stream");d(this.handshakeComplete_,"Handshake must be complete before writing mutations");d(this.lastStreamToken.length>0,"Trying to write mutation without a token");var r={streamToken:this.lastStreamToken,writes:e.map((function(e){return t.serializer.toMutation(e)}))};this.sendRequest(r)};return t}(ni);var oi=function(){function e(e,t,r,n){this.queue=e;this.connection=t;this.credentials=r;this.serializer=n}e.prototype.newPersistentWriteStream=function(e){return new ai(this.queue,this.connection,this.credentials,this.serializer,e)};e.prototype.newPersistentWatchStream=function(e){return new ii(this.queue,this.connection,this.credentials,this.serializer,e)};e.prototype.commit=function(e){var t=this;var r={database:this.serializer.encodedDatabaseId,writes:e.map((function(e){return t.serializer.toMutation(e)}))};return this.invokeRPC("Commit",r).then((function(e){return t.serializer.fromWriteResults(e.writeResults,e.commitTime)}))};e.prototype.lookup=function(e){var t=this;var r={database:this.serializer.encodedDatabaseId,documents:e.map((function(e){return t.serializer.toName(e)}))};return this.invokeStreamingRPC("BatchGetDocuments",r).then((function(r){var n=qe();r.forEach((function(e){var r=t.serializer.fromMaybeDocument(e);n=n.insert(r.key,r)}));var i=[];e.forEach((function(e){var t=n.get(e);d(!!t,"Missing entity in write response for "+e);i.push(t)}));return i}))};e.prototype.invokeRPC=function(e,t){var r=this;return this.credentials.getToken().then((function(n){return r.connection.invokeRPC(e,t,n)})).catch((function(e){if(e.code===m.UNAUTHENTICATED){r.credentials.invalidateToken()}throw e}))};e.prototype.invokeStreamingRPC=function(e,t){var r=this;return this.credentials.getToken().then((function(n){return r.connection.invokeStreamingRPC(e,t,n)})).catch((function(e){if(e.code===m.UNAUTHENTICATED){r.credentials.invalidateToken()}throw e}))};return e}();var si=function(){function e(e){this.datastore=e;this.readVersions=ze();this.mutations=[];this.committed=false;this.lastWriteError=null;this.writtenDocs=new Set}e.prototype.lookup=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t;var r=this;return F.__generator(this,(function(n){switch(n.label){case 0:this.ensureCommitNotCalled();if(this.mutations.length>0){throw new y(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.")}return[4,this.datastore.lookup(e)];case 1:t=n.sent();t.forEach((function(e){if(e instanceof tr||e instanceof er){r.recordVersion(e)}else{h("Document in a transaction was a "+e.constructor.name)}}));return[2,t]}}))}))};e.prototype.set=function(e,t){this.write(t.toMutations(e,this.precondition(e)));this.writtenDocs.add(e)};e.prototype.update=function(e,t){try{this.write(t.toMutations(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e)};e.prototype.delete=function(e){this.write([new xt(e,this.precondition(e))]);this.writtenDocs.add(e)};e.prototype.commit=function(){return F.__awaiter(this,void 0,void 0,(function(){var e;return F.__generator(this,(function(t){switch(t.label){case 0:this.ensureCommitNotCalled();if(this.lastWriteError){throw this.lastWriteError}e=this.readVersions;this.mutations.forEach((function(t){e=e.remove(t.key)}));if(!e.isEmpty()){throw new y(m.INVALID_ARGUMENT,"Every document read in a transaction must also be written.")}return[4,this.datastore.commit(this.mutations)];case 1:t.sent();this.committed=true;return[2]}}))}))};e.prototype.recordVersion=function(e){var t;if(e instanceof er){t=e.version}else if(e instanceof tr){t=Oe.forDeletedDoc()}else{throw h("Document in a transaction was a "+e.constructor.name)}var r=this.readVersions.get(e.key);if(r!==null){if(!t.isEqual(r)){throw new y(m.ABORTED,"Document version changed between two reads.")}}else{this.readVersions=this.readVersions.insert(e.key,t)}};e.prototype.precondition=function(e){var t=this.readVersions.get(e);if(!this.writtenDocs.has(e)&&t){return At.updateTime(t)}else{return At.NONE}};e.prototype.preconditionForUpdate=function(e){var t=this.readVersions.get(e);if(!this.writtenDocs.has(e)&&t){if(t.isEqual(Oe.forDeletedDoc())){throw new y(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.")}return At.updateTime(t)}else{return At.exists(true)}};e.prototype.write=function(e){this.ensureCommitNotCalled();this.mutations=this.mutations.concat(e)};e.prototype.ensureCommitNotCalled=function(){d(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")};return e}();var ui;(function(e){e[e["Unknown"]=0]="Unknown";e[e["Online"]=1]="Online";e[e["Offline"]=2]="Offline"})(ui||(ui={}));var ci;(function(e){e[e["RemoteStore"]=0]="RemoteStore";e[e["SharedClientState"]=1]="SharedClientState"})(ci||(ci={}));var li="OnlineStateTracker";var fi=1;var hi=10*1e3;var di=function(){function e(e,t){this.asyncQueue=e;this.onlineStateHandler=t;this.state=ui.Unknown;this.watchStreamFailures=0;this.onlineStateTimer=null;this.shouldWarnClientIsOffline=true}e.prototype.handleWatchStreamStart=function(){var e=this;if(this.watchStreamFailures===0){this.setAndBroadcast(ui.Unknown);d(this.onlineStateTimer===null,"onlineStateTimer shouldn't be started yet");this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(be.OnlineStateTimeout,hi,(function(){e.onlineStateTimer=null;d(e.state===ui.Unknown,"Timer should be canceled if we transitioned to a different state.");e.logClientOfflineWarningIfNecessary("Backend didn't respond within "+hi/1e3+" "+"seconds.");e.setAndBroadcast(ui.Offline);return Promise.resolve()}))}};e.prototype.handleWatchStreamFailure=function(e){if(this.state===ui.Online){this.setAndBroadcast(ui.Unknown);d(this.watchStreamFailures===0,"watchStreamFailures must be 0");d(this.onlineStateTimer===null,"onlineStateTimer must be null")}else{this.watchStreamFailures++;if(this.watchStreamFailures>=fi){this.clearOnlineStateTimer();this.logClientOfflineWarningIfNecessary("Connection failed "+fi+" "+("times. Most recent error: "+e.toString()));this.setAndBroadcast(ui.Offline)}}};e.prototype.set=function(e){this.clearOnlineStateTimer();this.watchStreamFailures=0;if(e===ui.Online){this.shouldWarnClientIsOffline=false}this.setAndBroadcast(e)};e.prototype.setAndBroadcast=function(e){if(e!==this.state){this.state=e;this.onlineStateHandler(e)}};e.prototype.logClientOfflineWarningIfNecessary=function(e){var t="Could not reach Cloud Firestore backend. "+e+"\n"+"This typically indicates that your device does not have a healthy "+"Internet connection at the moment. The client will operate in offline "+"mode until it is able to successfully connect to the backend.";if(this.shouldWarnClientIsOffline){l(t);this.shouldWarnClientIsOffline=false}else{c(li,t)}};e.prototype.clearOnlineStateTimer=function(){if(this.onlineStateTimer!==null){this.onlineStateTimer.cancel();this.onlineStateTimer=null}};return e}();var pi;(function(e){e[e["OK"]=0]="OK";e[e["CANCELLED"]=1]="CANCELLED";e[e["UNKNOWN"]=2]="UNKNOWN";e[e["INVALID_ARGUMENT"]=3]="INVALID_ARGUMENT";e[e["DEADLINE_EXCEEDED"]=4]="DEADLINE_EXCEEDED";e[e["NOT_FOUND"]=5]="NOT_FOUND";e[e["ALREADY_EXISTS"]=6]="ALREADY_EXISTS";e[e["PERMISSION_DENIED"]=7]="PERMISSION_DENIED";e[e["UNAUTHENTICATED"]=16]="UNAUTHENTICATED";e[e["RESOURCE_EXHAUSTED"]=8]="RESOURCE_EXHAUSTED";e[e["FAILED_PRECONDITION"]=9]="FAILED_PRECONDITION";e[e["ABORTED"]=10]="ABORTED";e[e["OUT_OF_RANGE"]=11]="OUT_OF_RANGE";e[e["UNIMPLEMENTED"]=12]="UNIMPLEMENTED";e[e["INTERNAL"]=13]="INTERNAL";e[e["UNAVAILABLE"]=14]="UNAVAILABLE";e[e["DATA_LOSS"]=15]="DATA_LOSS"})(pi||(pi={}));function vi(e){switch(e){case m.OK:return h("Treated status OK as error");case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return false;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return true;default:return h("Unknown status code: "+e)}}function mi(e){return vi(e)&&e!==m.ABORTED}function yi(e){var t=pi[e];if(t===undefined){return undefined}return gi(t)}function gi(e){if(e===undefined){l("GRPC error has no .code");return m.UNKNOWN}switch(e){case pi.OK:return m.OK;case pi.CANCELLED:return m.CANCELLED;case pi.UNKNOWN:return m.UNKNOWN;case pi.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case pi.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case pi.INTERNAL:return m.INTERNAL;case pi.UNAVAILABLE:return m.UNAVAILABLE;case pi.UNAUTHENTICATED:return m.UNAUTHENTICATED;case pi.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case pi.NOT_FOUND:return m.NOT_FOUND;case pi.ALREADY_EXISTS:return m.ALREADY_EXISTS;case pi.PERMISSION_DENIED:return m.PERMISSION_DENIED;case pi.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case pi.ABORTED:return m.ABORTED;case pi.OUT_OF_RANGE:return m.OUT_OF_RANGE;case pi.UNIMPLEMENTED:return m.UNIMPLEMENTED;case pi.DATA_LOSS:return m.DATA_LOSS;default:return h("Unknown status code: "+e)}}function wi(e){if(e===undefined){return pi.OK}switch(e){case m.OK:return pi.OK;case m.CANCELLED:return pi.CANCELLED;case m.UNKNOWN:return pi.UNKNOWN;case m.DEADLINE_EXCEEDED:return pi.DEADLINE_EXCEEDED;case m.RESOURCE_EXHAUSTED:return pi.RESOURCE_EXHAUSTED;case m.INTERNAL:return pi.INTERNAL;case m.UNAVAILABLE:return pi.UNAVAILABLE;case m.UNAUTHENTICATED:return pi.UNAUTHENTICATED;case m.INVALID_ARGUMENT:return pi.INVALID_ARGUMENT;case m.NOT_FOUND:return pi.NOT_FOUND;case m.ALREADY_EXISTS:return pi.ALREADY_EXISTS;case m.PERMISSION_DENIED:return pi.PERMISSION_DENIED;case m.FAILED_PRECONDITION:return pi.FAILED_PRECONDITION;case m.ABORTED:return pi.ABORTED;case m.OUT_OF_RANGE:return pi.OUT_OF_RANGE;case m.UNIMPLEMENTED:return pi.UNIMPLEMENTED;case m.DATA_LOSS:return pi.DATA_LOSS;default:return h("Unknown status code: "+e)}}function _i(e){var t=e.toLowerCase().replace("_","-");return Object.values(m).indexOf(t)>=0?t:m.UNKNOWN}var Si=function(){function e(e){if(e){this.comparator=function(t,r){return e(t,r)||ye.comparator(t.key,r.key)}}else{this.comparator=function(e,t){return ye.comparator(e.key,t.key)}}this.keyedMap=Ue();this.sortedSet=new Me(this.comparator)}e.emptySet=function(t){return new e(t.comparator)};e.prototype.has=function(e){return this.keyedMap.get(e)!=null};e.prototype.get=function(e){return this.keyedMap.get(e)};e.prototype.first=function(){return this.sortedSet.minKey()};e.prototype.last=function(){return this.sortedSet.maxKey()};e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()};e.prototype.indexOf=function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1};Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:true,configurable:true});e.prototype.forEach=function(e){this.sortedSet.inorderTraversal((function(t,r){e(t);return false}))};e.prototype.add=function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))};e.prototype.delete=function(e){var t=this.get(e);if(!t){return this}return this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t))};e.prototype.isEqual=function(t){if(!(t instanceof e)){return false}if(this.size!==t.size){return false}var r=this.sortedSet.getIterator();var n=t.sortedSet.getIterator();while(r.hasNext()){var i=r.getNext().key;var a=n.getNext().key;if(!i.isEqual(a)){return false}}return true};e.prototype.toString=function(){var e=[];this.forEach((function(t){e.push(t.toString())}));if(e.length===0){return"DocumentSet ()"}else{return"DocumentSet (\n  "+e.join("  \n")+"\n)"}};e.prototype.copy=function(t,r){var n=new e;n.comparator=this.comparator;n.keyedMap=t;n.sortedSet=r;return n};return e}();var Ei;(function(e){e[e["Added"]=0]="Added";e[e["Removed"]=1]="Removed";e[e["Modified"]=2]="Modified";e[e["Metadata"]=3]="Metadata"})(Ei||(Ei={}));var Ti;(function(e){e[e["Local"]=0]="Local";e[e["Synced"]=1]="Synced"})(Ti||(Ti={}));var Ii=function(){function e(){this.changeMap=new Me(ye.comparator)}e.prototype.track=function(e){var t=e.doc.key;var r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}if(e.type!==Ei.Added&&r.type===Ei.Metadata){this.changeMap=this.changeMap.insert(t,e)}else if(e.type===Ei.Metadata&&r.type!==Ei.Removed){this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc})}else if(e.type===Ei.Modified&&r.type===Ei.Modified){this.changeMap=this.changeMap.insert(t,{type:Ei.Modified,doc:e.doc})}else if(e.type===Ei.Modified&&r.type===Ei.Added){this.changeMap=this.changeMap.insert(t,{type:Ei.Added,doc:e.doc})}else if(e.type===Ei.Removed&&r.type===Ei.Added){this.changeMap=this.changeMap.remove(t)}else if(e.type===Ei.Removed&&r.type===Ei.Modified){this.changeMap=this.changeMap.insert(t,{type:Ei.Removed,doc:r.doc})}else if(e.type===Ei.Added&&r.type===Ei.Removed){this.changeMap=this.changeMap.insert(t,{type:Ei.Modified,doc:e.doc})}else{h("unsupported combination of changes: "+JSON.stringify(e)+" after "+JSON.stringify(r))}};e.prototype.getChanges=function(){var e=[];this.changeMap.inorderTraversal((function(t,r){e.push(r)}));return e};return e}();var Di=function(){function e(e,t,r,n,i,a,o,s){this.query=e;this.docs=t;this.oldDocs=r;this.docChanges=n;this.mutatedKeys=i;this.fromCache=a;this.syncStateChanged=o;this.excludesMetadataChanges=s}e.fromInitialDocuments=function(t,r,n,i){var a=[];r.forEach((function(e){a.push({type:Ei.Added,doc:e})}));return new e(t,r,Si.emptySet(r),a,n,i,true,false)};Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:true,configurable:true});e.prototype.isEqual=function(e){if(this.fromCache!==e.fromCache||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!this.query.isEqual(e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs)){return false}var t=this.docChanges;var r=e.docChanges;if(t.length!==r.length){return false}for(var n=0;n<t.length;n++){if(t[n].type!==r[n].type||!t[n].doc.isEqual(r[n].doc)){return false}}return true};return e}();var Ci=function(){function e(e,t,r,n,i){this.snapshotVersion=e;this.targetChanges=t;this.targetMismatches=r;this.documentUpdates=n;this.resolvedLimboDocuments=i}e.createSynthesizedRemoteEventForCurrentChange=function(t,r){var n;var i=(n={},n[t]=Ai.createSynthesizedTargetChangeForCurrentChange(t,r),n);return new e(Oe.MIN,i,He(),qe(),Ke())};return e}();var Ai=function(){function e(e,t,r,n,i){this.resumeToken=e;this.current=t;this.addedDocuments=r;this.modifiedDocuments=n;this.removedDocuments=i}e.createSynthesizedTargetChangeForCurrentChange=function(t,r){return new e(v(),r,Ke(),Ke(),Ke())};return e}();var Ni=function(){function e(e,t,r,n){this.updatedTargetIds=e;this.removedTargetIds=t;this.key=r;this.newDoc=n}return e}();var ki=function(){function e(e,t){this.targetId=e;this.existenceFilter=t}return e}();var Oi;(function(e){e[e["NoChange"]=0]="NoChange";e[e["Added"]=1]="Added";e[e["Removed"]=2]="Removed";e[e["Current"]=3]="Current";e[e["Reset"]=4]="Reset"})(Oi||(Oi={}));var Mi=function(){function e(e,t,r,n){if(r===void 0){r=v()}if(n===void 0){n=null}this.state=e;this.targetIds=t;this.resumeToken=r;this.cause=n}return e}();var xi=function(){function e(){this.pendingResponses=0;this.documentChanges=Fi();this._resumeToken=v();this._current=false;this._hasPendingChanges=true}Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"isPending",{get:function(){return this.pendingResponses!==0},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:true,configurable:true});e.prototype.updateResumeToken=function(e){if(e.length>0){this._hasPendingChanges=true;this._resumeToken=e}};e.prototype.toTargetChange=function(){var e=Ke();var t=Ke();var r=Ke();this.documentChanges.forEach((function(n,i){switch(i){case Ei.Added:e=e.add(n);break;case Ei.Modified:t=t.add(n);break;case Ei.Removed:r=r.add(n);break;default:h("Encountered invalid change type: "+i)}}));return new Ai(this._resumeToken,this._current,e,t,r)};e.prototype.clearPendingChanges=function(){this._hasPendingChanges=false;this.documentChanges=Fi()};e.prototype.addDocumentChange=function(e,t){this._hasPendingChanges=true;this.documentChanges=this.documentChanges.insert(e,t)};e.prototype.removeDocumentChange=function(e){this._hasPendingChanges=true;this.documentChanges=this.documentChanges.remove(e)};e.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1};e.prototype.recordTargetResponse=function(){this.pendingResponses-=1};e.prototype.markCurrent=function(){this._hasPendingChanges=true;this._current=true};return e}();var Pi="WatchChangeAggregator";var Ri=function(){function e(e){this.metadataProvider=e;this.targetStates={};this.pendingDocumentUpdates=qe();this.pendingDocumentTargetMapping=Li();this.pendingTargetResets=new Le(ee)}e.prototype.handleDocumentChange=function(e){for(var t=0,r=e.updatedTargetIds;t<r.length;t++){var n=r[t];if(e.newDoc instanceof er){this.addDocumentToTarget(n,e.newDoc)}else if(e.newDoc instanceof tr){this.removeDocumentFromTarget(n,e.key,e.newDoc)}}for(var i=0,a=e.removedTargetIds;i<a.length;i++){var n=a[i];this.removeDocumentFromTarget(n,e.key,e.newDoc)}};e.prototype.handleTargetChange=function(e){var t=this;this.forEachTarget(e,(function(r){var n=t.ensureTargetState(r);switch(e.state){case Oi.NoChange:if(t.isActiveTarget(r)){n.updateResumeToken(e.resumeToken)}break;case Oi.Added:n.recordTargetResponse();if(!n.isPending){n.clearPendingChanges()}n.updateResumeToken(e.resumeToken);break;case Oi.Removed:n.recordTargetResponse();if(!n.isPending){t.removeTarget(r)}d(!e.cause,"WatchChangeAggregator does not handle errored targets");break;case Oi.Current:if(t.isActiveTarget(r)){n.markCurrent();n.updateResumeToken(e.resumeToken)}break;case Oi.Reset:if(t.isActiveTarget(r)){t.resetTarget(r);n.updateResumeToken(e.resumeToken)}break;default:h("Unknown target watch change state: "+e.state)}}))};e.prototype.forEachTarget=function(e,t){if(e.targetIds.length>0){e.targetIds.forEach(t)}else{_(this.targetStates,t)}};e.prototype.handleExistenceFilter=function(e){var t=e.targetId;var r=e.existenceFilter.count;var n=this.queryDataForActiveTarget(t);if(n){var i=n.query;if(i.isDocumentQuery()){if(r===0){var a=new ye(i.path);this.removeDocumentFromTarget(t,a,new tr(a,Oe.forDeletedDoc()))}else{d(r===1,"Single document existence filter with count: "+r)}}else{var o=this.getCurrentDocumentCountForTarget(t);if(o!==r){this.resetTarget(t);this.pendingTargetResets=this.pendingTargetResets.add(t)}}}};e.prototype.createRemoteEvent=function(e){var t=this;var r={};_(this.targetStates,(function(n,i){var a=t.queryDataForActiveTarget(n);if(a){if(i.current&&a.query.isDocumentQuery()){var o=new ye(a.query.path);if(t.pendingDocumentUpdates.get(o)===null&&!t.targetContainsDocument(n,o)){t.removeDocumentFromTarget(n,o,new tr(o,e))}}if(i.hasPendingChanges){r[n]=i.toTargetChange();i.clearPendingChanges()}}}));var n=Ke();this.pendingDocumentTargetMapping.forEach((function(e,r){var i=true;r.forEachWhile((function(e){var r=t.queryDataForActiveTarget(e);if(r&&r.purpose!==Xr.LimboResolution){i=false;return false}return true}));if(i){n=n.add(e)}}));var i=new Ci(e,r,this.pendingTargetResets,this.pendingDocumentUpdates,n);this.pendingDocumentUpdates=qe();this.pendingDocumentTargetMapping=Li();this.pendingTargetResets=new Le(ee);return i};e.prototype.addDocumentToTarget=function(e,t){if(!this.isActiveTarget(e)){return}var r=this.targetContainsDocument(e,t.key)?Ei.Modified:Ei.Added;var n=this.ensureTargetState(e);n.addDocumentChange(t.key,r);this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t);this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))};e.prototype.removeDocumentFromTarget=function(e,t,r){if(!this.isActiveTarget(e)){return}var n=this.ensureTargetState(e);if(this.targetContainsDocument(e,t)){n.addDocumentChange(t,Ei.Removed)}else{n.removeDocumentChange(t)}this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e));if(r){this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r)}};e.prototype.removeTarget=function(e){delete this.targetStates[e]};e.prototype.getCurrentDocumentCountForTarget=function(e){var t=this.ensureTargetState(e);var r=t.toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size};e.prototype.recordPendingTargetRequest=function(e){var t=this.ensureTargetState(e);t.recordPendingTargetRequest()};e.prototype.ensureTargetState=function(e){if(!this.targetStates[e]){this.targetStates[e]=new xi}return this.targetStates[e]};e.prototype.ensureDocumentTargetMapping=function(e){var t=this.pendingDocumentTargetMapping.get(e);if(!t){t=new Le(ee);this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)}return t};e.prototype.isActiveTarget=function(e){var t=this.queryDataForActiveTarget(e)!==null;if(!t){c(Pi,"Detected inactive target",e)}return t};e.prototype.queryDataForActiveTarget=function(e){var t=this.targetStates[e];return t&&t.isPending?null:this.metadataProvider.getQueryDataForTarget(e)};e.prototype.resetTarget=function(e){var t=this;d(!this.targetStates[e].isPending,"Should only reset active targets");this.targetStates[e]=new xi;var r=this.metadataProvider.getRemoteKeysForTarget(e);r.forEach((function(r){t.removeDocumentFromTarget(e,r,null)}))};e.prototype.targetContainsDocument=function(e,t){var r=this.metadataProvider.getRemoteKeysForTarget(e);return r.has(t)};return e}();function Li(){return new Me(ye.comparator)}function Fi(){return new Me(ye.comparator)}var Vi="RemoteStore";var qi=10;var ji=function(){function e(e,t,r,n,i){var a=this;this.localStore=e;this.datastore=t;this.writePipeline=[];this.listenTargets={};this.watchChangeAggregator=null;this.networkEnabled=false;this.isPrimary=false;this.connectivityMonitor=i;this.connectivityMonitor.addCallback((function(e){r.enqueueAndForget((function(){return F.__awaiter(a,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:if(!this.canUseNetwork())return[3,2];c(Vi,"Restarting streams for network reachability change.");return[4,this.restartNetwork()];case 1:e.sent();e.label=2;case 2:return[2]}}))}))}))}));this.onlineStateTracker=new di(r,n);this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)});this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}e.prototype.start=function(){return this.enableNetwork()};e.prototype.enableNetwork=function(){return F.__awaiter(this,void 0,void 0,(function(){var e;return F.__generator(this,(function(t){switch(t.label){case 0:this.networkEnabled=true;if(!this.canUseNetwork())return[3,3];e=this.writeStream;return[4,this.localStore.getLastStreamToken()];case 1:e.lastStreamToken=t.sent();if(this.shouldStartWatchStream()){this.startWatchStream()}else{this.onlineStateTracker.set(ui.Unknown)}return[4,this.fillWritePipeline()];case 2:t.sent();t.label=3;case 3:return[2]}}))}))};e.prototype.disableNetwork=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:this.networkEnabled=false;return[4,this.disableNetworkInternal()];case 1:e.sent();this.onlineStateTracker.set(ui.Offline);return[2]}}))}))};e.prototype.disableNetworkInternal=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:return[4,this.writeStream.stop()];case 1:e.sent();return[4,this.watchStream.stop()];case 2:e.sent();if(this.writePipeline.length>0){c(Vi,"Stopping write stream with "+this.writePipeline.length+" pending writes");this.writePipeline=[]}this.cleanUpWatchStreamState();return[2]}}))}))};e.prototype.shutdown=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:c(Vi,"RemoteStore shutting down.");this.networkEnabled=false;return[4,this.disableNetworkInternal()];case 1:e.sent();this.connectivityMonitor.shutdown();this.onlineStateTracker.set(ui.Unknown);return[2]}}))}))};e.prototype.listen=function(e){d(!b(this.listenTargets,e.targetId),"listen called with duplicate targetId!");this.listenTargets[e.targetId]=e;if(this.shouldStartWatchStream()){this.startWatchStream()}else if(this.watchStream.isOpen()){this.sendWatchRequest(e)}};e.prototype.unlisten=function(e){d(b(this.listenTargets,e),"unlisten called without assigned target ID!");delete this.listenTargets[e];if(this.watchStream.isOpen()){this.sendUnwatchRequest(e)}if(T(this.listenTargets)){if(this.watchStream.isOpen()){this.watchStream.markIdle()}else if(this.canUseNetwork()){this.onlineStateTracker.set(ui.Unknown)}}};e.prototype.getQueryDataForTarget=function(e){return this.listenTargets[e]||null};e.prototype.getRemoteKeysForTarget=function(e){return this.syncEngine.getRemoteKeysForTarget(e)};e.prototype.sendWatchRequest=function(e){this.watchChangeAggregator.recordPendingTargetRequest(e.targetId);this.watchStream.watch(e)};e.prototype.sendUnwatchRequest=function(e){this.watchChangeAggregator.recordPendingTargetRequest(e);this.watchStream.unwatch(e)};e.prototype.startWatchStream=function(){d(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false.");this.watchChangeAggregator=new Ri(this);this.watchStream.start();this.onlineStateTracker.handleWatchStreamStart()};e.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!T(this.listenTargets)};e.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled};e.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null};e.prototype.onWatchStreamOpen=function(){return F.__awaiter(this,void 0,void 0,(function(){var e=this;return F.__generator(this,(function(t){_(this.listenTargets,(function(t,r){e.sendWatchRequest(r)}));return[2]}))}))};e.prototype.onWatchStreamClose=function(e){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(t){if(e===undefined){d(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed.")}this.cleanUpWatchStreamState();if(this.shouldStartWatchStream()){this.onlineStateTracker.handleWatchStreamFailure(e);this.startWatchStream()}else{this.onlineStateTracker.set(ui.Unknown)}return[2]}))}))};e.prototype.onWatchStreamChange=function(e,t){return F.__awaiter(this,void 0,void 0,(function(){var r;return F.__generator(this,(function(n){switch(n.label){case 0:this.onlineStateTracker.set(ui.Online);if(e instanceof Mi&&e.state===Oi.Removed&&e.cause){return[2,this.handleTargetError(e)]}if(e instanceof Ni){this.watchChangeAggregator.handleDocumentChange(e)}else if(e instanceof ki){this.watchChangeAggregator.handleExistenceFilter(e)}else{d(e instanceof Mi,"Expected watchChange to be an instance of WatchTargetChange");this.watchChangeAggregator.handleTargetChange(e)}if(!!t.isEqual(Oe.MIN))return[3,3];return[4,this.localStore.getLastRemoteSnapshotVersion()];case 1:r=n.sent();if(!(t.compareTo(r)>=0))return[3,3];return[4,this.raiseWatchSnapshot(t)];case 2:n.sent();n.label=3;case 3:return[2]}}))}))};e.prototype.raiseWatchSnapshot=function(e){var t=this;d(!e.isEqual(Oe.MIN),"Can't raise event for unknown SnapshotVersion");var r=this.watchChangeAggregator.createRemoteEvent(e);_(r.targetChanges,(function(r,n){if(n.resumeToken.length>0){var i=t.listenTargets[r];if(i){t.listenTargets[r]=i.withResumeToken(n.resumeToken,e)}}}));r.targetMismatches.forEach((function(e){var r=t.listenTargets[e];if(!r){return}t.listenTargets[e]=r.withResumeToken(v(),r.snapshotVersion);t.sendUnwatchRequest(e);var n=new Jr(r.query,e,Xr.ExistenceFilterMismatch,r.sequenceNumber);t.sendWatchRequest(n)}));return this.syncEngine.applyRemoteEvent(r)};e.prototype.handleTargetError=function(e){var t=this;d(!!e.cause,"Handling target error without a cause");var r=e.cause;var n=Promise.resolve();e.targetIds.forEach((function(e){n=n.then((function(){return F.__awaiter(t,void 0,void 0,(function(){return F.__generator(this,(function(t){if(b(this.listenTargets,e)){delete this.listenTargets[e];this.watchChangeAggregator.removeTarget(e);return[2,this.syncEngine.rejectListen(e,r)]}return[2]}))}))}))}));return n};e.prototype.fillWritePipeline=function(){return F.__awaiter(this,void 0,void 0,(function(){var e,t;return F.__generator(this,(function(r){switch(r.label){case 0:if(!this.canAddToWritePipeline())return[3,4];e=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:Ye;return[4,this.localStore.nextMutationBatch(e)];case 1:t=r.sent();if(!(t===null))return[3,2];if(this.writePipeline.length===0){this.writeStream.markIdle()}return[3,4];case 2:this.addToWritePipeline(t);return[4,this.fillWritePipeline()];case 3:r.sent();r.label=4;case 4:if(this.shouldStartWriteStream()){this.startWriteStream()}return[2]}}))}))};e.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<qi};e.prototype.outstandingWrites=function(){return this.writePipeline.length};e.prototype.addToWritePipeline=function(e){d(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full");this.writePipeline.push(e);if(this.writeStream.isOpen()&&this.writeStream.handshakeComplete){this.writeStream.writeMutations(e.mutations)}};e.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0};e.prototype.startWriteStream=function(){d(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false.");this.writeStream.start()};e.prototype.onWriteStreamOpen=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){this.writeStream.writeHandshake();return[2]}))}))};e.prototype.onWriteHandshakeComplete=function(){var e=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then((function(){for(var t=0,r=e.writePipeline;t<r.length;t++){var n=r[t];e.writeStream.writeMutations(n.mutations)}})).catch(Sn)};e.prototype.onMutationResult=function(e,t){var r=this;d(this.writePipeline.length>0,"Got result for empty write pipeline");var n=this.writePipeline.shift();var i=Xe.from(n,e,t,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then((function(){return r.fillWritePipeline()}))};e.prototype.onWriteStreamClose=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t;var r=this;return F.__generator(this,(function(n){if(e===undefined){d(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed.")}if(e&&this.writePipeline.length>0){t=void 0;if(this.writeStream.handshakeComplete){t=this.handleWriteError(e)}else{t=this.handleHandshakeError(e)}return[2,t.then((function(){if(r.shouldStartWriteStream()){r.startWriteStream()}}))]}return[2]}))}))};e.prototype.handleHandshakeError=function(e){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(t){if(vi(e.code)){c(Vi,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken);this.writeStream.lastStreamToken=v();return[2,this.localStore.setLastStreamToken(v()).catch(Sn)]}return[2]}))}))};e.prototype.handleWriteError=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t;var r=this;return F.__generator(this,(function(n){if(mi(e.code)){t=this.writePipeline.shift();this.writeStream.inhibitBackoff();return[2,this.syncEngine.rejectFailedWrite(t.batchId,e).then((function(){return r.fillWritePipeline()}))]}return[2]}))}))};e.prototype.createTransaction=function(){return new si(this.datastore)};e.prototype.restartNetwork=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:this.networkEnabled=false;return[4,this.disableNetworkInternal()];case 1:e.sent();this.onlineStateTracker.set(ui.Unknown);return[4,this.enableNetwork()];case 2:e.sent();return[2]}}))}))};e.prototype.handleCredentialChange=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:if(!this.canUseNetwork())return[3,2];c(Vi,"RemoteStore restarting streams for new credential");return[4,this.restartNetwork()];case 1:e.sent();e.label=2;case 2:return[2]}}))}))};e.prototype.applyPrimaryState=function(e){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(t){switch(t.label){case 0:this.isPrimary=e;if(!(e&&this.networkEnabled))return[3,2];return[4,this.enableNetwork()];case 1:t.sent();return[3,4];case 2:if(!!e)return[3,4];return[4,this.disableNetworkInternal()];case 3:t.sent();this.onlineStateTracker.set(ui.Unknown);t.label=4;case 4:return[2]}}))}))};return e}();var Bi=function(){function e(e,t){C("GeoPoint",arguments,2);O("GeoPoint","number",1,e);O("GeoPoint","number",2,t);if(!isFinite(e)||e<-90||e>90){throw new y(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e)}if(!isFinite(t)||t<-180||t>180){throw new y(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t)}this._lat=e;this._long=t}Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:true,configurable:true});e.prototype.isEqual=function(e){return this._lat===e._lat&&this._long===e._long};e.prototype._compareTo=function(e){return ee(this._lat,e._lat)||ee(this._long,e._long)};return e}();var Ui=function(){function e(e,t,r,n,i,a,o){if(t===void 0){t=null}if(r===void 0){r=[]}if(n===void 0){n=[]}if(i===void 0){i=null}if(a===void 0){a=null}if(o===void 0){o=null}this.path=e;this.collectionGroup=t;this.explicitOrderBy=r;this.filters=n;this.limit=i;this.startAt=a;this.endAt=o;this.memoizedCanonicalId=null;this.memoizedOrderBy=null;if(this.startAt){this.assertValidBound(this.startAt)}if(this.endAt){this.assertValidBound(this.endAt)}}e.atPath=function(t){return new e(t)};Object.defineProperty(e.prototype,"orderBy",{get:function(){if(this.memoizedOrderBy===null){var e=this.getInequalityFilterField();var t=this.getFirstOrderByField();if(e!==null&&t===null){if(e.isKeyField()){this.memoizedOrderBy=[ea]}else{this.memoizedOrderBy=[new Zi(e),ea]}}else{d(e===null||t!==null&&e.isEqual(t),"First orderBy should match inequality field.");this.memoizedOrderBy=[];var r=false;for(var n=0,i=this.explicitOrderBy;n<i.length;n++){var a=i[n];this.memoizedOrderBy.push(a);if(a.field.isKeyField()){r=true}}if(!r){var o=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Xi.ASCENDING;this.memoizedOrderBy.push(o===Xi.ASCENDING?ea:ta)}}}return this.memoizedOrderBy},enumerable:true,configurable:true});e.prototype.addFilter=function(t){d(this.getInequalityFilterField()==null||!(t instanceof Qi)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field.");d(!this.isDocumentQuery(),"No filtering allowed for document query");var r=this.filters.concat([t]);return new e(this.path,this.collectionGroup,this.explicitOrderBy.slice(),r,this.limit,this.startAt,this.endAt)};e.prototype.addOrderBy=function(t){d(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var r=this.explicitOrderBy.concat([t]);return new e(this.path,this.collectionGroup,r,this.filters.slice(),this.limit,this.startAt,this.endAt)};e.prototype.withLimit=function(t){return new e(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)};e.prototype.withStartAt=function(t){return new e(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)};e.prototype.withEndAt=function(t){return new e(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)};e.prototype.asCollectionQueryAtPath=function(t){return new e(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)};e.prototype.canonicalId=function(){if(this.memoizedCanonicalId===null){var e=this.path.canonicalString();if(this.isCollectionGroupQuery()){e+="|cg:"+this.collectionGroup}e+="|f:";for(var t=0,r=this.filters;t<r.length;t++){var n=r[t];e+=n.canonicalId();e+=","}e+="|ob:";for(var i=0,a=this.orderBy;i<a.length;i++){var o=a[i];e+=o.canonicalId();e+=","}if(!Gn(this.limit)){e+="|l:";e+=this.limit}if(this.startAt){e+="|lb:";e+=this.startAt.canonicalId()}if(this.endAt){e+="|ub:";e+=this.endAt.canonicalId()}this.memoizedCanonicalId=e}return this.memoizedCanonicalId};e.prototype.toString=function(){var e="Query("+this.path.canonicalString();if(this.isCollectionGroupQuery()){e+=" collectionGroup="+this.collectionGroup}if(this.filters.length>0){e+=", filters: ["+this.filters.join(", ")+"]"}if(!Gn(this.limit)){e+=", limit: "+this.limit}if(this.explicitOrderBy.length>0){e+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"}if(this.startAt){e+=", startAt: "+this.startAt.canonicalId()}if(this.endAt){e+=", endAt: "+this.endAt.canonicalId()}return e+")"};e.prototype.isEqual=function(e){if(this.limit!==e.limit){return false}if(this.orderBy.length!==e.orderBy.length){return false}for(var t=0;t<this.orderBy.length;t++){if(!this.orderBy[t].isEqual(e.orderBy[t])){return false}}if(this.filters.length!==e.filters.length){return false}for(var t=0;t<this.filters.length;t++){if(!this.filters[t].isEqual(e.filters[t])){return false}}if(this.collectionGroup!==e.collectionGroup){return false}if(!this.path.isEqual(e.path)){return false}if(this.startAt!==null?!this.startAt.isEqual(e.startAt):e.startAt!==null){return false}return this.endAt!==null?this.endAt.isEqual(e.endAt):e.endAt===null};e.prototype.docComparator=function(e,t){var r=false;for(var n=0,i=this.orderBy;n<i.length;n++){var a=i[n];var o=a.compare(e,t);if(o!==0){return o}r=r||a.field.isKeyField()}d(r,"orderBy used that doesn't compare on key field");return 0};e.prototype.matches=function(e){return this.matchesPathAndCollectionGroup(e)&&this.matchesOrderBy(e)&&this.matchesFilters(e)&&this.matchesBounds(e)};e.prototype.hasLimit=function(){return!Gn(this.limit)};e.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null};e.prototype.getInequalityFilterField=function(){for(var e=0,t=this.filters;e<t.length;e++){var r=t[e];if(r instanceof Qi&&r.isInequality()){return r.field}}return null};e.prototype.findFilterOperator=function(e){for(var t=0,r=this.filters;t<r.length;t++){var n=r[t];if(n instanceof Qi){if(e.indexOf(n.op)>=0){return n.op}}}return null};e.prototype.isDocumentQuery=function(){return ye.isDocumentKey(this.path)&&this.collectionGroup===null&&this.filters.length===0};e.prototype.isCollectionGroupQuery=function(){return this.collectionGroup!==null};e.prototype.matchesPathAndCollectionGroup=function(e){var t=e.key.path;if(this.collectionGroup!==null){return e.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(t)}else if(ye.isDocumentKey(this.path)){return this.path.isEqual(t)}else{return this.path.isImmediateParentOf(t)}};e.prototype.matchesOrderBy=function(e){for(var t=0,r=this.explicitOrderBy;t<r.length;t++){var n=r[t];if(!n.field.isKeyField()&&e.field(n.field)===null){return false}}return true};e.prototype.matchesFilters=function(e){for(var t=0,r=this.filters;t<r.length;t++){var n=r[t];if(!n.matches(e)){return false}}return true};e.prototype.matchesBounds=function(e){if(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,e)){return false}if(this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,e)){return false}return true};e.prototype.assertValidBound=function(e){d(e.position.length<=this.orderBy.length,"Bound is longer than orderBy")};return e}();var Wi=function(){function e(){}return e}();var zi=function(){function e(e){this.name=e}e.fromString=function(t){switch(t){case"<":return e.LESS_THAN;case"<=":return e.LESS_THAN_OR_EQUAL;case"==":return e.EQUAL;case">=":return e.GREATER_THAN_OR_EQUAL;case">":return e.GREATER_THAN;case"array-contains":return e.ARRAY_CONTAINS;case"in":return e.IN;case"array-contains-any":return e.ARRAY_CONTAINS_ANY;default:return h("Unknown FieldFilter operator: "+t)}};e.prototype.toString=function(){return this.name};e.prototype.isEqual=function(e){return this.name===e.name};e.LESS_THAN=new e("<");e.LESS_THAN_OR_EQUAL=new e("<=");e.EQUAL=new e("==");e.GREATER_THAN=new e(">");e.GREATER_THAN_OR_EQUAL=new e(">=");e.ARRAY_CONTAINS=new e("array-contains");e.IN=new e("in");e.ARRAY_CONTAINS_ANY=new e("array-contains-any");return e}();var Qi=function(e){F.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.field=t;i.op=r;i.value=n;return i}t.create=function(e,r,n){if(e.isKeyField()){if(r===zi.IN){d(n instanceof Jt,"Comparing on key with IN, but filter value not an ArrayValue");d(n.internalValue.every((function(e){return e instanceof Yt})),"Comparing on key with IN, but an array value was not a RefValue");return new Gi(e,n)}else{d(n instanceof Yt,"Comparing on key, but filter value not a RefValue");d(r!==zi.ARRAY_CONTAINS&&r!==zi.ARRAY_CONTAINS_ANY,"'"+r.toString()+"' queries don't make sense on document keys.");return new Ki(e,r,n)}}else if(n.isEqual(Vt.INSTANCE)){if(r!==zi.EQUAL){throw new y(m.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.")}return new t(e,r,n)}else if(n.isEqual(zt.NAN)){if(r!==zi.EQUAL){throw new y(m.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.")}return new t(e,r,n)}else if(r===zi.ARRAY_CONTAINS){return new Hi(e,n)}else if(r===zi.IN){d(n instanceof Jt,"IN filter has invalid value: "+n.toString());return new Yi(e,n)}else if(r===zi.ARRAY_CONTAINS_ANY){d(n instanceof Jt,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString());return new $i(e,n)}else{return new t(e,r,n)}};t.prototype.matches=function(e){var t=e.field(this.field);return t!==null&&this.value.typeOrder===t.typeOrder&&this.matchesComparison(t.compareTo(this.value))};t.prototype.matchesComparison=function(e){switch(this.op){case zi.LESS_THAN:return e<0;case zi.LESS_THAN_OR_EQUAL:return e<=0;case zi.EQUAL:return e===0;case zi.GREATER_THAN:return e>0;case zi.GREATER_THAN_OR_EQUAL:return e>=0;default:return h("Unknown FieldFilter operator: "+this.op)}};t.prototype.isInequality=function(){return[zi.LESS_THAN,zi.LESS_THAN_OR_EQUAL,zi.GREATER_THAN,zi.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0};t.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()};t.prototype.isEqual=function(e){if(e instanceof t){return this.op.isEqual(e.op)&&this.field.isEqual(e.field)&&this.value.isEqual(e.value)}else{return false}};t.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()};return t}(Wi);var Ki=function(e){F.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.matches=function(e){var t=this.value;var r=ye.comparator(e.key,t.key);return this.matchesComparison(r)};return t}(Qi);var Gi=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this,t,zi.IN,r)||this;n.value=r;return n}t.prototype.matches=function(e){var t=this.value;return t.internalValue.some((function(t){return e.key.isEqual(t.key)}))};return t}(Qi);var Hi=function(e){F.__extends(t,e);function t(t,r){return e.call(this,t,zi.ARRAY_CONTAINS,r)||this}t.prototype.matches=function(e){var t=e.field(this.field);return t instanceof Jt&&t.contains(this.value)};return t}(Qi);var Yi=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this,t,zi.IN,r)||this;n.value=r;return n}t.prototype.matches=function(e){var t=this.value;var r=e.field(this.field);return r!==null&&t.contains(r)};return t}(Qi);var $i=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this,t,zi.ARRAY_CONTAINS_ANY,r)||this;n.value=r;return n}t.prototype.matches=function(e){var t=this;var r=e.field(this.field);return r instanceof Jt&&r.internalValue.some((function(e){return t.value.contains(e)}))};return t}(Qi);var Xi=function(){function e(e){this.name=e}e.prototype.toString=function(){return this.name};e.ASCENDING=new e("asc");e.DESCENDING=new e("desc");return e}();var Ji=function(){function e(e,t){this.position=e;this.before=t}e.prototype.canonicalId=function(){var e=this.before?"b:":"a:";for(var t=0,r=this.position;t<r.length;t++){var n=r[t];e+=n.toString()}return e};e.prototype.sortsBeforeDocument=function(e,t){d(this.position.length<=e.length,"Bound has more components than query's orderBy");var r=0;for(var n=0;n<this.position.length;n++){var i=e[n];var a=this.position[n];if(i.field.isKeyField()){d(a instanceof Yt,"Bound has a non-key value where the key path is being used.");r=ye.comparator(a.key,t.key)}else{var o=t.field(i.field);d(o!==null,"Field should exist since document matched the orderBy already.");r=a.compareTo(o)}if(i.dir===Xi.DESCENDING){r=r*-1}if(r!==0){break}}return this.before?r<=0:r<0};e.prototype.isEqual=function(e){if(e===null){return false}if(this.before!==e.before||this.position.length!==e.position.length){return false}for(var t=0;t<this.position.length;t++){var r=this.position[t];var n=e.position[t];if(!r.isEqual(n)){return false}}return true};return e}();var Zi=function(){function e(e,t){this.field=e;if(t===undefined){t=Xi.ASCENDING}this.dir=t;this.isKeyOrderBy=e.isKeyField()}e.prototype.compare=function(e,t){var r=this.isKeyOrderBy?er.compareByKey(e,t):er.compareByField(this.field,e,t);switch(this.dir){case Xi.ASCENDING:return r;case Xi.DESCENDING:return-1*r;default:return h("Unknown direction: "+this.dir)}};e.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()};e.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"};e.prototype.isEqual=function(e){return this.dir===e.dir&&this.field.isEqual(e.field)};return e}();var ea=new Zi(me.keyField(),Xi.ASCENDING);var ta=new Zi(me.keyField(),Xi.DESCENDING);var ra=function(){function e(){}e.prototype.applyToLocalView=function(e,t){return new Gt(t,e)};e.prototype.applyToRemoteDocument=function(e,t){return t};e.prototype.computeBaseValue=function(e){return null};e.prototype.isEqual=function(t){return t instanceof e};e.instance=new e;return e}();var na=function(){function e(e){this.elements=e}e.prototype.applyToLocalView=function(e,t){return this.apply(e)};e.prototype.applyToRemoteDocument=function(e,t){return this.apply(e)};e.prototype.apply=function(e){var t=oa(e);var r=function(e){if(!t.find((function(t){return t.isEqual(e)}))){t.push(e)}};for(var n=0,i=this.elements;n<i.length;n++){var a=i[n];r(a)}return new Jt(t)};e.prototype.computeBaseValue=function(e){return null};e.prototype.isEqual=function(t){return t instanceof e&&re(t.elements,this.elements)};return e}();var ia=function(){function e(e){this.elements=e}e.prototype.applyToLocalView=function(e,t){return this.apply(e)};e.prototype.applyToRemoteDocument=function(e,t){return this.apply(e)};e.prototype.apply=function(e){var t=oa(e);var r=function(e){t=t.filter((function(t){return!t.isEqual(e)}))};for(var n=0,i=this.elements;n<i.length;n++){var a=i[n];r(a)}return new Jt(t)};e.prototype.computeBaseValue=function(e){return null};e.prototype.isEqual=function(t){return t instanceof e&&re(t.elements,this.elements)};return e}();var aa=function(){function e(e){this.operand=e}e.prototype.applyToLocalView=function(e,t){var r=this.computeBaseValue(e);if(r instanceof Wt&&this.operand instanceof Wt){var n=r.internalValue+this.operand.internalValue;return new Wt(n)}else{var n=r.internalValue+this.operand.internalValue;return new zt(n)}};e.prototype.applyToRemoteDocument=function(e,t){d(t!==null,"Didn't receive transformResult for NUMERIC_ADD transform");return t};e.prototype.computeBaseValue=function(e){return e instanceof jt?e:new Wt(0)};e.prototype.isEqual=function(t){return t instanceof e&&this.operand.isEqual(t.operand)};return e}();function oa(e){if(e instanceof Jt){return e.internalValue.slice()}else{return[]}}var sa=function(){function e(e){this.count=e}e.prototype.isEqual=function(e){return e&&e.count===this.count};return e}();var ua=function(){var e={};e[Xi.ASCENDING.name]="ASCENDING";e[Xi.DESCENDING.name]="DESCENDING";return e}();var ca=function(){var e={};e[zi.LESS_THAN.name]="LESS_THAN";e[zi.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL";e[zi.GREATER_THAN.name]="GREATER_THAN";e[zi.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL";e[zi.EQUAL.name]="EQUAL";e[zi.ARRAY_CONTAINS.name]="ARRAY_CONTAINS";e[zi.IN.name]="IN";e[zi.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY";return e}();var la=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fa(e,t){d(!Gn(e),t+" is missing")}function ha(e){if(typeof e==="number"){return e}else if(typeof e==="string"){return Number(e)}else{return h("can't parse "+e)}}var da=function(){function e(e,t){this.databaseId=e;this.options=t}e.prototype.emptyByteString=function(){if(this.options.useProto3Json){return""}else{return new Uint8Array(0)}};e.prototype.unsafeCastProtoByteString=function(e){return e};e.prototype.fromRpcStatus=function(e){var t=e.code===undefined?m.UNKNOWN:gi(e.code);return new y(t,e.message||"")};e.prototype.toInt32Value=function(e){if(!Gn(e)){return{value:e}}else{return undefined}};e.prototype.fromInt32Value=function(e){var t;if(typeof e==="object"){t=e.value}else{t=e}return Gn(t)?null:t};e.prototype.toTimestamp=function(e){return{seconds:""+e.seconds,nanos:e.nanoseconds}};e.prototype.fromTimestamp=function(e){if(typeof e==="string"){return this.fromIso8601String(e)}else{d(!!e,"Cannot deserialize null or undefined timestamp.");var t=ha(e.seconds||"0");var r=e.nanos||0;return new ke(t,r)}};e.prototype.fromIso8601String=function(e){var t=0;var r=la.exec(e);d(!!r,"invalid timestamp: "+e);if(r[1]){var n=r[1];n=(n+"000000000").substr(0,9);t=Number(n)}var i=new Date(e);var a=Math.floor(i.getTime()/1e3);return new ke(a,t)};e.prototype.toBytes=function(e){if(this.options.useProto3Json){return e.toBase64()}else{return this.unsafeCastProtoByteString(e.toUint8Array())}};e.prototype.fromBlob=function(e){if(typeof e==="string"){d(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead.");return oe.fromBase64String(e)}else{d(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead.");return oe.fromUint8Array(e)}};e.prototype.toVersion=function(e){return this.toTimestamp(e.toTimestamp())};e.prototype.fromVersion=function(e){d(!!e,"Trying to deserialize version that isn't set");return Oe.fromTimestamp(this.fromTimestamp(e))};e.prototype.toResourceName=function(e,t){return this.fullyQualifiedPrefixPath(e).child("documents").child(t).canonicalString()};e.prototype.fromResourceName=function(e){var t=pe.fromString(e);d(this.isValidResourceName(t),"Tried to deserialize invalid key "+t.toString());return t};e.prototype.toName=function(e){return this.toResourceName(this.databaseId,e.path)};e.prototype.fromName=function(e){var t=this.fromResourceName(e);d(t.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+t.get(1)+" vs "+this.databaseId.projectId);d(!t.get(3)&&!this.databaseId.database||t.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+t.get(3)+" vs "+this.databaseId.database);return new ye(this.extractLocalPathFromResourceName(t))};e.prototype.toQueryPath=function(e){return this.toResourceName(this.databaseId,e)};e.prototype.fromQueryPath=function(e){var t=this.fromResourceName(e);if(t.length===4){return pe.EMPTY_PATH}return this.extractLocalPathFromResourceName(t)};Object.defineProperty(e.prototype,"encodedDatabaseId",{get:function(){var e=new pe(["projects",this.databaseId.projectId,"databases",this.databaseId.database]);return e.canonicalString()},enumerable:true,configurable:true});e.prototype.fullyQualifiedPrefixPath=function(e){return new pe(["projects",e.projectId,"databases",e.database])};e.prototype.extractLocalPathFromResourceName=function(e){d(e.length>4&&e.get(4)==="documents","tried to deserialize invalid key "+e.toString());return e.popFirst(5)};e.prototype.isValidResourceName=function(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"};e.prototype.toValue=function(e){if(e instanceof Vt){return{nullValue:"NULL_VALUE"}}else if(e instanceof qt){return{booleanValue:e.value()}}else if(e instanceof Wt){return{integerValue:""+e.value()}}else if(e instanceof zt){var t=e.value();if(this.options.useProto3Json){if(isNaN(t)){return{doubleValue:"NaN"}}else if(t===Infinity){return{doubleValue:"Infinity"}}else if(t===-Infinity){return{doubleValue:"-Infinity"}}}return{doubleValue:e.value()}}else if(e instanceof Qt){return{stringValue:e.value()}}else if(e instanceof Xt){return{mapValue:this.toMapValue(e)}}else if(e instanceof Jt){return{arrayValue:this.toArrayValue(e)}}else if(e instanceof Kt){return{timestampValue:this.toTimestamp(e.internalValue)}}else if(e instanceof $t){return{geoPointValue:{latitude:e.value().latitude,longitude:e.value().longitude}}}else if(e instanceof Ht){return{bytesValue:this.toBytes(e.value())}}else if(e instanceof Yt){return{referenceValue:this.toResourceName(e.databaseId,e.key.path)}}else{return h("Unknown FieldValue "+JSON.stringify(e))}};e.prototype.fromValue=function(e){var t=this;if("nullValue"in e){return Vt.INSTANCE}else if("booleanValue"in e){return qt.of(e.booleanValue)}else if("integerValue"in e){return new Wt(ha(e.integerValue))}else if("doubleValue"in e){if(this.options.useProto3Json){if(e.doubleValue==="NaN"){return zt.NAN}else if(e.doubleValue==="Infinity"){return zt.POSITIVE_INFINITY}else if(e.doubleValue==="-Infinity"){return zt.NEGATIVE_INFINITY}}return new zt(e.doubleValue)}else if("stringValue"in e){return new Qt(e.stringValue)}else if("mapValue"in e){return this.fromFields(e.mapValue.fields||{})}else if("arrayValue"in e){fa(e.arrayValue,"arrayValue");var r=e.arrayValue.values||[];return new Jt(r.map((function(e){return t.fromValue(e)})))}else if("timestampValue"in e){fa(e.timestampValue,"timestampValue");return new Kt(this.fromTimestamp(e.timestampValue))}else if("geoPointValue"in e){fa(e.geoPointValue,"geoPointValue");var n=e.geoPointValue.latitude||0;var i=e.geoPointValue.longitude||0;return new $t(new Bi(n,i))}else if("bytesValue"in e){fa(e.bytesValue,"bytesValue");var a=this.fromBlob(e.bytesValue);return new Ht(a)}else if("referenceValue"in e){fa(e.referenceValue,"referenceValue");var o=this.fromResourceName(e.referenceValue);var s=new le(o.get(1),o.get(3));var u=new ye(this.extractLocalPathFromResourceName(o));return new Yt(s,u)}else{return h("Unknown Value proto "+JSON.stringify(e))}};e.prototype.toMutationDocument=function(e,t){return{name:this.toName(e),fields:this.toFields(t)}};e.prototype.toDocument=function(e){d(!e.hasLocalMutations,"Can't serialize documents with mutations.");return{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toTimestamp(e.version.toTimestamp())}};e.prototype.fromDocument=function(e,t){var r=this;var n=this.fromName(e.name);var i=this.fromVersion(e.updateTime);return new er(n,i,{hasCommittedMutations:!!t},undefined,e,(function(e){return r.fromValue(e)}))};e.prototype.toFields=function(e){var t=this;var r={};e.forEach((function(e,n){r[e]=t.toValue(n)}));return r};e.prototype.fromFields=function(e){var t=this;var r=e;var n=Xt.EMPTY;E(r,(function(e,r){n=n.set(new me([e]),t.fromValue(r))}));return n};e.prototype.toMapValue=function(e){return{fields:this.toFields(e)}};e.prototype.toArrayValue=function(e){var t=this;var r=[];e.forEach((function(e){r.push(t.toValue(e))}));return{values:r}};e.prototype.fromFound=function(e){var t=this;d(!!e.found,"Tried to deserialize a found document from a missing document.");fa(e.found.name,"doc.found.name");fa(e.found.updateTime,"doc.found.updateTime");var r=this.fromName(e.found.name);var n=this.fromVersion(e.found.updateTime);return new er(r,n,{},undefined,e.found,(function(e){return t.fromValue(e)}))};e.prototype.fromMissing=function(e){d(!!e.missing,"Tried to deserialize a missing document from a found document.");d(!!e.readTime,"Tried to deserialize a missing document without a read time.");var t=this.fromName(e.missing);var r=this.fromVersion(e.readTime);return new tr(t,r)};e.prototype.fromMaybeDocument=function(e){if("found"in e){return this.fromFound(e)}else if("missing"in e){return this.fromMissing(e)}return h("invalid batch get response: "+JSON.stringify(e))};e.prototype.toWatchTargetChangeState=function(e){switch(e){case Oi.Added:return"ADD";case Oi.Current:return"CURRENT";case Oi.NoChange:return"NO_CHANGE";case Oi.Removed:return"REMOVE";case Oi.Reset:return"RESET";default:return h("Unknown WatchTargetChangeState: "+e)}};e.prototype.toTestWatchChange=function(e){if(e instanceof ki){return{filter:{count:e.existenceFilter.count,targetId:e.targetId}}}if(e instanceof Ni){if(e.newDoc instanceof er){var t=e.newDoc;return{documentChange:{document:{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toVersion(t.version)},targetIds:e.updatedTargetIds,removedTargetIds:e.removedTargetIds}}}else if(e.newDoc instanceof tr){var t=e.newDoc;return{documentDelete:{document:this.toName(t.key),readTime:this.toVersion(t.version),removedTargetIds:e.removedTargetIds}}}else if(e.newDoc===null){return{documentRemove:{document:this.toName(e.key),removedTargetIds:e.removedTargetIds}}}}if(e instanceof Mi){var r=undefined;if(e.cause){r={code:wi(e.cause.code),message:e.cause.message}}return{targetChange:{targetChangeType:this.toWatchTargetChangeState(e.state),targetIds:e.targetIds,resumeToken:this.unsafeCastProtoByteString(e.resumeToken),cause:r}}}return h("Unrecognized watch change: "+JSON.stringify(e))};e.prototype.fromWatchChange=function(e){var t=this;var r;if("targetChange"in e){fa(e.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(e.targetChange.targetChangeType||"NO_CHANGE");var i=e.targetChange.targetIds||[];var a=e.targetChange.resumeToken||this.emptyByteString();var o=e.targetChange.cause;var s=o&&this.fromRpcStatus(o);r=new Mi(n,i,a,s||null)}else if("documentChange"in e){fa(e.documentChange,"documentChange");fa(e.documentChange.document,"documentChange.name");fa(e.documentChange.document.name,"documentChange.document.name");fa(e.documentChange.document.updateTime,"documentChange.document.updateTime");var u=e.documentChange;var c=this.fromName(u.document.name);var l=this.fromVersion(u.document.updateTime);var f=new er(c,l,{},undefined,u.document,(function(e){return t.fromValue(e)}));var d=u.targetIds||[];var p=u.removedTargetIds||[];r=new Ni(d,p,f.key,f)}else if("documentDelete"in e){fa(e.documentDelete,"documentDelete");fa(e.documentDelete.document,"documentDelete.document");var v=e.documentDelete;var c=this.fromName(v.document);var l=v.readTime?this.fromVersion(v.readTime):Oe.forDeletedDoc();var f=new tr(c,l);var p=v.removedTargetIds||[];r=new Ni([],p,f.key,f)}else if("documentRemove"in e){fa(e.documentRemove,"documentRemove");fa(e.documentRemove.document,"documentRemove");var m=e.documentRemove;var c=this.fromName(m.document);var p=m.removedTargetIds||[];r=new Ni([],p,c,null)}else if("filter"in e){fa(e.filter,"filter");fa(e.filter.targetId,"filter.targetId");var y=e.filter;var g=y.count||0;var b=new sa(g);var w=y.targetId;r=new ki(w,b)}else{return h("Unknown change type "+JSON.stringify(e))}return r};e.prototype.fromWatchTargetChangeState=function(e){if(e==="NO_CHANGE"){return Oi.NoChange}else if(e==="ADD"){return Oi.Added}else if(e==="REMOVE"){return Oi.Removed}else if(e==="CURRENT"){return Oi.Current}else if(e==="RESET"){return Oi.Reset}else{return h("Got unexpected TargetChange.state: "+e)}};e.prototype.versionFromListenResponse=function(e){if(!("targetChange"in e)){return Oe.MIN}var t=e.targetChange;if(t.targetIds&&t.targetIds.length){return Oe.MIN}if(!t.readTime){return Oe.MIN}return this.fromVersion(t.readTime)};e.prototype.toMutation=function(e){var t=this;var r;if(e instanceof kt){r={update:this.toMutationDocument(e.key,e.value)}}else if(e instanceof xt){r={delete:this.toName(e.key)}}else if(e instanceof Ot){r={update:this.toMutationDocument(e.key,e.data),updateMask:this.toDocumentMask(e.fieldMask)}}else if(e instanceof Mt){r={transform:{document:this.toName(e.key),fieldTransforms:e.fieldTransforms.map((function(e){return t.toFieldTransform(e)}))}}}else{return h("Unknown mutation type "+e.type)}if(!e.precondition.isNone){r.currentDocument=this.toPrecondition(e.precondition)}return r};e.prototype.fromMutation=function(e){var t=this;var r=e.currentDocument?this.fromPrecondition(e.currentDocument):At.NONE;if(e.update){fa(e.update.name,"name");var n=this.fromName(e.update.name);var i=this.fromFields(e.update.fields||{});if(e.updateMask){var a=this.fromDocumentMask(e.updateMask);return new Ot(n,i,a,r)}else{return new kt(n,i,r)}}else if(e.delete){var n=this.fromName(e.delete);return new xt(n,r)}else if(e.transform){var n=this.fromName(e.transform.document);var o=e.transform.fieldTransforms.map((function(e){return t.fromFieldTransform(e)}));d(r.exists===true,'Transforms only support precondition "exists == true"');return new Mt(n,o)}else{return h("unknown mutation proto: "+JSON.stringify(e))}};e.prototype.toPrecondition=function(e){d(!e.isNone,"Can't serialize an empty precondition");if(e.updateTime!==undefined){return{updateTime:this.toVersion(e.updateTime)}}else if(e.exists!==undefined){return{exists:e.exists}}else{return h("Unknown precondition")}};e.prototype.fromPrecondition=function(e){if(e.updateTime!==undefined){return At.updateTime(this.fromVersion(e.updateTime))}else if(e.exists!==undefined){return At.exists(e.exists)}else{return At.NONE}};e.prototype.fromWriteResult=function(e,t){var r=this;var n=e.updateTime?this.fromVersion(e.updateTime):this.fromVersion(t);var i=null;if(e.transformResults&&e.transformResults.length>0){i=e.transformResults.map((function(e){return r.fromValue(e)}))}return new Dt(n,i)};e.prototype.fromWriteResults=function(e,t){var r=this;if(e&&e.length>0){d(t!==undefined,"Received a write result without a commit time");return e.map((function(e){return r.fromWriteResult(e,t)}))}else{return[]}};e.prototype.toFieldTransform=function(e){var t=this;var r=e.transform;if(r instanceof ra){return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"}}else if(r instanceof na){return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:r.elements.map((function(e){return t.toValue(e)}))}}}else if(r instanceof ia){return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:r.elements.map((function(e){return t.toValue(e)}))}}}else if(r instanceof aa){return{fieldPath:e.field.canonicalString(),increment:this.toValue(r.operand)}}else{throw h("Unknown transform: "+e.transform)}};e.prototype.fromFieldTransform=function(e){var t=this;var r=null;if("setToServerValue"in e){d(e.setToServerValue==="REQUEST_TIME","Unknown server value transform proto: "+JSON.stringify(e));r=ra.instance}else if("appendMissingElements"in e){var n=e.appendMissingElements.values||[];r=new na(n.map((function(e){return t.fromValue(e)})))}else if("removeAllFromArray"in e){var n=e.removeAllFromArray.values||[];r=new ia(n.map((function(e){return t.fromValue(e)})))}else if("increment"in e){var i=this.fromValue(e.increment);d(i instanceof jt,"NUMERIC_ADD transform requires a NumberValue");r=new aa(i)}else{h("Unknown transform proto: "+JSON.stringify(e))}var a=me.fromServerFormat(e.fieldPath);return new It(a,r)};e.prototype.toDocumentsTarget=function(e){return{documents:[this.toQueryPath(e.path)]}};e.prototype.fromDocumentsTarget=function(e){var t=e.documents.length;d(t===1,"DocumentsTarget contained other than 1 document: "+t);var r=e.documents[0];return Ui.atPath(this.fromQueryPath(r))};e.prototype.toQueryTarget=function(e){var t={structuredQuery:{}};var r=e.path;if(e.collectionGroup!==null){d(r.length%2===0,"Collection Group queries should be within a document path or root.");t.parent=this.toQueryPath(r);t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:true}]}else{d(r.length%2!==0,"Document queries with filters are not supported.");t.parent=this.toQueryPath(r.popLast());t.structuredQuery.from=[{collectionId:r.lastSegment()}]}var n=this.toFilter(e.filters);if(n){t.structuredQuery.where=n}var i=this.toOrder(e.orderBy);if(i){t.structuredQuery.orderBy=i}var a=this.toInt32Value(e.limit);if(a!==undefined){t.structuredQuery.limit=a}if(e.startAt){t.structuredQuery.startAt=this.toCursor(e.startAt)}if(e.endAt){t.structuredQuery.endAt=this.toCursor(e.endAt)}return t};e.prototype.fromQueryTarget=function(e){var t=this.fromQueryPath(e.parent);var r=e.structuredQuery;var n=r.from?r.from.length:0;var i=null;if(n>0){d(n===1,"StructuredQuery.from with more than one collection is not supported.");var a=r.from[0];if(a.allDescendants){i=a.collectionId}else{t=t.child(a.collectionId)}}var o=[];if(r.where){o=this.fromFilter(r.where)}var s=[];if(r.orderBy){s=this.fromOrder(r.orderBy)}var u=null;if(r.limit){u=this.fromInt32Value(r.limit)}var c=null;if(r.startAt){c=this.fromCursor(r.startAt)}var l=null;if(r.endAt){l=this.fromCursor(r.endAt)}return new Ui(t,i,s,o,u,c,l)};e.prototype.toListenRequestLabels=function(e){var t=this.toLabel(e.purpose);if(t==null){return null}else{return{"goog-listen-tags":t}}};e.prototype.toLabel=function(e){switch(e){case Xr.Listen:return null;case Xr.ExistenceFilterMismatch:return"existence-filter-mismatch";case Xr.LimboResolution:return"limbo-document";default:return h("Unrecognized query purpose: "+e)}};e.prototype.toTarget=function(e){var t;var r=e.query;if(r.isDocumentQuery()){t={documents:this.toDocumentsTarget(r)}}else{t={query:this.toQueryTarget(r)}}t.targetId=e.targetId;if(e.resumeToken.length>0){t.resumeToken=this.unsafeCastProtoByteString(e.resumeToken)}return t};e.prototype.toFilter=function(e){var t=this;if(e.length===0){return}var r=e.map((function(e){if(e instanceof Qi){return t.toUnaryOrFieldFilter(e)}else{return h("Unrecognized filter: "+JSON.stringify(e))}}));if(r.length===1){return r[0]}return{compositeFilter:{op:"AND",filters:r}}};e.prototype.fromFilter=function(e){var t=this;if(!e){return[]}else if(e.unaryFilter!==undefined){return[this.fromUnaryFilter(e)]}else if(e.fieldFilter!==undefined){return[this.fromFieldFilter(e)]}else if(e.compositeFilter!==undefined){return e.compositeFilter.filters.map((function(e){return t.fromFilter(e)})).reduce((function(e,t){return e.concat(t)}))}else{return h("Unknown filter: "+JSON.stringify(e))}};e.prototype.toOrder=function(e){var t=this;if(e.length===0){return}return e.map((function(e){return t.toPropertyOrder(e)}))};e.prototype.fromOrder=function(e){var t=this;return e.map((function(e){return t.fromPropertyOrder(e)}))};e.prototype.toCursor=function(e){var t=this;return{before:e.before,values:e.position.map((function(e){return t.toValue(e)}))}};e.prototype.fromCursor=function(e){var t=this;var r=!!e.before;var n=e.values.map((function(e){return t.fromValue(e)}));return new Ji(n,r)};e.prototype.toDirection=function(e){return ua[e.name]};e.prototype.fromDirection=function(e){switch(e){case"ASCENDING":return Xi.ASCENDING;case"DESCENDING":return Xi.DESCENDING;default:return undefined}};e.prototype.toOperatorName=function(e){return ca[e.name]};e.prototype.fromOperatorName=function(e){switch(e){case"EQUAL":return zi.EQUAL;case"GREATER_THAN":return zi.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return zi.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return zi.LESS_THAN;case"LESS_THAN_OR_EQUAL":return zi.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return zi.ARRAY_CONTAINS;case"IN":return zi.IN;case"ARRAY_CONTAINS_ANY":return zi.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return h("Unspecified operator");default:return h("Unknown operator")}};e.prototype.toFieldPathReference=function(e){return{fieldPath:e.canonicalString()}};e.prototype.fromFieldPathReference=function(e){return me.fromServerFormat(e.fieldPath)};e.prototype.toPropertyOrder=function(e){return{field:this.toFieldPathReference(e.field),direction:this.toDirection(e.dir)}};e.prototype.fromPropertyOrder=function(e){return new Zi(this.fromFieldPathReference(e.field),this.fromDirection(e.direction))};e.prototype.fromFieldFilter=function(e){return Qi.create(this.fromFieldPathReference(e.fieldFilter.field),this.fromOperatorName(e.fieldFilter.op),this.fromValue(e.fieldFilter.value))};e.prototype.toUnaryOrFieldFilter=function(e){if(e.op===zi.EQUAL){if(e.value.isEqual(zt.NAN)){return{unaryFilter:{field:this.toFieldPathReference(e.field),op:"IS_NAN"}}}else if(e.value.isEqual(Vt.INSTANCE)){return{unaryFilter:{field:this.toFieldPathReference(e.field),op:"IS_NULL"}}}}return{fieldFilter:{field:this.toFieldPathReference(e.field),op:this.toOperatorName(e.op),value:this.toValue(e.value)}}};e.prototype.fromUnaryFilter=function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=this.fromFieldPathReference(e.unaryFilter.field);return Qi.create(t,zi.EQUAL,zt.NAN);case"IS_NULL":var r=this.fromFieldPathReference(e.unaryFilter.field);return Qi.create(r,zi.EQUAL,Vt.INSTANCE);case"OPERATOR_UNSPECIFIED":return h("Unspecified filter");default:return h("Unknown filter")}};e.prototype.toDocumentMask=function(e){var t=[];e.fields.forEach((function(e){return t.push(e.canonicalString())}));return{fieldPaths:t}};e.prototype.fromDocumentMask=function(e){var t=e.fieldPaths||[];var r=t.map((function(e){return me.fromServerFormat(e)}));return Tt.fromArray(r)};return e}();var pa=function(){function e(){this.viewSnap=null;this.targetId=0;this.listeners=[]}return e}();var va=function(){function e(e){this.syncEngine=e;this.queries=new nr((function(e){return e.canonicalId()}));this.onlineState=ui.Unknown;this.snapshotsInSyncListeners=new Set;this.syncEngine.subscribe(this)}e.prototype.listen=function(e){var t=e.query;var r=false;var n=this.queries.get(t);if(!n){r=true;n=new pa;this.queries.set(t,n)}n.listeners.push(e);var i=e.applyOnlineStateChange(this.onlineState);d(!i,"applyOnlineStateChange() shouldn't raise an event for brand-new listeners.");if(n.viewSnap){var a=e.onViewSnapshot(n.viewSnap);if(a){this.raiseSnapshotsInSyncEvent()}}if(r){return this.syncEngine.listen(t).then((function(e){n.targetId=e;return e}))}else{return Promise.resolve(n.targetId)}};e.prototype.unlisten=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r,n,i;return F.__generator(this,(function(a){t=e.query;r=false;n=this.queries.get(t);if(n){i=n.listeners.indexOf(e);if(i>=0){n.listeners.splice(i,1);r=n.listeners.length===0}}if(r){this.queries.delete(t);return[2,this.syncEngine.unlisten(t)]}return[2]}))}))};e.prototype.onWatchChange=function(e){var t=false;for(var r=0,n=e;r<n.length;r++){var i=n[r];var a=i.query;var o=this.queries.get(a);if(o){for(var s=0,u=o.listeners;s<u.length;s++){var c=u[s];if(c.onViewSnapshot(i)){t=true}}o.viewSnap=i}}if(t){this.raiseSnapshotsInSyncEvent()}};e.prototype.onWatchError=function(e,t){var r=this.queries.get(e);if(r){for(var n=0,i=r.listeners;n<i.length;n++){var a=i[n];a.onError(t)}}this.queries.delete(e)};e.prototype.onOnlineStateChange=function(e){this.onlineState=e;var t=false;this.queries.forEach((function(r,n){for(var i=0,a=n.listeners;i<a.length;i++){var o=a[i];if(o.applyOnlineStateChange(e)){t=true}}}));if(t){this.raiseSnapshotsInSyncEvent()}};e.prototype.addSnapshotsInSyncListener=function(e){this.snapshotsInSyncListeners.add(e);e.next()};e.prototype.removeSnapshotsInSyncListener=function(e){this.snapshotsInSyncListeners.delete(e)};e.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach((function(e){e.next()}))};return e}();var ma=function(){function e(e,t,r){this.query=e;this.queryObserver=t;this.raisedInitialEvent=false;this.snap=null;this.onlineState=ui.Unknown;this.options=r||{}}e.prototype.onViewSnapshot=function(e){d(e.docChanges.length>0||e.syncStateChanged,"We got a new snapshot with no changes?");if(!this.options.includeMetadataChanges){var t=[];for(var r=0,n=e.docChanges;r<n.length;r++){var i=n[r];if(i.type!==Ei.Metadata){t.push(i)}}e=new Di(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,true)}var a=false;if(!this.raisedInitialEvent){if(this.shouldRaiseInitialEvent(e,this.onlineState)){this.raiseInitialEvent(e);a=true}}else if(this.shouldRaiseEvent(e)){this.queryObserver.next(e);a=true}this.snap=e;return a};e.prototype.onError=function(e){this.queryObserver.error(e)};e.prototype.applyOnlineStateChange=function(e){this.onlineState=e;var t=false;if(this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)){this.raiseInitialEvent(this.snap);t=true}return t};e.prototype.shouldRaiseInitialEvent=function(e,t){d(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event");if(!e.fromCache){return true}var r=t!==ui.Offline;if(this.options.waitForSyncWhenOnline&&r){d(e.fromCache,"Waiting for sync, but snapshot is not from cache");return false}return!e.docs.isEmpty()||t===ui.Offline};e.prototype.shouldRaiseEvent=function(e){if(e.docChanges.length>0){return true}var t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;if(e.syncStateChanged||t){return this.options.includeMetadataChanges===true}return false};e.prototype.raiseInitialEvent=function(e){d(!this.raisedInitialEvent,"Trying to raise initial events for second time");e=Di.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache);this.raisedInitialEvent=true;this.queryObserver.next(e)};return e}();var ya=function(){function e(e,t,r){this.targetId=e;this.addedKeys=t;this.removedKeys=r}e.fromSnapshot=function(t,r){var n=Ke();var i=Ke();for(var a=0,o=r.docChanges;a<o.length;a++){var s=o[a];switch(s.type){case Ei.Added:n=n.add(s.doc.key);break;case Ei.Removed:i=i.add(s.doc.key);break;default:}}return new e(t,n,i)};return e}();var ga=function(){function e(e){this.key=e}return e}();var ba=function(){function e(e){this.key=e}return e}();var wa=function(){function e(e,t){this.query=e;this._syncedDocuments=t;this.syncState=null;this.current=false;this.limboDocuments=Ke();this.mutatedKeys=Ke();this.documentSet=new Si(e.docComparator.bind(e))}Object.defineProperty(e.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:true,configurable:true});e.prototype.computeDocChanges=function(e,t){var r=this;var n=t?t.changeSet:new Ii;var i=t?t.documentSet:this.documentSet;var a=t?t.mutatedKeys:this.mutatedKeys;var o=i;var s=false;var u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;e.inorderTraversal((function(e,t){var c=i.get(e);var l=t instanceof er?t:null;if(l){d(e.isEqual(l.key),"Mismatching keys found in document changes: "+e+" != "+l.key);l=r.query.matches(l)?l:null}var f=c?r.mutatedKeys.has(c.key):false;var h=l?l.hasLocalMutations||r.mutatedKeys.has(l.key)&&l.hasCommittedMutations:false;var p=false;if(c&&l){var v=c.data().isEqual(l.data());if(!v){if(!r.shouldWaitForSyncedDocument(c,l)){n.track({type:Ei.Modified,doc:l});p=true;if(u&&r.query.docComparator(l,u)>0){s=true}}}else if(f!==h){n.track({type:Ei.Metadata,doc:l});p=true}}else if(!c&&l){n.track({type:Ei.Added,doc:l});p=true}else if(c&&!l){n.track({type:Ei.Removed,doc:c});p=true;if(u){s=true}}if(p){if(l){o=o.add(l);if(h){a=a.add(e)}else{a=a.delete(e)}}else{o=o.delete(e);a=a.delete(e)}}}));if(this.query.hasLimit()){while(o.size>this.query.limit){var c=o.last();o=o.delete(c.key);a=a.delete(c.key);n.track({type:Ei.Removed,doc:c})}}d(!s||!t,"View was refilled using docs that themselves needed refilling.");return{documentSet:o,changeSet:n,needsRefill:s,mutatedKeys:a}};e.prototype.shouldWaitForSyncedDocument=function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations};e.prototype.applyChanges=function(e,t,r){var n=this;d(!e.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=e.documentSet;this.mutatedKeys=e.mutatedKeys;var a=e.changeSet.getChanges();a.sort((function(e,t){return _a(e.type,t.type)||n.query.docComparator(e.doc,t.doc)}));this.applyTargetChange(r);var o=t?this.updateLimboDocuments():[];var s=this.limboDocuments.size===0&&this.current;var u=s?Ti.Synced:Ti.Local;var c=u!==this.syncState;this.syncState=u;if(a.length===0&&!c){return{limboChanges:o}}else{var l=new Di(this.query,e.documentSet,i,a,e.mutatedKeys,u===Ti.Local,c,false);return{snapshot:l,limboChanges:o}}};e.prototype.applyOnlineStateChange=function(e){if(this.current&&e===ui.Offline){this.current=false;return this.applyChanges({documentSet:this.documentSet,changeSet:new Ii,mutatedKeys:this.mutatedKeys,needsRefill:false},false)}else{return{limboChanges:[]}}};e.prototype.shouldBeInLimbo=function(e){if(this._syncedDocuments.has(e)){return false}if(!this.documentSet.has(e)){return false}if(this.documentSet.get(e).hasLocalMutations){return false}return true};e.prototype.applyTargetChange=function(e){var t=this;if(e){e.addedDocuments.forEach((function(e){return t._syncedDocuments=t._syncedDocuments.add(e)}));e.modifiedDocuments.forEach((function(e){return d(t._syncedDocuments.has(e),"Modified document "+e+" not found in view.")}));e.removedDocuments.forEach((function(e){return t._syncedDocuments=t._syncedDocuments.delete(e)}));this.current=e.current}};e.prototype.updateLimboDocuments=function(){var e=this;if(!this.current){return[]}var t=this.limboDocuments;this.limboDocuments=Ke();this.documentSet.forEach((function(t){if(e.shouldBeInLimbo(t.key)){e.limboDocuments=e.limboDocuments.add(t.key)}}));var r=[];t.forEach((function(t){if(!e.limboDocuments.has(t)){r.push(new ba(t))}}));this.limboDocuments.forEach((function(e){if(!t.has(e)){r.push(new ga(e))}}));return r};e.prototype.synchronizeWithPersistedState=function(e,t){this._syncedDocuments=t;this.limboDocuments=Ke();var r=this.computeDocChanges(e);return this.applyChanges(r,true)};e.prototype.computeInitialSnapshot=function(){return Di.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===Ti.Local)};return e}();function _a(e,t){var r=function(e){switch(e){case Ei.Added:return 1;case Ei.Modified:return 2;case Ei.Metadata:return 2;case Ei.Removed:return 0;default:return h("Unknown ChangeType: "+e)}};return r(e)-r(t)}var Sa=5;var Ea=function(){function e(e,t,r,n){this.asyncQueue=e;this.remoteStore=t;this.updateFunction=r;this.deferred=n;this.retries=Sa;this.backoff=new Zn(this.asyncQueue,be.RetryTransaction)}e.prototype.run=function(){this.runWithBackOff()};e.prototype.runWithBackOff=function(){var e=this;this.backoff.backoffAndRun((function(){return F.__awaiter(e,void 0,void 0,(function(){var e,t;var r=this;return F.__generator(this,(function(n){e=this.remoteStore.createTransaction();t=this.tryRunUpdateFunction(e);if(t){t.then((function(t){r.asyncQueue.enqueueAndForget((function(){return e.commit().then((function(){r.deferred.resolve(t)})).catch((function(e){r.handleTransactionError(e)}))}))})).catch((function(e){r.handleTransactionError(e)}))}return[2]}))}))}))};e.prototype.tryRunUpdateFunction=function(e){try{var t=this.updateFunction(e);if(Gn(t)||!t.catch||!t.then){this.deferred.reject(Error("Transaction callback must return a Promise"));return null}return t}catch(e){this.deferred.reject(e);return null}};e.prototype.handleTransactionError=function(e){var t=this;if(this.retries>0&&this.isRetryableTransactionError(e)){this.retries-=1;this.asyncQueue.enqueueAndForget((function(){t.runWithBackOff();return Promise.resolve()}))}else{this.deferred.reject(e)}};e.prototype.isRetryableTransactionError=function(e){if(e.name==="FirebaseError"){var t=e.code;return t==="aborted"||t==="failed-precondition"||!vi(t)}return false};return e}();var Ta="SyncEngine";var Ia=function(){function e(e,t,r){this.query=e;this.targetId=t;this.view=r}return e}();var Da=function(){function e(e){this.key=e;this.receivedDocument=false}return e}();var Ca=function(){function e(e,t,r,n){this.localStore=e;this.remoteStore=t;this.sharedClientState=r;this.currentUser=n;this.syncEngineListener=null;this.queryViewsByQuery=new nr((function(e){return e.canonicalId()}));this.queryViewsByTarget={};this.limboTargetsByKey=new Me(ye.comparator);this.limboResolutionsByTarget={};this.limboDocumentRefs=new kn;this.mutationUserCallbacks={};this.pendingWritesCallbacks=new Map;this.limboTargetIdGenerator=ct.forSyncEngine();this.isPrimary=undefined;this.onlineState=ui.Unknown}Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return this.isPrimary===true},enumerable:true,configurable:true});e.prototype.subscribe=function(e){d(e!==null,"SyncEngine listener cannot be null");d(this.syncEngineListener===null,"SyncEngine already has a subscriber.");this.syncEngineListener=e};e.prototype.listen=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r,n,i,a;return F.__generator(this,(function(o){switch(o.label){case 0:this.assertSubscribed("listen()");n=this.queryViewsByQuery.get(e);if(!n)return[3,1];t=n.targetId;this.sharedClientState.addLocalQueryTarget(t);r=n.view.computeInitialSnapshot();return[3,4];case 1:return[4,this.localStore.allocateQuery(e)];case 2:i=o.sent();a=this.sharedClientState.addLocalQueryTarget(i.targetId);t=i.targetId;return[4,this.initializeViewAndComputeSnapshot(i,a==="current")];case 3:r=o.sent();if(this.isPrimary){this.remoteStore.listen(i)}o.label=4;case 4:this.syncEngineListener.onWatchChange([r]);return[2,t]}}))}))};e.prototype.initializeViewAndComputeSnapshot=function(e,t){return F.__awaiter(this,void 0,void 0,(function(){var r,n,i,a,o,s,u,c;return F.__generator(this,(function(l){switch(l.label){case 0:r=e.query;return[4,this.localStore.executeQuery(r)];case 1:n=l.sent();return[4,this.localStore.remoteDocumentKeys(e.targetId)];case 2:i=l.sent();a=new wa(r,i);o=a.computeDocChanges(n);s=Ai.createSynthesizedTargetChangeForCurrentChange(e.targetId,t&&this.onlineState!==ui.Offline);u=a.applyChanges(o,this.isPrimary===true,s);d(u.limboChanges.length===0,"View returned limbo docs before target ack from the server.");d(!!u.snapshot,"applyChanges for new view should always return a snapshot");c=new Ia(r,e.targetId,a);this.queryViewsByQuery.set(r,c);this.queryViewsByTarget[e.targetId]=c;return[2,u.snapshot]}}))}))};e.prototype.synchronizeViewAndComputeSnapshot=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r,n;return F.__generator(this,(function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(e.query)];case 1:t=i.sent();return[4,this.localStore.remoteDocumentKeys(e.targetId)];case 2:r=i.sent();n=e.view.synchronizeWithPersistedState(t,r);if(this.isPrimary){this.updateTrackedLimbos(e.targetId,n.limboChanges)}return[2,n]}}))}))};e.prototype.unlisten=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r;var n=this;return F.__generator(this,(function(i){switch(i.label){case 0:this.assertSubscribed("unlisten()");t=this.queryViewsByQuery.get(e);d(!!t,"Trying to unlisten on query not found:"+e);if(!this.isPrimary)return[3,3];this.sharedClientState.removeLocalQueryTarget(t.targetId);r=this.sharedClientState.isActiveQueryTarget(t.targetId);if(!!r)return[3,2];return[4,this.localStore.releaseQuery(e,false).then((function(){n.sharedClientState.clearQueryState(t.targetId);n.remoteStore.unlisten(t.targetId);n.removeAndCleanupQuery(t)})).catch(Sn)];case 1:i.sent();i.label=2;case 2:return[3,5];case 3:this.removeAndCleanupQuery(t);return[4,this.localStore.releaseQuery(e,true)];case 4:i.sent();i.label=5;case 5:return[2]}}))}))};e.prototype.write=function(e,t){return F.__awaiter(this,void 0,void 0,(function(){var r;return F.__generator(this,(function(n){switch(n.label){case 0:this.assertSubscribed("write()");return[4,this.localStore.localWrite(e)];case 1:r=n.sent();this.sharedClientState.addPendingMutation(r.batchId);this.addMutationCallback(r.batchId,t);return[4,this.emitNewSnapsAndNotifyLocalStore(r.changes)];case 2:n.sent();return[4,this.remoteStore.fillWritePipeline()];case 3:n.sent();return[2]}}))}))};e.prototype.runTransaction=function(e,t,r){new Ea(e,this.remoteStore,t,r).run()};e.prototype.applyRemoteEvent=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r;var n=this;return F.__generator(this,(function(i){switch(i.label){case 0:this.assertSubscribed("applyRemoteEvent()");i.label=1;case 1:i.trys.push([1,4,,6]);return[4,this.localStore.applyRemoteEvent(e)];case 2:t=i.sent();E(e.targetChanges,(function(e,t){var r=n.limboResolutionsByTarget[Number(e)];if(r){d(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes.");if(t.addedDocuments.size>0){r.receivedDocument=true}else if(t.modifiedDocuments.size>0){d(r.receivedDocument,"Received change for limbo target document without add.")}else if(t.removedDocuments.size>0){d(r.receivedDocument,"Received remove for limbo target document without add.");r.receivedDocument=false}}}));return[4,this.emitNewSnapsAndNotifyLocalStore(t,e)];case 3:i.sent();return[3,6];case 4:r=i.sent();return[4,Sn(r)];case 5:i.sent();return[3,6];case 6:return[2]}}))}))};e.prototype.applyOnlineStateChange=function(e,t){if(this.isPrimary&&t===ci.RemoteStore||!this.isPrimary&&t===ci.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var r=[];this.queryViewsByQuery.forEach((function(t,n){var i=n.view.applyOnlineStateChange(e);d(i.limboChanges.length===0,"OnlineState should not affect limbo documents.");if(i.snapshot){r.push(i.snapshot)}}));this.syncEngineListener.onOnlineStateChange(e);this.syncEngineListener.onWatchChange(r);this.onlineState=e;if(this.isPrimary){this.sharedClientState.setOnlineState(e)}}};e.prototype.rejectListen=function(e,t){return F.__awaiter(this,void 0,void 0,(function(){var r,n,i,a,o,s;var u=this;return F.__generator(this,(function(c){switch(c.label){case 0:this.assertSubscribed("rejectListens()");this.sharedClientState.updateQueryState(e,"rejected",t);r=this.limboResolutionsByTarget[e];n=r&&r.key;if(!n)return[3,1];this.limboTargetsByKey=this.limboTargetsByKey.remove(n);delete this.limboResolutionsByTarget[e];i=new Me(ye.comparator);i=i.insert(n,new tr(n,Oe.forDeletedDoc()));a=Ke().add(n);o=new Ci(Oe.MIN,{},new Le(ee),i,a);return[2,this.applyRemoteEvent(o)];case 1:s=this.queryViewsByTarget[e];d(!!s,"Unknown targetId: "+e);return[4,this.localStore.releaseQuery(s.query,false).then((function(){return u.removeAndCleanupQuery(s)})).catch(Sn)];case 2:c.sent();this.syncEngineListener.onWatchError(s.query,t);c.label=3;case 3:return[2]}}))}))};e.prototype.applyBatchState=function(e,t,r){return F.__awaiter(this,void 0,void 0,(function(){var n;return F.__generator(this,(function(i){switch(i.label){case 0:this.assertSubscribed("applyBatchState()");return[4,this.localStore.lookupMutationDocuments(e)];case 1:n=i.sent();if(n===null){c(Ta,"Cannot apply mutation batch with id: "+e);return[2]}if(!(t==="pending"))return[3,3];return[4,this.remoteStore.fillWritePipeline()];case 2:i.sent();return[3,4];case 3:if(t==="acknowledged"||t==="rejected"){this.processUserCallback(e,r?r:null);this.localStore.removeCachedMutationBatchMetadata(e)}else{h("Unknown batchState: "+t)}i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 5:i.sent();return[2]}}))}))};e.prototype.applySuccessfulWrite=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r,n;return F.__generator(this,(function(i){switch(i.label){case 0:this.assertSubscribed("applySuccessfulWrite()");t=e.batch.batchId;this.processUserCallback(t,null);this.triggerPendingWritesCallbacks(t);i.label=1;case 1:i.trys.push([1,4,,6]);return[4,this.localStore.acknowledgeBatch(e)];case 2:r=i.sent();this.sharedClientState.updateMutationState(t,"acknowledged");return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 3:i.sent();return[3,6];case 4:n=i.sent();return[4,Sn(n)];case 5:i.sent();return[3,6];case 6:return[2]}}))}))};e.prototype.rejectFailedWrite=function(e,t){return F.__awaiter(this,void 0,void 0,(function(){var r,n;return F.__generator(this,(function(i){switch(i.label){case 0:this.assertSubscribed("rejectFailedWrite()");this.processUserCallback(e,t);this.triggerPendingWritesCallbacks(e);i.label=1;case 1:i.trys.push([1,4,,6]);return[4,this.localStore.rejectBatch(e)];case 2:r=i.sent();this.sharedClientState.updateMutationState(e,"rejected",t);return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 3:i.sent();return[3,6];case 4:n=i.sent();return[4,Sn(n)];case 5:i.sent();return[3,6];case 6:return[2]}}))}))};e.prototype.registerPendingWritesCallback=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r;return F.__generator(this,(function(n){switch(n.label){case 0:if(!this.remoteStore.canUseNetwork()){c(Ta,"The network is disabled. The task returned by "+"'awaitPendingWrites()' will not complete until the network is enabled.")}return[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:t=n.sent();if(t===Ye){e.resolve();return[2]}r=this.pendingWritesCallbacks.get(t)||[];r.push(e);this.pendingWritesCallbacks.set(t,r);return[2]}}))}))};e.prototype.triggerPendingWritesCallbacks=function(e){(this.pendingWritesCallbacks.get(e)||[]).forEach((function(e){e.resolve()}));this.pendingWritesCallbacks.delete(e)};e.prototype.rejectOutstandingPendingWritesCallbacks=function(e){this.pendingWritesCallbacks.forEach((function(t){t.forEach((function(t){t.reject(new y(m.CANCELLED,e))}))}));this.pendingWritesCallbacks.clear()};e.prototype.addMutationCallback=function(e,t){var r=this.mutationUserCallbacks[this.currentUser.toKey()];if(!r){r=new Me(ee)}r=r.insert(e,t);this.mutationUserCallbacks[this.currentUser.toKey()]=r};e.prototype.processUserCallback=function(e,t){var r=this.mutationUserCallbacks[this.currentUser.toKey()];if(r){var n=r.get(e);if(n){d(e===r.minKey(),"Mutation callbacks processed out-of-order?");if(t){n.reject(t)}else{n.resolve()}r=r.remove(e)}this.mutationUserCallbacks[this.currentUser.toKey()]=r}};e.prototype.removeAndCleanupQuery=function(e){var t=this;this.sharedClientState.removeLocalQueryTarget(e.targetId);this.queryViewsByQuery.delete(e.query);delete this.queryViewsByTarget[e.targetId];if(this.isPrimary){var r=this.limboDocumentRefs.referencesForId(e.targetId);this.limboDocumentRefs.removeReferencesForId(e.targetId);r.forEach((function(e){var r=t.limboDocumentRefs.containsKey(e);if(!r){t.removeLimboTarget(e)}}))}};e.prototype.removeLimboTarget=function(e){var t=this.limboTargetsByKey.get(e);if(t===null){return}this.remoteStore.unlisten(t);this.limboTargetsByKey=this.limboTargetsByKey.remove(e);delete this.limboResolutionsByTarget[t]};e.prototype.updateTrackedLimbos=function(e,t){for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i instanceof ga){this.limboDocumentRefs.addReference(i.key,e);this.trackLimboChange(i)}else if(i instanceof ba){c(Ta,"Document no longer in limbo: "+i.key);this.limboDocumentRefs.removeReference(i.key,e);var a=this.limboDocumentRefs.containsKey(i.key);if(!a){this.removeLimboTarget(i.key)}}else{h("Unknown limbo change: "+JSON.stringify(i))}}};e.prototype.trackLimboChange=function(e){var t=e.key;if(!this.limboTargetsByKey.get(t)){c(Ta,"New document in limbo: "+t);var r=this.limboTargetIdGenerator.next();var n=Ui.atPath(t.path);this.limboResolutionsByTarget[r]=new Da(t);this.remoteStore.listen(new Jr(n,r,Xr.LimboResolution,fe.INVALID));this.limboTargetsByKey=this.limboTargetsByKey.insert(t,r)}};e.prototype.currentLimboDocs=function(){return this.limboTargetsByKey};e.prototype.emitNewSnapsAndNotifyLocalStore=function(e,t){return F.__awaiter(this,void 0,void 0,(function(){var r,n,i;var a=this;return F.__generator(this,(function(o){switch(o.label){case 0:r=[];n=[];i=[];this.queryViewsByQuery.forEach((function(o,s){i.push(Promise.resolve().then((function(){var t=s.view.computeDocChanges(e);if(!t.needsRefill){return t}return a.localStore.executeQuery(s.query).then((function(e){return s.view.computeDocChanges(e,t)}))})).then((function(e){var i=t&&t.targetChanges[s.targetId];var o=s.view.applyChanges(e,a.isPrimary===true,i);a.updateTrackedLimbos(s.targetId,o.limboChanges);if(o.snapshot){if(a.isPrimary){a.sharedClientState.updateQueryState(s.targetId,o.snapshot.fromCache?"not-current":"current")}r.push(o.snapshot);var u=ya.fromSnapshot(s.targetId,o.snapshot);n.push(u)}})))}));return[4,Promise.all(i)];case 1:o.sent();this.syncEngineListener.onWatchChange(r);return[4,this.localStore.notifyLocalViewChanges(n)];case 2:o.sent();return[2]}}))}))};e.prototype.assertSubscribed=function(e){d(this.syncEngineListener!==null,"Trying to call "+e+" before calling subscribe().")};e.prototype.handleCredentialChange=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r;return F.__generator(this,(function(n){switch(n.label){case 0:t=!this.currentUser.isEqual(e);this.currentUser=e;if(!t)return[3,3];this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change.");return[4,this.localStore.handleUserChange(e)];case 1:r=n.sent();this.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds);return[4,this.emitNewSnapsAndNotifyLocalStore(r.affectedDocuments)];case 2:n.sent();n.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:n.sent();return[2]}}))}))};e.prototype.applyPrimaryState=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r,n,i,a,o,s;var u=this;return F.__generator(this,(function(c){switch(c.label){case 0:if(!(e===true&&this.isPrimary!==true))return[3,3];this.isPrimary=true;return[4,this.remoteStore.applyPrimaryState(true)];case 1:c.sent();t=this.sharedClientState.getAllActiveQueryTargets();return[4,this.synchronizeQueryViewsAndRaiseSnapshots(t.toArray())];case 2:r=c.sent();for(n=0,i=r;n<i.length;n++){a=i[n];this.remoteStore.listen(a)}return[3,7];case 3:if(!(e===false&&this.isPrimary!==false))return[3,7];this.isPrimary=false;o=[];s=Promise.resolve();_(this.queryViewsByTarget,(function(e,t){if(u.sharedClientState.isLocalQueryTarget(e)){o.push(e)}else{s=s.then((function(){return u.unlisten(t.query)}))}u.remoteStore.unlisten(t.targetId)}));return[4,s];case 4:c.sent();return[4,this.synchronizeQueryViewsAndRaiseSnapshots(o)];case 5:c.sent();this.resetLimboDocuments();return[4,this.remoteStore.applyPrimaryState(false)];case 6:c.sent();c.label=7;case 7:return[2]}}))}))};e.prototype.resetLimboDocuments=function(){var e=this;_(this.limboResolutionsByTarget,(function(t){e.remoteStore.unlisten(t)}));this.limboDocumentRefs.removeAllReferences();this.limboResolutionsByTarget=[];this.limboTargetsByKey=new Me(ye.comparator)};e.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(e){return F.__awaiter(this,void 0,void 0,(function(){var t,r,n,i,a,o,s,u,c;return F.__generator(this,(function(l){switch(l.label){case 0:t=[];r=[];n=0,i=e;l.label=1;case 1:if(!(n<i.length))return[3,11];a=i[n];o=void 0;s=this.queryViewsByTarget[a];if(!s)return[3,5];return[4,this.localStore.releaseQuery(s.query,true)];case 2:l.sent();return[4,this.localStore.allocateQuery(s.query)];case 3:o=l.sent();return[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:u=l.sent();if(u.snapshot){r.push(u.snapshot)}return[3,9];case 5:d(this.isPrimary===true,"A secondary tab should never have an active query without an active view.");return[4,this.localStore.getQueryForTarget(a)];case 6:c=l.sent();d(!!c,"Query data for target "+a+" not found");return[4,this.localStore.allocateQuery(c)];case 7:o=l.sent();return[4,this.initializeViewAndComputeSnapshot(o,false)];case 8:l.sent();l.label=9;case 9:t.push(o);l.label=10;case 10:n++;return[3,1];case 11:this.syncEngineListener.onWatchChange(r);return[2,t]}}))}))};e.prototype.getActiveClients=function(){return this.localStore.getActiveClients()};e.prototype.applyTargetState=function(e,t,r){return F.__awaiter(this,void 0,void 0,(function(){var n,i,a,o,s,u;return F.__generator(this,(function(l){switch(l.label){case 0:if(this.isPrimary){c(Ta,"Ignoring unexpected query state notification.");return[2]}if(!this.queryViewsByTarget[e])return[3,11];n=t;switch(n){case"current":return[3,1];case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:l.trys.push([1,4,,8]);return[4,this.localStore.getNewDocumentChanges()];case 2:i=l.sent();a=Ci.createSynthesizedRemoteEventForCurrentChange(e,t==="current");return[4,this.emitNewSnapsAndNotifyLocalStore(i,a)];case 3:l.sent();return[3,11];case 4:o=l.sent();if(!ur(o))return[3,6];s=[];_(this.queryViewsByTarget,(function(e){return s.push(e)}));return[4,this.synchronizeQueryViewsAndRaiseSnapshots(s)];case 5:l.sent();return[3,7];case 6:throw o;case 7:return[3,8];case 8:u=this.queryViewsByTarget[e];this.removeAndCleanupQuery(u);return[4,this.localStore.releaseQuery(u.query,true)];case 9:l.sent();this.syncEngineListener.onWatchError(u.query,r);return[3,11];case 10:h("Unexpected target state: "+t);l.label=11;case 11:return[2]}}))}))};e.prototype.applyActiveTargetsChange=function(e,t){return F.__awaiter(this,void 0,void 0,(function(){var r,n,i,a,o,s,u,c,l,i;var f=this;return F.__generator(this,(function(h){switch(h.label){case 0:if(!this.isPrimary){return[2]}r=0,n=e;h.label=1;case 1:if(!(r<n.length))return[3,6];i=n[r];d(!this.queryViewsByTarget[i],"Trying to add an already active target");return[4,this.localStore.getQueryForTarget(i)];case 2:a=h.sent();d(!!a,"Query data for active target "+i+" not found");return[4,this.localStore.allocateQuery(a)];case 3:o=h.sent();return[4,this.initializeViewAndComputeSnapshot(o,false)];case 4:h.sent();this.remoteStore.listen(o);h.label=5;case 5:r++;return[3,1];case 6:s=function(e){var t;return F.__generator(this,(function(r){switch(r.label){case 0:t=u.queryViewsByTarget[e];if(!t)return[3,2];return[4,u.localStore.releaseQuery(t.query,false).then((function(){f.remoteStore.unlisten(e);f.removeAndCleanupQuery(t)})).catch(Sn)];case 1:r.sent();r.label=2;case 2:return[2]}}))};u=this;c=0,l=t;h.label=7;case 7:if(!(c<l.length))return[3,10];i=l[c];return[5,s(i)];case 8:h.sent();h.label=9;case 9:c++;return[3,7];case 10:return[2]}}))}))};e.prototype.enableNetwork=function(){this.localStore.setNetworkEnabled(true);return this.remoteStore.enableNetwork()};e.prototype.disableNetwork=function(){this.localStore.setNetworkEnabled(false);return this.remoteStore.disableNetwork()};e.prototype.getRemoteKeysForTarget=function(e){var t=this.limboResolutionsByTarget[e];if(t&&t.receivedDocument){return Ke().add(t.key)}else{return this.queryViewsByTarget[e]?this.queryViewsByTarget[e].view.syncedDocuments:Ke()}};return e}();var Aa=function(){function e(e){this.uid=e}e.prototype.isAuthenticated=function(){return this.uid!=null};e.prototype.toKey=function(){if(this.isAuthenticated()){return"uid:"+this.uid}else{return"anonymous-user"}};e.prototype.isEqual=function(e){return e.uid===this.uid};e.UNAUTHENTICATED=new e(null);e.GOOGLE_CREDENTIALS=new e("google-credentials-uid");e.FIRST_PARTY=new e("first-party-uid");return e}();var Na="SharedClientState";var ka="firestore_clients";var Oa="firestore_mutations";var Ma="firestore_targets";var xa="firestore_online_state";var Pa="firestore_sequence_number";var Ra=function(){function e(e,t,r,n){this.user=e;this.batchId=t;this.state=r;this.error=n;d(n!==undefined===(r==="rejected"),"MutationMetadata must contain an error iff state is 'rejected'")}e.fromWebStorageEntry=function(t,r,n){var i=JSON.parse(n);var a=typeof i==="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===undefined||typeof i.error==="object");var o=undefined;if(a&&i.error){a=typeof i.error.message==="string"&&typeof i.error.code==="string";if(a){o=new y(i.error.code,i.error.message)}}if(a){return new e(t,r,i.state,o)}else{l(Na,"Failed to parse mutation state for ID '"+r+"': "+n);return null}};e.prototype.toWebStorageJSON=function(){var e={state:this.state,updateTimeMs:Date.now()};if(this.error){e.error={code:this.error.code,message:this.error.message}}return JSON.stringify(e)};return e}();var La=function(){function e(e,t,r){this.targetId=e;this.state=t;this.error=r;d(r!==undefined===(t==="rejected"),"QueryTargetMetadata must contain an error iff state is 'rejected'")}e.fromWebStorageEntry=function(t,r){var n=JSON.parse(r);var i=typeof n==="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===undefined||typeof n.error==="object");var a=undefined;if(i&&n.error){i=typeof n.error.message==="string"&&typeof n.error.code==="string";if(i){a=new y(n.error.code,n.error.message)}}if(i){return new e(t,n.state,a)}else{l(Na,"Failed to parse target state for ID '"+t+"': "+r);return null}};e.prototype.toWebStorageJSON=function(){var e={state:this.state,updateTimeMs:Date.now()};if(this.error){e.error={code:this.error.code,message:this.error.message}}return JSON.stringify(e)};return e}();var Fa=function(){function e(e,t){this.clientId=e;this.activeTargetIds=t}e.fromWebStorageEntry=function(t,r){var n=JSON.parse(r);var i=typeof n==="object"&&n.activeTargetIds instanceof Array;var a=He();for(var o=0;i&&o<n.activeTargetIds.length;++o){i=Hn(n.activeTargetIds[o]);a=a.add(n.activeTargetIds[o])}if(i){return new e(t,a)}else{l(Na,"Failed to parse client data for instance '"+t+"': "+r);return null}};return e}();var Va=function(){function e(e,t){this.clientId=e;this.onlineState=t}e.fromWebStorageEntry=function(t){var r=JSON.parse(t);var n=typeof r==="object"&&r.onlineState in ui&&typeof r.clientId==="string";if(n){return new e(r.clientId,ui[r.onlineState])}else{l(Na,"Failed to parse online state: "+t);return null}};return e}();var qa=function(){function e(){this.activeTargetIds=He()}e.prototype.addQueryTarget=function(e){d(!this.activeTargetIds.has(e),"Target with ID '"+e+"' already active.");this.activeTargetIds=this.activeTargetIds.add(e)};e.prototype.removeQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.delete(e)};e.prototype.toWebStorageJSON=function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)};return e}();var ja=function(){function e(t,r,n,i,a){this.queue=t;this.platform=r;this.persistenceKey=n;this.localClientId=i;this.syncEngine=null;this.onlineStateHandler=null;this.sequenceNumberHandler=null;this.activeClients={};this.storageListener=this.handleWebStorageEvent.bind(this);this.started=false;this.earlyEvents=[];if(!e.isAvailable(this.platform)){throw new y(m.UNIMPLEMENTED,"LocalStorage is not available on this platform.")}var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage;this.currentUser=a;this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId);this.sequenceNumberKey=Pa+"_"+n;this.activeClients[this.localClientId]=new qa;this.clientStateKeyRe=new RegExp("^"+ka+"_"+o+"_([^_]*)$");this.mutationBatchKeyRe=new RegExp("^"+Oa+"_"+o+"_(\\d+)(?:_(.*))?$");this.queryTargetKeyRe=new RegExp("^"+Ma+"_"+o+"_(\\d+)$");this.onlineStateKey=xa+"_"+n;this.platform.window.addEventListener("storage",this.storageListener)}e.isAvailable=function(e){return!!(e.window&&e.window.localStorage!=null)};e.prototype.start=function(){return F.__awaiter(this,void 0,void 0,(function(){var e,t,r,n,i,a,o,s,u,c,l;var f=this;return F.__generator(this,(function(h){switch(h.label){case 0:d(!this.started,"WebStorageSharedClientState already started");d(this.syncEngine!==null,"syncEngine property must be set before calling start()");d(this.onlineStateHandler!==null,"onlineStateHandler property must be set before calling start()");return[4,this.syncEngine.getActiveClients()];case 1:e=h.sent();for(t=0,r=e;t<r.length;t++){n=r[t];if(n===this.localClientId){continue}i=this.getItem(this.toWebStorageClientStateKey(n));if(i){a=Fa.fromWebStorageEntry(n,i);if(a){this.activeClients[a.clientId]=a}}}this.persistClientState();o=this.storage.getItem(this.onlineStateKey);if(o){s=this.fromWebStorageOnlineState(o);if(s){this.handleOnlineStateEvent(s)}}for(u=0,c=this.earlyEvents;u<c.length;u++){l=c[u];this.handleWebStorageEvent(l)}this.earlyEvents=[];this.platform.window.addEventListener("unload",(function(){return f.shutdown()}));this.started=true;return[2]}}))}))};e.prototype.writeSequenceNumber=function(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))};e.prototype.getAllActiveQueryTargets=function(){var e=He();E(this.activeClients,(function(t,r){e=e.unionWith(r.activeTargetIds)}));return e};e.prototype.isActiveQueryTarget=function(e){for(var t in this.activeClients){if(this.activeClients.hasOwnProperty(t)){if(this.activeClients[t].activeTargetIds.has(e)){return true}}}return false};e.prototype.addPendingMutation=function(e){this.persistMutationState(e,"pending")};e.prototype.updateMutationState=function(e,t,r){this.persistMutationState(e,t,r);this.removeMutationState(e)};e.prototype.addLocalQueryTarget=function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var r=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(e));if(r){var n=La.fromWebStorageEntry(e,r);if(n){t=n.state}}}this.localClientState.addQueryTarget(e);this.persistClientState();return t};e.prototype.removeLocalQueryTarget=function(e){this.localClientState.removeQueryTarget(e);this.persistClientState()};e.prototype.isLocalQueryTarget=function(e){return this.localClientState.activeTargetIds.has(e)};e.prototype.clearQueryState=function(e){this.removeItem(this.toWebStorageQueryTargetMetadataKey(e))};e.prototype.updateQueryState=function(e,t,r){this.persistQueryTargetState(e,t,r)};e.prototype.handleUserChange=function(e,t,r){var n=this;t.forEach((function(e){n.removeMutationState(e)}));this.currentUser=e;r.forEach((function(e){n.addPendingMutation(e)}))};e.prototype.setOnlineState=function(e){this.persistOnlineState(e)};e.prototype.shutdown=function(){if(this.started){this.platform.window.removeEventListener("storage",this.storageListener);this.removeItem(this.localClientStorageKey);this.started=false}};e.prototype.getItem=function(e){var t=this.storage.getItem(e);c(Na,"READ",e,t);return t};e.prototype.setItem=function(e,t){c(Na,"SET",e,t);this.storage.setItem(e,t)};e.prototype.removeItem=function(e){c(Na,"REMOVE",e);this.storage.removeItem(e)};e.prototype.handleWebStorageEvent=function(e){var t=this;if(e.storageArea===this.storage){c(Na,"EVENT",e.key,e.newValue);if(e.key===this.localClientStorageKey){l("Received WebStorage notification for local change. Another client might have "+"garbage-collected our state");return}this.queue.enqueueAndForget((function(){return F.__awaiter(t,void 0,void 0,(function(){var t,r,n,i,a,o;return F.__generator(this,(function(s){if(!this.started){this.earlyEvents.push(e);return[2]}if(e.key===null){return[2]}if(this.clientStateKeyRe.test(e.key)){if(e.newValue!=null){t=this.fromWebStorageClientState(e.key,e.newValue);if(t){return[2,this.handleClientStateEvent(t.clientId,t)]}}else{r=this.fromWebStorageClientStateKey(e.key);return[2,this.handleClientStateEvent(r,null)]}}else if(this.mutationBatchKeyRe.test(e.key)){if(e.newValue!==null){n=this.fromWebStorageMutationMetadata(e.key,e.newValue);if(n){return[2,this.handleMutationBatchEvent(n)]}}}else if(this.queryTargetKeyRe.test(e.key)){if(e.newValue!==null){i=this.fromWebStorageQueryTargetMetadata(e.key,e.newValue);if(i){return[2,this.handleQueryTargetEvent(i)]}}}else if(e.key===this.onlineStateKey){if(e.newValue!==null){a=this.fromWebStorageOnlineState(e.newValue);if(a){return[2,this.handleOnlineStateEvent(a)]}}}else if(e.key===this.sequenceNumberKey){d(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler");o=Ba(e.newValue);if(o!==fe.INVALID){this.sequenceNumberHandler(o)}}return[2]}))}))}))}};Object.defineProperty(e.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:true,configurable:true});e.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())};e.prototype.persistMutationState=function(e,t,r){var n=new Ra(this.currentUser,e,t,r);var i=this.toWebStorageMutationBatchKey(e);this.setItem(i,n.toWebStorageJSON())};e.prototype.removeMutationState=function(e){var t=this.toWebStorageMutationBatchKey(e);this.removeItem(t)};e.prototype.persistOnlineState=function(e){var t={clientId:this.localClientId,onlineState:ui[e]};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))};e.prototype.persistQueryTargetState=function(e,t,r){var n=this.toWebStorageQueryTargetMetadataKey(e);var i=new La(e,t,r);this.setItem(n,i.toWebStorageJSON())};e.prototype.toWebStorageClientStateKey=function(e){d(e.indexOf("_")===-1,"Client key cannot contain '_', but was '"+e+"'");return ka+"_"+this.persistenceKey+"_"+e};e.prototype.toWebStorageQueryTargetMetadataKey=function(e){return Ma+"_"+this.persistenceKey+"_"+e};e.prototype.toWebStorageMutationBatchKey=function(e){var t=Oa+"_"+this.persistenceKey+"_"+e;if(this.currentUser.isAuthenticated()){t+="_"+this.currentUser.uid}return t};e.prototype.fromWebStorageClientStateKey=function(e){var t=this.clientStateKeyRe.exec(e);return t?t[1]:null};e.prototype.fromWebStorageClientState=function(e,t){var r=this.fromWebStorageClientStateKey(e);d(r!==null,"Cannot parse client state key '"+e+"'");return Fa.fromWebStorageEntry(r,t)};e.prototype.fromWebStorageMutationMetadata=function(e,t){var r=this.mutationBatchKeyRe.exec(e);d(r!==null,"Cannot parse mutation batch key '"+e+"'");var n=Number(r[1]);var i=r[2]!==undefined?r[2]:null;return Ra.fromWebStorageEntry(new Aa(i),n,t)};e.prototype.fromWebStorageQueryTargetMetadata=function(e,t){var r=this.queryTargetKeyRe.exec(e);d(r!==null,"Cannot parse query target key '"+e+"'");var n=Number(r[1]);return La.fromWebStorageEntry(n,t)};e.prototype.fromWebStorageOnlineState=function(e){return Va.fromWebStorageEntry(e)};e.prototype.handleMutationBatchEvent=function(e){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(t){if(e.user.uid!==this.currentUser.uid){c(Na,"Ignoring mutation for non-active user "+e.user.uid);return[2]}return[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]}))}))};e.prototype.handleQueryTargetEvent=function(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)};e.prototype.handleClientStateEvent=function(e,t){var r=this;var n=this.getAllActiveQueryTargets();if(t){this.activeClients[e]=t}else{delete this.activeClients[e]}var i=this.getAllActiveQueryTargets();var a=[];var o=[];i.forEach((function(e){return F.__awaiter(r,void 0,void 0,(function(){return F.__generator(this,(function(t){if(!n.has(e)){a.push(e)}return[2]}))}))}));n.forEach((function(e){return F.__awaiter(r,void 0,void 0,(function(){return F.__generator(this,(function(t){if(!i.has(e)){o.push(e)}return[2]}))}))}));return this.syncEngine.applyActiveTargetsChange(a,o)};e.prototype.handleOnlineStateEvent=function(e){if(this.activeClients[e.clientId]){this.onlineStateHandler(e.onlineState)}};return e}();function Ba(e){var t=fe.INVALID;if(e!=null){try{var r=JSON.parse(e);d(typeof r==="number","Found non-numeric sequence number");t=r}catch(e){l(Na,"Failed to read sequence number from WebStorage",e)}}return t}var Ua=function(){function e(){this.localState=new qa;this.queryState={};this.syncEngine=null;this.onlineStateHandler=null;this.sequenceNumberHandler=null}e.prototype.addPendingMutation=function(e){};e.prototype.updateMutationState=function(e,t,r){};e.prototype.addLocalQueryTarget=function(e){this.localState.addQueryTarget(e);return this.queryState[e]||"not-current"};e.prototype.updateQueryState=function(e,t,r){this.queryState[e]=t};e.prototype.removeLocalQueryTarget=function(e){this.localState.removeQueryTarget(e)};e.prototype.isLocalQueryTarget=function(e){return this.localState.activeTargetIds.has(e)};e.prototype.clearQueryState=function(e){delete this.queryState[e]};e.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds};e.prototype.isActiveQueryTarget=function(e){return this.localState.activeTargetIds.has(e)};e.prototype.start=function(){this.localState=new qa;return Promise.resolve()};e.prototype.handleUserChange=function(e,t,r){};e.prototype.setOnlineState=function(e){};e.prototype.shutdown=function(){};e.prototype.writeSequenceNumber=function(e){};return e}();var Wa="FirestoreClient";var za=11;var Qa=20;var Ka=22;var Ga=function(){function e(e,t){this.cacheSizeBytes=e;this.synchronizeTabs=t}e.prototype.lruParams=function(){return an.withCacheSize(this.cacheSizeBytes)};return e}();var Ha=function(){function e(){}return e}();var Ya=function(){function e(e,t,r,n){this.platform=e;this.databaseInfo=t;this.credentials=r;this.asyncQueue=n;this.clientId=Z.newId()}e.prototype.start=function(e){var t=this;this.verifyNotTerminated();var r=new ge;var n=new ge;var i=false;this.credentials.setChangeListener((function(a){if(!i){i=true;t.initializePersistence(e,n,a).then((function(e){return t.initializeRest(a,e)})).then(r.resolve,r.reject)}else{t.asyncQueue.enqueueAndForget((function(){return t.handleCredentialChange(a)}))}}));this.asyncQueue.enqueueAndForget((function(){return r.promise}));return n.promise};e.prototype.enableNetwork=function(){var e=this;this.verifyNotTerminated();return this.asyncQueue.enqueue((function(){return e.syncEngine.enableNetwork()}))};e.prototype.initializePersistence=function(e,t,r){var n=this;if(e instanceof Ga){return this.startIndexedDbPersistence(r,e).then((function(e){t.resolve();return e})).catch((function(e){t.reject(e);if(!n.canFallback(e)){throw e}console.warn("Error enabling offline persistence. Falling back to"+" persistence disabled: "+e);return n.startMemoryPersistence()}))}else{t.resolve();return this.startMemoryPersistence()}};e.prototype.canFallback=function(e){if(e instanceof y){return e.code===m.FAILED_PRECONDITION||e.code===m.UNIMPLEMENTED}else if(typeof DOMException!=="undefined"&&e instanceof DOMException){return e.code===Ka||e.code===Qa||e.code===za}return true};e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown){throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}};e.prototype.startIndexedDbPersistence=function(e,t){var r=this;var n=wn.buildStoragePrefix(this.databaseInfo);var i=new da(this.databaseInfo.databaseId,{useProto3Json:true});return Promise.resolve().then((function(){return F.__awaiter(r,void 0,void 0,(function(){var r,a;return F.__generator(this,(function(o){switch(o.label){case 0:if(t.synchronizeTabs&&!ja.isAvailable(this.platform)){throw new y(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.")}r=t.lruParams();this.sharedClientState=t.synchronizeTabs?new ja(this.asyncQueue,this.platform,n,this.clientId,e):new Ua;return[4,wn.createIndexedDbPersistence({allowTabSynchronization:t.synchronizeTabs,persistenceKey:n,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:i,lruParams:r,sequenceNumberSyncer:this.sharedClientState})];case 1:a=o.sent();this.persistence=a;return[2,a.referenceDelegate.garbageCollector]}}))}))}))};e.prototype.startMemoryPersistence=function(){this.persistence=qn.createEagerPersistence(this.clientId);this.sharedClientState=new Ua;return Promise.resolve(null)};e.prototype.initializeRest=function(e,t){var r=this;c(Wa,"Initializing. user=",e.uid);return this.platform.loadConnection(this.databaseInfo).then((function(n){return F.__awaiter(r,void 0,void 0,(function(){var r,i,a,o,s;var u=this;return F.__generator(this,(function(c){switch(c.label){case 0:this.localStore=new xn(this.persistence,e);if(t){this.lruScheduler=new un(t,this.asyncQueue,this.localStore)}r=this.platform.newConnectivityMonitor();i=this.platform.newSerializer(this.databaseInfo.databaseId);a=new oi(this.asyncQueue,n,this.credentials,i);o=function(e){return u.syncEngine.applyOnlineStateChange(e,ci.RemoteStore)};s=function(e){return u.syncEngine.applyOnlineStateChange(e,ci.SharedClientState)};this.remoteStore=new ji(this.localStore,a,this.asyncQueue,o,r);this.syncEngine=new Ca(this.localStore,this.remoteStore,this.sharedClientState,e);this.sharedClientState.onlineStateHandler=s;this.remoteStore.syncEngine=this.syncEngine;this.sharedClientState.syncEngine=this.syncEngine;this.eventMgr=new va(this.syncEngine);return[4,this.sharedClientState.start()];case 1:c.sent();return[4,this.remoteStore.start()];case 2:c.sent();return[4,this.persistence.setPrimaryStateListener((function(e){return F.__awaiter(u,void 0,void 0,(function(){return F.__generator(this,(function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:t.sent();if(this.lruScheduler){if(e&&!this.lruScheduler.started){this.lruScheduler.start()}else if(!e){this.lruScheduler.stop()}}return[2]}}))}))}))];case 3:c.sent();return[4,this.persistence.setDatabaseDeletedListener((function(){return F.__awaiter(u,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:return[4,this.terminate()];case 1:e.sent();return[2]}}))}))}))];case 4:c.sent();return[2]}}))}))}))};e.prototype.handleCredentialChange=function(e){this.asyncQueue.verifyOperationInProgress();c(Wa,"Credential Changed. Current user: "+e.uid);return this.syncEngine.handleCredentialChange(e)};e.prototype.disableNetwork=function(){var e=this;this.verifyNotTerminated();return this.asyncQueue.enqueue((function(){return e.syncEngine.disableNetwork()}))};e.prototype.terminate=function(){var e=this;return this.asyncQueue.enqueueAndInitiateShutdown((function(){return F.__awaiter(e,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:if(this.lruScheduler){this.lruScheduler.stop()}return[4,this.remoteStore.shutdown()];case 1:e.sent();return[4,this.sharedClientState.shutdown()];case 2:e.sent();return[4,this.persistence.shutdown()];case 3:e.sent();this.credentials.removeChangeListener();return[2]}}))}))}))};e.prototype.waitForPendingWrites=function(){var e=this;this.verifyNotTerminated();var t=new ge;this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.registerPendingWritesCallback(t)}));return t.promise};e.prototype.listen=function(e,t,r){var n=this;this.verifyNotTerminated();var i=new ma(e,t,r);this.asyncQueue.enqueueAndForget((function(){return n.eventMgr.listen(i)}));return i};e.prototype.unlisten=function(e){var t=this;if(this.clientTerminated){return}this.asyncQueue.enqueueAndForget((function(){return t.eventMgr.unlisten(e)}))};e.prototype.getDocumentFromLocalCache=function(e){var t=this;this.verifyNotTerminated();return this.asyncQueue.enqueue((function(){return t.localStore.readDocument(e)})).then((function(e){if(e instanceof er){return e}else if(e instanceof tr){return null}else{throw new y(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may "+"exist on the server. Run again without setting 'source' in "+"the GetOptions to attempt to retrieve the document from the "+"server.)")}}))};e.prototype.getDocumentsFromLocalCache=function(e){var t=this;this.verifyNotTerminated();return this.asyncQueue.enqueue((function(){return t.localStore.executeQuery(e)})).then((function(t){var r=Ke();var n=new wa(e,r);var i=n.computeDocChanges(t);return n.applyChanges(i,false).snapshot}))};e.prototype.write=function(e){var t=this;this.verifyNotTerminated();var r=new ge;this.asyncQueue.enqueueAndForget((function(){return t.syncEngine.write(e,r)}));return r.promise};e.prototype.databaseId=function(){return this.databaseInfo.databaseId};e.prototype.addSnapshotsInSyncListener=function(e){var t=this;this.verifyNotTerminated();this.asyncQueue.enqueueAndForget((function(){t.eventMgr.addSnapshotsInSyncListener(e);return Promise.resolve()}))};e.prototype.removeSnapshotsInSyncListener=function(e){if(this.clientTerminated){return}this.eventMgr.removeSnapshotsInSyncListener(e)};Object.defineProperty(e.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:true,configurable:true});e.prototype.transaction=function(e){var t=this;this.verifyNotTerminated();var r=new ge;this.asyncQueue.enqueueAndForget((function(){t.syncEngine.runTransaction(t.asyncQueue,e,r);return Promise.resolve()}));return r.promise};return e}();var $a=function(){function e(e){this.observer=e;this.muted=false}e.prototype.next=function(e){this.scheduleEvent(this.observer.next,e)};e.prototype.error=function(e){this.scheduleEvent(this.observer.error,e)};e.prototype.mute=function(){this.muted=true};e.prototype.scheduleEvent=function(e,t){var r=this;if(!this.muted){setTimeout((function(){if(!r.muted){e(t)}}),0)}};return e}();var Xa=function(){function e(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}k("FieldPath",e,"fieldNames",1);for(var r=0;r<e.length;++r){O("FieldPath","string",r,e[r]);if(e[r].length===0){throw new y(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). "+"Field names must not be empty.")}}this._internalPath=new me(e)}e.documentId=function(){return e._DOCUMENT_ID};e.prototype.isEqual=function(t){if(!(t instanceof e)){throw $("isEqual","FieldPath",1,t)}return this._internalPath.isEqual(t._internalPath)};e._DOCUMENT_ID=new e(me.keyField().canonicalString());return e}();var Ja=new RegExp("[~\\*/\\[\\]]");function Za(e){var t=e.search(Ja);if(t>=0){throw new y(m.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain "+"'~', '*', '/', '[', or ']'")}try{return new(Xa.bind.apply(Xa,[void 0].concat(e.split("."))))}catch(t){throw new y(m.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, "+"begin with '.', end with '.', or contain '..'")}}var eo=function(){function e(e,t){this.user=t;this.type="OAuth";this.authHeaders={Authorization:"Bearer "+e}}return e}();var to=function(){function e(){this.changeListener=null}e.prototype.getToken=function(){return Promise.resolve(null)};e.prototype.invalidateToken=function(){};e.prototype.setChangeListener=function(e){d(!this.changeListener,"Can only call setChangeListener() once.");this.changeListener=e;e(Aa.UNAUTHENTICATED)};e.prototype.removeChangeListener=function(){d(this.changeListener!==null,"removeChangeListener() when no listener registered");this.changeListener=null};return e}();var ro=function(){function e(e){var t=this;this.app=e;this.tokenListener=null;this.currentUser=Aa.UNAUTHENTICATED;this.tokenCounter=0;this.changeListener=null;this.forceRefresh=false;this.tokenListener=function(){t.tokenCounter++;t.currentUser=t.getUser();if(t.changeListener){t.changeListener(t.currentUser)}};this.currentUser=this.getUser();this.tokenCounter=0;this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}e.prototype.getToken=function(){var e=this;d(this.tokenListener!=null,"getToken cannot be called after listener removed.");var t=this.tokenCounter;var r=this.forceRefresh;this.forceRefresh=false;return this.app.INTERNAL.getToken(r).then((function(r){if(e.tokenCounter!==t){throw new y(m.ABORTED,"getToken aborted due to token change.")}else{if(r){d(typeof r.accessToken==="string","Invalid tokenData returned from getToken():"+r);return new eo(r.accessToken,e.currentUser)}else{return null}}}))};e.prototype.invalidateToken=function(){this.forceRefresh=true};e.prototype.setChangeListener=function(e){d(!this.changeListener,"Can only call setChangeListener() once.");this.changeListener=e;e(this.currentUser)};e.prototype.removeChangeListener=function(){d(this.tokenListener!=null,"removeChangeListener() called twice");d(this.changeListener!==null,"removeChangeListener() called when no listener registered");this.app.INTERNAL.removeAuthTokenListener(this.tokenListener);this.tokenListener=null;this.changeListener=null};e.prototype.getUser=function(){var e=this.app.INTERNAL.getUid();d(e===null||typeof e==="string","Received invalid UID: "+e);return new Aa(e)};return e}();var no=function(){function e(e,t){this.gapi=e;this.sessionIndex=t;this.type="FirstParty";this.user=Aa.FIRST_PARTY}Object.defineProperty(e.prototype,"authHeaders",{get:function(){var e={"X-Goog-AuthUser":this.sessionIndex};var t=this.gapi.auth.getAuthHeaderValueForFirstParty([]);if(t){e["Authorization"]=t}return e},enumerable:true,configurable:true});return e}();var io=function(){function e(e,t){this.gapi=e;this.sessionIndex=t}e.prototype.getToken=function(){return Promise.resolve(new no(this.gapi,this.sessionIndex))};e.prototype.setChangeListener=function(e){e(Aa.FIRST_PARTY)};e.prototype.removeChangeListener=function(){};e.prototype.invalidateToken=function(){};return e}();function ao(e){if(!e){return new to}switch(e.type){case"gapi":var t=e.client;d(!!(typeof t==="object"&&t!==null&&t["auth"]&&t["auth"]["getAuthHeaderValueForFirstParty"]),"unexpected gapi interface");return new io(t,e.sessionIndex||"0");case"provider":return e.client;default:throw new y(m.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}function oo(e){return so(e,["next","error","complete"])}function so(e,t){if(typeof e!=="object"||e===null){return false}var r=e;for(var n=0,i=t;n<i.length;n++){var a=i[n];if(a in r&&typeof r[a]==="function"){return true}}return false}var uo=function(){function e(e){this._methodName=e}e.delete=function(){D("FieldValue.delete",arguments);return co.instance};e.serverTimestamp=function(){D("FieldValue.serverTimestamp",arguments);return lo.instance};e.arrayUnion=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}A("FieldValue.arrayUnion",arguments,1);return new fo(e)};e.arrayRemove=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}A("FieldValue.arrayRemove",arguments,1);return new ho(e)};e.increment=function(e){O("FieldValue.increment","number",1,e);C("FieldValue.increment",arguments,1);return new po(e)};e.prototype.isEqual=function(e){return this===e};return e}();var co=function(e){F.__extends(t,e);function t(){return e.call(this,"FieldValue.delete")||this}t.instance=new t;return t}(uo);var lo=function(e){F.__extends(t,e);function t(){return e.call(this,"FieldValue.serverTimestamp")||this}t.instance=new t;return t}(uo);var fo=function(e){F.__extends(t,e);function t(t){var r=e.call(this,"FieldValue.arrayUnion")||this;r._elements=t;return r}return t}(uo);var ho=function(e){F.__extends(t,e);function t(t){var r=e.call(this,"FieldValue.arrayRemove")||this;r._elements=t;return r}return t}(uo);var po=function(e){F.__extends(t,e);function t(t){var r=e.call(this,"FieldValue.increment")||this;r._operand=t;return r}return t}(uo);var vo=g(uo,"Use FieldValue.<field>() instead.");var mo=/^__.*__$/;var yo=function(){function e(e,t,r){this.data=e;this.fieldMask=t;this.fieldTransforms=r}e.prototype.toMutations=function(e,t){var r=[];if(this.fieldMask!==null){r.push(new Ot(e,this.data,this.fieldMask,t))}else{r.push(new kt(e,this.data,t))}if(this.fieldTransforms.length>0){r.push(new Mt(e,this.fieldTransforms))}return r};return e}();var go=function(){function e(e,t,r){this.data=e;this.fieldMask=t;this.fieldTransforms=r}e.prototype.toMutations=function(e,t){var r=[new Ot(e,this.data,this.fieldMask,t)];if(this.fieldTransforms.length>0){r.push(new Mt(e,this.fieldTransforms))}return r};return e}();var bo;(function(e){e[e["Set"]=0]="Set";e[e["Update"]=1]="Update";e[e["MergeSet"]=2]="MergeSet";e[e["Argument"]=3]="Argument"})(bo||(bo={}));function wo(e){switch(e){case bo.Set:case bo.MergeSet:case bo.Update:return true;case bo.Argument:return false;default:throw h("Unexpected case for UserDataSource: "+e)}}var _o=function(){function e(e,t,r,n,i,a){this.dataSource=e;this.methodName=t;this.path=r;this.arrayElement=n;if(i===undefined){this.validatePath()}this.arrayElement=n!==undefined?n:false;this.fieldTransforms=i||[];this.fieldMask=a||[]}e.prototype.childContextForField=function(t){var r=this.path==null?null:this.path.child(t);var n=new e(this.dataSource,this.methodName,r,false,this.fieldTransforms,this.fieldMask);n.validatePathSegment(t);return n};e.prototype.childContextForFieldPath=function(t){var r=this.path==null?null:this.path.child(t);var n=new e(this.dataSource,this.methodName,r,false,this.fieldTransforms,this.fieldMask);n.validatePath();return n};e.prototype.childContextForArray=function(t){return new e(this.dataSource,this.methodName,null,true,this.fieldTransforms,this.fieldMask)};e.prototype.createError=function(e){var t=this.path===null||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new y(m.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+e+t)};e.prototype.contains=function(e){return this.fieldMask.find((function(t){return e.isPrefixOf(t)}))!==undefined||this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))!==undefined};e.prototype.validatePath=function(){if(this.path===null){return}for(var e=0;e<this.path.length;e++){this.validatePathSegment(this.path.get(e))}};e.prototype.validatePathSegment=function(e){if(wo(this.dataSource)&&mo.test(e)){throw this.createError("Document fields cannot begin and end with __")}};return e}();var So=function(){function e(e,t){this.databaseId=e;this.key=t}return e}();var Eo=function(){function e(e){this.preConverter=e}e.prototype.parseSetData=function(e,t){var r=new _o(bo.Set,e,me.EMPTY_PATH);Io("Data must be an object, but it was:",r,t);var n=this.parseData(t,r);return new yo(n,null,r.fieldTransforms)};e.prototype.parseMergeData=function(e,t,r){var n=new _o(bo.MergeSet,e,me.EMPTY_PATH);Io("Data must be an object, but it was:",n,t);var i=this.parseData(t,n);var a;var o;if(!r){a=Tt.fromArray(n.fieldMask);o=n.fieldTransforms}else{var s=new Le(me.comparator);for(var u=0,c=r;u<c.length;u++){var l=c[u];var f=void 0;if(l instanceof Xa){f=l._internalPath}else if(typeof l==="string"){f=Co(e,l)}else{throw h("Expected stringOrFieldPath to be a string or a FieldPath")}if(!n.contains(f)){throw new y(m.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.")}s=s.add(f)}a=Tt.fromSet(s);o=n.fieldTransforms.filter((function(e){return a.covers(e.field)}))}return new yo(i,a,o)};e.prototype.parseUpdateData=function(e,t){var r=this;var n=new _o(bo.Update,e,me.EMPTY_PATH);Io("Data must be an object, but it was:",n,t);var i=new Le(me.comparator);var a=Xt.EMPTY;E(t,(function(t,o){var s=Co(e,t);var u=n.childContextForFieldPath(s);o=r.runPreConverter(o,u);if(o instanceof co){i=i.add(s)}else{var c=r.parseData(o,u);if(c!=null){i=i.add(s);a=a.set(s,c)}}}));var o=Tt.fromSet(i);return new go(a,o,n.fieldTransforms)};e.prototype.parseUpdateVarargs=function(e,t,r,n){var i=new _o(bo.Update,e,me.EMPTY_PATH);var a=[Do(e,t)];var o=[r];if(n.length%2!==0){throw new y(m.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number "+"of arguments that alternate between field names and values.")}for(var s=0;s<n.length;s+=2){a.push(Do(e,n[s]));o.push(n[s+1])}var u=new Le(me.comparator);var c=Xt.EMPTY;for(var s=0;s<a.length;++s){var l=a[s];var f=i.childContextForFieldPath(l);var h=this.runPreConverter(o[s],f);if(h instanceof co){u=u.add(l)}else{var d=this.parseData(h,f);if(d!=null){u=u.add(l);c=c.set(l,d)}}}var p=Tt.fromSet(u);return new go(c,p,i.fieldTransforms)};e.prototype.parseQueryValue=function(e,t){var r=new _o(bo.Argument,e,me.EMPTY_PATH);var n=this.parseData(t,r);d(n!=null,"Parsed data should not be null.");d(r.fieldTransforms.length===0,"Field transforms should have been disallowed.");return n};e.prototype.runPreConverter=function(e,t){try{return this.preConverter(e)}catch(e){var r=Ao(e);throw t.createError(r)}};e.prototype.parseData=function(e,t){e=this.runPreConverter(e,t);if(To(e)){Io("Unsupported field value:",t,e);return this.parseObject(e,t)}else if(e instanceof uo){this.parseSentinelFieldValue(e,t);return null}else{if(t.path){t.fieldMask.push(t.path)}if(e instanceof Array){if(t.arrayElement){throw t.createError("Nested arrays are not supported")}return this.parseArray(e,t)}else{return this.parseScalarValue(e,t)}}};e.prototype.parseObject=function(e,t){var r=this;var n=new Me(ee);if(T(e)){if(t.path&&t.path.length>0){t.fieldMask.push(t.path)}}else{E(e,(function(e,i){var a=r.parseData(i,t.childContextForField(e));if(a!=null){n=n.insert(e,a)}}))}return new Xt(n)};e.prototype.parseArray=function(e,t){var r=[];var n=0;for(var i=0,a=e;i<a.length;i++){var o=a[i];var s=this.parseData(o,t.childContextForArray(n));if(s==null){s=Vt.INSTANCE}r.push(s);n++}return new Jt(r)};e.prototype.parseSentinelFieldValue=function(e,t){if(!wo(t.dataSource)){throw t.createError(e._methodName+"() can only be used with update() and set()")}if(t.path===null){throw t.createError(e._methodName+"() is not currently supported inside arrays")}if(e instanceof co){if(t.dataSource===bo.MergeSet){t.fieldMask.push(t.path)}else if(t.dataSource===bo.Update){d(t.path.length>0,"FieldValue.delete() at the top level should have already"+" been handled.");throw t.createError("FieldValue.delete() can only appear at the top level "+"of your update data")}else{throw t.createError("FieldValue.delete() cannot be used with set() unless you pass "+"{merge:true}")}}else if(e instanceof lo){t.fieldTransforms.push(new It(t.path,ra.instance))}else if(e instanceof fo){var r=this.parseArrayTransformElements(e._methodName,e._elements);var n=new na(r);t.fieldTransforms.push(new It(t.path,n))}else if(e instanceof ho){var r=this.parseArrayTransformElements(e._methodName,e._elements);var i=new ia(r);t.fieldTransforms.push(new It(t.path,i))}else if(e instanceof po){var a=this.parseQueryValue("FieldValue.increment",e._operand);var o=new aa(a);t.fieldTransforms.push(new It(t.path,o))}else{h("Unknown FieldValue type: "+e)}};e.prototype.parseScalarValue=function(e,t){if(e===null){return Vt.INSTANCE}else if(typeof e==="number"){if(Hn(e)){return new Wt(e)}else{return new zt(e)}}else if(typeof e==="boolean"){return qt.of(e)}else if(typeof e==="string"){return new Qt(e)}else if(e instanceof Date){return new Kt(ke.fromDate(e))}else if(e instanceof ke){return new Kt(new ke(e.seconds,Math.floor(e.nanoseconds/1e3)*1e3))}else if(e instanceof Bi){return new $t(e)}else if(e instanceof oe){return new Ht(e)}else if(e instanceof So){return new Yt(e.databaseId,e.key)}else{throw t.createError("Unsupported field value: "+z(e))}};e.prototype.parseArrayTransformElements=function(e,t){var r=this;return t.map((function(t,n){var i=new _o(bo.Argument,e,me.EMPTY_PATH);return r.parseData(t,i.childContextForArray(n))}))};return e}();function To(e){return typeof e==="object"&&e!==null&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof ke)&&!(e instanceof Bi)&&!(e instanceof oe)&&!(e instanceof So)&&!(e instanceof uo)}function Io(e,t,r){if(!To(r)||!W(r)){var n=z(r);if(n==="an object"){throw t.createError(e+" a custom object")}else{throw t.createError(e+" "+n)}}}function Do(e,t){if(t instanceof Xa){return t._internalPath}else if(typeof t==="string"){return Co(e,t)}else{var r="Field path arguments must be of type string or FieldPath.";throw new y(m.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+r)}}function Co(e,t){try{return Za(t)._internalPath}catch(t){var r=Ao(t);throw new y(m.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+r)}}function Ao(e){return e instanceof Error?e.message:e.toString()}var No="firestore.googleapis.com";var ko=true;var Oo=true;var Mo=false;var xo=an.COLLECTION_DISABLED;var Po=false;var Ro=function(){function e(e){if(e.host===undefined){if(e.ssl!==undefined){throw new y(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set")}this.host=No;this.ssl=ko}else{x("settings","non-empty string","host",e.host);this.host=e.host;P("settings","boolean","ssl",e.ssl);this.ssl=w(e.ssl,ko)}Y("settings",e,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]);P("settings","object","credentials",e.credentials);this.credentials=e.credentials;P("settings","boolean","timestampsInSnapshots",e.timestampsInSnapshots);if(e.timestampsInSnapshots===true){l("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now.")}else if(e.timestampsInSnapshots===false){l("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior.")}this.timestampsInSnapshots=w(e.timestampsInSnapshots,Oo);P("settings","number","cacheSizeBytes",e.cacheSizeBytes);if(e.cacheSizeBytes===undefined){this.cacheSizeBytes=an.DEFAULT_CACHE_SIZE_BYTES}else{if(e.cacheSizeBytes!==xo&&e.cacheSizeBytes<an.MINIMUM_CACHE_SIZE_BYTES){throw new y(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+an.MINIMUM_CACHE_SIZE_BYTES)}else{this.cacheSizeBytes=e.cacheSizeBytes}}P("settings","boolean","experimentalForceLongPolling",e.experimentalForceLongPolling);this.forceLongPolling=e.experimentalForceLongPolling===undefined?Mo:e.experimentalForceLongPolling}e.prototype.isEqual=function(e){return this.host===e.host&&this.ssl===e.ssl&&this.timestampsInSnapshots===e.timestampsInSnapshots&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.forceLongPolling===e.forceLongPolling};return e}();var Lo=function(){function e(t){var r=this;this._firebaseApp=null;this._queue=new _e;this.INTERNAL={delete:function(){return F.__awaiter(r,void 0,void 0,(function(){return F.__generator(this,(function(e){switch(e.label){case 0:this.ensureClientConfigured();return[4,this._firestoreClient.terminate()];case 1:e.sent();return[2]}}))}))}};if(typeof t.options==="object"){var n=t;this._firebaseApp=n;this._databaseId=e.databaseIdFromApp(n);this._persistenceKey=n.name;this._credentials=new ro(n)}else{var i=t;if(!i.projectId){throw new y(m.INVALID_ARGUMENT,"Must provide projectId")}this._databaseId=new le(i.projectId,i.database);this._persistenceKey="[DEFAULT]";this._credentials=new to}this._settings=new Ro({});this._dataConverter=this.createDataConverter(this._databaseId)}e.prototype.settings=function(e){C("Firestore.settings",arguments,1);O("Firestore.settings","object",1,e);if(b(e,"persistence")){throw new y(m.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to '+"firestore.enablePersistence().")}var t=new Ro(e);if(this._firestoreClient&&!this._settings.isEqual(t)){throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer "+"be changed. You can only call settings() before calling any other "+"methods on a Firestore object.")}this._settings=t;if(t.credentials!==undefined){this._credentials=ao(t.credentials)}};e.prototype.enableNetwork=function(){this.ensureClientConfigured();return this._firestoreClient.enableNetwork()};e.prototype.disableNetwork=function(){this.ensureClientConfigured();return this._firestoreClient.disableNetwork()};e.prototype.enablePersistence=function(e){if(this._firestoreClient){throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer "+"be enabled. You can only call enablePersistence() before calling "+"any other methods on a Firestore object.")}var t=false;if(e){if(e.experimentalTabSynchronization!==undefined){l("The 'experimentalTabSynchronization' setting has been renamed to "+"'synchronizeTabs'. In a future release, the setting will be removed "+"and it is recommended that you update your "+"firestore.enablePersistence() call to use 'synchronizeTabs'.")}t=w(e.synchronizeTabs!==undefined?e.synchronizeTabs:e.experimentalTabSynchronization,Po)}return this.configureClient(new Ga(this._settings.cacheSizeBytes,t))};e.prototype.clearPersistence=function(){var e=this;var t=wn.buildStoragePrefix(this.makeDatabaseInfo());var r=new ge;this._queue.enqueueAndForgetEvenAfterShutdown((function(){return F.__awaiter(e,void 0,void 0,(function(){var e;return F.__generator(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);if(this._firestoreClient!==undefined&&!this._firestoreClient.clientTerminated){throw new y(m.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.")}return[4,wn.clearPersistence(t)];case 1:n.sent();r.resolve();return[3,3];case 2:e=n.sent();r.reject(e);return[3,3];case 3:return[2]}}))}))}));return r.promise};e.prototype.terminate=function(){this.app._removeServiceInstance("firestore");return this.INTERNAL.delete()};Object.defineProperty(e.prototype,"_isTerminated",{get:function(){this.ensureClientConfigured();return this._firestoreClient.clientTerminated},enumerable:true,configurable:true});e.prototype.waitForPendingWrites=function(){this.ensureClientConfigured();return this._firestoreClient.waitForPendingWrites()};e.prototype._onSnapshotsInSync=function(e){this.ensureClientConfigured();if(oo(e)){return this.onSnapshotsInSyncInternal(e)}else{O("Firestore.onSnapshotsInSync","function",1,e);var t={next:e};return this.onSnapshotsInSyncInternal(t)}};e.prototype.onSnapshotsInSyncInternal=function(e){var t=this;var r=function(e){throw h("Uncaught Error in onSnapshotsInSync")};var n=new $a({next:function(){if(e.next){e.next()}},error:r});this._firestoreClient.addSnapshotsInSyncListener(n);return function(){n.mute();t._firestoreClient.removeSnapshotsInSyncListener(n)}};e.prototype.ensureClientConfigured=function(){if(!this._firestoreClient){this.configureClient(new Ha)}return this._firestoreClient};e.prototype.makeDatabaseInfo=function(){return new ue(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)};e.prototype.configureClient=function(e){d(!!this._settings.host,"FirestoreSettings.host is not set");d(!this._firestoreClient,"configureClient() called multiple times");var t=this.makeDatabaseInfo();this._firestoreClient=new Ya(p.getPlatform(),t,this._credentials,this._queue);return this._firestoreClient.start(e)};e.prototype.createDataConverter=function(e){var t=function(t){if(t instanceof qo){var r=e;var n=t.firestore._databaseId;if(!n.isEqual(r)){throw new y(m.INVALID_ARGUMENT,"Document reference is for database "+(n.projectId+"/"+n.database+" but should be ")+("for database "+r.projectId+"/"+r.database))}return new So(e,t._key)}else{return t}};return new Eo(t)};e.databaseIdFromApp=function(e){var t=e.options;if(!b(t,"projectId")){throw new y(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')}var r=t["projectId"];if(!r||typeof r!=="string"){throw new y(m.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options")}return new le(r)};Object.defineProperty(e.prototype,"app",{get:function(){if(!this._firebaseApp){throw new y(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is "+"not available")}return this._firebaseApp},enumerable:true,configurable:true});e.prototype.collection=function(e){C("Firestore.collection",arguments,1);O("Firestore.collection","non-empty string",1,e);this.ensureClientConfigured();return new Go(pe.fromString(e),this)};e.prototype.doc=function(e){C("Firestore.doc",arguments,1);O("Firestore.doc","non-empty string",1,e);this.ensureClientConfigured();return qo.forPath(pe.fromString(e),this)};e.prototype.collectionGroup=function(e){C("Firestore.collectionGroup",arguments,1);O("Firestore.collectionGroup","non-empty string",1,e);if(e.indexOf("/")>=0){throw new y(m.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function "+"Firestore.collectionGroup(). Collection IDs must not contain '/'.")}this.ensureClientConfigured();return new Wo(new Ui(pe.EMPTY_PATH,e),this)};e.prototype.runTransaction=function(e){var t=this;C("Firestore.runTransaction",arguments,1);O("Firestore.runTransaction","function",1,e);return this.ensureClientConfigured().transaction((function(r){return e(new Fo(t,r))}))};e.prototype.batch=function(){this.ensureClientConfigured();return new Vo(this)};Object.defineProperty(e,"logLevel",{get:function(){switch(s()){case o.DEBUG:return"debug";case o.ERROR:return"error";case o.SILENT:return"silent";default:return h("Unknown log level: "+s())}},enumerable:true,configurable:true});e.setLogLevel=function(e){C("Firestore.setLogLevel",arguments,1);O("Firestore.setLogLevel","non-empty string",1,e);switch(e){case"debug":u(o.DEBUG);break;case"error":u(o.ERROR);break;case"silent":u(o.SILENT);break;default:throw new y(m.INVALID_ARGUMENT,"Invalid log level: "+e)}};e.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots};return e}();var Fo=function(){function e(e,t){this._firestore=e;this._transaction=t}e.prototype.get=function(e){var t=this;C("Transaction.get",arguments,1);var r=Xo("Transaction.get",e,this._firestore);return this._transaction.lookup([r._key]).then((function(e){if(!e||e.length!==1){return h("Mismatch in docs returned from document lookup.")}var n=e[0];if(n instanceof tr){return new Bo(t._firestore,r._key,null,false,false)}else if(n instanceof er){return new Bo(t._firestore,r._key,n,false,false)}else{throw h("BatchGetDocumentsRequest returned unexpected document type: "+n.constructor.name)}}))};e.prototype.set=function(e,t,r){N("Transaction.set",arguments,2,3);var n=Xo("Transaction.set",e,this._firestore);r=Ho("Transaction.set",r);var i=r.merge||r.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",t,r.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",t);this._transaction.set(n._key,i);return this};e.prototype.update=function(e,t,r){var n=[];for(var i=3;i<arguments.length;i++){n[i-3]=arguments[i]}var a;var o;if(typeof t==="string"||t instanceof Xa){A("Transaction.update",arguments,3);a=Xo("Transaction.update",e,this._firestore);o=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",t,r,n)}else{C("Transaction.update",arguments,2);a=Xo("Transaction.update",e,this._firestore);o=this._firestore._dataConverter.parseUpdateData("Transaction.update",t)}this._transaction.update(a._key,o);return this};e.prototype.delete=function(e){C("Transaction.delete",arguments,1);var t=Xo("Transaction.delete",e,this._firestore);this._transaction.delete(t._key);return this};return e}();var Vo=function(){function e(e){this._firestore=e;this._mutations=[];this._committed=false}e.prototype.set=function(e,t,r){N("WriteBatch.set",arguments,2,3);this.verifyNotCommitted();var n=Xo("WriteBatch.set",e,this._firestore);r=Ho("WriteBatch.set",r);var i=r.merge||r.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",t,r.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",t);this._mutations=this._mutations.concat(i.toMutations(n._key,At.NONE));return this};e.prototype.update=function(e,t,r){var n=[];for(var i=3;i<arguments.length;i++){n[i-3]=arguments[i]}this.verifyNotCommitted();var a;var o;if(typeof t==="string"||t instanceof Xa){A("WriteBatch.update",arguments,3);a=Xo("WriteBatch.update",e,this._firestore);o=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",t,r,n)}else{C("WriteBatch.update",arguments,2);a=Xo("WriteBatch.update",e,this._firestore);o=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",t)}this._mutations=this._mutations.concat(o.toMutations(a._key,At.exists(true)));return this};e.prototype.delete=function(e){C("WriteBatch.delete",arguments,1);this.verifyNotCommitted();var t=Xo("WriteBatch.delete",e,this._firestore);this._mutations=this._mutations.concat(new xt(t._key,At.NONE));return this};e.prototype.commit=function(){return F.__awaiter(this,void 0,void 0,(function(){return F.__generator(this,(function(e){this.verifyNotCommitted();this._committed=true;if(this._mutations.length>0){return[2,this._firestore.ensureClientConfigured().write(this._mutations)]}return[2]}))}))};e.prototype.verifyNotCommitted=function(){if(this._committed){throw new y(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() "+"has been called.")}};return e}();var qo=function(){function e(e,t){this._key=e;this.firestore=t;this._firestoreClient=this.firestore.ensureClientConfigured()}e.forPath=function(t,r){if(t.length%2!==0){throw new y(m.INVALID_ARGUMENT,"Invalid document reference. Document "+"references must have an even number of segments, but "+(t.canonicalString()+" has "+t.length))}return new e(new ye(t),r)};Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"parent",{get:function(){return new Go(this._key.path.popLast(),this.firestore)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:true,configurable:true});e.prototype.collection=function(e){C("DocumentReference.collection",arguments,1);O("DocumentReference.collection","non-empty string",1,e);if(!e){throw new y(m.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()")}var t=pe.fromString(e);return new Go(this._key.path.child(t),this.firestore)};e.prototype.isEqual=function(t){if(!(t instanceof e)){throw $("isEqual","DocumentReference",1,t)}return this.firestore===t.firestore&&this._key.isEqual(t._key)};e.prototype.set=function(e,t){N("DocumentReference.set",arguments,1,2);t=Ho("DocumentReference.set",t);var r=t.merge||t.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",e,t.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",e);return this._firestoreClient.write(r.toMutations(this._key,At.NONE))};e.prototype.update=function(e,t){var r=[];for(var n=2;n<arguments.length;n++){r[n-2]=arguments[n]}var i;if(typeof e==="string"||e instanceof Xa){A("DocumentReference.update",arguments,2);i=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",e,t,r)}else{C("DocumentReference.update",arguments,1);i=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",e)}return this._firestoreClient.write(i.toMutations(this._key,At.exists(true)))};e.prototype.delete=function(){C("DocumentReference.delete",arguments,0);return this._firestoreClient.write([new xt(this._key,At.NONE)])};e.prototype.onSnapshot=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}N("DocumentReference.onSnapshot",arguments,1,4);var r={includeMetadataChanges:false};var n;var i=0;if(typeof e[i]==="object"&&!oo(e[i])){r=e[i];Y("DocumentReference.onSnapshot",r,["includeMetadataChanges"]);P("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges);i++}var a={includeMetadataChanges:r.includeMetadataChanges};if(oo(e[i])){n=e[i]}else{O("DocumentReference.onSnapshot","function",i,e[i]);M("DocumentReference.onSnapshot","function",i+1,e[i+1]);M("DocumentReference.onSnapshot","function",i+2,e[i+2]);n={next:e[i],error:e[i+1],complete:e[i+2]}}return this.onSnapshotInternal(a,n)};e.prototype.onSnapshotInternal=function(e,t){var r=this;var n=function(e){console.error("Uncaught Error in onSnapshot:",e)};if(t.error){n=t.error.bind(t)}var i=new $a({next:function(e){if(t.next){d(e.docs.size<=1,"Too many documents returned on a document query");var n=e.docs.get(r._key);t.next(new Bo(r.firestore,r._key,n,e.fromCache,e.hasPendingWrites))}},error:n});var a=this._firestoreClient.listen(Ui.atPath(this._key.path),i,e);return function(){i.mute();r._firestoreClient.unlisten(a)}};e.prototype.get=function(e){var t=this;N("DocumentReference.get",arguments,0,1);$o("DocumentReference.get",e);return new Promise((function(r,n){if(e&&e.source==="cache"){t.firestore.ensureClientConfigured().getDocumentFromLocalCache(t._key).then((function(e){r(new Bo(t.firestore,t._key,e,true,e instanceof er?e.hasLocalMutations:false))}),n)}else{t.getViaSnapshotListener(r,n,e)}}))};e.prototype.getViaSnapshotListener=function(e,t,r){var n=this.onSnapshotInternal({includeMetadataChanges:true,waitForSyncWhenOnline:true},{next:function(i){n();if(!i.exists&&i.metadata.fromCache){t(new y(m.UNAVAILABLE,"Failed to get document because the client is "+"offline."))}else if(i.exists&&i.metadata.fromCache&&r&&r.source==="server"){t(new y(m.UNAVAILABLE,"Failed to get document from server. (However, this "+"document does exist in the local cache. Run again "+'without setting source to "server" to '+"retrieve the cached document.)"))}else{e(i)}},error:t})};return e}();var jo=function(){function e(e,t){this.hasPendingWrites=e;this.fromCache=t}e.prototype.isEqual=function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache};return e}();var Bo=function(){function e(e,t,r,n,i){this._firestore=e;this._key=t;this._document=r;this._fromCache=n;this._hasPendingWrites=i}e.prototype.data=function(e){N("DocumentSnapshot.data",arguments,0,1);e=Yo("DocumentSnapshot.data",e);return!this._document?undefined:this.convertObject(this._document.data(),Lt.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))};e.prototype.get=function(e,t){N("DocumentSnapshot.get",arguments,1,2);t=Yo("DocumentSnapshot.get",t);if(this._document){var r=this._document.data().field(Do("DocumentSnapshot.get",e));if(r!==null){return this.convertValue(r,Lt.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}}return undefined};Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ref",{get:function(){return new qo(this._key,this._firestore)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"exists",{get:function(){return this._document!==null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"metadata",{get:function(){return new jo(this._hasPendingWrites,this._fromCache)},enumerable:true,configurable:true});e.prototype.isEqual=function(t){if(!(t instanceof e)){throw $("isEqual","DocumentSnapshot",1,t)}return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(this._document===null?t._document===null:this._document.isEqual(t._document))};e.prototype.convertObject=function(e,t){var r=this;var n={};e.forEach((function(e,i){n[e]=r.convertValue(i,t)}));return n};e.prototype.convertValue=function(e,t){if(e instanceof Xt){return this.convertObject(e,t)}else if(e instanceof Jt){return this.convertArray(e,t)}else if(e instanceof Yt){var r=e.value(t);var n=this._firestore.ensureClientConfigured().databaseId();if(!e.databaseId.isEqual(n)){l("Document "+this._key.path+" contains a document "+"reference within a different database ("+(e.databaseId.projectId+"/"+e.databaseId.database+") which is not ")+"supported. It will be treated as a reference in the current "+("database ("+n.projectId+"/"+n.database+") ")+"instead.")}return new qo(r,this._firestore)}else{return e.value(t)}};e.prototype.convertArray=function(e,t){var r=this;return e.internalValue.map((function(e){return r.convertValue(e,t)}))};return e}();var Uo=function(e){F.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.data=function(t){var r=e.prototype.data.call(this,t);d(typeof r==="object","Document in a QueryDocumentSnapshot should exist");return r};return t}(Bo);var Wo=function(){function e(e,t){this._query=e;this.firestore=t}e.prototype.where=function(t,r,n){C("Query.where",arguments,3);H("Query.where",3,n);if(r!=="in"&&r!=="array-contains-any"){var i=["<","<=","==",">=",">","array-contains"];B("Query.where",i,2,r)}var a;var o=Do("Query.where",t);var s=zi.fromString(r);if(o.isKeyField()){if(s===zi.ARRAY_CONTAINS||s===zi.ARRAY_CONTAINS_ANY){throw new y(m.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+s.toString()+"' "+"queries on FieldPath.documentId().")}else if(s===zi.IN){this.validateDisjunctiveFilterElements(n,s);var u=[];for(var c=0,l=n;c<l.length;c++){var f=l[c];u.push(this.parseDocumentIdValue(f))}a=new Jt(u)}else{a=this.parseDocumentIdValue(n)}}else{if(s===zi.IN||s===zi.ARRAY_CONTAINS_ANY){this.validateDisjunctiveFilterElements(n,s)}a=this.firestore._dataConverter.parseQueryValue("Query.where",n)}var h=Qi.create(o,s,a);this.validateNewFilter(h);return new e(this._query.addFilter(h),this.firestore)};e.prototype.orderBy=function(t,r){N("Query.orderBy",arguments,1,2);M("Query.orderBy","non-empty string",2,r);var n;if(r===undefined||r==="asc"){n=Xi.ASCENDING}else if(r==="desc"){n=Xi.DESCENDING}else{throw new y(m.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+r+"', "+"expected 'asc' or 'desc'.")}if(this._query.startAt!==null){throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or "+"Query.startAfter() before calling Query.orderBy().")}if(this._query.endAt!==null){throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or "+"Query.endBefore() before calling Query.orderBy().")}var i=Do("Query.orderBy",t);var a=new Zi(i,n);this.validateNewOrderBy(a);return new e(this._query.addOrderBy(a),this.firestore)};e.prototype.limit=function(t){C("Query.limit",arguments,1);O("Query.limit","number",1,t);if(t<=0){throw new y(m.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be "+"positive.")}return new e(this._query.withLimit(t),this.firestore)};e.prototype.startAt=function(t){var r=[];for(var n=1;n<arguments.length;n++){r[n-1]=arguments[n]}A("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",t,r,true);return new e(this._query.withStartAt(i),this.firestore)};e.prototype.startAfter=function(t){var r=[];for(var n=1;n<arguments.length;n++){r[n-1]=arguments[n]}A("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",t,r,false);return new e(this._query.withStartAt(i),this.firestore)};e.prototype.endBefore=function(t){var r=[];for(var n=1;n<arguments.length;n++){r[n-1]=arguments[n]}A("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",t,r,true);return new e(this._query.withEndAt(i),this.firestore)};e.prototype.endAt=function(t){var r=[];for(var n=1;n<arguments.length;n++){r[n-1]=arguments[n]}A("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",t,r,false);return new e(this._query.withEndAt(i),this.firestore)};e.prototype.isEqual=function(t){if(!(t instanceof e)){throw $("isEqual","Query",1,t)}return this.firestore===t.firestore&&this._query.isEqual(t._query)};e.prototype.boundFromDocOrFields=function(e,t,r,n){H(e,1,t);if(t instanceof Bo){if(r.length>0){throw new y(m.INVALID_ARGUMENT,"Too many arguments provided to "+e+"().")}var i=t;if(!i.exists){throw new y(m.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+(e+"()."))}return this.boundFromDocument(e,i._document,n)}else{var a=[t].concat(r);return this.boundFromFields(e,a,n)}};e.prototype.boundFromDocument=function(e,t,r){var n=[];for(var i=0,a=this._query.orderBy;i<a.length;i++){var o=a[i];if(o.field.isKeyField()){n.push(new Yt(this.firestore._databaseId,t.key))}else{var s=t.field(o.field);if(s instanceof Gt){throw new y(m.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a "+'document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of '+"this field is unknown, you cannot start/end a query with it.)")}else if(s!==null){n.push(s)}else{var u=o.field.canonicalString();throw new y(m.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a "+("document for which the field '"+u+"' (used as the ")+"orderBy) does not exist.")}}}return new Ji(n,r)};e.prototype.boundFromFields=function(e,t,r){var n=this._query.explicitOrderBy;if(t.length>n.length){throw new y(m.INVALID_ARGUMENT,"Too many arguments provided to "+e+"(). "+"The number of arguments must be less than or equal to the "+"number of Query.orderBy() clauses")}var i=[];for(var a=0;a<t.length;a++){var o=t[a];var s=n[a];if(s.field.isKeyField()){if(typeof o!=="string"){throw new y(m.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+(e+"(), but got a "+typeof o))}if(!this._query.isCollectionGroupQuery()&&o.indexOf("/")!==-1){throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), "+("the value passed to "+e+"() must be a plain document ID, but ")+("'"+o+"' contains a slash."))}var u=this._query.path.child(pe.fromString(o));if(!ye.isDocumentKey(u)){throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by "+("FieldPath.documentId(), the value passed to "+e+"() must result in a ")+("valid document path, but '"+u+"' is not because it contains an odd number ")+"of segments.")}var c=new ye(u);i.push(new Yt(this.firestore._databaseId,c))}else{var l=this.firestore._dataConverter.parseQueryValue(e,o);i.push(l)}}return new Ji(i,r)};e.prototype.onSnapshot=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}N("Query.onSnapshot",arguments,1,4);var r={};var n;var i=0;if(typeof e[i]==="object"&&!oo(e[i])){r=e[i];Y("Query.onSnapshot",r,["includeMetadataChanges"]);P("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges);i++}if(oo(e[i])){n=e[i]}else{O("Query.onSnapshot","function",i,e[i]);M("Query.onSnapshot","function",i+1,e[i+1]);M("Query.onSnapshot","function",i+2,e[i+2]);n={next:e[i],error:e[i+1],complete:e[i+2]}}return this.onSnapshotInternal(r,n)};e.prototype.onSnapshotInternal=function(e,t){var r=this;var n=function(e){console.error("Uncaught Error in onSnapshot:",e)};if(t.error){n=t.error.bind(t)}var i=new $a({next:function(e){if(t.next){t.next(new zo(r.firestore,r._query,e))}},error:n});var a=this.firestore.ensureClientConfigured();var o=a.listen(this._query,i,e);return function(){i.mute();a.unlisten(o)}};e.prototype.get=function(e){var t=this;N("Query.get",arguments,0,1);$o("Query.get",e);return new Promise((function(r,n){if(e&&e.source==="cache"){t.firestore.ensureClientConfigured().getDocumentsFromLocalCache(t._query).then((function(e){r(new zo(t.firestore,t._query,e))}),n)}else{t.getViaSnapshotListener(r,n,e)}}))};e.prototype.getViaSnapshotListener=function(e,t,r){var n=this.onSnapshotInternal({includeMetadataChanges:true,waitForSyncWhenOnline:true},{next:function(i){n();if(i.metadata.fromCache&&r&&r.source==="server"){t(new y(m.UNAVAILABLE,"Failed to get documents from server. (However, these "+"documents may exist in the local cache. Run again "+'without setting source to "server" to '+"retrieve the cached documents.)"))}else{e(i)}},error:t})};e.prototype.parseDocumentIdValue=function(e){if(typeof e==="string"){if(e===""){throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you "+"must provide a valid document ID, but it was an empty string.")}if(!this._query.isCollectionGroupQuery()&&e.indexOf("/")!==-1){throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying a collection by "+"FieldPath.documentId(), you must provide a plain document ID, but "+("'"+e+"' contains a '/' character."))}var t=this._query.path.child(pe.fromString(e));if(!ye.isDocumentKey(t)){throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying a collection group by "+"FieldPath.documentId(), the value provided must result in a valid document path, "+("but '"+t+"' is not because it has an odd number of segments ("+t.length+")."))}return new Yt(this.firestore._databaseId,new ye(t))}else if(e instanceof qo){var r=e;return new Yt(this.firestore._databaseId,r._key)}else{throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid "+"string or a DocumentReference, but it was: "+(z(e)+"."))}};e.prototype.validateDisjunctiveFilterElements=function(e,t){if(!Array.isArray(e)||e.length===0){throw new y(m.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for "+("'"+t.toString()+"' filters."))}if(e.length>10){throw new y(m.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a "+"maximum of 10 elements in the value array.")}if(e.indexOf(null)>=0){throw new y(m.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters cannot contain 'null' "+"in the value array.")}if(e.filter((function(e){return Number.isNaN(e)})).length>0){throw new y(m.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters cannot contain 'NaN' "+"in the value array.")}};e.prototype.validateNewFilter=function(e){if(e instanceof Qi){var t=[zi.ARRAY_CONTAINS,zi.ARRAY_CONTAINS_ANY];var r=[zi.IN,zi.ARRAY_CONTAINS_ANY];var n=t.indexOf(e.op)>=0;var i=r.indexOf(e.op)>=0;if(e.isInequality()){var a=this._query.getInequalityFilterField();if(a!==null&&!a.isEqual(e.field)){throw new y(m.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality"+" (<, <=, >, or >=) must be on the same field. But you have"+(" inequality filters on '"+a.toString()+"'")+(" and '"+e.field.toString()+"'"))}var o=this._query.getFirstOrderByField();if(o!==null){this.validateOrderByAndInequalityMatch(e.field,o)}}else if(i||n){var s=null;if(i){s=this._query.findFilterOperator(r)}if(s===null&&n){s=this._query.findFilterOperator(t)}if(s!=null){if(s===e.op){throw new y(m.INVALID_ARGUMENT,"Invalid query. You cannot use more than one "+("'"+e.op.toString()+"' filter."))}else{throw new y(m.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters "+("with '"+s.toString()+"' filters."))}}}}};e.prototype.validateNewOrderBy=function(e){if(this._query.getFirstOrderByField()===null){var t=this._query.getInequalityFilterField();if(t!==null){this.validateOrderByAndInequalityMatch(t,e.field)}}};e.prototype.validateOrderByAndInequalityMatch=function(e,t){if(!t.isEqual(e)){throw new y(m.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality "+("(<, <=, >, or >=) on field '"+e.toString()+"' ")+("and so you must also use '"+e.toString()+"' ")+"as your first Query.orderBy(), but your first Query.orderBy() "+("is on field '"+t.toString()+"' instead."))}};return e}();var zo=function(){function e(e,t,r){this._firestore=e;this._originalQuery=t;this._snapshot=r;this._cachedChanges=null;this._cachedChangesIncludeMetadataChanges=null;this.metadata=new jo(r.hasPendingWrites,r.fromCache)}Object.defineProperty(e.prototype,"docs",{get:function(){var e=[];this.forEach((function(t){return e.push(t)}));return e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:true,configurable:true});e.prototype.forEach=function(e,t){var r=this;N("QuerySnapshot.forEach",arguments,1,2);O("QuerySnapshot.forEach","function",1,e);this._snapshot.docs.forEach((function(n){e.call(t,r.convertToDocumentImpl(n))}))};Object.defineProperty(e.prototype,"query",{get:function(){return new Wo(this._originalQuery,this._firestore)},enumerable:true,configurable:true});e.prototype.docChanges=function(e){if(e){Y("QuerySnapshot.docChanges",e,["includeMetadataChanges"]);P("QuerySnapshot.docChanges","boolean","includeMetadataChanges",e.includeMetadataChanges)}var t=!!(e&&e.includeMetadataChanges);if(t&&this._snapshot.excludesMetadataChanges){throw new y(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must "+"also pass { includeMetadataChanges:true } to onSnapshot().")}if(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t){this._cachedChanges=Jo(this._firestore,t,this._snapshot);this._cachedChangesIncludeMetadataChanges=t}return this._cachedChanges};e.prototype.isEqual=function(t){if(!(t instanceof e)){throw $("isEqual","QuerySnapshot",1,t)}return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)};e.prototype.convertToDocumentImpl=function(e){return new Uo(this._firestore,e.key,e,this.metadata.fromCache,this._snapshot.mutatedKeys.has(e.key))};return e}();function Qo(){throw new y(m.INVALID_ARGUMENT,"QuerySnapshot.docChanges has been changed from a property into a "+'method, so usages like "querySnapshot.docChanges" should become '+'"querySnapshot.docChanges()"')}var Ko=["length","forEach","map"].concat(typeof Symbol!=="undefined"?[Symbol.iterator]:[]);Ko.forEach((function(e){try{Object.defineProperty(zo.prototype.docChanges,e,{get:function(){return Qo()}})}catch(e){}}));var Go=function(e){F.__extends(t,e);function t(t,r){var n=e.call(this,Ui.atPath(t),r)||this;if(t.length%2!==1){throw new y(m.INVALID_ARGUMENT,"Invalid collection reference. Collection "+"references must have an odd number of segments, but "+(t.canonicalString()+" has "+t.length))}return n}Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parent",{get:function(){var e=this._query.path.popLast();if(e.isEmpty()){return null}else{return new qo(new ye(e),this.firestore)}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:true,configurable:true});t.prototype.doc=function(e){N("CollectionReference.doc",arguments,0,1);if(arguments.length===0){e=Z.newId()}O("CollectionReference.doc","non-empty string",1,e);if(e===""){throw new y(m.INVALID_ARGUMENT,"Document path must be a non-empty string")}var t=pe.fromString(e);return qo.forPath(this._query.path.child(t),this.firestore)};t.prototype.add=function(e){C("CollectionReference.add",arguments,1);O("CollectionReference.add","object",1,e);var t=this.doc();return t.set(e).then((function(){return t}))};return t}(Wo);function Ho(e,t){if(t===undefined){return{merge:false}}Y(e,t,["merge","mergeFields"]);P(e,"boolean","merge",t.merge);L(e,"mergeFields","a string or a FieldPath",t.mergeFields,(function(e){return typeof e==="string"||e instanceof Xa}));if(t.mergeFields!==undefined&&t.merge!==undefined){throw new y(m.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" '+'and "mergeFields".')}return t}function Yo(e,t){if(t===undefined){return{}}Y(e,t,["serverTimestamps"]);j(e,"options","serverTimestamps",t.serverTimestamps,["estimate","previous","none"]);return t}function $o(e,t){M(e,"object",1,t);if(t){Y(e,t,["source"]);j(e,"options","source",t.source,["default","server","cache"])}}function Xo(e,t,r){if(!(t instanceof qo)){throw $(e,"DocumentReference",1,t)}else if(t.firestore!==r){throw new y(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}else{return t}}function Jo(e,t,r){if(r.oldDocs.isEmpty()){var n;var i=0;return r.docChanges.map((function(t){var a=new Uo(e,t.doc.key,t.doc,r.fromCache,r.mutatedKeys.has(t.doc.key));d(t.type===Ei.Added,"Invalid event type for first snapshot");d(!n||r.query.docComparator(n,t.doc)<0,"Got added events in wrong order");n=t.doc;return{type:"added",doc:a,oldIndex:-1,newIndex:i++}}))}else{var a=r.oldDocs;return r.docChanges.filter((function(e){return t||e.type!==Ei.Metadata})).map((function(t){var n=new Uo(e,t.doc.key,t.doc,r.fromCache,r.mutatedKeys.has(t.doc.key));var i=-1;var o=-1;if(t.type!==Ei.Added){i=a.indexOf(t.doc.key);d(i>=0,"Index for document not found");a=a.delete(t.doc.key)}if(t.type!==Ei.Removed){a=a.add(t.doc);o=a.indexOf(t.doc.key)}return{type:Zo(t.type),doc:n,oldIndex:i,newIndex:o}}))}}function Zo(e){switch(e){case Ei.Added:return"added";case Ei.Modified:case Ei.Metadata:return"modified";case Ei.Removed:return"removed";default:return h("Unknown change type: "+e)}}var es=g(Lo,"Use firebase.firestore() instead.");var ts=g(Fo,"Use firebase.firestore().runTransaction() instead.");var rs=g(Vo,"Use firebase.firestore().batch() instead.");var ns=g(qo,"Use firebase.firestore().doc() instead.");var is=g(Bo);var as=g(Uo);var os=g(Wo);var ss=g(zo);var us=g(Go,"Use firebase.firestore().collection() instead.");var cs={Firestore:es,GeoPoint:Bi,Timestamp:ke,Blob:se,Transaction:ts,WriteBatch:rs,DocumentReference:ns,DocumentSnapshot:is,Query:os,QueryDocumentSnapshot:as,QuerySnapshot:ss,CollectionReference:us,FieldPath:Xa,FieldValue:vo,setLogLevel:Lo.setLogLevel,CACHE_SIZE_UNLIMITED:xo};function ls(e){e.INTERNAL.registerService("firestore",(function(e){return new Lo(e)}),I(cs))}var fs=function(){function e(){}e.prototype.addCallback=function(e){};e.prototype.shutdown=function(){};return e}();var hs="ConnectivityMonitor";var ds=function(){function e(){var e=this;this.networkAvailableListener=function(){return e.onNetworkAvailable()};this.networkUnavailableListener=function(){return e.onNetworkUnavailable()};this.callbacks=[];this.configureNetworkMonitoring()}e.prototype.addCallback=function(e){this.callbacks.push(e)};e.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener);window.removeEventListener("offline",this.networkUnavailableListener)};e.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener);window.addEventListener("offline",this.networkUnavailableListener)};e.prototype.onNetworkAvailable=function(){c(hs,"Network connectivity changed: AVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++){var r=t[e];r(0)}};e.prototype.onNetworkUnavailable=function(){c(hs,"Network connectivity changed: UNAVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++){var r=t[e];r(1)}};e.isAvailable=function(){return typeof window!=="undefined"&&window.addEventListener!==undefined&&window.removeEventListener!==undefined};return e}();var ps=function(){function e(e){this.sendFn=e.sendFn;this.closeFn=e.closeFn}e.prototype.onOpen=function(e){d(!this.wrappedOnOpen,"Called onOpen on stream twice!");this.wrappedOnOpen=e};e.prototype.onClose=function(e){d(!this.wrappedOnClose,"Called onClose on stream twice!");this.wrappedOnClose=e};e.prototype.onMessage=function(e){d(!this.wrappedOnMessage,"Called onMessage on stream twice!");this.wrappedOnMessage=e};e.prototype.close=function(){this.closeFn()};e.prototype.send=function(e){this.sendFn(e)};e.prototype.callOnOpen=function(){d(this.wrappedOnOpen!==undefined,"Cannot call onOpen because no callback was set");this.wrappedOnOpen()};e.prototype.callOnClose=function(e){d(this.wrappedOnClose!==undefined,"Cannot call onClose because no callback was set");this.wrappedOnClose(e)};e.prototype.callOnMessage=function(e){d(this.wrappedOnMessage!==undefined,"Cannot call onMessage because no callback was set");this.wrappedOnMessage(e)};return e}();var vs="Connection";var ms="google.firestore.v1.Firestore";var ys="v1";var gs={BatchGetDocuments:"batchGet",Commit:"commit"};var bs="gl-js/ fire/"+i;var ws=15;var _s=function(){function e(e){this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.baseUrl=t+"://"+e.host;this.forceLongPolling=e.forceLongPolling}e.prototype.modifyHeadersForRequest=function(e,t){if(t){for(var r in t.authHeaders){if(t.authHeaders.hasOwnProperty(r)){e[r]=t.authHeaders[r]}}}e["X-Goog-Api-Client"]=bs};e.prototype.invokeRPC=function(e,t,r){var n=this;var i=this.makeUrl(e);return new Promise((function(a,o){var s=new bi.XhrIo;s.listenOnce(bi.EventType.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case bi.ErrorCode.NO_ERROR:var t=s.getResponseJson();c(vs,"XHR received:",JSON.stringify(t));a(t);break;case bi.ErrorCode.TIMEOUT:c(vs,'RPC "'+e+'" timed out');o(new y(m.DEADLINE_EXCEEDED,"Request time out"));break;case bi.ErrorCode.HTTP_ERROR:var r=s.getStatus();c(vs,'RPC "'+e+'" failed with status:',r,"response text:",s.getResponseText());if(r>0){var n=s.getResponseJson().error;if(!!n&&!!n.status&&!!n.message){var i=_i(n.status);o(new y(i,n.message))}else{o(new y(m.UNKNOWN,"Server responded with status "+s.getStatus()))}}else{c(vs,'RPC "'+e+'" failed');o(new y(m.UNAVAILABLE,"Connection failed."))}break;default:h('RPC "'+e+'" failed with unanticipated '+"webchannel error "+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{c(vs,'RPC "'+e+'" completed.')}}));var u=JSON.stringify(t);c(vs,"XHR sending: ",i+" "+u);var l={"Content-Type":"text/plain"};n.modifyHeadersForRequest(l,r);s.send(i,"POST",u,l,ws)}))};e.prototype.invokeStreamingRPC=function(e,t,r){return this.invokeRPC(e,t,r)};e.prototype.openStream=function(e,t){var r=[this.baseUrl,"/",ms,"/",e,"/channel"];var n=bi.createWebChannelTransport();var i={backgroundChannelTest:true,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:true,supportsCrossDomainXhr:true,internalChannelParams:{forwardChannelRequestTimeoutMs:10*60*1e3},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,t);if(!V.isReactNative()){i.httpHeadersOverwriteParam="$httpHeaders"}var a=r.join("");c(vs,"Creating WebChannel: "+a+" "+i);var o=n.createWebChannel(a,i);var s=false;var u=false;var l=new ps({sendFn:function(e){if(!u){if(!s){c(vs,"Opening WebChannel transport.");o.open();s=true}c(vs,"WebChannel sending:",e);o.send(e)}else{c(vs,"Not sending because WebChannel is closed:",e)}},closeFn:function(){return o.close()}});var f=function(e,t){o.listen(e,(function(e){try{t(e)}catch(e){setTimeout((function(){throw e}),0)}}))};f(bi.WebChannel.EventType.OPEN,(function(){if(!u){c(vs,"WebChannel transport opened.")}}));f(bi.WebChannel.EventType.CLOSE,(function(){if(!u){u=true;c(vs,"WebChannel transport closed");l.callOnClose()}}));f(bi.WebChannel.EventType.ERROR,(function(e){if(!u){u=true;c(vs,"WebChannel transport errored:",e);l.callOnClose(new y(m.UNAVAILABLE,"The operation could not be completed"))}}));f(bi.WebChannel.EventType.MESSAGE,(function(e){if(!u){var t=e.data[0];d(!!t,"Got a webchannel message without data.");var r=t;var n=r.error||r[0]&&r[0].error;if(n){c(vs,"WebChannel received error:",n);var i=n.status;var a=yi(i);var s=n.message;if(a===undefined){a=m.INTERNAL;s="Unknown error status: "+i+" with message "+n.message}u=true;l.callOnClose(new y(a,s));o.close()}else{c(vs,"WebChannel received:",t);l.callOnMessage(t)}}}));setTimeout((function(){l.callOnOpen()}),0);return l};e.prototype.makeUrl=function(e){var t=gs[e];d(t!==undefined,"Unknown REST mapping for: "+e);var r=[this.baseUrl,"/",ys];r.push("/projects/");r.push(this.databaseId.projectId);r.push("/databases/");r.push(this.databaseId.database);r.push("/documents");r.push(":");r.push(t);return r.join("")};return e}();var Ss=function(){function e(){this.emptyByteString="";this.base64Available=typeof atob!=="undefined"}Object.defineProperty(e.prototype,"document",{get:function(){return typeof document!=="undefined"?document:null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"window",{get:function(){return typeof window!=="undefined"?window:null},enumerable:true,configurable:true});e.prototype.loadConnection=function(e){return Promise.resolve(new _s(e))};e.prototype.newConnectivityMonitor=function(){if(ds.isAvailable()){return new ds}else{return new fs}};e.prototype.newSerializer=function(e){return new da(e,{useProto3Json:true})};e.prototype.formatJSON=function(e){return JSON.stringify(e)};e.prototype.atob=function(e){return atob(e)};e.prototype.btoa=function(e){return btoa(e)};return e}();p.setPlatform(new Ss);function Es(e){ls(e)}Es(n);t.registerFirestore=Es}));p(wi);var _i=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var n=r(K);var i={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};var a=function(e){F.__extends(t,e);function t(r,n,i){var a=e.call(this,n)||this;Object.setPrototypeOf(a,t.prototype);a.code=r;a.details=i;return a}return t}(Error);function o(e){if(e>=200&&e<300){return"ok"}switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded";default:}return"unknown"}function s(e,t,r){var n=o(e);var s=n;var u=undefined;try{var c=t&&t.error;if(c){var l=c.status;if(typeof l==="string"){if(!i[l]){return new a("internal","internal")}n=i[l];s=l}var f=c.message;if(typeof f==="string"){s=f}u=c.details;if(u!==undefined){u=r.decode(u)}}}catch(e){}if(n==="ok"){return null}return new a(n,s,u)}var u=function(){function e(e){this.app=e}e.prototype.getAuthToken=function(){return F.__awaiter(this,void 0,void 0,(function(){var e,t;return F.__generator(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,this.app.INTERNAL.getToken()];case 1:e=r.sent();if(!e){return[2,undefined]}return[2,e.accessToken];case 2:t=r.sent();return[2,undefined];case 3:return[2]}}))}))};e.prototype.getInstanceIdToken=function(){return F.__awaiter(this,void 0,void 0,(function(){var e,t,r;return F.__generator(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);if(!this.app.messaging){return[2,undefined]}e=this.app.messaging();return[4,e.getToken()];case 1:t=n.sent();if(!t){return[2,undefined]}return[2,t];case 2:r=n.sent();return[2,undefined];case 3:return[2]}}))}))};e.prototype.getContext=function(){return F.__awaiter(this,void 0,void 0,(function(){var e,t;return F.__generator(this,(function(r){switch(r.label){case 0:return[4,this.getAuthToken()];case 1:e=r.sent();return[4,this.getInstanceIdToken()];case 2:t=r.sent();return[2,{authToken:e,instanceIdToken:t}]}}))}))};return e}();var c="type.googleapis.com/google.protobuf.Int64Value";var l="type.googleapis.com/google.protobuf.UInt64Value";function f(e,t){var r={};for(var n in e){if(e.hasOwnProperty(n)){r[n]=t(e[n])}}return r}var h=function(){function e(){}e.prototype.encode=function(e){var t=this;if(e==null){return null}if(e instanceof Number){e=e.valueOf()}if(typeof e==="number"&&isFinite(e)){return e}if(e===true||e===false){return e}if(Object.prototype.toString.call(e)==="[object String]"){return e}if(Array.isArray(e)){return e.map((function(e){return t.encode(e)}))}if(typeof e==="function"||typeof e==="object"){return f(e,(function(e){return t.encode(e)}))}throw new Error("Data cannot be encoded in JSON: "+e)};e.prototype.decode=function(e){var t=this;if(e==null){return e}if(e["@type"]){switch(e["@type"]){case c:case l:{var r=Number(e["value"]);if(isNaN(r)){throw new Error("Data cannot be decoded from JSON: "+e)}return r}default:{throw new Error("Data cannot be decoded from JSON: "+e)}}}if(Array.isArray(e)){return e.map((function(e){return t.decode(e)}))}if(typeof e==="function"||typeof e==="object"){return f(e,(function(e){return t.decode(e)}))}return e};return e}();function d(e){return new Promise((function(t,r){setTimeout((function(){r(new a("deadline-exceeded","deadline-exceeded"))}),e)}))}var p=function(){function e(e,t){var r=this;if(t===void 0){t="us-central1"}this.app_=e;this.region_=t;this.serializer=new h;this.emulatorOrigin=null;this.INTERNAL={delete:function(){return r.deleteService()}};this.contextProvider=new u(e);this.cancelAllRequests=new Promise((function(e){r.deleteService=function(){return e()}}))}Object.defineProperty(e.prototype,"app",{get:function(){return this.app_},enumerable:true,configurable:true});e.prototype._url=function(e){var t=this.app_.options.projectId;var r=this.region_;if(this.emulatorOrigin!==null){var n=this.emulatorOrigin;return n+"/"+t+"/"+r+"/"+e}return"https://"+r+"-"+t+".cloudfunctions.net/"+e};e.prototype.useFunctionsEmulator=function(e){this.emulatorOrigin=e};e.prototype.httpsCallable=function(e,t){var r=this;return function(n){return r.call(e,n,t||{})}};e.prototype.postJSON=function(e,t,r){return F.__awaiter(this,void 0,void 0,(function(){var n,i,a,o;return F.__generator(this,(function(s){switch(s.label){case 0:r.append("Content-Type","application/json");s.label=1;case 1:s.trys.push([1,3,,4]);return[4,fetch(e,{method:"POST",body:JSON.stringify(t),headers:r})];case 2:n=s.sent();return[3,4];case 3:i=s.sent();return[2,{status:0,json:null}];case 4:a=null;s.label=5;case 5:s.trys.push([5,7,,8]);return[4,n.json()];case 6:a=s.sent();return[3,8];case 7:o=s.sent();return[3,8];case 8:return[2,{status:n.status,json:a}]}}))}))};e.prototype.call=function(e,t,r){return F.__awaiter(this,void 0,void 0,(function(){var n,i,o,u,c,l,f,h,p;return F.__generator(this,(function(v){switch(v.label){case 0:n=this._url(e);t=this.serializer.encode(t);i={data:t};o=new Headers;return[4,this.contextProvider.getContext()];case 1:u=v.sent();if(u.authToken){o.append("Authorization","Bearer "+u.authToken)}if(u.instanceIdToken){o.append("Firebase-Instance-ID-Token",u.instanceIdToken)}c=r.timeout||7e4;return[4,Promise.race([this.postJSON(n,i,o),d(c),this.cancelAllRequests])];case 2:l=v.sent();if(!l){throw new a("cancelled","Firebase Functions instance was deleted.")}f=s(l.status,l.json,this.serializer);if(f){throw f}if(!l.json){throw new a("internal","Response is not valid JSON object.")}h=l.json.data;if(typeof h==="undefined"){h=l.json.result}if(typeof h==="undefined"){throw new a("internal","Response is missing data field.")}p=this.serializer.decode(h);return[2,{data:p}]}}))}))};return e}();var v="functions";function m(e,t,r){return new p(e,r)}function y(e){var t={Functions:p};e.INTERNAL.registerService(v,m,t,undefined,true)}y(n);t.registerFunctions=y}));p(_i);var Si={apiKey:"AIzaSyA42mJ5aKLQI-8kFt24thcEVIoInKkEQDk",authDomain:"fontumibots.firebaseapp.com",databaseURL:"https://fontumibots.firebaseio.com",projectId:"fontumibots",storageBucket:"fontumibots.appspot.com",messagingSenderId:"1047975832929",appId:"1:1047975832929:web:3778f496fc1321d8"};var Ei=Y.initializeApp(Si);var Ti=Ei.firestore();var Ii=Ei.functions();var Di=function(e){var t=new Map;return function(r){return __awaiter_1(a,void 0,void 0,(function(){var n;return __generator_1(this,(function(i){switch(i.label){case 0:return[4,Ti.collection(e).doc(r).get()];case 1:n=i.sent();if(!t.get(r)){t.set(r,n)}return[2,t.get(r)]}}))}))}};var Ci;var Ai;var Ni=document.createElement("audio");Ni.loop=true;Ni.src="//www.fontumi.co/fontumibots/ringtone.mp3";var ki=function(e){var t=e.login,r=e.password,n=e.to;return __awaiter_1(a,void 0,void 0,(function(){return __generator_1(this,(function(e){Ci=new window["FontumiClient"]({login:t,password:r});Ai=n;Ci.onError=function(){Ni.pause();Mi()};return[2,Ci]}))}))};var Oi=function(){if(!Ci||!Ci.isRegistered)return;Ci.makeCall({media:{audio:true,video:false},username:Ai,contact:{isRoom:false}});Ni.play();Ci.onCallConnected=function(){return Ni.pause()}};var Mi=function(){if(!Ci)return;Ci.endCall();Ni.pause()};var xi=e("fontumibots_chat_container",function(){function e(e){var r=this;t(this,e);this.messages=[];this.actualQuestionType="text";this.inCall=false;this.phoneReady=false;this.call=function(){return __awaiter_1(r,void 0,void 0,(function(){var e=this;return __generator_1(this,(function(t){if(this.inCall)return[2];Oi();setTimeout((function(){e.hangup();Oi();e.inCall=true}),1e3);Ci.onCallEnd=function(){e.hangup()};return[2]}))}))};this.hangup=function(){Mi();r.inCall=false};this.answer=function(e){r.addMessage(e.detail,true);if(r.actualQuestionType==="yesno"){r.controller.next(e.detail==="No"?1:0)}else{r.controller.next()}r.ask()}}e.prototype.callOutside=function(){return __awaiter_1(this,void 0,void 0,(function(){return __generator_1(this,(function(e){return[2,this.call()]}))}))};e.prototype.ask=function(){return __awaiter_1(this,void 0,void 0,(function(){var e,t;return __generator_1(this,(function(r){switch(r.label){case 0:this.addMessage(this.controller.actualBlock.question().value,false);this.actualQuestionType=this.controller.actualBlock.question().type;if(!(this.actualQuestionType==="end"))return[3,4];r.label=1;case 1:r.trys.push([1,3,,4]);return[4,Ii.httpsCallable("sendMail")({messages:this.messages,to:this.bot.email,name:this.bot.name})];case 2:e=r.sent().data;console.log(e);return[3,4];case 3:t=r.sent();console.log(t);return[3,4];case 4:return[2]}}))}))};e.prototype.initChatController=function(){this.controller=new f(this.bot.escene.links,this.bot.escene.blocks);this.ask();this.controller.next();this.ask()};e.prototype.addMessage=function(e,t){this.messages=__spreadArrays_1(this.messages,[{id:Date.now(),message:e,user:t}])};e.prototype.componentWillLoad=function(){this.initChatController()};e.prototype.componentDidLoad=function(){};e.prototype.render=function(){var e=s(this.bot.colors.a);var t=s(this.bot.colors.b);var r=this.bot.colors.a;var i=this.bot.colors.b;var a=function(a){var o=a.id,s=a.message,u=a.user;return n("div",{id:"message-"+o+"-"+u,class:"uk-text-"+(u?"right":"left")+" fontumibots-message"},n("div",{style:{background:u?i:r}},n("p",{class:"uk-text-break",style:{color:u?t:e}},s)))};return n("div",{id:"fontumibots-chat-container",class:"uk-card uk-card-default uk-card-hover uk-width-5-6 uk-width-1-4@m"},n("div",{class:"uk-card-header",style:{background:r,padding:"15px 20px"}},n("div",{class:"uk-grid uk-grid-small uk-flex-middle"},n("div",{class:"uk-width-expand"},n("h3",{class:"uk-card-title uk-margin-remove-bottom",style:{color:e}},this.bot.name),n("p",{class:"uk-text-meta uk-margin-remove-top",style:{color:e}},this.bot.email)),this.bot.sip.on&&this.phoneReady?n("div",{class:"uk-width-auto"},this.inCall?n("fontumibots-icon-end-call",{fill:e,onClick:this.hangup}):n("fontumibots-icon-call",{fill:e,onClick:this.call})):n("div",null))),n("div",{id:"fontumibots-chat-container-body",class:"uk-card-body uk-padding-small"},this.messages.map((function(e){return a(e)}))),n("div",{class:"uk-card-footer"},this.actualQuestionType==="end"?n("div",null):n("fontumibots-chat-input",{type:this.actualQuestionType,props:this.controller.actualBlock.props()||[],style:{width:"100px"},onSendMessage:this.answer}),n("div",{class:"uk-grid uk-flex-center"},n("img",{src:"https://www.fontumi.co/empresas/logos/byfontumilogo.png",alt:"",style:{width:"100px",marginBottom:"10px"}}))))};Object.defineProperty(e,"style",{get:function(){return"#fontumibots-chat-container{border-radius:var(--fontumibots-border);max-height:calc(100vh - (var(--fontumibots-chat-borders) + 95px));position:fixed;right:var(--fontumibots-chat-borders);margin-left:10px;bottom:calc(10px + 55px + var(--fontumibots-chat-borders));z-index:var(--fontumibots-z-index)}#fontumibots-chat-container>.uk-card-body{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;overflow:scroll;overflow-x:hidden;max-height:calc(100vh - 330px)}#fontumibots-chat-container>.uk-card-footer{padding:6px 10px}fontumibots-chat-input .uk-inline{width:100%}#fontumibots-chat-container-input{border-radius:30px}.fontumibots-message>div>p{margin:7px 10px}.fontumibots-message>div{display:-ms-inline-flexbox;display:inline-flex;max-width:90%;border-radius:20px;margin-bottom:5px}.uk-button{border-radius:30px}"},enumerable:true,configurable:true});return e}());var Pi=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e){if(e instanceof Date){return e}if(typeof e!=="string"){return null}var t=new Date(e);return t.toString()==="Invalid Date"?null:t}t.toDate=r}));p(Pi);var Ri=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e){if(e===null||e===undefined||e.constructor===Object){return null}return String(e)}t.toString=r}));p(Ri);var Li=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=["true","1",1];var n=["false","0",0];function i(e){if(typeof e==="boolean"){return e}if(r.includes(e)){return true}if(n.includes(e)){return false}return null}t.toBoolean=i}));p(Li);var Fi=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e,t){if(t===void 0){t=false}if(typeof e==="number"){return t?e:Math.trunc(e)}if(typeof e!=="string"){return null}var r=Number(e);if(isNaN(r)){return null}return t?r:Math.trunc(r)}t.toInt=r}));p(Fi);var Vi=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e,t,r){if(typeof e===t){return e}var n=null;switch(t){case"float":n=Fi.toInt(e,true);break;case"string":n=Ri.toString(e);break;case"integer":n=Fi.toInt(e);break;case"date":n=Pi.toDate(e);break;case"boolean":n=Li.toBoolean(e);break}if(n===null&&r){throw new Error(r)}return n}t.cast=r}));p(Vi);var qi=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e,t,r){if(r===void 0){r=1}if(e.length<r){throw new Error(t)}}t.ensureLength=r}));p(qi);var ji="Expected a function";var Bi="__lodash_hash_undefined__";var Ui=1/0;var Wi="[object Function]",zi="[object GeneratorFunction]",Qi="[object Symbol]";var Ki=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Gi=/^\w*$/,Hi=/^\./,Yi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var $i=/[\\^$.*+?()[\]{}|]/g;var Xi=/\\(\\)?/g;var Ji=/^\[object .+?Constructor\]$/;var Zi=typeof h=="object"&&h&&h.Object===Object&&h;var ea=typeof self=="object"&&self&&self.Object===Object&&self;var ta=Zi||ea||Function("return this")();function ra(e,t){return e==null?undefined:e[t]}function na(e){var t=false;if(e!=null&&typeof e.toString!="function"){try{t=!!(e+"")}catch(e){}}return t}var ia=Array.prototype,aa=Function.prototype,oa=Object.prototype;var sa=ta["__core-js_shared__"];var ua=function(){var e=/[^.]+$/.exec(sa&&sa.keys&&sa.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var ca=aa.toString;var la=oa.hasOwnProperty;var fa=oa.toString;var ha=RegExp("^"+ca.call(la).replace($i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var da=ta.Symbol,pa=ia.splice;var va=Wa(ta,"Map"),ma=Wa(Object,"create");var ya=da?da.prototype:undefined,ga=ya?ya.toString:undefined;function ba(e){var t=-1,r=e?e.length:0;this.clear();while(++t<r){var n=e[t];this.set(n[0],n[1])}}function wa(){this.__data__=ma?ma(null):{}}function _a(e){return this.has(e)&&delete this.__data__[e]}function Sa(e){var t=this.__data__;if(ma){var r=t[e];return r===Bi?undefined:r}return la.call(t,e)?t[e]:undefined}function Ea(e){var t=this.__data__;return ma?t[e]!==undefined:la.call(t,e)}function Ta(e,t){var r=this.__data__;r[e]=ma&&t===undefined?Bi:t;return this}ba.prototype.clear=wa;ba.prototype["delete"]=_a;ba.prototype.get=Sa;ba.prototype.has=Ea;ba.prototype.set=Ta;function Ia(e){var t=-1,r=e?e.length:0;this.clear();while(++t<r){var n=e[t];this.set(n[0],n[1])}}function Da(){this.__data__=[]}function Ca(e){var t=this.__data__,r=Fa(t,e);if(r<0){return false}var n=t.length-1;if(r==n){t.pop()}else{pa.call(t,r,1)}return true}function Aa(e){var t=this.__data__,r=Fa(t,e);return r<0?undefined:t[r][1]}function Na(e){return Fa(this.__data__,e)>-1}function ka(e,t){var r=this.__data__,n=Fa(r,e);if(n<0){r.push([e,t])}else{r[n][1]=t}return this}Ia.prototype.clear=Da;Ia.prototype["delete"]=Ca;Ia.prototype.get=Aa;Ia.prototype.has=Na;Ia.prototype.set=ka;function Oa(e){var t=-1,r=e?e.length:0;this.clear();while(++t<r){var n=e[t];this.set(n[0],n[1])}}function Ma(){this.__data__={hash:new ba,map:new(va||Ia),string:new ba}}function xa(e){return Ua(this,e)["delete"](e)}function Pa(e){return Ua(this,e).get(e)}function Ra(e){return Ua(this,e).has(e)}function La(e,t){Ua(this,e).set(e,t);return this}Oa.prototype.clear=Ma;Oa.prototype["delete"]=xa;Oa.prototype.get=Pa;Oa.prototype.has=Ra;Oa.prototype.set=La;function Fa(e,t){var r=e.length;while(r--){if(Xa(e[r][0],t)){return r}}return-1}function Va(e,t){t=za(t,e)?[t]:Ba(t);var r=0,n=t.length;while(e!=null&&r<n){e=e[Ha(t[r++])]}return r&&r==n?e:undefined}function qa(e){if(!eo(e)||Ka(e)){return false}var t=Za(e)||na(e)?ha:Ji;return t.test(Ya(e))}function ja(e){if(typeof e=="string"){return e}if(ro(e)){return ga?ga.call(e):""}var t=e+"";return t=="0"&&1/e==-Ui?"-0":t}function Ba(e){return Ja(e)?e:Ga(e)}function Ua(e,t){var r=e.__data__;return Qa(t)?r[typeof t=="string"?"string":"hash"]:r.map}function Wa(e,t){var r=ra(e,t);return qa(r)?r:undefined}function za(e,t){if(Ja(e)){return false}var r=typeof e;if(r=="number"||r=="symbol"||r=="boolean"||e==null||ro(e)){return true}return Gi.test(e)||!Ki.test(e)||t!=null&&e in Object(t)}function Qa(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ka(e){return!!ua&&ua in e}var Ga=$a((function(e){e=no(e);var t=[];if(Hi.test(e)){t.push("")}e.replace(Yi,(function(e,r,n,i){t.push(n?i.replace(Xi,"$1"):r||e)}));return t}));function Ha(e){if(typeof e=="string"||ro(e)){return e}var t=e+"";return t=="0"&&1/e==-Ui?"-0":t}function Ya(e){if(e!=null){try{return ca.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function $a(e,t){if(typeof e!="function"||t&&typeof t!="function"){throw new TypeError(ji)}var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i)){return a.get(i)}var o=e.apply(this,n);r.cache=a.set(i,o);return o};r.cache=new($a.Cache||Oa);return r}$a.Cache=Oa;function Xa(e,t){return e===t||e!==e&&t!==t}var Ja=Array.isArray;function Za(e){var t=eo(e)?fa.call(e):"";return t==Wi||t==zi}function eo(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function to(e){return!!e&&typeof e=="object"}function ro(e){return typeof e=="symbol"||to(e)&&fa.call(e)==Qi}function no(e){return e==null?"":ja(e)}function io(e,t,r){var n=e==null?undefined:Va(e,t);return n===undefined?r:n}var ao=io;var oo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e,t){if(t.startsWith("/")){return ao(e.original,t.substr(1))}return e.tip[t]}t.getValue=r}));p(oo);var so=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e,t,r){e.tip[t]=r;if(t==="::tip::"){e.parentArray[e.currentIndex]=r}}t.patchValue=r}));p(so);var uo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.skippable=function(e,t,r){if(t==="::tip::"){return false}if(r.existyStrict){return e===undefined}if(typeof e==="string"){return e.trim().length===0}return e===null||e===undefined}}));p(uo);var co=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.cast=Vi.cast;t.ensureLength=qi.ensureLength;t.getValue=oo.getValue;t.patchValue=so.patchValue;t.skippable=uo.skippable}));p(co);var lo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.above=function(e,t){return e>t}}));p(lo);var fo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="above:make sure to define minValue";var n="above:min value must be defined as an integer";var i={async:false,compile:function(e){co.ensureLength(e,r,1);var t=co.cast(e[0],"integer",n);return[t]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);return co.skippable(a,t,n)||lo.above(a,i)}};t.default=i}));p(fo);var ho=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.existy=function(e){if(typeof e==="string"){return e.trim().length>0}return e!==null&&e!==undefined}}));p(ho);var po=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.truthy=function(e){return ho.existy(e)&&e!==false&&e!==0}}));p(po);var vo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||po.truthy(i)}};t.default=r}));p(vo);var mo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=/^[a-z]+$/i;t.alpha=function(e){return typeof e==="string"&&r.test(e)}}));p(mo);var yo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||mo.alpha(i)}};t.default=r}));p(yo);var go=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=/^[a-z0-9]+$/i;t.alphaNumeric=function(e){return typeof e==="string"&&r.test(e)}}));p(go);var bo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||go.alphaNumeric(i)}};t.default=r}));p(bo);var wo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t){var r=co.getValue(e,t);var n={existyStrict:true};return co.skippable(r,t,n)||Array.isArray(r)}};t.default=r}));p(wo);var _o=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);if(co.skippable(i,t,n)){return true}var a=co.cast(i,"boolean");if(a===null){return false}co.patchValue(e,t,a);return true}};t.default=r}));p(_o);var So=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.same=function(e,t){return e===t}}));p(So);var Eo=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e,t){if(t==="string"){return co.cast(e,"string")}if(t==="number"){return co.cast(e,"integer")}return e}var n={async:false,validate:function(e,t,n,i){var a=co.getValue(e,t);if(co.skippable(a,t,i)){return true}var o=typeof a;var s=co.getValue(e,t+"_confirmation");if(typeof s!==o){s=r(s,o)}return So.same(a,s)}};t.default=n}));p(Eo);var To=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=["yes","true","y","ok","okay"];t.affirmative=function(e){if(e==="A"||e===true){return true}return r.indexOf(e.toLowerCase())>-1}}));p(To);var Io=6e4;var Do=function e(t){var r=new Date(t.getTime());var n=r.getTimezoneOffset();r.setSeconds(0,0);var i=r.getTime()%Io;return n*Io+i};function Co(e){return e instanceof Date}var Ao=Co;var No=36e5;var ko=6e4;var Oo=2;var Mo=/[T ]/;var xo=/:/;var Po=/^(\d{2})$/;var Ro=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/];var Lo=/^(\d{4})/;var Fo=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/];var Vo=/^-(\d{2})$/;var qo=/^-?(\d{3})$/;var jo=/^-?(\d{2})-?(\d{2})$/;var Bo=/^-?W(\d{2})$/;var Uo=/^-?W(\d{2})-?(\d{1})$/;var Wo=/^(\d{2}([.,]\d*)?)$/;var zo=/^(\d{2}):?(\d{2}([.,]\d*)?)$/;var Qo=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/;var Ko=/([Z+-].*)$/;var Go=/^(Z)$/;var Ho=/^([+-])(\d{2})$/;var Yo=/^([+-])(\d{2}):?(\d{2})$/;function $o(e,t){if(Ao(e)){return new Date(e.getTime())}else if(typeof e!=="string"){return new Date(e)}var r=t||{};var n=r.additionalDigits;if(n==null){n=Oo}else{n=Number(n)}var i=Xo(e);var a=Jo(i.date,n);var o=a.year;var s=a.restDateString;var u=Zo(s,o);if(u){var c=u.getTime();var l=0;var f;if(i.time){l=es(i.time)}if(i.timezone){f=ts(i.timezone)*ko}else{var h=c+l;var d=new Date(h);f=Do(d);var p=new Date(h);p.setDate(d.getDate()+1);var v=Do(p)-Do(d);if(v>0){f+=v}}return new Date(c+l+f)}else{return new Date(e)}}function Xo(e){var t={};var r=e.split(Mo);var n;if(xo.test(r[0])){t.date=null;n=r[0]}else{t.date=r[0];n=r[1]}if(n){var i=Ko.exec(n);if(i){t.time=n.replace(i[1],"");t.timezone=i[1]}else{t.time=n}}return t}function Jo(e,t){var r=Ro[t];var n=Fo[t];var i;i=Lo.exec(e)||n.exec(e);if(i){var a=i[1];return{year:parseInt(a,10),restDateString:e.slice(a.length)}}i=Po.exec(e)||r.exec(e);if(i){var o=i[1];return{year:parseInt(o,10)*100,restDateString:e.slice(o.length)}}return{year:null}}function Zo(e,t){if(t===null){return null}var r;var n;var i;var a;if(e.length===0){n=new Date(0);n.setUTCFullYear(t);return n}r=Vo.exec(e);if(r){n=new Date(0);i=parseInt(r[1],10)-1;n.setUTCFullYear(t,i);return n}r=qo.exec(e);if(r){n=new Date(0);var o=parseInt(r[1],10);n.setUTCFullYear(t,0,o);return n}r=jo.exec(e);if(r){n=new Date(0);i=parseInt(r[1],10)-1;var s=parseInt(r[2],10);n.setUTCFullYear(t,i,s);return n}r=Bo.exec(e);if(r){a=parseInt(r[1],10)-1;return rs(t,a)}r=Uo.exec(e);if(r){a=parseInt(r[1],10)-1;var u=parseInt(r[2],10)-1;return rs(t,a,u)}return null}function es(e){var t;var r;var n;t=Wo.exec(e);if(t){r=parseFloat(t[1].replace(",","."));return r%24*No}t=zo.exec(e);if(t){r=parseInt(t[1],10);n=parseFloat(t[2].replace(",","."));return r%24*No+n*ko}t=Qo.exec(e);if(t){r=parseInt(t[1],10);n=parseInt(t[2],10);var i=parseFloat(t[3].replace(",","."));return r%24*No+n*ko+i*1e3}return null}function ts(e){var t;var r;t=Go.exec(e);if(t){return 0}t=Ho.exec(e);if(t){r=parseInt(t[2],10)*60;return t[1]==="+"?-r:r}t=Yo.exec(e);if(t){r=parseInt(t[2],10)*60+parseInt(t[3],10);return t[1]==="+"?-r:r}return 0}function rs(e,t,r){t=t||0;r=r||0;var n=new Date(0);n.setUTCFullYear(e,0,4);var i=n.getUTCDay()||7;var a=t*7+r+1-i;n.setUTCDate(n.getUTCDate()+a);return n}var ns=$o;function is(e,t){var r=ns(e);var n=Number(t);r.setDate(r.getDate()+n);return r}var as=is;function os(e,t){var r=ns(e).getTime();var n=Number(t);return new Date(r+n)}var ss=os;var us=36e5;function cs(e,t){var r=Number(t);return ss(e,r*us)}var ls=cs;function fs(e,t){var r=t?Number(t.weekStartsOn)||0:0;var n=ns(e);var i=n.getDay();var a=(i<r?7:0)+i-r;n.setDate(n.getDate()-a);n.setHours(0,0,0,0);return n}var hs=fs;function ds(e){return hs(e,{weekStartsOn:1})}var ps=ds;function vs(e){var t=ns(e);var r=t.getFullYear();var n=new Date(0);n.setFullYear(r+1,0,4);n.setHours(0,0,0,0);var i=ps(n);var a=new Date(0);a.setFullYear(r,0,4);a.setHours(0,0,0,0);var o=ps(a);if(t.getTime()>=i.getTime()){return r+1}else if(t.getTime()>=o.getTime()){return r}else{return r-1}}var ms=vs;function ys(e){var t=ms(e);var r=new Date(0);r.setFullYear(t,0,4);r.setHours(0,0,0,0);var n=ps(r);return n}var gs=ys;function bs(e){var t=ns(e);t.setHours(0,0,0,0);return t}var ws=bs;var _s=6e4;var Ss=864e5;function Es(e,t){var r=ws(e);var n=ws(t);var i=r.getTime()-r.getTimezoneOffset()*_s;var a=n.getTime()-n.getTimezoneOffset()*_s;return Math.round((i-a)/Ss)}var Ts=Es;function Is(e,t){var r=ns(e);var n=Number(t);var i=Ts(r,gs(r));var a=new Date(0);a.setFullYear(n,0,4);a.setHours(0,0,0,0);r=gs(a);r.setDate(r.getDate()+i);return r}var Ds=Is;function Cs(e,t){var r=Number(t);return Ds(e,ms(e)+r)}var As=Cs;var Ns=6e4;function ks(e,t){var r=Number(t);return ss(e,r*Ns)}var Os=ks;function Ms(e){var t=ns(e);var r=t.getFullYear();var n=t.getMonth();var i=new Date(0);i.setFullYear(r,n+1,0);i.setHours(0,0,0,0);return i.getDate()}var xs=Ms;function Ps(e,t){var r=ns(e);var n=Number(t);var i=r.getMonth()+n;var a=new Date(0);a.setFullYear(r.getFullYear(),i,1);a.setHours(0,0,0,0);var o=xs(a);r.setMonth(i,Math.min(o,r.getDate()));return r}var Rs=Ps;function Ls(e,t){var r=Number(t);var n=r*3;return Rs(e,n)}var Fs=Ls;function Vs(e,t){var r=Number(t);return ss(e,r*1e3)}var qs=Vs;function js(e,t){var r=Number(t);var n=r*7;return as(e,n)}var Bs=js;function Us(e,t){var r=Number(t);return Rs(e,r*12)}var Ws=Us;function zs(e,t,r,n){var i=ns(e).getTime();var a=ns(t).getTime();var o=ns(r).getTime();var s=ns(n).getTime();if(i>a||o>s){throw new Error("The start of the range cannot be after the end of the range")}return i<s&&o<a}var Qs=zs;function Ks(e,t){if(!(t instanceof Array)){throw new TypeError(toString.call(t)+" is not an instance of Array")}var r=ns(e);var n=r.getTime();var i;var a;t.forEach((function(e,t){var r=ns(e);var o=Math.abs(n-r.getTime());if(i===undefined||o<a){i=t;a=o}}));return i}var Gs=Ks;function Hs(e,t){if(!(t instanceof Array)){throw new TypeError(toString.call(t)+" is not an instance of Array")}var r=ns(e);var n=r.getTime();var i;var a;t.forEach((function(e){var t=ns(e);var r=Math.abs(n-t.getTime());if(i===undefined||r<a){i=t;a=r}}));return i}var Ys=Hs;function $s(e,t){var r=ns(e);var n=r.getTime();var i=ns(t);var a=i.getTime();if(n<a){return-1}else if(n>a){return 1}else{return 0}}var Xs=$s;function Js(e,t){var r=ns(e);var n=r.getTime();var i=ns(t);var a=i.getTime();if(n>a){return-1}else if(n<a){return 1}else{return 0}}var Zs=Js;var eu=6e4;var tu=6048e5;function ru(e,t){var r=ps(e);var n=ps(t);var i=r.getTime()-r.getTimezoneOffset()*eu;var a=n.getTime()-n.getTimezoneOffset()*eu;return Math.round((i-a)/tu)}var nu=ru;function iu(e,t){return ms(e)-ms(t)}var au=iu;function ou(e,t){var r=ns(e);var n=ns(t);var i=r.getFullYear()-n.getFullYear();var a=r.getMonth()-n.getMonth();return i*12+a}var su=ou;function uu(e){var t=ns(e);var r=Math.floor(t.getMonth()/3)+1;return r}var cu=uu;function lu(e,t){var r=ns(e);var n=ns(t);var i=r.getFullYear()-n.getFullYear();var a=cu(r)-cu(n);return i*4+a}var fu=lu;var hu=6e4;var du=6048e5;function pu(e,t,r){var n=hs(e,r);var i=hs(t,r);var a=n.getTime()-n.getTimezoneOffset()*hu;var o=i.getTime()-i.getTimezoneOffset()*hu;return Math.round((a-o)/du)}var vu=pu;function mu(e,t){var r=ns(e);var n=ns(t);return r.getFullYear()-n.getFullYear()}var yu=mu;function gu(e,t){var r=ns(e);var n=ns(t);var i=Xs(r,n);var a=Math.abs(Ts(r,n));r.setDate(r.getDate()-i*a);var o=Xs(r,n)===-i;return i*(a-o)}var bu=gu;function wu(e,t){var r=ns(e);var n=ns(t);return r.getTime()-n.getTime()}var _u=wu;var Su=36e5;function Eu(e,t){var r=_u(e,t)/Su;return r>0?Math.floor(r):Math.ceil(r)}var Tu=Eu;function Iu(e,t){var r=Number(t);return As(e,-r)}var Du=Iu;function Cu(e,t){var r=ns(e);var n=ns(t);var i=Xs(r,n);var a=Math.abs(au(r,n));r=Du(r,i*a);var o=Xs(r,n)===-i;return i*(a-o)}var Au=Cu;var Nu=6e4;function ku(e,t){var r=_u(e,t)/Nu;return r>0?Math.floor(r):Math.ceil(r)}var Ou=ku;function Mu(e,t){var r=ns(e);var n=ns(t);var i=Xs(r,n);var a=Math.abs(su(r,n));r.setMonth(r.getMonth()-i*a);var o=Xs(r,n)===-i;return i*(a-o)}var xu=Mu;function Pu(e,t){var r=xu(e,t)/3;return r>0?Math.floor(r):Math.ceil(r)}var Ru=Pu;function Lu(e,t){var r=_u(e,t)/1e3;return r>0?Math.floor(r):Math.ceil(r)}var Fu=Lu;function Vu(e,t){var r=bu(e,t)/7;return r>0?Math.floor(r):Math.ceil(r)}var qu=Vu;function ju(e,t){var r=ns(e);var n=ns(t);var i=Xs(r,n);var a=Math.abs(yu(r,n));r.setFullYear(r.getFullYear()-i*a);var o=Xs(r,n)===-i;return i*(a-o)}var Bu=ju;function Uu(){var e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function t(t,r,n){n=n||{};var i;if(typeof e[t]==="string"){i=e[t]}else if(r===1){i=e[t].one}else{i=e[t].other.replace("{{count}}",r)}if(n.addSuffix){if(n.comparison>0){return"in "+i}else{return i+" ago"}}return i}return{localize:t}}var Wu=Uu;var zu=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"];function Qu(e){var t=[];for(var r in e){if(e.hasOwnProperty(r)){t.push(r)}}var n=zu.concat(t).sort().reverse();var i=new RegExp("(\\[[^\\[]*\\])|(\\\\)?"+"("+n.join("|")+"|.)","g");return i}var Ku=Qu;function Gu(){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var t=["January","February","March","April","May","June","July","August","September","October","November","December"];var r=["Su","Mo","Tu","We","Th","Fr","Sa"];var n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var a=["AM","PM"];var o=["am","pm"];var s=["a.m.","p.m."];var u={MMM:function(t){return e[t.getMonth()]},MMMM:function(e){return t[e.getMonth()]},dd:function(e){return r[e.getDay()]},ddd:function(e){return n[e.getDay()]},dddd:function(e){return i[e.getDay()]},A:function(e){return e.getHours()/12>=1?a[1]:a[0]},a:function(e){return e.getHours()/12>=1?o[1]:o[0]},aa:function(e){return e.getHours()/12>=1?s[1]:s[0]}};var c=["M","D","DDD","d","Q","W"];c.forEach((function(e){u[e+"o"]=function(t,r){return Hu(r[e](t))}}));return{formatters:u,formattingTokensRegExp:Ku(u)}}function Hu(e){var t=e%100;if(t>20||t<10){switch(t%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}}return e+"th"}var Yu=Gu;var $u={distanceInWords:Wu(),format:Yu()};var Xu=1440;var Ju=2520;var Zu=43200;var ec=86400;function tc(e,t,r){var n=r||{};var i=Zs(e,t);var a=n.locale;var o=$u.distanceInWords.localize;if(a&&a.distanceInWords&&a.distanceInWords.localize){o=a.distanceInWords.localize}var s={addSuffix:Boolean(n.addSuffix),comparison:i};var u,c;if(i>0){u=ns(e);c=ns(t)}else{u=ns(t);c=ns(e)}var l=Fu(c,u);var f=c.getTimezoneOffset()-u.getTimezoneOffset();var h=Math.round(l/60)-f;var d;if(h<2){if(n.includeSeconds){if(l<5){return o("lessThanXSeconds",5,s)}else if(l<10){return o("lessThanXSeconds",10,s)}else if(l<20){return o("lessThanXSeconds",20,s)}else if(l<40){return o("halfAMinute",null,s)}else if(l<60){return o("lessThanXMinutes",1,s)}else{return o("xMinutes",1,s)}}else{if(h===0){return o("lessThanXMinutes",1,s)}else{return o("xMinutes",h,s)}}}else if(h<45){return o("xMinutes",h,s)}else if(h<90){return o("aboutXHours",1,s)}else if(h<Xu){var p=Math.round(h/60);return o("aboutXHours",p,s)}else if(h<Ju){return o("xDays",1,s)}else if(h<Zu){var v=Math.round(h/Xu);return o("xDays",v,s)}else if(h<ec){d=Math.round(h/Zu);return o("aboutXMonths",d,s)}d=xu(c,u);if(d<12){var m=Math.round(h/Zu);return o("xMonths",m,s)}else{var y=d%12;var g=Math.floor(d/12);if(y<3){return o("aboutXYears",g,s)}else if(y<9){return o("overXYears",g,s)}else{return o("almostXYears",g+1,s)}}}var rc=tc;var nc=1440;var ic=43200;var ac=525600;function oc(e,t,r){var n=r||{};var i=Zs(e,t);var a=n.locale;var o=$u.distanceInWords.localize;if(a&&a.distanceInWords&&a.distanceInWords.localize){o=a.distanceInWords.localize}var s={addSuffix:Boolean(n.addSuffix),comparison:i};var u,c;if(i>0){u=ns(e);c=ns(t)}else{u=ns(t);c=ns(e)}var l;var f=Math[n.partialMethod?String(n.partialMethod):"floor"];var h=Fu(c,u);var d=c.getTimezoneOffset()-u.getTimezoneOffset();var p=f(h/60)-d;var v,m,y,g;if(n.unit){l=String(n.unit)}else{if(p<1){l="s"}else if(p<60){l="m"}else if(p<nc){l="h"}else if(p<ic){l="d"}else if(p<ac){l="M"}else{l="Y"}}if(l==="s"){return o("xSeconds",h,s)}else if(l==="m"){return o("xMinutes",p,s)}else if(l==="h"){v=f(p/60);return o("xHours",v,s)}else if(l==="d"){m=f(p/nc);return o("xDays",m,s)}else if(l==="M"){y=f(p/ic);return o("xMonths",y,s)}else if(l==="Y"){g=f(p/ac);return o("xYears",g,s)}throw new Error("Unknown unit: "+l)}var sc=oc;function uc(e,t){return rc(Date.now(),e,t)}var cc=uc;function lc(e,t,r){var n=ns(e);var i=ns(t);var a=r!==undefined?r:1;var o=i.getTime();if(n.getTime()>o){throw new Error("The first date cannot be after the second date")}var s=[];var u=n;u.setHours(0,0,0,0);while(u.getTime()<=o){s.push(ns(u));u.setDate(u.getDate()+a)}return s}var fc=lc;function hc(e){var t=ns(e);t.setHours(23,59,59,999);return t}var dc=hc;function pc(e){var t=ns(e);t.setMinutes(59,59,999);return t}var vc=pc;function mc(e,t){var r=t?Number(t.weekStartsOn)||0:0;var n=ns(e);var i=n.getDay();var a=(i<r?-7:0)+6-(i-r);n.setDate(n.getDate()+a);n.setHours(23,59,59,999);return n}var yc=mc;function gc(e){return yc(e,{weekStartsOn:1})}var bc=gc;function wc(e){var t=ms(e);var r=new Date(0);r.setFullYear(t+1,0,4);r.setHours(0,0,0,0);var n=ps(r);n.setMilliseconds(n.getMilliseconds()-1);return n}var _c=wc;function Sc(e){var t=ns(e);t.setSeconds(59,999);return t}var Ec=Sc;function Tc(e){var t=ns(e);var r=t.getMonth();t.setFullYear(t.getFullYear(),r+1,0);t.setHours(23,59,59,999);return t}var Ic=Tc;function Dc(e){var t=ns(e);var r=t.getMonth();var n=r-r%3+3;t.setMonth(n,0);t.setHours(23,59,59,999);return t}var Cc=Dc;function Ac(e){var t=ns(e);t.setMilliseconds(999);return t}var Nc=Ac;function kc(){return dc(new Date)}var Oc=kc;function Mc(){var e=new Date;var t=e.getFullYear();var r=e.getMonth();var n=e.getDate();var i=new Date(0);i.setFullYear(t,r,n+1);i.setHours(23,59,59,999);return i}var xc=Mc;function Pc(e){var t=ns(e);var r=t.getFullYear();t.setFullYear(r+1,0,0);t.setHours(23,59,59,999);return t}var Rc=Pc;function Lc(){var e=new Date;var t=e.getFullYear();var r=e.getMonth();var n=e.getDate();var i=new Date(0);i.setFullYear(t,r,n-1);i.setHours(23,59,59,999);return i}var Fc=Lc;function Vc(e){var t=ns(e);var r=new Date(0);r.setFullYear(t.getFullYear(),0,1);r.setHours(0,0,0,0);return r}var qc=Vc;function jc(e){var t=ns(e);var r=Ts(t,qc(t));var n=r+1;return n}var Bc=jc;var Uc=6048e5;function Wc(e){var t=ns(e);var r=ps(t).getTime()-gs(t).getTime();return Math.round(r/Uc)+1}var zc=Wc;function Qc(e){if(Ao(e)){return!isNaN(e)}else{throw new TypeError(toString.call(e)+" is not an instance of Date")}}var Kc=Qc;function Gc(e,t,r){var n=t?String(t):"YYYY-MM-DDTHH:mm:ss.SSSZ";var i=r||{};var a=i.locale;var o=$u.format.formatters;var s=$u.format.formattingTokensRegExp;if(a&&a.format&&a.format.formatters){o=a.format.formatters;if(a.format.formattingTokensRegExp){s=a.format.formattingTokensRegExp}}var u=ns(e);if(!Kc(u)){return"Invalid Date"}var c=Yc(n,o,s);return c(u)}var Hc={M:function(e){return e.getMonth()+1},MM:function(e){return Jc(e.getMonth()+1,2)},Q:function(e){return Math.ceil((e.getMonth()+1)/3)},D:function(e){return e.getDate()},DD:function(e){return Jc(e.getDate(),2)},DDD:function(e){return Bc(e)},DDDD:function(e){return Jc(Bc(e),3)},d:function(e){return e.getDay()},E:function(e){return e.getDay()||7},W:function(e){return zc(e)},WW:function(e){return Jc(zc(e),2)},YY:function(e){return Jc(e.getFullYear(),4).substr(2)},YYYY:function(e){return Jc(e.getFullYear(),4)},GG:function(e){return String(ms(e)).substr(2)},GGGG:function(e){return ms(e)},H:function(e){return e.getHours()},HH:function(e){return Jc(e.getHours(),2)},h:function(e){var t=e.getHours();if(t===0){return 12}else if(t>12){return t%12}else{return t}},hh:function(e){return Jc(Hc["h"](e),2)},m:function(e){return e.getMinutes()},mm:function(e){return Jc(e.getMinutes(),2)},s:function(e){return e.getSeconds()},ss:function(e){return Jc(e.getSeconds(),2)},S:function(e){return Math.floor(e.getMilliseconds()/100)},SS:function(e){return Jc(Math.floor(e.getMilliseconds()/10),2)},SSS:function(e){return Jc(e.getMilliseconds(),3)},Z:function(e){return Xc(e.getTimezoneOffset(),":")},ZZ:function(e){return Xc(e.getTimezoneOffset())},X:function(e){return Math.floor(e.getTime()/1e3)},x:function(e){return e.getTime()}};function Yc(e,t,r){var n=e.match(r);var i=n.length;var a;var o;for(a=0;a<i;a++){o=t[n[a]]||Hc[n[a]];if(o){n[a]=o}else{n[a]=$c(n[a])}}return function(e){var t="";for(var r=0;r<i;r++){if(n[r]instanceof Function){t+=n[r](e,Hc)}else{t+=n[r]}}return t}}function $c(e){if(e.match(/\[[\s\S]/)){return e.replace(/^\[|]$/g,"")}return e.replace(/\\/g,"")}function Xc(e,t){t=t||"";var r=e>0?"-":"+";var n=Math.abs(e);var i=Math.floor(n/60);var a=n%60;return r+Jc(i,2)+t+Jc(a,2)}function Jc(e,t){var r=Math.abs(e).toString();while(r.length<t){r="0"+r}return r}var Zc=Gc;function el(e){var t=ns(e);var r=t.getDate();return r}var tl=el;function rl(e){var t=ns(e);var r=t.getDay();return r}var nl=rl;function il(e){var t=ns(e);var r=t.getFullYear();return r%400===0||r%4===0&&r%100!==0}var al=il;function ol(e){return al(e)?366:365}var sl=ol;function ul(e){var t=ns(e);var r=t.getHours();return r}var cl=ul;function ll(e){var t=ns(e);var r=t.getDay();if(r===0){r=7}return r}var fl=ll;var hl=6048e5;function dl(e){var t=gs(e);var r=gs(Bs(t,60));var n=r.valueOf()-t.valueOf();return Math.round(n/hl)}var pl=dl;function vl(e){var t=ns(e);var r=t.getMilliseconds();return r}var ml=vl;function yl(e){var t=ns(e);var r=t.getMinutes();return r}var gl=yl;function bl(e){var t=ns(e);var r=t.getMonth();return r}var wl=bl;var _l=24*60*60*1e3;function Sl(e,t,r,n){var i=ns(e).getTime();var a=ns(t).getTime();var o=ns(r).getTime();var s=ns(n).getTime();if(i>a||o>s){throw new Error("The start of the range cannot be after the end of the range")}var u=i<s&&o<a;if(!u){return 0}var c=o<i?i:o;var l=s>a?a:s;var f=l-c;return Math.ceil(f/_l)}var El=Sl;function Tl(e){var t=ns(e);var r=t.getSeconds();return r}var Il=Tl;function Dl(e){var t=ns(e);var r=t.getTime();return r}var Cl=Dl;function Al(e){var t=ns(e);var r=t.getFullYear();return r}var Nl=Al;function kl(e,t){var r=ns(e);var n=ns(t);return r.getTime()>n.getTime()}var Ol=kl;function Ml(e,t){var r=ns(e);var n=ns(t);return r.getTime()<n.getTime()}var xl=Ml;function Pl(e,t){var r=ns(e);var n=ns(t);return r.getTime()===n.getTime()}var Rl=Pl;function Ll(e){return ns(e).getDate()===1}var Fl=Ll;function Vl(e){return ns(e).getDay()===5}var ql=Vl;function jl(e){return ns(e).getTime()>(new Date).getTime()}var Bl=jl;function Ul(e){var t=ns(e);return dc(t).getTime()===Ic(t).getTime()}var Wl=Ul;function zl(e){return ns(e).getDay()===1}var Ql=zl;function Kl(e){return ns(e).getTime()<(new Date).getTime()}var Gl=Kl;function Hl(e,t){var r=ws(e);var n=ws(t);return r.getTime()===n.getTime()}var Yl=Hl;function $l(e){var t=ns(e);t.setMinutes(0,0,0);return t}var Xl=$l;function Jl(e,t){var r=Xl(e);var n=Xl(t);return r.getTime()===n.getTime()}var Zl=Jl;function ef(e,t,r){var n=hs(e,r);var i=hs(t,r);return n.getTime()===i.getTime()}var tf=ef;function rf(e,t){return tf(e,t,{weekStartsOn:1})}var nf=rf;function af(e,t){var r=gs(e);var n=gs(t);return r.getTime()===n.getTime()}var of=af;function sf(e){var t=ns(e);t.setSeconds(0,0);return t}var uf=sf;function cf(e,t){var r=uf(e);var n=uf(t);return r.getTime()===n.getTime()}var lf=cf;function ff(e,t){var r=ns(e);var n=ns(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}var hf=ff;function df(e){var t=ns(e);var r=t.getMonth();var n=r-r%3;t.setMonth(n,1);t.setHours(0,0,0,0);return t}var pf=df;function vf(e,t){var r=pf(e);var n=pf(t);return r.getTime()===n.getTime()}var mf=vf;function yf(e){var t=ns(e);t.setMilliseconds(0);return t}var gf=yf;function bf(e,t){var r=gf(e);var n=gf(t);return r.getTime()===n.getTime()}var wf=bf;function _f(e,t){var r=ns(e);var n=ns(t);return r.getFullYear()===n.getFullYear()}var Sf=_f;function Ef(e){return ns(e).getDay()===6}var Tf=Ef;function If(e){return ns(e).getDay()===0}var Df=If;function Cf(e){return Zl(new Date,e)}var Af=Cf;function Nf(e){return nf(new Date,e)}var kf=Nf;function Of(e){return of(new Date,e)}var Mf=Of;function xf(e){return lf(new Date,e)}var Pf=xf;function Rf(e){return hf(new Date,e)}var Lf=Rf;function Ff(e){return mf(new Date,e)}var Vf=Ff;function qf(e){return wf(new Date,e)}var jf=qf;function Bf(e,t){return tf(new Date,e,t)}var Uf=Bf;function Wf(e){return Sf(new Date,e)}var zf=Wf;function Qf(e){return ns(e).getDay()===4}var Kf=Qf;function Gf(e){return ws(e).getTime()===ws(new Date).getTime()}var Hf=Gf;function Yf(e){var t=new Date;t.setDate(t.getDate()+1);return ws(e).getTime()===ws(t).getTime()}var $f=Yf;function Xf(e){return ns(e).getDay()===2}var Jf=Xf;function Zf(e){return ns(e).getDay()===3}var eh=Zf;function th(e){var t=ns(e);var r=t.getDay();return r===0||r===6}var rh=th;function nh(e,t,r){var n=ns(e).getTime();var i=ns(t).getTime();var a=ns(r).getTime();if(i>a){throw new Error("The start of the range cannot be after the end of the range")}return n>=i&&n<=a}var ih=nh;function ah(e){var t=new Date;t.setDate(t.getDate()-1);return ws(e).getTime()===ws(t).getTime()}var oh=ah;function sh(e,t){var r=t?Number(t.weekStartsOn)||0:0;var n=ns(e);var i=n.getDay();var a=(i<r?-7:0)+6-(i-r);n.setHours(0,0,0,0);n.setDate(n.getDate()+a);return n}var uh=sh;function ch(e){return uh(e,{weekStartsOn:1})}var lh=ch;function fh(e){var t=ms(e);var r=new Date(0);r.setFullYear(t+1,0,4);r.setHours(0,0,0,0);var n=ps(r);n.setDate(n.getDate()-1);return n}var hh=fh;function dh(e){var t=ns(e);var r=t.getMonth();t.setFullYear(t.getFullYear(),r+1,0);t.setHours(0,0,0,0);return t}var ph=dh;function vh(e){var t=ns(e);var r=t.getMonth();var n=r-r%3+3;t.setMonth(n,0);t.setHours(0,0,0,0);return t}var mh=vh;function yh(e){var t=ns(e);var r=t.getFullYear();t.setFullYear(r+1,0,0);t.setHours(0,0,0,0);return t}var gh=yh;function bh(){var e=Array.prototype.slice.call(arguments);var t=e.map((function(e){return ns(e)}));var r=Math.max.apply(null,t);return new Date(r)}var wh=bh;function _h(){var e=Array.prototype.slice.call(arguments);var t=e.map((function(e){return ns(e)}));var r=Math.min.apply(null,t);return new Date(r)}var Sh=_h;function Eh(e,t){var r=ns(e);var n=Number(t);r.setDate(n);return r}var Th=Eh;function Ih(e,t,r){var n=r?Number(r.weekStartsOn)||0:0;var i=ns(e);var a=Number(t);var o=i.getDay();var s=a%7;var u=(s+7)%7;var c=(u<n?7:0)+a-o;return as(i,c)}var Dh=Ih;function Ch(e,t){var r=ns(e);var n=Number(t);r.setMonth(0);r.setDate(n);return r}var Ah=Ch;function Nh(e,t){var r=ns(e);var n=Number(t);r.setHours(n);return r}var kh=Nh;function Oh(e,t){var r=ns(e);var n=Number(t);var i=fl(r);var a=n-i;return as(r,a)}var Mh=Oh;function xh(e,t){var r=ns(e);var n=Number(t);var i=zc(r)-n;r.setDate(r.getDate()-i*7);return r}var Ph=xh;function Rh(e,t){var r=ns(e);var n=Number(t);r.setMilliseconds(n);return r}var Lh=Rh;function Fh(e,t){var r=ns(e);var n=Number(t);r.setMinutes(n);return r}var Vh=Fh;function qh(e,t){var r=ns(e);var n=Number(t);var i=r.getFullYear();var a=r.getDate();var o=new Date(0);o.setFullYear(i,n,15);o.setHours(0,0,0,0);var s=xs(o);r.setMonth(n,Math.min(a,s));return r}var jh=qh;function Bh(e,t){var r=ns(e);var n=Number(t);var i=Math.floor(r.getMonth()/3)+1;var a=n-i;return jh(r,r.getMonth()+a*3)}var Uh=Bh;function Wh(e,t){var r=ns(e);var n=Number(t);r.setSeconds(n);return r}var zh=Wh;function Qh(e,t){var r=ns(e);var n=Number(t);r.setFullYear(n);return r}var Kh=Qh;function Gh(e){var t=ns(e);t.setDate(1);t.setHours(0,0,0,0);return t}var Hh=Gh;function Yh(){return ws(new Date)}var $h=Yh;function Xh(){var e=new Date;var t=e.getFullYear();var r=e.getMonth();var n=e.getDate();var i=new Date(0);i.setFullYear(t,r,n+1);i.setHours(0,0,0,0);return i}var Jh=Xh;function Zh(){var e=new Date;var t=e.getFullYear();var r=e.getMonth();var n=e.getDate();var i=new Date(0);i.setFullYear(t,r,n-1);i.setHours(0,0,0,0);return i}var ed=Zh;function td(e,t){var r=Number(t);return as(e,-r)}var rd=td;function nd(e,t){var r=Number(t);return ls(e,-r)}var id=nd;function ad(e,t){var r=Number(t);return ss(e,-r)}var od=ad;function sd(e,t){var r=Number(t);return Os(e,-r)}var ud=sd;function cd(e,t){var r=Number(t);return Rs(e,-r)}var ld=cd;function fd(e,t){var r=Number(t);return Fs(e,-r)}var hd=fd;function dd(e,t){var r=Number(t);return qs(e,-r)}var pd=dd;function vd(e,t){var r=Number(t);return Bs(e,-r)}var md=vd;function yd(e,t){var r=Number(t);return Ws(e,-r)}var gd=yd;var bd={addDays:as,addHours:ls,addISOYears:As,addMilliseconds:ss,addMinutes:Os,addMonths:Rs,addQuarters:Fs,addSeconds:qs,addWeeks:Bs,addYears:Ws,areRangesOverlapping:Qs,closestIndexTo:Gs,closestTo:Ys,compareAsc:Xs,compareDesc:Zs,differenceInCalendarDays:Ts,differenceInCalendarISOWeeks:nu,differenceInCalendarISOYears:au,differenceInCalendarMonths:su,differenceInCalendarQuarters:fu,differenceInCalendarWeeks:vu,differenceInCalendarYears:yu,differenceInDays:bu,differenceInHours:Tu,differenceInISOYears:Au,differenceInMilliseconds:_u,differenceInMinutes:Ou,differenceInMonths:xu,differenceInQuarters:Ru,differenceInSeconds:Fu,differenceInWeeks:qu,differenceInYears:Bu,distanceInWords:rc,distanceInWordsStrict:sc,distanceInWordsToNow:cc,eachDay:fc,endOfDay:dc,endOfHour:vc,endOfISOWeek:bc,endOfISOYear:_c,endOfMinute:Ec,endOfMonth:Ic,endOfQuarter:Cc,endOfSecond:Nc,endOfToday:Oc,endOfTomorrow:xc,endOfWeek:yc,endOfYear:Rc,endOfYesterday:Fc,format:Zc,getDate:tl,getDay:nl,getDayOfYear:Bc,getDaysInMonth:xs,getDaysInYear:sl,getHours:cl,getISODay:fl,getISOWeek:zc,getISOWeeksInYear:pl,getISOYear:ms,getMilliseconds:ml,getMinutes:gl,getMonth:wl,getOverlappingDaysInRanges:El,getQuarter:cu,getSeconds:Il,getTime:Cl,getYear:Nl,isAfter:Ol,isBefore:xl,isDate:Ao,isEqual:Rl,isFirstDayOfMonth:Fl,isFriday:ql,isFuture:Bl,isLastDayOfMonth:Wl,isLeapYear:al,isMonday:Ql,isPast:Gl,isSameDay:Yl,isSameHour:Zl,isSameISOWeek:nf,isSameISOYear:of,isSameMinute:lf,isSameMonth:hf,isSameQuarter:mf,isSameSecond:wf,isSameWeek:tf,isSameYear:Sf,isSaturday:Tf,isSunday:Df,isThisHour:Af,isThisISOWeek:kf,isThisISOYear:Mf,isThisMinute:Pf,isThisMonth:Lf,isThisQuarter:Vf,isThisSecond:jf,isThisWeek:Uf,isThisYear:zf,isThursday:Kf,isToday:Hf,isTomorrow:$f,isTuesday:Jf,isValid:Kc,isWednesday:eh,isWeekend:rh,isWithinRange:ih,isYesterday:oh,lastDayOfISOWeek:lh,lastDayOfISOYear:hh,lastDayOfMonth:ph,lastDayOfQuarter:mh,lastDayOfWeek:uh,lastDayOfYear:gh,max:wh,min:Sh,parse:ns,setDate:Th,setDay:Dh,setDayOfYear:Ah,setHours:kh,setISODay:Mh,setISOWeek:Ph,setISOYear:Ds,setMilliseconds:Lh,setMinutes:Vh,setMonth:jh,setQuarter:Uh,setSeconds:zh,setYear:Kh,startOfDay:ws,startOfHour:Xl,startOfISOWeek:ps,startOfISOYear:gs,startOfMinute:uf,startOfMonth:Hh,startOfQuarter:pf,startOfSecond:gf,startOfToday:$h,startOfTomorrow:Jh,startOfWeek:hs,startOfYear:qc,startOfYesterday:ed,subDays:rd,subHours:id,subISOYears:Du,subMilliseconds:od,subMinutes:ud,subMonths:ld,subQuarters:hd,subSeconds:pd,subWeeks:md,subYears:gd};var wd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.after=bd.isAfter}));p(wd);var _d=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.array=function(e){return Array.isArray(e)}}));p(_d);var Sd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.between=function(e,t){var r=t[0],n=t[1];return e>r&&e<n}}));p(Sd);var Ed=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.isBoolean=function(e){return typeof e==="boolean"}}));p(Ed);var Td=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.default=n;function r(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){r=function e(t){return typeof t}}else{r=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return r(e)}function n(e){var t=typeof e==="string"||e instanceof String;if(!t){var n;if(e===null){n="null"}else{n=r(e);if(n==="object"&&e.constructor&&e.constructor.hasOwnProperty("name")){n=e.constructor.name}else{n="a ".concat(n)}}throw new TypeError("Expected string but received ".concat(n,"."))}}e.exports=t.default;e.exports.default=t.default}));p(Td);var Id=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.default=a;var r=n(Td);function n(e){return e&&e.__esModule?e:{default:e}}var i=/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11}|6[27][0-9]{14})$/;function a(e){(0,r.default)(e);var t=e.replace(/[- ]+/g,"");if(!i.test(t)){return false}var n=0;var a;var o;var s;for(var u=t.length-1;u>=0;u--){a=t.substring(u,u+1);o=parseInt(a,10);if(s){o*=2;if(o>=10){n+=o%10+1}else{n+=o}}else{n+=o}s=!s}return!!(n%10===0?t:false)}e.exports=t.default;e.exports.default=t.default}));p(Id);var Dd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.creditCard=function(e){return Id.default(e)}}));p(Dd);var Cd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.date=function(e){return e instanceof Date===true}}));p(Cd);var Ad=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i;t.email=function(e){return r.test(e)}}));p(Ad);var Nd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.empty=function(e){if(!ho.existy(e)){return true}if(e instanceof Date){return false}if(typeof e==="object"){return Object.keys(e).length===0}return false}}));p(Nd);var kd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.even=function(e){return e%2===0}}));p(kd);var Od=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.falsy=function(e){return!po.truthy(e)}}));p(Od);var Md=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.inArray=function(e,t){if(!Array.isArray(t)){return false}return t.indexOf(e)>-1}}));p(Md);var xd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.intersectAll=function(e,t){if(!Array.isArray(e)||!Array.isArray(t)){return false}return e.filter((function(e){return t.indexOf(e)>-1})).length===e.length}}));p(xd);var Pd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.intersectAny=function(e,t){if(!Array.isArray(e)||!Array.isArray(t)){return false}return e.filter((function(e){return t.indexOf(e)>-1})).length>0}}));p(Pd);var Rd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=/^(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}$/;t.ipv4=function(e){return r.test(e)}}));p(Rd);var Ld=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=/^(?:(?:[0-9a-fA-F:]){1,4}(?:(?::(?:[0-9a-fA-F]){1,4}|:)){2,7})+$/;t.ipv6=function(e){return r.test(e)}}));p(Ld);var Fd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.ip=function(e){return Rd.ipv4(e)||Ld.ipv6(e)}}));p(Fd);var Vd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.isFunction=function(e){return typeof e==="function"}}));p(Vd);var qd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.json=function(e){if(typeof e!=="string"){return false}try{return!!JSON.parse(e)}catch(e){return false}}}));p(qd);var jd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.positive=function(e){return e>=0}}));p(jd);var Bd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.negative=function(e){return!jd.positive(e)}}));p(Bd);var Ud=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.isNull=function(e){return e===null}}));p(Ud);var Wd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.isNumber=function(e){return typeof e==="number"&&!isNaN(e)}}));p(Wd);var zd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.isObject=function(e){return e instanceof Object&&!Array.isArray(e)}}));p(zd);var Qd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.odd=function(e){return!kd.even(e)}}));p(Qd);var Kd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=/\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/;t.phone=function(e){return r.test(e)}}));p(Kd);var Gd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.matches=function(e,t){return t.test(e)}}));p(Gd);var Hd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.sameType=function(e,t){return typeof e===typeof t}}));p(Hd);var Yd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.sorted=function(e){if(!Array.isArray(e)){return false}var t=false;var r=0;while(r<e.length){var n=Number(e[r++]);var i=Number(e[r-2]);if(i&&i>n){t=true;break}}return!t}}));p(Yd);var $d=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.subset=function(e,t){if(!Array.isArray(e)||!Array.isArray(t)){return false}return e.every((function(e){return t.includes(e)}))}}));p($d);var Xd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.isString=function(e){return typeof e==="string"}}));p(Xd);var Jd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.under=function(e,t){return e<t}}));p(Jd);var Zd=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=/https?:\/\/(www\.)?([-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}|localhost)\b([-a-zA-Z0-9@:%_+.~#?&\/\/=]*)/i;t.url=function(e){return r.test(e)}}));p(Zd);var ep=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.today=bd.isToday}));p(ep);var tp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.yesterday=bd.isYesterday}));p(tp);var rp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.tomorrow=bd.isTomorrow}));p(rp);var np=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.past=bd.isPast}));p(np);var ip=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.future=bd.isFuture}));p(ip);var ap=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.inDateRange=bd.isWithinRange}));p(ap);var op=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={years:function(e){return e*12},quarters:function(e){return e*3},months:function(e){return e}};var n={weeks:function(e){return e*7},days:function(e){return e}};var i={hours:function(e){return e*36e5},minutes:function(e){return e*6e4},seconds:function(e){return e*1e3},milliseconds:function(e){return e}};t.calcUnits=function(e,t,a){if(r[t]){return bd.addMonths(new Date,a==="-"?-r[t](e):r[t](e))}if(n[t]){return bd.addDays(new Date,a==="-"?-n[t](e):n[t](e))}if(i[t]){return bd.addMilliseconds(new Date,a==="-"?-i[t](e):i[t](e))}};t.dateOffsetKeys=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"]}));p(op);var sp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.afterOffsetOf=function(e,t,r){var n=op.calcUnits(t,r,"+");return n?wd.after(e,n):false}}));p(sp);var up=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.before=bd.isBefore}));p(up);var cp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.beforeOffsetOf=function(e,t,r){var n=op.calcUnits(t,r,"-");return n?up.before(e,n):false}}));p(cp);var lp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.dateFormat=function(e,t){return(Array.isArray(t)?t:[t]).some((function(t){var r=e;var n=false;if(t.endsWith("ZZ")){r=e.replace(/(\+|-)\d{4}$/,"");t=t.replace(/ZZ$/,"");n=true}else if(t.endsWith("Z")){r=e.replace(/Z$/,"").replace(/(\+|-)\d{2}:\d{2}$/,"");t=t.replace(/Z$/,"");n=true}var i=bd.format(r,t);if(i==="Invalid Date"){return false}if(!n){return i===e}return i===r&&r!==e}))}}));p(lp);var fp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.above=lo.above;t.affirmative=To.affirmative;t.after=wd.after;t.alpha=mo.alpha;t.alphaNumeric=go.alphaNumeric;t.array=_d.array;t.between=Sd.between;t.boolean=Ed.isBoolean;t.creditCard=Dd.creditCard;t.date=Cd.date;t.email=Ad.email;t.empty=Nd.empty;t.even=kd.even;t.existy=ho.existy;t.falsy=Od.falsy;t.inArray=Md.inArray;t.intersectAll=xd.intersectAll;t.intersectAny=Pd.intersectAny;t.ip=Fd.ip;t.ipv4=Rd.ipv4;t.ipv6=Ld.ipv6;t.isFunction=Vd.isFunction;t.json=qd.json;t.negative=Bd.negative;t.isNull=Ud.isNull;t.isNumber=Wd.isNumber;t.isObject=zd.isObject;t.odd=Qd.odd;t.phone=Kd.phone;t.positive=jd.positive;t.matches=Gd.matches;t.same=So.same;t.sameType=Hd.sameType;t.sorted=Yd.sorted;t.subset=$d.subset;t.isString=Xd.isString;t.truthy=po.truthy;t.under=Jd.under;t.url=Zd.url;t.today=ep.today;t.yesterday=tp.yesterday;t.tomorrow=rp.tomorrow;t.past=np.past;t.future=ip.future;t.inDateRange=ap.inDateRange;t.afterOffsetOf=sp.afterOffsetOf;t.beforeOffsetOf=cp.beforeOffsetOf;t.before=up.before;t.dateFormat=lp.dateFormat}));p(fp);var hp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="different:make sure to define target field for comparison";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return[String(e[0])]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);if(co.skippable(a,t,n)){return true}var o=co.getValue(e,i);return!fp.existy(o)||o!==a}};t.default=n}));p(hp);var dp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||Ad.email(i)}};t.default=r}));p(dp);var pp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="endsWith:make sure to define substring";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return[String(e[0])]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);if(co.skippable(a,t,n)){return true}if(typeof a!=="string"){return false}return a.endsWith(i)}};t.default=n}));p(pp);var vp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="equals:make sure to define the comparison string";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return[e[0]]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);return co.skippable(a,t,n)||i==a}};t.default=n}));p(vp);var mp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="in:make sure to define search collection";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return e},validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||Md.inArray(i,r)}};t.default=n}));p(mp);var yp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="includes:make sure to define substring to match";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return[String(e[0])]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);if(co.skippable(a,t,n)){return true}if(typeof a!=="string"){return false}return a.includes(i)}};t.default=n}));p(yp);var gp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);if(co.skippable(i,t,n)){return true}var a=co.cast(i,"integer");if(a===null){return false}if(a!==co.cast(i,"float")){return false}co.patchValue(e,t,a);return true}};t.default=r}));p(gp);var bp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);if(co.skippable(i,t,n)){return true}var a=co.cast(i,"float");if(a===null){return false}co.patchValue(e,t,a);return true}};t.default=r}));p(bp);var wp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||Fd.ip(i)}};t.default=r}));p(wp);var _p=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||Rd.ipv4(i)}};t.default=r}));p(_p);var Sp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||Ld.ipv6(i)}};t.default=r}));p(Sp);var Ep=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||qd.json(i)}};t.default=r}));p(Ep);var Tp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="max: make sure to define max length";var n="max: length must be defined as an integer";var i={async:false,compile:function(e){co.ensureLength(e,r,1);var t=co.cast(e[0],"integer",n);return[t]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);if(co.skippable(a,t,n)){return true}if(Array.isArray(a)||typeof a==="string"){return a.length<=i}return false}};t.default=i}));p(Tp);var Ip=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="min: make sure to define min length";var n="min: length must be defined as an integer";var i={async:false,compile:function(e){co.ensureLength(e,r,1);var t=co.cast(e[0],"integer",n);return[t]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);if(co.skippable(a,t,n)){return true}if(Array.isArray(a)||typeof a==="string"){return a.length>=i}return false}};t.default=i}));p(Ip);var Dp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="notEquals:make sure to define comparison value";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return[e[0]]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);return co.skippable(a,t,n)||i!=a}};t.default=n}));p(Dp);var Cp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="notIn:make sure to define search collection";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return e},validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||!Md.inArray(i,r)}};t.default=n}));p(Cp);var Ap=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);if(co.skippable(i,t,n)){return true}var a=co.cast(i,"float");if(a===null){return false}if(a<0){return false}co.patchValue(e,t,a);return true}};t.default=r}));p(Ap);var Np=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||zd.isObject(i)}};t.default=r}));p(Np);var kp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="range:make sure to define min and max values";var n="range:min and max values must be defined as integers";var i={async:false,compile:function(e){co.ensureLength(e,r,2);var t=co.cast(e[0],"float",n);var i=co.cast(e[1],"float",n);return[t,i]},validate:function(e,t,r,n){var i=r[0],a=r[1];var o=co.getValue(e,t);return co.skippable(o,t,n)||o>=i&&o<=a}};t.default=i}));p(kp);var Op=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="regex:make sure to define regex pattern";var n={async:false,compile:function(e){co.ensureLength(e,r,1);var t=e[0]instanceof RegExp?e[0]:new RegExp(e[0],e[1]);return[t]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);return co.skippable(a,t,n)||i.test(a)}};t.default=n}));p(Op);var Mp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t){return ho.existy(co.getValue(e,t))}};t.default=r}));p(Mp);var xp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="requiredIf:make sure to define target field";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return[String(e[0])]},validate:function(e,t,r){var n=r[0];if(!ho.existy(co.getValue(e,n))){return true}return!Nd.empty(co.getValue(e,t))}};t.default=n}));p(xp);var Pp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="requiredWhen:make sure to define target field and it's expected value";var n={async:false,compile:function(e){co.ensureLength(e,r,2);return[String(e[0]),e[1]]},validate:function(e,t,r){var n=r[0],i=r[1];var a=co.getValue(e,n);if(Nd.empty(a)||i!=a){return true}return!Nd.empty(co.getValue(e,t))}};t.default=n}));p(Pp);var Rp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="requiredWithAll:make sure to define one or more target fields";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return e.map((function(e){return String(e)}))},validate:function(e,t,r){var n=r.some((function(t){return!ho.existy(co.getValue(e,t))}));if(n){return true}return!Nd.empty(co.getValue(e,t))}};t.default=n}));p(Rp);var Lp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="requiredWithAny:make sure to define one or more target fields";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return e.map((function(e){return String(e)}))},validate:function(e,t,r){var n=r.some((function(t){return ho.existy(co.getValue(e,t))}));if(!n){return true}return!Nd.empty(co.getValue(e,t))}};t.default=n}));p(Lp);var Fp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="requiredWithoutAll:make sure to define one or more target fields";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return e.map((function(e){return String(e)}))},validate:function(e,t,r){var n=r.some((function(t){return ho.existy(co.getValue(e,t))}));if(n){return true}return!Nd.empty(co.getValue(e,t))}};t.default=n}));p(Fp);var Vp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="requiredWithoutAny:make sure to define one or more target fields";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return e.map((function(e){return String(e)}))},validate:function(e,t,r){var n=r.some((function(t){return!ho.existy(co.getValue(e,t))}));if(n){return!Nd.empty(co.getValue(e,t))}return true}};t.default=n}));p(Vp);var qp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="same:make sure to define target field for comparison";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return[String(e[0])]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);if(co.skippable(a,t,n)){return true}var o=co.getValue(e,i);return!ho.existy(o)||o===a}};t.default=n}));p(qp);var jp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="startsWith:make sure to define substring";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return[String(e[0])]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);if(co.skippable(a,t,n)){return true}if(typeof a!=="string"){return false}return a.startsWith(i)}};t.default=n}));p(jp);var Bp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);if(co.skippable(i,t,n)){return true}return typeof i==="string"}};t.default=r}));p(Bp);var Up=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="subset:make sure to define subset collection";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return e.map((function(e){return co.cast(e,"string")}))},validate:function(e,t,r,n){var i=co.getValue(e,t);if(co.skippable(i,t,n)){return true}if(Xd.isString(i)){i=i.split(",").map((function(e){return e.trim()}))}else if(Array.isArray(i)){i=i.map((function(e){return co.cast(e,"string")}))}else{return false}if(!$d.subset(i,r)){return false}co.patchValue(e,t,i);return true}};t.default=n}));p(Up);var Wp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="under:make sure to define max value";var n="under:max value must be defined as an integer";var i={async:false,compile:function(e){co.ensureLength(e,r,1);var t=co.cast(e[0],"float",n);return[t]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);return co.skippable(a,t,n)||Jd.under(a,i)}};t.default=i}));p(Wp);var zp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||Zd.url(i)}};t.default=r}));p(zp);var Qp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="after:make sure to define the after date";var n="after:after date must be defined as string or date object";var i={async:false,compile:function(e){co.ensureLength(e,r,1);var t=co.cast(e[0],"date",n);return[t]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);return co.skippable(a,t,n)||wd.after(a,i)}};t.default=i}));p(Qp);var Kp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="before:make sure to define the before date";var n="before:before date must be defined as string or date object";var i={async:false,compile:function(e){co.ensureLength(e,r,1);var t=co.cast(e[0],"date",n);return[t]},validate:function(e,t,r,n){var i=r[0];var a=co.getValue(e,t);return co.skippable(a,t,n)||up.before(a,i)}};t.default=i}));p(Kp);var Gp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={async:false,validate:function(e,t,r,n){var i=co.getValue(e,t);if(co.skippable(i,t,n)){return true}var a=co.cast(i,"date");if(a===null){return false}co.patchValue(e,t,a);return true}};t.default=r}));p(Gp);var Hp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="dateFormat:make sure to define atleast one date format";var n={async:false,compile:function(e){co.ensureLength(e,r,1);return e.map((function(e){return String(e)}))},validate:function(e,t,r,n){var i=co.getValue(e,t);return co.skippable(i,t,n)||lp.dateFormat(i,r)}};t.default=n}));p(Hp);var Yp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="beforeOffsetOf:make sure to define offset unit and key";var n="beforeOffsetOf:2nd argument must be a valid calc key";var i="beforeOffsetOf:1st argument must be a number";var a={async:false,compile:function(e){co.ensureLength(e,r,2);var t=co.cast(e[0],"integer",i);var a=e[1];if(!op.dateOffsetKeys.includes(a)){throw new Error(n)}return[Number(t),a]},validate:function(e,t,r,n){var i=r[0],a=r[1];var o=co.getValue(e,t);return co.skippable(o,t,n)||cp.beforeOffsetOf(o,i,a)}};t.default=a}));p(Yp);var $p=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r="afterOffsetOf:make sure to define offset unit and key";var n="afterOffsetOf:2nd argument must be a valid calc key";var i="afterOffsetOf:1st argument must be a number";var a={async:false,compile:function(e){co.ensureLength(e,r,2);var t=co.cast(e[0],"integer",i);var a=e[1];if(!op.dateOffsetKeys.includes(a)){throw new Error(n)}return[Number(t),a]},validate:function(e,t,r,n){var i=r[0],a=r[1];var o=co.getValue(e,t);return co.skippable(o,t,n)||sp.afterOffsetOf(o,i,a)}};t.default=a}));p($p);var Xp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.above=fo.default;t.accepted=vo.default;t.alpha=yo.default;t.alphaNumeric=bo.default;t.array=wo.default;t.boolean=_o.default;t.confirmed=Eo.default;t.different=hp.default;t.email=dp.default;t.endsWith=pp.default;t.equals=vp.default;t.in=mp.default;t.includes=yp.default;t.integer=gp.default;t.float=bp.default;t.ip=wp.default;t.ipv4=_p.default;t.ipv6=Sp.default;t.json=Ep.default;t.max=Tp.default;t.min=Ip.default;t.notEquals=Dp.default;t.notIn=Cp.default;t.number=Ap.default;t.object=Np.default;t.range=kp.default;t.regex=Op.default;t.required=Mp.default;t.requiredIf=xp.default;t.requiredWhen=Pp.default;t.requiredWithAll=Rp.default;t.requiredWithAny=Lp.default;t.requiredWithoutAll=Fp.default;t.requiredWithoutAny=Vp.default;t.same=qp.default;t.startsWith=jp.default;t.string=Bp.default;t.subset=Up.default;t.under=Wp.default;t.url=zp.default;t.after=Qp.default;t.before=Kp.default;t.date=Gp.default;t.dateFormat=Hp.default;t.beforeOffsetOf=Yp.default;t.afterOffsetOf=$p.default}));p(Xp);var Jp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={sanitize:function(e,t){var r=co.getValue(e,t);if(typeof r!=="string"){return}r=r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;");co.patchValue(e,t,r)}};t.default=r}));p(Jp);var Zp=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={sanitize:function(e,t,r){if(r===void 0){r=[]}var n=co.getValue(e,t);if(typeof n!=="string"){return}co.patchValue(e,t,n.toLocaleLowerCase(r[0]))}};t.default=r}));p(Zp);var ev=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.default=r;function r(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var t=arguments.length>1?arguments[1]:undefined;for(var r in t){if(typeof e[r]==="undefined"){e[r]=t[r]}}return e}e.exports=t.default;e.exports.default=t.default}));p(ev);var tv=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.default=l;var r=n(ev);function n(e){return e&&e.__esModule?e:{default:e}}var i={all_lowercase:true,gmail_lowercase:true,gmail_remove_dots:true,gmail_remove_subaddress:true,gmail_convert_googlemaildotcom:true,outlookdotcom_lowercase:true,outlookdotcom_remove_subaddress:true,yahoo_lowercase:true,yahoo_remove_subaddress:true,yandex_lowercase:true,icloud_lowercase:true,icloud_remove_subaddress:true};var a=["icloud.com","me.com"];var o=["hotmail.at","hotmail.be","hotmail.ca","hotmail.cl","hotmail.co.il","hotmail.co.nz","hotmail.co.th","hotmail.co.uk","hotmail.com","hotmail.com.ar","hotmail.com.au","hotmail.com.br","hotmail.com.gr","hotmail.com.mx","hotmail.com.pe","hotmail.com.tr","hotmail.com.vn","hotmail.cz","hotmail.de","hotmail.dk","hotmail.es","hotmail.fr","hotmail.hu","hotmail.id","hotmail.ie","hotmail.in","hotmail.it","hotmail.jp","hotmail.kr","hotmail.lv","hotmail.my","hotmail.ph","hotmail.pt","hotmail.sa","hotmail.sg","hotmail.sk","live.be","live.co.uk","live.com","live.com.ar","live.com.mx","live.de","live.es","live.eu","live.fr","live.it","live.nl","msn.com","outlook.at","outlook.be","outlook.cl","outlook.co.il","outlook.co.nz","outlook.co.th","outlook.com","outlook.com.ar","outlook.com.au","outlook.com.br","outlook.com.gr","outlook.com.pe","outlook.com.tr","outlook.com.vn","outlook.cz","outlook.de","outlook.dk","outlook.es","outlook.fr","outlook.hu","outlook.id","outlook.ie","outlook.in","outlook.it","outlook.jp","outlook.kr","outlook.lv","outlook.my","outlook.ph","outlook.pt","outlook.sa","outlook.sg","outlook.sk","passport.com"];var s=["rocketmail.com","yahoo.ca","yahoo.co.uk","yahoo.com","yahoo.de","yahoo.fr","yahoo.in","yahoo.it","ymail.com"];var u=["yandex.ru","yandex.ua","yandex.kz","yandex.com","yandex.by","ya.ru"];function c(e){if(e.length>1){return e}return""}function l(e,t){t=(0,r.default)(t,i);var n=e.split("@");var l=n.pop();var f=n.join("@");var h=[f,l];h[1]=h[1].toLowerCase();if(h[1]==="gmail.com"||h[1]==="googlemail.com"){if(t.gmail_remove_subaddress){h[0]=h[0].split("+")[0]}if(t.gmail_remove_dots){h[0]=h[0].replace(/\.+/g,c)}if(!h[0].length){return false}if(t.all_lowercase||t.gmail_lowercase){h[0]=h[0].toLowerCase()}h[1]=t.gmail_convert_googlemaildotcom?"gmail.com":h[1]}else if(a.indexOf(h[1])>=0){if(t.icloud_remove_subaddress){h[0]=h[0].split("+")[0]}if(!h[0].length){return false}if(t.all_lowercase||t.icloud_lowercase){h[0]=h[0].toLowerCase()}}else if(o.indexOf(h[1])>=0){if(t.outlookdotcom_remove_subaddress){h[0]=h[0].split("+")[0]}if(!h[0].length){return false}if(t.all_lowercase||t.outlookdotcom_lowercase){h[0]=h[0].toLowerCase()}}else if(s.indexOf(h[1])>=0){if(t.yahoo_remove_subaddress){var d=h[0].split("-");h[0]=d.length>1?d.slice(0,-1).join("-"):d[0]}if(!h[0].length){return false}if(t.all_lowercase||t.yahoo_lowercase){h[0]=h[0].toLowerCase()}}else if(u.indexOf(h[1])>=0){if(t.all_lowercase||t.yandex_lowercase){h[0]=h[0].toLowerCase()}h[1]="yandex.ru"}else if(t.all_lowercase){h[0]=h[0].toLowerCase()}return h.join("@")}e.exports=t.default;e.exports.default=t.default}));p(tv);var rv=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={sanitize:function(e,t,r){if(r===void 0){r=[]}var n=co.getValue(e,t);if(typeof n!=="string"){return}co.patchValue(e,t,tv(n,r[0]))}};t.default=r}));p(rv);var nv=v((function(e,t){(function(t,r){if(typeof d==="function"&&"object"==="object"&&"object"==="object"){e.exports=r()}else{t.pluralize=r()}})(h,(function(){var e=[];var t=[];var r={};var n={};var i={};function a(e){if(typeof e==="string"){return new RegExp("^"+e+"$","i")}return e}function o(e,t){if(e===t)return t;if(e===e.toLowerCase())return t.toLowerCase();if(e===e.toUpperCase())return t.toUpperCase();if(e[0]===e[0].toUpperCase()){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}return t.toLowerCase()}function s(e,t){return e.replace(/\$(\d{1,2})/g,(function(e,r){return t[r]||""}))}function u(e,t){return e.replace(t[0],(function(r,n){var i=s(t[1],arguments);if(r===""){return o(e[n-1],i)}return o(r,i)}))}function c(e,t,n){if(!e.length||r.hasOwnProperty(e)){return t}var i=n.length;while(i--){var a=n[i];if(a[0].test(t))return u(t,a)}return t}function l(e,t,r){return function(n){var i=n.toLowerCase();if(t.hasOwnProperty(i)){return o(n,i)}if(e.hasOwnProperty(i)){return o(n,e[i])}return c(i,n,r)}}function f(e,t,r,n){return function(n){var i=n.toLowerCase();if(t.hasOwnProperty(i))return true;if(e.hasOwnProperty(i))return false;return c(i,i,r)===i}}function h(e,t,r){var n=t===1?h.singular(e):h.plural(e);return(r?t+" ":"")+n}h.plural=l(i,n,e);h.isPlural=f(i,n,e);h.singular=l(n,i,t);h.isSingular=f(n,i,t);h.addPluralRule=function(t,r){e.push([a(t),r])};h.addSingularRule=function(e,r){t.push([a(e),r])};h.addUncountableRule=function(e){if(typeof e==="string"){r[e.toLowerCase()]=true;return}h.addPluralRule(e,"$0");h.addSingularRule(e,"$0")};h.addIrregularRule=function(e,t){t=t.toLowerCase();e=e.toLowerCase();i[e]=t;n[t]=e};[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["passerby","passersby"]].forEach((function(e){return h.addIrregularRule(e[0],e[1])}));[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|t[lm]as|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[ejzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/\b((?:tit)?m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach((function(e){return h.addPluralRule(e[0],e[1])}));[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/\b((?:tit)?m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|t[lm]as|gas|(?:her|at|gr)o|[aeiou]ris)(?:es)?$/i,"$1"],[/(analy|diagno|parenthe|progno|synop|the|empha|cri|ne)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach((function(e){return h.addSingularRule(e[0],e[1])}));["adulthood","advice","agenda","aid","aircraft","alcohol","ammo","analytics","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","firmware","flounder","fun","gallows","garbage","graffiti","hardware","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","mud","manga","news","only","personnel","pike","plankton","pliers","police","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","software","species","staff","swine","tennis","traffic","transportation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/pok[e]mon$/i,/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(h.addUncountableRule);return h}))}));var iv=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={sanitize:function(e,t){var r=co.getValue(e,t);if(typeof r!=="string"){return}co.patchValue(e,t,nv(r))}};t.default=r}));p(iv);var av=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={sanitize:function(e,t){var r=co.getValue(e,t);if(typeof r!=="string"){return}co.patchValue(e,t,nv.singular(r))}};t.default=r}));p(av);var ov=1/0;var sv="[object Symbol]";var uv=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var cv=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g;var lv="\\ud800-\\udfff",fv="\\u0300-\\u036f\\ufe20-\\ufe23",hv="\\u20d0-\\u20f0",dv="\\u2700-\\u27bf",pv="a-z\\xdf-\\xf6\\xf8-\\xff",vv="\\xac\\xb1\\xd7\\xf7",mv="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",yv="\\u2000-\\u206f",gv=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",bv="A-Z\\xc0-\\xd6\\xd8-\\xde",wv="\\ufe0e\\ufe0f",_v=vv+mv+yv+gv;var Sv="[']",Ev="["+_v+"]",Tv="["+fv+hv+"]",Iv="\\d+",Dv="["+dv+"]",Cv="["+pv+"]",Av="[^"+lv+_v+Iv+dv+pv+bv+"]",Nv="\\ud83c[\\udffb-\\udfff]",kv="(?:"+Tv+"|"+Nv+")",Ov="[^"+lv+"]",Mv="(?:\\ud83c[\\udde6-\\uddff]){2}",xv="[\\ud800-\\udbff][\\udc00-\\udfff]",Pv="["+bv+"]",Rv="\\u200d";var Lv="(?:"+Cv+"|"+Av+")",Fv="(?:"+Pv+"|"+Av+")",Vv="(?:"+Sv+"(?:d|ll|m|re|s|t|ve))?",qv="(?:"+Sv+"(?:D|LL|M|RE|S|T|VE))?",jv=kv+"?",Bv="["+wv+"]?",Uv="(?:"+Rv+"(?:"+[Ov,Mv,xv].join("|")+")"+Bv+jv+")*",Wv=Bv+jv+Uv,zv="(?:"+[Dv,Mv,xv].join("|")+")"+Wv;var Qv=RegExp(Sv,"g");var Kv=RegExp(Tv,"g");var Gv=RegExp([Pv+"?"+Cv+"+"+Vv+"(?="+[Ev,Pv,"$"].join("|")+")",Fv+"+"+qv+"(?="+[Ev,Pv+Lv,"$"].join("|")+")",Pv+"?"+Lv+"+"+Vv,Pv+"+"+qv,Iv,zv].join("|"),"g");var Hv=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var Yv={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"ss"};var $v=typeof h=="object"&&h&&h.Object===Object&&h;var Xv=typeof self=="object"&&self&&self.Object===Object&&self;var Jv=$v||Xv||Function("return this")();function Zv(e,t,r,n){var i=-1,a=e?e.length:0;if(n&&a){r=e[++i]}while(++i<a){r=t(r,e[i],i,e)}return r}function em(e){return e.match(uv)||[]}function tm(e){return function(t){return e==null?undefined:e[t]}}var rm=tm(Yv);function nm(e){return Hv.test(e)}function im(e){return e.match(Gv)||[]}var am=Object.prototype;var om=am.toString;var sm=Jv.Symbol;var um=sm?sm.prototype:undefined,cm=um?um.toString:undefined;function lm(e){if(typeof e=="string"){return e}if(dm(e)){return cm?cm.call(e):""}var t=e+"";return t=="0"&&1/e==-ov?"-0":t}function fm(e){return function(t){return Zv(ym(vm(t).replace(Qv,"")),e,"")}}function hm(e){return!!e&&typeof e=="object"}function dm(e){return typeof e=="symbol"||hm(e)&&om.call(e)==sv}function pm(e){return e==null?"":lm(e)}function vm(e){e=pm(e);return e&&e.replace(cv,rm).replace(Kv,"")}var mm=fm((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}));function ym(e,t,r){e=pm(e);t=r?undefined:t;if(t===undefined){return nm(e)?im(e):em(e)}return e.match(t)||[]}var gm=mm;function bm(e,t){if(e===undefined||e===null){throw new TypeError("Cannot convert first argument to object")}var r=Object(e);for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i===undefined||i===null){continue}var a=Object.keys(Object(i));for(var o=0,s=a.length;o<s;o++){var u=a[o];var c=Object.getOwnPropertyDescriptor(i,u);if(c!==undefined&&c.enumerable){r[u]=i[u]}}}return r}function wm(){if(!Object.assign){Object.defineProperty(Object,"assign",{enumerable:false,configurable:true,writable:true,value:bm})}}var _m={assign:bm,polyfill:wm};var Sm=_m.assign;var Em={"":"A","":"A","":"A","":"A","":"A","":"A","":"AE","":"C","":"E","":"E","":"E","":"E","":"I","":"I","":"I","":"I","":"D","":"N","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"U","":"U","":"U","":"U","":"U","":"Y","":"TH","":"Y","":"ss","":"a","":"a","":"a","":"a","":"a","":"a","":"ae","":"c","":"e","":"e","":"e","":"e","":"i","":"i","":"i","":"i","":"d","":"n","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"u","":"u","":"u","":"u","":"u","":"y","":"th","":"y"};var Tm={"":"(c)","":"oe","":"OE","":"sum","":"(r)","":"+","":'"',"":'"',"":"'","":"'","":"d","":"f","":"tm","":"sm","":"...","":"o","":"o","":"a","":"*","":"delta","":"infinity","":"love","&":"and","|":"or","<":"less",">":"greater","@":"at"};var Im={"":"a","":"b","":"g","":"d","":"e","":"z","":"h","":"8","":"i","":"k","":"l","":"m","":"n","":"3","":"o","":"p","":"r","":"s","":"t","":"y","":"f","":"x","":"ps","":"w","":"a","":"e","":"i","":"o","":"y","":"h","":"w","":"s","":"i","":"y","":"y","":"i","":"A","":"B","":"G","":"D","":"E","":"Z","":"H","":"8","":"I","":"K","":"L","":"M","":"N","":"3","":"O","":"P","":"R","":"S","":"T","":"Y","":"F","":"X","":"PS","":"W","":"A","":"E","":"I","":"O","":"Y","":"H","":"W","":"I","":"Y"};var Dm={"":"s","":"S","":"i","":"I","":"c","":"C","":"u","":"U","":"o","":"O","":"g","":"G"};var Cm={"":"a","":"i","":"s","":"t","":"a","":"A","":"I","":"S","":"T","":"A"};var Am={"":"a","":"b","":"v","":"g","":"d","":"e","":"yo","":"zh","":"z","":"i","":"j","":"k","":"l","":"m","":"n","":"o","":"p","":"r","":"s","":"t","":"u","":"f","":"h","":"c","":"ch","":"sh","":"sh","":"","":"y","":"","":"e","":"yu","":"ya","":"A","":"B","":"V","":"G","":"D","":"E","":"Yo","":"Zh","":"Z","":"I","":"J","":"K","":"L","":"M","":"N","":"O","":"P","":"R","":"S","":"T","":"U","":"F","":"H","":"C","":"Ch","":"Sh","":"Sh","":"","":"Y","":"","":"E","":"Yu","":"Ya"};var Nm={"":"Ye","":"I","":"Yi","":"G","":"ye","":"i","":"yi","":"g"};var km={"":"c","":"d","":"e","":"n","":"r","":"s","":"t","":"u","":"z","":"C","":"D","":"E","":"N","":"R","":"S","":"T","":"U","":"Z"};var Om={"":"a","":"a","":"c","":"d","":"e","":"i","":"l","":"l","":"n","":"o","":"o","":"r","":"s","":"t","":"u","":"y","":"z","":"a","":"A","":"C","":"D","":"E","":"I","":"L","":"L","":"N","":"O","":"O","":"R","":"S","":"T","":"U","":"Y","":"Z"};var Mm={"":"a","":"c","":"e","":"l","":"n","":"o","":"s","":"z","":"z","":"A","":"C","":"E","":"L","":"N","":"O","":"S","":"Z","":"Z"};var xm={"":"a","":"c","":"e","":"g","":"i","":"k","":"l","":"n","":"s","":"u","":"z","":"A","":"C","":"E","":"G","":"I","":"K","":"L","":"N","":"S","":"U","":"Z"};var Pm={"":"a","":"b","":"t","":"th","":"g","":"h","":"kh","":"d","":"th","":"r","":"z","":"s","":"sh","":"s","":"d","":"t","":"th","":"aa","":"gh","":"f","":"k","":"k","":"l","":"m","":"n","":"h","":"o","":"y"};var Rm={"":"a","":"c","":"e","":"e","":"i","":"s","":"u","":"u","":"z","":"A","":"C","":"E","":"E","":"I","":"S","":"U","":"U","":"Z"};var Lm={"":"dj","":"j","":"lj","":"nj","":"c","":"dz","":"dj","":"Dj","":"j","":"Lj","":"Nj","":"C","":"Dz","":"Dj"};var Fm={"":"c","":"e","":"g","":"i","":"o","":"s","":"u","":"C","":"E","":"G","":"I","":"O","":"S","":"U"};var Vm={"":"a","":"b","":"g","":"d","":"e","":"v","":"z","":"t","":"i","":"k","":"l","":"m","":"n","":"o","":"p","":"j","":"r","":"s","":"t","":"u","":"f","":"q","":"g","":"y","":"sh","":"ch","":"c","":"dz","":"w","":"ch","":"x","":"j","":"h"};var qm={"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"I","":"I","":"I","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"Y","":"Y","":"Y","":"Y","":"D","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"i","":"i","":"i","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"y","":"y","":"y","":"y","":"d"};var jm={"":"euro","":"cruzeiro","":"french franc","":"pound","":"lira","":"mill","":"naira","":"peseta","":"rupee","":"won","":"new shequel","":"dong","":"kip","":"tugrik","":"drachma","":"penny","":"peso","":"guarani","":"austral","":"hryvnia","":"cedi","":"cent","":"yen","":"yuan","":"yen","":"rial","":"ecu","":"currency","":"baht",$:"dollar","":"indian rupee"};var Bm=Sm(Em,Tm,Im,Dm,Cm,Am,Nm,km,Om,Mm,xm,Pm,Rm,Lm,Fm,Vm,qm,jm);function Um(e){if(e===void 0)return"";var t="";for(var r=0;r<e.length;r++){var n=e[r];t+=Bm[n]!==void 0?Bm[n]:n}return t}Um.extends=function(e){Sm(Bm,e)};var Wm={transform:Um};var zm=Wm.transform;function Qm(e){if(e===void 0)return"";return gm(Km(zm(e.toString())))}function Km(e){var t="";for(var r=0;r<=e.length;r++){if(e.charCodeAt(r)<128){t+=e[r]}}return t}Qm.extends=function(e){zm.extends(e)};var Gm=Qm;var Hm=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={sanitize:function(e,t){var r=co.getValue(e,t);if(typeof r!=="string"){return}co.patchValue(e,t,Gm(r))}};t.default=r}));p(Hm);var Ym=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=/<a\b[^>]*>(.*?)<\/a>/g;var n={sanitize:function(e,t){var n=co.getValue(e,t);if(typeof n!=="string"){return}co.patchValue(e,t,n.replace(r,(function(e,t){return t.trim()})))}};t.default=n}));p(Ym);var $m=v((function(e){(function(t){if(typeof r!=="function"){var r=function(e){return e};r.nonNative=true}var n=r("plaintext");var i=r("html");var a=r("comment");var o=/<(\w*)>/g;var s=/<\/?([^\s\/>]+)/;function u(e,t,r){e=e||"";t=t||[];r=r||"";var n=l(t,r);return f(e,n)}function c(e,t){e=e||[];t=t||"";var r=l(e,t);return function e(t){return f(t||"",r)}}u.init_streaming_mode=c;function l(e,t){e=h(e);return{allowable_tags:e,tag_replacement:t,state:n,tag_buffer:"",depth:0,in_quote_char:""}}function f(e,t){var r=t.allowable_tags;var o=t.tag_replacement;var s=t.state;var u=t.tag_buffer;var c=t.depth;var l=t.in_quote_char;var f="";for(var h=0,p=e.length;h<p;h++){var v=e[h];if(s===n){switch(v){case"<":s=i;u+=v;break;default:f+=v;break}}else if(s===i){switch(v){case"<":if(l){break}c++;break;case">":if(l){break}if(c){c--;break}l="";s=n;u+=">";if(r.has(d(u))){f+=u}else{f+=o}u="";break;case'"':case"'":if(v===l){l=""}else{l=l||v}u+=v;break;case"-":if(u==="<!-"){s=a}u+=v;break;case" ":case"\n":if(u==="<"){s=n;f+="< ";u="";break}u+=v;break;default:u+=v;break}}else if(s===a){switch(v){case">":if(u.slice(-2)=="--"){s=n}u="";break;default:u+=v;break}}}t.state=s;t.tag_buffer=u;t.depth=c;t.in_quote_char=l;return f}function h(e){var t=new Set;if(typeof e==="string"){var n=void 0;while(n=o.exec(e)){t.add(n[1])}}else if(!r.nonNative&&typeof e[r.iterator]==="function"){t=new Set(e)}else if(typeof e.forEach==="function"){e.forEach(t.add,t)}return t}function d(e){var t=s.exec(e);return t?t[1].toLowerCase():null}if(e.exports){e.exports=u}else{t.striptags=u}})(h)}));var Xm=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={sanitize:function(e,t,r){if(r===void 0){r=[]}var n=co.getValue(e,t);if(typeof n!=="string"){return}co.patchValue(e,t,$m(n,r))}};t.default=r}));p(Xm);var Jm=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={sanitize:function(e,t){var r=co.getValue(e,t);if(typeof r!=="string"){return}co.patchValue(e,t,r.trim())}};t.default=r}));p(Jm);var Zm=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={sanitize:function(e,t,r){if(r===void 0){r=[]}var n=co.getValue(e,t);if(typeof n!=="string"){return}co.patchValue(e,t,n.toLocaleUpperCase(r[0]))}};t.default=r}));p(Zm);var ey=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.escape=Jp.default;t.lowerCase=Zp.default;t.normalizeEmail=rv.default;t.plural=iv.default;t.singular=av.default;t.slug=Hm.default;t.stripLinks=Ym.default;t.stripTags=Xm.default;t.trim=Jm.default;t.upperCase=Zm.default}));p(ey);var ty=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.validations=Xp;t.sanitizations=ey;t.raw=fp}));p(ty);function ry(e,t){t.add();for(var r=e.length,n=0,i="name";n<r;){var a=e[n++],o=a.charCodeAt(0);58===o||44===o?(i="arg",t.shiftValue()):124===o?(i="name",t.add()):"arg"===i?t.appendValue(a):t.appendKey(a,o)}return t.toJSON()}var ny=ry;function iy(){return{nodes:[],currentNode:null,add:function(){this.currentNode={name:"",args:[]},this.nodes.push(this.currentNode)},appendKey:function(e,t){32!==t&&(this.currentNode.name+=e)},appendValue:function(e){this.currentNode.args[this.currentNode.args.length-1]+=e},shiftValue:function(){this.currentNode.args.push("")},toJSON:function(){return this.nodes}}}var ay=iy;var oy=v((function(e,t){var r=h&&h.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});var n=r(ny);var i=r(ay);function a(e){return e.replace(/_(\w)/g,(function(e,t){return t.toUpperCase()}))}function o(e,t,r){var n=e[t]||{type:"literal"};n.rules=r;e[t]=n;return n}function s(e,t){if(e[t]&&e[t].type==="array"){throw new Error("cannot reshape "+t+" array to an object")}var r=e[t]||{rules:[]};r.type="object";r.children=r.children||{};e[t]=r;return r}function u(e,t,r){if(e[t]&&e[t].type==="object"){throw new Error("cannot reshape "+t+" object to an array")}var n=e[t]||{rules:[]};n.each=n.each||{};n.each[r]=n.each[r]||{children:{},rules:[]};n.type="array";e[t]=n;return n}function c(e,t,r,n){if(n===void 0){n=0}var i=e[n++];var a=e.length===n;var l=/^\d+$/.test(e[n]);var f=e[n]==="*"||l;if(i==="*"||/^\d+$/.test(i)){if(a){r.each[i].rules=t;return}return c(e,t,r.each[i].children,n)}if(a){o(r,i,t);return}if(f){var h=u(r,i,l?e[n]:"*");return c(e,t,h,n)}var d=s(r,i);return c(e,t,d.children,n)}function l(e){return Object.keys(e).reduce((function(t,r){var o=e[r];var s=[];if(!o){throw new Error("make sure to define rules for "+r)}if(typeof o==="string"){s=new n.default(o,new i.default).map((function(e){return{name:a(e.name),args:e.args}}))}else{s=o}c(r.split("."),s,t);return t}),{})}t.rulesParser=l;function f(e){return Object.keys(e).reduce((function(t,r){var n=e[r];var i=r.split(".");var o=a(i.pop());if(!i.length){t.rules[o]=n;return t}var s=i.join(".");t.fields[s]=t.fields[s]||{};t.fields[s][o]=n;return t}),{fields:{},rules:{}})}t.messagesParser=f}));p(oy);var sy=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.rulesParser=oy.rulesParser;t.messagesParser=oy.messagesParser}));p(sy);var uy=v((function(e,t){var r=h&&h.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});var n=r(ao);var i=function(){function e(e,t,r,n){this._field=e;this._index=t;this._childValidators=r;this._dotPath=n;this._pointer=this._dotPath.concat(this._field).join(".");this.async=!!this._childValidators.find((function(e){return e.async}))}e.prototype._getDataCopy=function(e){var t=n.default(e.tip,this._pointer);if(!Array.isArray(t)){return null}return{original:e.original,pointer:"",tip:null,parentArray:t,currentIndex:this._index==="*"?0:Number(this._index),arrayPointer:e.arrayPointer?e.arrayPointer+"."+e.currentIndex+"."+this._pointer:this._pointer}};e.prototype._executeValidations=function(e,t,r,n){var i=false;for(var a=0,o=this._childValidators;a<o.length;a++){var s=o[a];var u=s.exec(e,t,r,n);if(!u){i=true;if(n){break}}}return!i};e.prototype._executeAsyncValidations=function(e,t,r,n){return __awaiter_1(this,void 0,void 0,(function(){var i,a,o,s,u;return __generator_1(this,(function(c){switch(c.label){case 0:i=false;a=0,o=this._childValidators;c.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a];u=true;if(!s.async)return[3,3];return[4,s.execAsync(e,t,r,n)];case 2:u=c.sent();return[3,4];case 3:u=s.exec(e,t,r,n);c.label=4;case 4:if(!u){i=true;if(n){return[3,6]}}c.label=5;case 5:a++;return[3,1];case 6:return[2,!i]}}))}))};e.prototype.exec=function(e,t,r,n){if(n===void 0){n=false}var i=this._getDataCopy(e);if(!i){return true}if(this._index!=="*"){i.tip=i.parentArray[i.currentIndex];return this._executeValidations(i,t,r,n)}var a=0;var o=false;for(var s=0,u=i.parentArray;s<u.length;s++){var c=u[s];i.tip=c;i.currentIndex=a;var l=true;l=this._executeValidations(i,t,r,n);if(!l){o=true;if(n){break}}a++}return!o};e.prototype.execAsync=function(e,t,r,n){if(n===void 0){n=false}return __awaiter_1(this,void 0,void 0,(function(){var i,a,o,s,u,c,l;return __generator_1(this,(function(f){switch(f.label){case 0:i=this._getDataCopy(e);if(!i){return[2,true]}if(this._index!=="*"){i.tip=i.parentArray[i.currentIndex];return[2,this._executeAsyncValidations(i,t,r,n)]}a=0;o=false;s=0,u=i.parentArray;f.label=1;case 1:if(!(s<u.length))return[3,4];c=u[s];i.tip=c;i.currentIndex=a;return[4,this._executeAsyncValidations(i,t,r,n)];case 2:l=f.sent();if(!l){o=true;if(n){return[3,4]}}a++;f.label=3;case 3:s++;return[3,1];case 4:return[2,!o]}}))}))};return e}();t.ArrayWrapper=i}));p(uy);function cy(e){return e!=null&&typeof e==="object"&&Array.isArray(e)===false}var ly=v((function(e,t){var r=h&&h.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});var n=r(ao);var i=r(cy);var a=function(){function e(e,t,r,n,i,a,o){this._field=e;this._type=t;this._dotPath=r;this._fieldMessages=a;this._genericMessages=o;this.async=false;this._validations=[];this._pointer=this._dotPath.concat(this._field).join(".");this._computeValidations(i,n)}e.prototype._computeValidations=function(e,t){var r=this;this._validations=t.map((function(t){var n=e[t.name];if(!n){throw new Error(t.name+" is not a registered as a validation")}if(typeof n.validate!=="function"){throw new Error(t.name+" is missing validate function")}if(typeof n.compile==="function"){t.args=n.compile(t.args)}if(n.async){r.async=true}return{rule:t,fn:n.validate,async:n.async}}))};e.prototype._getDataCopy=function(e){var t;var r=this._dotPath.length?n.default(e.tip,this._dotPath):e.tip;var i=e.arrayPointer?e.arrayPointer+"."+e.currentIndex+"."+this._pointer:this._pointer;return Object.assign({},e,{tip:this._field==="::tip::"?(t={},t[this._field]=r,t):r,pointer:i})};e.prototype._reportValueToCollector=function(e,t,r){if(!e||this._type!=="literal"){return}r.setValue(t.pointer,t.tip[this._field])};e.prototype._reportErrorToCollector=function(e,t,r,n){var i=n||this._fieldMessages[t.name]||this._genericMessages[t.name];r.setError(e,t,i)};e.prototype.exec=function(e,t,r,n){if(n===void 0){n=false}var a=this._getDataCopy(e);if(!i.default(a.tip)){return true}var o=false;for(var s=0,u=this._validations;s<u.length;s++){var c=u[s];var l=null;var f=true;try{f=c.fn(a,this._field,c.rule.args,r)}catch(e){l=e;f=false}if(!f){o=true;this._reportErrorToCollector(a.pointer,c.rule,t,l);if(n){break}}}this._reportValueToCollector(!o,a,t);return!o};e.prototype.execAsync=function(e,t,r,n){if(n===void 0){n=false}return __awaiter_1(this,void 0,void 0,(function(){var a,o,s,u,c,l,f,h;return __generator_1(this,(function(d){switch(d.label){case 0:a=this._getDataCopy(e);if(!i.default(a.tip)){return[2,true]}o=false;s=0,u=this._validations;d.label=1;case 1:if(!(s<u.length))return[3,9];c=u[s];l=null;f=true;d.label=2;case 2:d.trys.push([2,6,,7]);if(!c.async)return[3,4];return[4,c.fn(a,this._field,c.rule.args,r)];case 3:f=d.sent();return[3,5];case 4:f=c.fn(a,this._field,c.rule.args,r);d.label=5;case 5:return[3,7];case 6:h=d.sent();f=false;l=h;return[3,7];case 7:if(!f){o=true;this._reportErrorToCollector(a.pointer,c.rule,t,l);if(n){return[3,9]}}d.label=8;case 8:s++;return[3,1];case 9:this._reportValueToCollector(!o,a,t);return[2,!o]}}))}))};return e}();t.ValidationsRunner=a}));p(ly);var fy=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){this._consumerFn=e;this._arrayWrapper=t}e.prototype._processLiteralNode=function(e,t,r,n){var i=n.concat(r).concat(e).join(".");return this._consumerFn(e,t.type,t.rules,r,i)};e.prototype._processObjectNode=function(e,t,r,n){var i=[];if(t.rules.length){var a=n.concat(r).concat(e).join(".");i.push(this._consumerFn(e,t.type,t.rules,r,a))}i=i.concat(this.walk(t.children,r.concat(e),n));return i};e.prototype._processArrayNode=function(e,t,r,n){var i=this;var a=[];var o=n.concat(r).concat(e);if(t.rules.length){var s=o.join(".");a.push(this._consumerFn(e,t.type,t.rules,r,s))}Object.keys(t.each).forEach((function(n){var s=[];if(t.each[n].rules.length){var u=o.concat(n).join(".");s.push(i._consumerFn("::tip::","literal",t.each[n].rules,r,u))}s=s.concat(i.walk(t.each[n].children,[],o.concat(n)));a=a.concat(i._arrayWrapper(n,e,s,r))}));return a};e.prototype.walk=function(e,t,r){var n=this;if(t===void 0){t=[]}if(r===void 0){r=[]}return Object.keys(e).reduce((function(i,a){var o=e[a];if(o.type==="literal"){i=i.concat(n._processLiteralNode(a,o,t,r))}if(o.type==="object"){i=i.concat(n._processObjectNode(a,o,t,r))}if(o.type==="array"){i=i.concat(n._processArrayNode(a,o,t,r))}return i}),[])};return e}();t.TreeWalker=r}));p(fy);var hy=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t,r){this._validations=r;this._parsedSchema=sy.rulesParser(e);this._parsedMessages=sy.messagesParser(t)}e.prototype.compile=function(){var e=this;return new fy.TreeWalker((function(t,r,n,i,a){var o=e._parsedMessages.fields[a]||{};var s=e._parsedMessages.rules;return new ly.ValidationsRunner(t,r,i,n,e._validations,o,s)}),(function(e,t,r,n){return new uy.ArrayWrapper(t,e,r,n)})).walk(this._parsedSchema)};return e}();t.Compiler=r}));p(hy);var dy="Expected a function";var py="__lodash_hash_undefined__";var vy=1/0,my=9007199254740991;var yy="[object Function]",gy="[object GeneratorFunction]",by="[object Symbol]";var wy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,_y=/^\w*$/,Sy=/^\./,Ey=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var Ty=/[\\^$.*+?()[\]{}|]/g;var Iy=/\\(\\)?/g;var Dy=/^\[object .+?Constructor\]$/;var Cy=/^(?:0|[1-9]\d*)$/;var Ay=typeof h=="object"&&h&&h.Object===Object&&h;var Ny=typeof self=="object"&&self&&self.Object===Object&&self;var ky=Ay||Ny||Function("return this")();function Oy(e,t){return e==null?undefined:e[t]}function My(e){var t=false;if(e!=null&&typeof e.toString!="function"){try{t=!!(e+"")}catch(e){}}return t}var xy=Array.prototype,Py=Function.prototype,Ry=Object.prototype;var Ly=ky["__core-js_shared__"];var Fy=function(){var e=/[^.]+$/.exec(Ly&&Ly.keys&&Ly.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var Vy=Py.toString;var qy=Ry.hasOwnProperty;var jy=Ry.toString;var By=RegExp("^"+Vy.call(qy).replace(Ty,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Uy=ky.Symbol,Wy=xy.splice;var zy=bg(ky,"Map"),Qy=bg(Object,"create");var Ky=Uy?Uy.prototype:undefined,Gy=Ky?Ky.toString:undefined;function Hy(e){var t=-1,r=e?e.length:0;this.clear();while(++t<r){var n=e[t];this.set(n[0],n[1])}}function Yy(){this.__data__=Qy?Qy(null):{}}function $y(e){return this.has(e)&&delete this.__data__[e]}function Xy(e){var t=this.__data__;if(Qy){var r=t[e];return r===py?undefined:r}return qy.call(t,e)?t[e]:undefined}function Jy(e){var t=this.__data__;return Qy?t[e]!==undefined:qy.call(t,e)}function Zy(e,t){var r=this.__data__;r[e]=Qy&&t===undefined?py:t;return this}Hy.prototype.clear=Yy;Hy.prototype["delete"]=$y;Hy.prototype.get=Xy;Hy.prototype.has=Jy;Hy.prototype.set=Zy;function eg(e){var t=-1,r=e?e.length:0;this.clear();while(++t<r){var n=e[t];this.set(n[0],n[1])}}function tg(){this.__data__=[]}function rg(e){var t=this.__data__,r=dg(t,e);if(r<0){return false}var n=t.length-1;if(r==n){t.pop()}else{Wy.call(t,r,1)}return true}function ng(e){var t=this.__data__,r=dg(t,e);return r<0?undefined:t[r][1]}function ig(e){return dg(this.__data__,e)>-1}function ag(e,t){var r=this.__data__,n=dg(r,e);if(n<0){r.push([e,t])}else{r[n][1]=t}return this}eg.prototype.clear=tg;eg.prototype["delete"]=rg;eg.prototype.get=ng;eg.prototype.has=ig;eg.prototype.set=ag;function og(e){var t=-1,r=e?e.length:0;this.clear();while(++t<r){var n=e[t];this.set(n[0],n[1])}}function sg(){this.__data__={hash:new Hy,map:new(zy||eg),string:new Hy}}function ug(e){return gg(this,e)["delete"](e)}function cg(e){return gg(this,e).get(e)}function lg(e){return gg(this,e).has(e)}function fg(e,t){gg(this,e).set(e,t);return this}og.prototype.clear=sg;og.prototype["delete"]=ug;og.prototype.get=cg;og.prototype.has=lg;og.prototype.set=fg;function hg(e,t,r){var n=e[t];if(!(qy.call(e,t)&&Ag(n,r))||r===undefined&&!(t in e)){e[t]=r}}function dg(e,t){var r=e.length;while(r--){if(Ag(e[r][0],t)){return r}}return-1}function pg(e){if(!Og(e)||Eg(e)){return false}var t=kg(e)||My(e)?By:Dy;return t.test(Dg(e))}function vg(e,t,r,n){if(!Og(e)){return e}t=_g(t,e)?[t]:yg(t);var i=-1,a=t.length,o=a-1,s=e;while(s!=null&&++i<a){var u=Ig(t[i]),c=r;if(i!=o){var l=s[u];c=n?n(l,u,s):undefined;if(c===undefined){c=Og(l)?l:wg(t[i+1])?[]:{}}}hg(s,u,c);s=s[u]}return e}function mg(e){if(typeof e=="string"){return e}if(xg(e)){return Gy?Gy.call(e):""}var t=e+"";return t=="0"&&1/e==-vy?"-0":t}function yg(e){return Ng(e)?e:Tg(e)}function gg(e,t){var r=e.__data__;return Sg(t)?r[typeof t=="string"?"string":"hash"]:r.map}function bg(e,t){var r=Oy(e,t);return pg(r)?r:undefined}function wg(e,t){t=t==null?my:t;return!!t&&(typeof e=="number"||Cy.test(e))&&(e>-1&&e%1==0&&e<t)}function _g(e,t){if(Ng(e)){return false}var r=typeof e;if(r=="number"||r=="symbol"||r=="boolean"||e==null||xg(e)){return true}return _y.test(e)||!wy.test(e)||t!=null&&e in Object(t)}function Sg(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Eg(e){return!!Fy&&Fy in e}var Tg=Cg((function(e){e=Pg(e);var t=[];if(Sy.test(e)){t.push("")}e.replace(Ey,(function(e,r,n,i){t.push(n?i.replace(Iy,"$1"):r||e)}));return t}));function Ig(e){if(typeof e=="string"||xg(e)){return e}var t=e+"";return t=="0"&&1/e==-vy?"-0":t}function Dg(e){if(e!=null){try{return Vy.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Cg(e,t){if(typeof e!="function"||t&&typeof t!="function"){throw new TypeError(dy)}var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i)){return a.get(i)}var o=e.apply(this,n);r.cache=a.set(i,o);return o};r.cache=new(Cg.Cache||og);return r}Cg.Cache=og;function Ag(e,t){return e===t||e!==e&&t!==t}var Ng=Array.isArray;function kg(e){var t=Og(e)?jy.call(e):"";return t==yy||t==gy}function Og(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Mg(e){return!!e&&typeof e=="object"}function xg(e){return typeof e=="symbol"||Mg(e)&&jy.call(e)==by}function Pg(e){return e==null?"":mg(e)}function Rg(e,t,r){return e==null?e:vg(e,t,r)}var Lg=Rg;var Fg=v((function(e,t){var r=h&&h.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});var n=r(Lg);var i=function(){function e(e,t){this.formatter=e;this._generateTree=t;this.tree={};this.hasErrors=false}e.prototype.setValue=function(e,t){if(!this._generateTree||t===undefined||this.hasErrors){return}e=e.replace(".::tip::","");n.default(this.tree,e,t)};e.prototype.getData=function(){return this.tree};e.prototype.getErrors=function(){return this.formatter.toJSON()};e.prototype.setError=function(e,t,r){this.hasErrors=true;r=r||t.name+" validation failed on "+e;r=typeof r==="function"?r(e,t.name,t.args):r;this.formatter.addError(r,e,t.name,t.args)};return e}();t.Collector=i}));p(Fg);var Vg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e){this._fns=e}e.prototype.exec=function(e,t,r,n,i){return __awaiter_1(this,void 0,void 0,(function(){var a,o,s,u,c,l,f;return __generator_1(this,(function(h){switch(h.label){case 0:a={tip:e,original:e,pointer:""};o=new Fg.Collector(new t,i);s=0,u=this._fns;h.label=1;case 1:if(!(s<u.length))return[3,6];c=u[s];l=false;if(!c.async)return[3,3];return[4,c.execAsync(a,o,r,n)];case 2:l=h.sent();return[3,4];case 3:l=c.exec(a,o,r,n);h.label=4;case 4:if(!l&&n){return[3,6]}h.label=5;case 5:s++;return[3,1];case 6:f=o.getErrors();if(!f){return[2,i?o.getData():e]}throw f}}))}))};return e}();t.Executor=r}));p(Vg);var qg=v((function(e,t){var r=h&&h.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});var n=r(ao);var i=function(){function e(e,t,r,n){this._field=e;this._index=t;this._childSanitizations=r;this._dotPath=n;this._pointer=this._dotPath.concat(this._field).join(".")}e.prototype._getDataCopy=function(e){var t=n.default(e.tip,this._pointer);if(!Array.isArray(t)){return null}return{original:e.original,tip:null,parentArray:t,currentIndex:this._index==="*"?0:Number(this._index)}};e.prototype._executeSanitizations=function(e,t){this._childSanitizations.forEach((function(r){return r.exec(e,t)}))};e.prototype.exec=function(e,t){var r=this;var n=this._getDataCopy(e);if(!n){return true}if(this._index!=="*"){n.tip=n.parentArray[n.currentIndex];return this._executeSanitizations(n,t)}n.parentArray.forEach((function(e,i){n.tip=e;n.currentIndex=i;r._executeSanitizations(n,t)}))};return e}();t.ArrayWrapper=i}));p(qg);var jg=v((function(e,t){var r=h&&h.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});var n=r(ao);var i=r(cy);var a=function(){function e(e,t,r,n){this._field=e;this._dotPath=t;this._sanitizations=[];this._computeSanitizations(n,r)}e.prototype._computeSanitizations=function(e,t){this._sanitizations=t.map((function(t){var r=e[t.name];if(!r){throw new Error(t.name+" is not a registered as a sanitization")}if(typeof r.sanitize!=="function"){throw new Error(t.name+" is missing sanitize function")}if(typeof r.compile==="function"){t.args=r.compile(t.args)}return{rule:t,fn:r.sanitize}}))};e.prototype._getDataCopy=function(e){var t;var r=this._dotPath.length?n.default(e.tip,this._dotPath):e.tip;return Object.assign({},e,{tip:this._field==="::tip::"?(t={},t[this._field]=r,t):r})};e.prototype.exec=function(e,t){var r=this;var n=this._getDataCopy(e);if(!i.default(n.tip)){return true}this._sanitizations.forEach((function(e){e.fn(n,r._field,e.rule.args,t)}))};return e}();t.SanitizationsRunner=a}));p(jg);var Bg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){this._sanitizations=t;this._parsedSchema=sy.rulesParser(e)}e.prototype.compile=function(){var e=this;return new fy.TreeWalker((function(t,r,n,i){return new jg.SanitizationsRunner(t,i,n,e._sanitizations)}),(function(e,t,r,n){return new qg.ArrayWrapper(t,e,r,n)})).walk(this._parsedSchema)};return e}();t.Compiler=r}));p(Bg);var Ug=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e){this._fns=e}e.prototype.exec=function(e,t){var r={tip:e,original:e};this._fns.forEach((function(e){return e.exec(r,t)}));return e};return e}();t.Executor=r}));p(Ug);var Wg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.ValidatorCompiler=hy.Compiler;t.ValidatorExecutor=Vg.Executor;t.SanitizerCompiler=Bg.Compiler;t.SanitizerExecutor=Ug.Executor}));p(Wg);var zg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(){this._cache=new Map}e.prototype.set=function(e,t){this._cache.set(e,t)};e.prototype.get=function(e){return this._cache.get(e)};return e}();t.CacheManager=r}));p(zg);var Qg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(){this.errors=[]}e.prototype.addError=function(e,t,r){var n="";var i=r;if(e instanceof Error){n=e.message;i="ENGINE_EXCEPTION"}else{n=e}this.errors.push({message:n,validation:i,field:t})};e.prototype.toJSON=function(){return this.errors.length?this.errors:null};return e}();t.VanillaFormatter=r}));p(Qg);var Kg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(){this.errors=[]}e.prototype.addError=function(e,t,r,n){var i="";var a=r;if(e instanceof Error){i=e.message;a="ENGINE_EXCEPTION"}else{i=e}this.errors.push({source:{pointer:t},title:a,detail:i,meta:{args:n}})};e.prototype.toJSON=function(){return this.errors.length?{errors:this.errors}:null};return e}();t.JsonApiFormatter=r}));p(Kg);var Gg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.VanillaFormatter=Qg.VanillaFormatter;t.JsonApiFormatter=Kg.JsonApiFormatter}));p(Gg);var Hg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.config={existyStrict:false,formatter:Gg.VanillaFormatter,removeAdditional:false}}));p(Hg);var Yg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=new zg.CacheManager;function n(e,t,n){if(!n.cacheKey){var i=new Wg.ValidatorCompiler(e,t,ty.validations);return new Wg.ValidatorExecutor(i.compile())}var a=r.get(n.cacheKey);if(!a){var i=new Wg.ValidatorCompiler(e,t,ty.validations);r.set(n.cacheKey,i.compile())}return new Wg.ValidatorExecutor(r.get(n.cacheKey))}t.validate=function(e,t,r,i){i=Object.assign({},Hg.config,i);return n(t,r||{},i).exec(e,i.formatter,i,true,i.removeAdditional)};t.validateAll=function(e,t,r,i){i=Object.assign({},Hg.config,i);return n(t,r||{},i).exec(e,i.formatter,i,false,i.removeAdditional)}}));p(Yg);var $g=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e){Object.assign(Hg.config,e)}t.configure=r;r.DEFAULTS=Object.assign({},Hg.config)}));p($g);var Xg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.validations={above:function(e){var t=e[0];return{name:"above",args:[t]}},accepted:function(){return{name:"accepted",args:[]}},alpha:function(){return{name:"alpha",args:[]}},alphaNumeric:function(){return{name:"alphaNumeric",args:[]}},array:function(){return{name:"array",args:[]}},boolean:function(){return{name:"boolean",args:[]}},confirmed:function(){return{name:"confirmed",args:[]}},different:function(e){return{name:"different",args:e||[]}},email:function(){return{name:"email",args:[]}},endsWith:function(e){return{name:"endsWith",args:e||[]}},equals:function(e){return{name:"equals",args:e||[]}},in:function(e){return{name:"in",args:e||[]}},includes:function(e){return{name:"includes",args:e||[]}},integer:function(){return{name:"integer",args:[]}},float:function(){return{name:"float",args:[]}},ip:function(){return{name:"ip",args:[]}},ipv4:function(){return{name:"ipv4",args:[]}},ipv6:function(){return{name:"ipv6",args:[]}},json:function(){return{name:"json",args:[]}},max:function(e){return{name:"max",args:e||[]}},min:function(e){return{name:"min",args:e||[]}},notEquals:function(e){return{name:"notEquals",args:e||[]}},notIn:function(e){return{name:"notIn",args:e||[]}},number:function(){return{name:"number",args:[]}},object:function(){return{name:"object",args:[]}},range:function(e){return{name:"range",args:e||[]}},regex:function(e){return{name:"regex",args:e||[]}},required:function(){return{name:"required",args:[]}},requiredIf:function(e){return{name:"requiredIf",args:e||[]}},requiredWhen:function(e){return{name:"requiredWhen",args:e||[]}},requiredWithAll:function(e){return{name:"requiredWithAll",args:e||[]}},requiredWithAny:function(e){return{name:"requiredWithAny",args:e||[]}},requiredWithoutAll:function(e){return{name:"requiredWithoutAll",args:e||[]}},requiredWithoutAny:function(e){return{name:"requiredWithoutAny",args:e||[]}},same:function(e){return{name:"same",args:e||[]}},startsWith:function(e){return{name:"startsWith",args:e||[]}},string:function(){return{name:"string",args:[]}},subset:function(e){return{name:"subset",args:e||[]}},under:function(e){return{name:"under",args:e||[]}},url:function(){return{name:"url",args:[]}},after:function(e){return{name:"after",args:e||[]}},before:function(e){return{name:"before",args:e||[]}},date:function(){return{name:"date",args:[]}},dateFormat:function(e){return{name:"dateFormat",args:e||[]}},beforeOffsetOf:function(e){return{name:"beforeOffsetOf",args:e||[]}},afterOffsetOf:function(e){return{name:"afterOffsetOf",args:e||[]}}}}));p(Xg);var Jg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e,t){ty.validations[e]=t;Xg.validations[e]=function t(r){return{name:e,args:r||[]}}}t.extend=r}));p(Jg);var Zg=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.validate=Yg.validate;t.validateAll=Yg.validateAll;t.configure=$g.configure;t.extend=Jg.extend;t.validations=Xg.validations}));p(Zg);var eb=Zg.validate;var tb=Zg.extend;var rb=Zg.validations;var nb=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=new zg.CacheManager;function n(e,t){if(!t.cacheKey){var n=new Wg.SanitizerCompiler(e,ty.sanitizations);return new Wg.SanitizerExecutor(n.compile())}var i=r.get(t.cacheKey);if(!i){var n=new Wg.SanitizerCompiler(e,ty.sanitizations);r.set(t.cacheKey,n.compile())}return new Wg.SanitizerExecutor(r.get(t.cacheKey))}t.sanitize=function(e,t,r){r=r||{};return n(t,r).exec(e,r)}}));p(nb);var ib=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.sanitizations={escape:function(){return{name:"escape",args:[]}},lowerCase:function(e){return{name:"lowerCase",args:e||[]}},normalizeEmail:function(e){return{name:"normalizeEmail",args:e||[]}},plural:function(){return{name:"plural",args:[]}},singular:function(){return{name:"singular",args:[]}},slug:function(){return{name:"slug",args:[]}},stripLinks:function(){return{name:"stripLinks",args:[]}},stripTags:function(e){return{name:"stripTags",args:e||[]}},trim:function(){return{name:"trim",args:[]}},upperCase:function(e){return{name:"upperCase",args:e||[]}}}}));p(ib);var ab=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});function r(e,t){ty.sanitizations[e]=t;ib.sanitizations[e]=function t(r){return{name:e,args:r||[]}}}t.extend=r}));p(ab);var ob=v((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.sanitize=nb.sanitize;t.extend=ab.extend;t.sanitizations=ib.sanitizations}));p(ob);var sb=ob.sanitize;var ub=ob.sanitizations;tb("phone",{async:false,compile:function(e){return e},validate:function(e){return e.original.message.replace(/ +/g,"").match(/^[0-9]*$/)}});var cb={email:function(){return[rb.email()]},number:function(e){var t=e.min,r=e.max,n=e.integer;var i=[rb.number()];if(n){i.push(rb.integer())}if(t){i.push(rb.min(t))}if(r){i.push(rb.max(r))}return i},phone:function(){return[rb["phone"]()]}};var lb=function(){return[rb.required()]};var fb=function(){return[ub.trim()]};var hb=function(e,t,r){if(r===void 0){r={required:true,min:null,max:null,integer:false}}return __awaiter_1(a,void 0,void 0,(function(){var n,i,a;return __generator_1(this,(function(o){n={message:t};i=__spreadArrays_1(fb());if(e==="email"){i.push(ub.normalizeEmail())}sb(n,{message:i});a=[];if(r.required){a=__spreadArrays_1(a,lb())}if(cb[e]){a=__spreadArrays_1(a,cb[e](r))}return[2,eb(n,{message:a})]}))}))};var db=e("fontumibots_chat_input",function(){function e(e){var n=this;t(this,e);this.validMessage=true;this.handleInput=function(e){return n.message=e.target.value};this.handleKeyPress=function(e){return e.key=="enter"||e.key=="Enter"?n.sendMessage():n.validMessage=true};this.sendMessageEvent=r(this,"sendMessage",7)}e.prototype.sendMessage=function(){return __awaiter_1(this,void 0,void 0,(function(){var e;return __generator_1(this,(function(t){switch(t.label){case 0:t.trys.push([0,2,,3]);return[4,hb(this.type,this.message)];case 1:t.sent();this.sendMessageEvent.emit(this.message);this.message="";return[3,3];case 2:e=t.sent();console.log(e);this.validMessage=false;return[3,3];case 3:return[2]}}))}))};e.prototype.render=function(){var e=this;var t=function(){switch(e.type){case"email":{return n("input",{id:"fontumibots-chat-container-input",class:{"uk-input uk-text-center":true,"uk-form-danger":!e.validMessage},type:"email",placeholder:"E-Mail",value:e.message,onInput:e.handleInput,onKeyPress:e.handleKeyPress})}case"number":{return n("input",{id:"fontumibots-chat-container-input",class:{"uk-input uk-text-center":true,"uk-form-danger":!e.validMessage},type:"number",min:e.props["min"].value,max:e.props["max"].value,placeholder:"Respuesta numrica",value:e.message,onInput:e.handleInput,onKeyPress:e.handleKeyPress})}case"phone":{return n("input",{id:"fontumibots-chat-container-input",class:{"uk-input uk-text-center":true,"uk-form-danger":!e.validMessage},type:"tel",placeholder:"Nmero de celular",minLength:5,maxlength:13,value:e.message,onInput:e.handleInput,onKeyPress:e.handleKeyPress})}case"yesno":{return n("div",{class:"uk-flex uk-flex-center"},n("button",{class:"uk-button uk-button-secondary",onClick:function(){e.message="Si";e.sendMessage()}},"S"),n("button",{class:"uk-button uk-margin-left uk-button-danger",onClick:function(){e.message="No";e.sendMessage()}},"No"))}}return n("input",{id:"fontumibots-chat-container-input",class:{"uk-input uk-text-center":true,"uk-form-danger":!e.validMessage},type:"text",placeholder:"Enviar un mensaje...",value:e.message,onInput:e.handleInput,onKeyPress:e.handleKeyPress})};return n("div",{class:"uk-margin"},n("div",{class:"uk-inline"},t()))};return e}());var pb=e("fontumibots_icon_call",function(){function e(e){t(this,e);this.fill="white"}e.prototype.render=function(){return n("svg",{fill:this.fill,width:30,height:30,version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 481.168 481.168",style:{"enable-background":"new 0 0 481.168 481.168;"}},n("g",null,n("path",{d:"M410.639,70.5c-94-94-246.3-94-340.2,0c-90.4,90.4-93.8,235-10.1,329.5l2.5,2c-9.1,19.6-24.7,43.8-49.5,56\r\n\t\tc-8.2,4-6.3,16.2,2.7,17.6c27.1,4.2,66-0.5,102.3-27.9l0.5,0.4c92.2,54.2,212.8,41.8,292-37.4\r\n\t\tC504.639,316.8,504.639,164.4,410.639,70.5z M319.839,343.5c-5.3,5.4-10.9,10.4-15.9,16c-7.3,8.2-16.5,10.8-26.9,10.2\r\n\t\tc-15.2-0.8-29.3-5.9-42.8-12.5c-30.1-14.6-55.8-34.9-77.3-60.5c-15.9-18.9-29-39.5-37.7-62.8c-4.2-11.3-7.2-22.8-6.3-35\r\n\t\tc0.6-7.5,3.4-13.9,8.9-19.2c6-5.7,11.6-11.6,17.5-17.4c7.7-7.6,17.3-7.5,25,0c4.8,4.7,9.4,9.4,14.1,14.1c4.6,4.6,9.2,9.1,13.7,13.7\r\n\t\tc8,8.1,8,17.5,0,25.6c-5.7,5.8-11.4,11.6-17.3,17.2c-1.5,1.5-1.7,2.7-0.9,4.6c3.8,9.2,9.4,17.4,15.6,25\r\n\t\tc12.5,15.4,26.7,29.1,43.7,39.7c3.6,2.3,7.6,3.9,11.4,6c1.9,1.1,3.3,0.7,4.8-0.9c5.7-5.9,11.6-11.7,17.4-17.5\r\n\t\tc7.7-7.6,17.3-7.6,24.9,0c9.4,9.3,18.7,18.6,28,28C327.739,326,327.739,335.6,319.839,343.5z M231.139,188.1l3-21.4\r\n\t\tc20.7,2.9,39.5,12.3,54.3,27.1c14.1,14.1,23.3,31.8,26.6,51.3l-21.3,3.7c-2.6-15.1-9.7-28.8-20.6-39.7\r\n\t\tC261.639,197.6,247.139,190.3,231.139,188.1z M349.839,245.1c-4.8-28-18-53.4-38.1-73.6c-21.2-21.2-48.1-34.6-77.8-38.8l3-21.4\r\n\t\tc34.3,4.8,65.5,20.3,90,44.9c23.3,23.3,38.6,52.8,44.2,85.2L349.839,245.1z"})),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null))};return e}());var vb=e("fontumibots_icon_close",function(){function e(e){t(this,e);this.height=30;this.width=30;this.fill="black"}e.prototype.render=function(){return n("svg",{xmlns:"http://www.w3.org/2000/svg",width:this.width,height:this.height,fill:this.fill,viewBox:"0 0 17 17",style:{marginTop:"-4px"}},n("path",{d:"M9.207 8.5l6.646 6.646-.707.707L8.5 9.207l-6.646 6.646-.707-.707L7.793 8.5 1.146 1.854l.707-.707L8.5 7.793l6.646-6.646.707.707L9.207 8.5z"}))};return e}());var mb=e("fontumibots_icon_end_call",function(){function e(e){t(this,e);this.fill="white"}e.prototype.render=function(){return n("svg",{width:30,height:30,fill:this.fill,version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 318.454 318.454",style:{"enable-background":"new 0 0 318.454 318.454;"}},n("g",null,n("g",null,n("g",null,n("path",{fill:this.fill,d:"M312.169,256.07l-50.241-50.279c-3.927-3.905-9.377-6.054-15.354-6.054\r\n                                c-6.309,0-12.379,2.458-16.676,6.755l-27.168,27.163l-7.343-4.068c-16.143-8.953-38.258-21.229-61.619-44.617\r\n                                c-23.448-23.421-35.729-45.59-44.715-61.799l-4.009-7.136l27.201-27.201c9.002-9.029,9.306-23.393,0.68-32.042L62.662,6.542\r\n                                c-3.905-3.905-9.361-6.065-15.333-6.065c-6.298,0-12.374,2.464-16.676,6.772L18.307,19.661l-1.153,1.893\r\n                                c-4.596,5.891-8.36,12.521-11.166,19.733c-2.611,6.88-4.242,13.413-4.993,19.967C-5.489,115.111,19.351,164.557,86.73,231.92\r\n                                c79.856,79.851,146.588,86.057,165.141,86.057c3.182,0,5.102-0.174,5.635-0.228c6.864-0.832,13.418-2.486,20.038-5.053\r\n                                c7.142-2.785,13.75-6.516,19.619-11.112l2.812-2.208l11.547-11.324C320.507,279.055,320.795,264.707,312.169,256.07z"})),n("g",null,n("polygon",{fill:this.fill,points:"229.484,115.339 278.022,66.812 258.969,47.732 210.42,96.275 161.893,47.737 142.823,66.806 191.351,115.339 142.813,163.877 161.904,182.925 210.42,134.409 258.942,182.925 278.033,163.877"})))),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null),n("g",null))};return e}());var yb=e("fontumibots_icon_messages",function(){function e(e){t(this,e);this.height=30;this.width=30;this.fill="black"}e.prototype.render=function(){return n("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:this.width,height:this.height,fill:this.fill,viewBox:"0 0 96.000000 96.000000",preserveAspectRatio:"xMidYMid meet",style:{marginTop:"-4px"}},n("g",{transform:"translate(0.000000,96.000000) scale(0.100000,-0.100000)",fill:this.fill,stroke:"none"},n("path",{d:"M105 855 l-25 -24 0 -278 0 -277 63 62 63 62 212 0 c283 0 262 -19 262 240 0 189 0 191 -25 215 l-24 25 -251 0 -251 0 -24 -25z"}),n("path",{d:"M720 569 c0 -197 -16 -209 -269 -209 l-171 0 0 -55 c0 -46 4 -60 25 -80 l24 -25 218 0 217 0 58 -57 58 -57 0 272 0 273 -25 24 c-20 21 -34 25 -80 25 l-55 0 0 -111z"})))};return e}());var gb=e("fontumibots_widget",function(){function e(e){var r=this;t(this,e);this.opened=false;this.error=true;this.phoneReady=false;this.toggle=function(){return r.opened=!r.opened};this.toggleAndCall=function(){if(r.phoneReady){r.widgetElement.shadowRoot.querySelector("fontumibots-chat-container").callOutside()}r.toggle()}}e.prototype.componentWillLoad=function(){return __awaiter_1(this,void 0,void 0,(function(){var e,t,r,n,i;var a=this;return __generator_1(this,(function(o){r=function(e){return __awaiter_1(a,void 0,void 0,(function(){var t=this;return __generator_1(this,(function(r){switch(r.label){case 0:if(!(e.on&&e.login&&e.password&&e.to))return[3,2];return[4,ki(e)];case 1:r.sent();Ci.onRegistered=function(){return t.phoneReady=true};r.label=2;case 2:return[2]}}))}))};n=document.createElement("script");i=document.createElement("script");i.src="//www.fontumi.co/cdn/fontumi-sdk/1.0.0/plugins.webrtc.min.js";n.src="//www.fontumi.co/cdn/fontumi-sdk/1.0.0/main.js";return[2,new Promise((function(o,s){return __awaiter_1(a,void 0,void 0,(function(){var a,u,c,l,f,h,d,p,v,m;return __generator_1(this,(function(y){switch(y.label){case 0:y.trys.push([0,2,,3]);return[4,Di("bots")(this.botId)];case 1:a=y.sent();if(a.exists){u=a.data(),c=u.name,l=u.email,f=u.description,h=u.escene,d=u.user_id,p=u.colors,v=u.sip;i.onload=function(){e=true;return e&&t&&r(v)};n.onload=function(){t=true;return e&&t&&r(v)};this.bot={name:c,email:l,description:f,escene:h,user_id:d,colors:p,sip:v};this.error=false;document.head.appendChild(n);document.head.appendChild(i);return[2,o()]}return[3,3];case 2:m=y.sent();return[2,s(m)];case 3:return[2,s("FONTUMIBOT: Bot with id: "+this.botId+" doesnt exists.")]}}))}))}))]}))}))};e.prototype.render=function(){return this.error?n("div",null):n("div",{id:"fontumibots-widget"},n("fontumibots-chat-container",{style:{visibility:this.opened?"visible":"hidden",padding:"10px"},bot:this.bot,phoneReady:this.phoneReady}),n("div",{id:"fontumibots-buttons-container"},n("fontumibots-bubble-button",{onToggled:this.toggleAndCall,style:{display:this.opened&&this.bot.sip.on?"none":this.phoneReady?"flex":"none"},color:this.bot.colors.a,icon:"call"}),n("fontumibots-bubble-button",{onToggled:this.toggle,style:{display:this.opened?"none":"flex"},color:this.bot.colors.a,icon:"message"}),n("fontumibots-bubble-button",{style:{display:!this.opened?"none":"flex"},onToggled:this.toggle,color:this.bot.colors.a,icon:"close"})))};Object.defineProperty(e.prototype,"widgetElement",{get:function(){return i(this)},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return"\@import url(\"https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.5/css/uikit.min.css\");:host{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:16px;font-weight:400;line-height:1.5;-webkit-text-size-adjust:100%;background:#fff;color:#666;--fontumibots-border:3px;--fontumibots-z-index:99999999;--fontumibots-shadow:0 5px 15px rgba(0,0,0,0.08);--fontumibots-chat-borders:25px;--fontumibots-color-a:red;--fontumibots-color-b:#00f}#fontumi-widget{position:fixed;z-index:99999}#fontumibots-buttons-container{position:fixed;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;bottom:var(--fontumibots-chat-borders);right:var(--fontumibots-chat-borders);z-index:var(--fontumibots-z-index)}"},enumerable:true,configurable:true});return e}())}}}));